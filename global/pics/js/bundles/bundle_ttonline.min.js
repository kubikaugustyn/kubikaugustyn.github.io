"use strict";ASC.loadBundle("dbi"),ASC.loadBundle("subst"),ASC.setModuleSourceFunc("/timetable/app/online.js",function(a,require,t){a.__esModule=!0;var d=require("tslib"),o=require("react"),l=require("./rozview"),u=require("./tview"),i=require("./print"),e=require("./gendlgs"),c=require("./rokobject");require("./import");var p,n,m=require("./dlg"),h=require("../../asc/asc_react"),_=require("../../asc/edurequest"),f=require("../../asc/actions"),v=require("./gener"),r=require("./server/generator"),s=require("../../asc/asc_react2"),b=require("./lesson_dlg"),g=require("./test");function T(t){t||ASC.logProblem("9576331351",t)}(n=p=p||{})[n.KONTROLAMODE_VYPNUTA=0]="KONTROLAMODE_VYPNUTA",n[n.KONTROLAMODE_KONTROLA=1]="KONTROLAMODE_KONTROLA",n[n.KONTROLAMODE_PODMIENKY=2]="KONTROLAMODE_PODMIENKY",n[n.KONTROLAMODE_CHANGE=3]="KONTROLAMODE_CHANGE",n[n.KONTROLAMODE_RUCNEINFO=4]="KONTROLAMODE_RUCNEINFO",n[n.KONTROLAMODE_PO_RIES=5]="KONTROLAMODE_PO_RIES",n[n.KONTROLAMODE_ADVISOR=6]="KONTROLAMODE_ADVISOR",a.startTTOnline=function(e,i){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(t){switch(t.label){case 0:return[4,ASC.loadTTLang()];case 1:return t.sent(),new y(e).Sync(i),[2]}})})},a.farby=[];var y=(k.prototype.checkPurchased=function(){return d.__awaiter(this,void 0,void 0,function(){var e,i=this;return d.__generator(this,function(t){switch(t.label){case 0:return this.jsc.unregistered?(e=_.client_req,[4,h.RDialog.show(o.createElement(h.RDialog,{width:400,buttons:[{label:e.ttls(2797),type:"green",onClick:function(){return d.__awaiter(i,void 0,void 0,function(){return d.__generator(this,function(t){switch(t.label){case 0:return[4,Promise.resolve().then(function(){return require("../../asc/purchase")})];case 1:return[4,t.sent().showPurchaseEdupage()];case 2:return[2,t.sent()]}})})}},"cancel"]},o.createElement(s.DlgHeader,{title:e.ttls(2061),small:!0,icon:"/timetable/pics/app/office/purchase_32.png"}),o.createElement("div",null,e.ls(2016))))]):[2,!0];case 1:return t.sent(),[2,!1]}})})},k.prototype.trackEvent=function(t,e){if(!this.ttviewer){var i=window.ga;i&&("App"==t&&"initialized"==e?(i("ttonlineTracker.send","pageview"),i("ttonlineTracker.send","event",t,e,null,null,{nonInteraction:!0})):i("ttonlineTracker.send","event",t,e))}},k.prototype.InitRibbon_back=function(t){var e=this;new ASC.ui.RibbonButton(t,ASC.ls(1748),I.GetImage("back_32"),function(){e.ribbonMenu.select("main")})},k.prototype.InitRibbon_file=function(t,e){var i=this;new ASC.ui.RibbonButton(t,ASC.ls(6133),I.GetImage("file_new_32"),function(){i.ClickNew()}),new ASC.ui.RibbonButton(t,ASC.ls(6370),I.GetImage("open_32"),function(){i.click_func("open")}),"file"==e&&this.InitRibbon_close(t),new ASC.ui.RibbonButton(t,ASC.ttls(2577),I.GetImage("save_32"),null,{menu:[{text:ASC.escapeHTML(ASC.ttls(2577)),onclick:function(){i.click_func("save")}},{text:ASC.escapeHTML(ASC.ttls(1589).replace("&","")),onclick:function(){i.click_func("save","saveas=1")}}]})},k.prototype.InitRibbon_demos=function(t){var e=this;new ASC.ui.RibbonButton(t,ASC.ttls(3045),I.GetImage("demofiles_32"),function(){e.click_func("demos")})},k.prototype.InitRibbon_feedback=function(t){var e=this;new ASC.ui.RibbonButton(t,ASC.ls(1593),I.GetImage("help_32"),function(){e.click_func("feedback")})},k.prototype.InitRibbon_close=function(t){var e=this;new ASC.ui.RibbonButton(t,ASC.ls(1567),I.GetImage("close_32"),function(){e.click_func("close")})},k.prototype.InitRibbon=function(){var t,e,i=this,l=_.client_req;if(!this.ttviewer){if(t=this.ribbonMenu.addRibbon("main",ASC.ttls(3222).replace("&","")),e=new ASC.ui.RibbonGroup(t),this.InitRibbon_file(e,"main"),this.jsc.ttfeedbackid&&new ASC.ui.RibbonButton(e,"FEEDBACK info",I.GetImage("print_preview_32"),function(){i.click_func("ttfeedback")},{}),new ASC.ui.RibbonButton(e,ASC.ttls(3351),I.GetImage("print_preview_32"),function(){i.ClickPrintPreview()},{cmd:"printpreview"}),e=new ASC.ui.RibbonGroup(t),this.$rg_pohlad_div=$j(e.addDiv()).css("margin-top","2px"),e=new ASC.ui.RibbonGroup(t),["subjects","classes","classrooms","teachers"].forEach(function(t){new ASC.ui.RibbonButton(e,I.GetTableName(t),I.GetTableIcon(t),function(){i.ZrusKontrolu(),i.click_func("zadanie","table="+t)})}),e=new ASC.ui.RibbonGroup(t),new ASC.ui.RibbonButton(e,ASC.ttls(3263)+"\n(beta)",I.GetImage("seminar_32"),function(){return d.__awaiter(i,void 0,void 0,function(){var e=this;return d.__generator(this,function(t){switch(t.label){case 0:return 0!=this.m_pRok.TableObjects("students").length?[3,2]:[4,h.RDialog.showConfirm(o.createElement(o.Fragment,null,o.createElement("h1",null,ASC.ttls(2610)),o.createElement("span",{style:{whiteSpace:"pre-wrap"}},ASC.ttls(3258)+" "+ASC.ttls(3259),": ",o.createElement("a",{onClick:function(){return e.ShowHelp("seminarsdialog")},style:{cursor:"pointer"}},ASC.ttls(3263)))),{buttons:[{label:ASC.ttls(3260),action:"ok",type:"green"},"cancel"],width:400})];case 1:if(!t.sent())return[2];t.label=2;case 2:return[4,Promise.resolve().then(function(){return require("./students_dlg")})];case 3:return t.sent().showStudentsDlg(this.ttgpid),[2]}})})}),new ASC.ui.RibbonButton(e,ASC.ttls(2614),I.GetImage("relation_32"),function(){i.ZrusKontrolu(),i.click_func("cardrelationships")}),e=new ASC.ui.RibbonGroup(t),new ASC.ui.RibbonButton(e,ASC.ttls(2047),I.GetImage("test_32"),function(){i.ClickTest()}),new ASC.ui.RibbonButton(e,ASC.ttls(1090),I.GetImage("gener_32"),function(){i.ZrusKontrolu(),i.ClickGenerate()}),new ASC.ui.RibbonButton(e,ASC.ttls(1616),I.GetImage("verification_32"),function(){i.ClickVerification("verification")},{cmd:"verification"}),e=new ASC.ui.RibbonGroup(t),new ASC.ui.RibbonButton(e,ASC.ttls(3148),I.GetImage("school_32"),function(){i.ZrusKontrolu(),i.click_func("school","")}),e=new ASC.ui.RibbonGroup(t),this.InitRibbon_feedback(e),e=new ASC.ui.RibbonGroup(t),!ASC.ascdebug&&"ascpalo"!=ASC.edupage||(this.m_pSync.$debug=$j(e.addDiv())),e=new ASC.ui.RibbonGroup(t,{right:!0}),this.InitRibbon_close(e),t=this.ribbonMenu.addRibbon("files",ASC.ttls(1572).replace("&","")),e=new ASC.ui.RibbonGroup(t),this.InitRibbon_back(e),e=new ASC.ui.RibbonGroup(t),this.InitRibbon_file(e,"file"),this.InitRibbon_demos(e),e=new ASC.ui.RibbonGroup(t),this.jsc.import_menu&&new ASC.ui.RibbonButton(e,ASC.ls(1422),I.GetImage("import_32"),null,{menu:this.jsc.import_menu}),this.jsc.export_menu){var c=this.jsc.export_menu;new ASC.ui.RibbonButton(e,ASC.ls(1701),I.GetImage("export_32"),null,{menu:c}),d.__awaiter(i,void 0,void 0,function(){var s,e,i,n,r,o,a=this;return d.__generator(this,function(t){switch(t.label){case 0:return[4,Promise.resolve().then(function(){return require("./server/export")})];case 1:return[4,(s=t.sent()).availableXmlExports(null)];case 2:for(e=t.sent(),c.push([]),i=function(n){c.push({text:n.name,onclick:function(){ASC.blockUI(function(){return d.__awaiter(a,void 0,void 0,function(){var e,i;return d.__generator(this,function(t){switch(t.label){case 0:return i=(e=window).open,[4,s.xmlExportDownloadLink(null,this.ttgpid,n.id)];case 1:return i.apply(e,[t.sent(),"_blank"]),[2]}})})})}})},n=0,r=e;n<r.length;n++)o=r[n],i(o);return c.push([]),c.push({text:"GP-Untis DIF ("+ASC.ls(1001)+")",onclick:function(){ASC.blockUI(function(){return d.__awaiter(a,void 0,void 0,function(){var e,i;return d.__generator(this,function(t){switch(t.label){case 0:return i=(e=window).open,[4,Promise.resolve().then(function(){return require("../../exports/de/server/untis_DIF")})];case 1:return[4,t.sent().untisDIFExportDownloadLink(null,this.ttgpid)];case 2:return i.apply(e,[t.sent(),"_self"]),[2]}})})})}}),c.push({text:"Atlantis (STDPLAN) - beta",onclick:function(){ASC.blockUI(function(){return d.__awaiter(a,void 0,void 0,function(){var e,i;return d.__generator(this,function(t){switch(t.label){case 0:return i=(e=window).open,[4,Promise.resolve().then(function(){return require("../../exports/de/server/atlantis_stdplan")})];case 1:return[4,t.sent().atlantisSTDPLANExportDownloadLink(null,this.ttgpid)];case 2:return i.apply(e,[t.sent(),"_self"]),[2]}})})})}}),0<=["ascpalo","gsg-waldkirch-test","schillertest2"].indexOf(l.edupage)&&c.push({text:"ASV - Stundenplanprogramm->ASV",onclick:function(){return d.__awaiter(a,void 0,void 0,function(){return d.__generator(this,function(t){switch(t.label){case 0:return[4,Promise.resolve().then(function(){return require("../../exports/de_bw/asv_stdplan")})];case 1:return[2,t.sent().showExportStdplan(this.ttgpid)]}})})}}),["ascpalo","greenfieldsch"].includes(l.edupage)&&c.push({text:"(aSc) "+l.ttls(1079)+" (*.roz)",onclick:function(){ASC.blockUI(function(){return d.__awaiter(a,void 0,void 0,function(){var e,i;return d.__generator(this,function(t){switch(t.label){case 0:return i=(e=window).open,[4,Promise.resolve().then(function(){return require("./server/generator")})];case 1:return[4,t.sent().rozExportDownloadLink(null,this.ttgpid)];case 2:return i.apply(e,[t.sent(),"_blank"]),[2]}})})})}}),[2]}})})}new ASC.ui.RibbonButton(e,ASC.ttls(2819),I.GetImage("compare_32"),null,{menu:[{text:ASC.ttls(2820),onclick:function(){return d.__awaiter(i,void 0,void 0,function(){return d.__generator(this,function(t){switch(t.label){case 0:return[4,Promise.resolve().then(function(){return require("./compare")})];case 1:return t.sent().showCompareDoc(this),[2]}})})}},{text:ASC.ttls(2821),onclick:function(){return d.__awaiter(i,void 0,void 0,function(){return d.__generator(this,function(t){switch(t.label){case 0:return[4,Promise.resolve().then(function(){return require("./compare")})];case 1:return t.sent().showCompareDoc(this,!0),[2]}})})}}]}),e=new ASC.ui.RibbonGroup(t),new ASC.ui.RibbonButton(e,ASC.ttls(3351),I.GetImage("print_preview_32"),function(){i.ClickPrintPreview()},{cmd:"printpreview"}),t=this.ribbonMenu.addRibbon("specification",ASC.ttls(1598).replace("&","")),e=new ASC.ui.RibbonGroup(t),this.InitRibbon_back(e),e=new ASC.ui.RibbonGroup(t),new ASC.ui.RibbonButton(e,ASC.ttls(1599),I.GetImage("wizard_32"),function(){i.ZrusKontrolu(),i.click_func("wizard","")}),e=new ASC.ui.RibbonGroup(t),new ASC.ui.RibbonButton(e,ASC.ttls(3148),I.GetImage("school_32"),function(){i.ZrusKontrolu(),i.click_func("school","")}),["subjects","classes","classrooms","teachers"].forEach(function(t){new ASC.ui.RibbonButton(e,I.GetTableName(t),I.GetTableIcon(t),function(){i.ZrusKontrolu(),i.click_func("zadanie","table="+t)})}),e=new ASC.ui.RibbonGroup(t),new ASC.ui.RibbonButton(e,ASC.ttls(2614),I.GetImage("relation_32"),function(){i.ZrusKontrolu(),i.click_func("cardrelationships")}),new ASC.ui.RibbonButton(e,ASC.ttls(3719),I.GetImage("constraints_32"),function(){i.ClickVerification("listconstraints")},{cmd:"listconstraints"}),e=new ASC.ui.RibbonGroup(t),new ASC.ui.RibbonButton(e,I.GetTableName("lessons"),I.GetTableIcon("lessons"),function(){i.ZrusKontrolu(),b.showLessonsDlg(i.ttgpid)}),t=this.ribbonMenu.addRibbon("view",ASC.ttls(1149).replace("&","")),e=new ASC.ui.RibbonGroup(t),this.InitRibbon_back(e),e=new ASC.ui.RibbonGroup(t),new ASC.ui.RibbonButton(e,I.StripStringTab(ASC.ttls(2629)),I.GetImage("undo_32"),function(){i.click_func("undo")},{mini:!1,id:"undo"}),new ASC.ui.RibbonButton(e,I.StripStringTab(ASC.ttls(2630)),I.GetImage("redo_32"),function(){i.click_func("undo","redo=1")},{mini:!1,id:"redo"}),e=new ASC.ui.RibbonGroup(t),new ASC.ui.RibbonButton(e,I.StripStringTab(ASC.ttls(3117)),I.GetImage("show_tabs_32"),function(){i.m_pPohladSwitcher.SetEnabled(!i.m_pPohladSwitcher.m_bEnabled)}),new ASC.ui.RibbonButton(e,ASC.ttls(2551),I.GetImage("zoom_32"),null,{menu:[{text:"50%",onclick:function(){i.Zoom("50%")}},{text:"100%",onclick:function(){i.Zoom("100%")}},{text:"200%",onclick:function(){i.Zoom("200%")}},[],{text:ASC.ttls(2551)+" +",onclick:function(){i.Zoom("+")}},{text:ASC.ttls(2551)+" -",onclick:function(){i.Zoom("-")}},[],{text:ASC.ttls(2829),onclick:function(){i.Zoom("/")}}]}),e=new ASC.ui.RibbonGroup(t),new ASC.ui.RibbonButton(e,I.StripStringTab(ASC.ttls(3303)),I.GetImage("view_define_32"),function(){i.click_func("edit","table=ttviews&id="+i.m_pTriedyView.m_pAktPohlad.m_Id)}),t=this.ribbonMenu.addRibbon("timetable",ASC.ttls(1502).replace("&","")),e=new ASC.ui.RibbonGroup(t),this.InitRibbon_back(e),e=new ASC.ui.RibbonGroup(t),new ASC.ui.RibbonButton(e,ASC.ttls(2047),I.GetImage("test_32"),function(){i.ClickTest()}),new ASC.ui.RibbonButton(e,ASC.ttls(1090),I.GetImage("gener_32"),function(){i.ClickGenerate()}),new ASC.ui.RibbonButton(e,ASC.ttls(1613),I.GetImage("improve_32"),function(){return d.__awaiter(i,void 0,void 0,function(){return d.__generator(this,function(t){switch(t.label){case 0:return[4,this.checkPurchased()];case 1:return t.sent()&&v.showImprove(this.ttgpid),[2]}})})}),e=new ASC.ui.RibbonGroup(t),new ASC.ui.RibbonButton(e,ASC.ttls(1615),I.GetImage("parameters_32"),function(){i.ZrusKontrolu(),i.click_func("constraints","table=globals&id=1")}),new ASC.ui.RibbonButton(e,ASC.ttls(3719),I.GetImage("constraints_32"),function(){i.ClickVerification("listconstraints")},{cmd:"listconstraints"}),new ASC.ui.RibbonButton(e,ASC.ttls(1616),I.GetImage("verification_32"),function(){return d.__awaiter(i,void 0,void 0,function(){return d.__generator(this,function(t){return this.ClickVerification("verification"),[2]})})},{cmd:"verification"}),e=new ASC.ui.RibbonGroup(t),new ASC.ui.RibbonButton(e,ASC.ttls(1617),I.GetImage("assignclassrooms_32"),function(){i.ZrusKontrolu(),v.showAssignClassrooms(i.ttgpid)}),new ASC.ui.RibbonButton(e,ASC.ttls(1618),I.GetIconLocked(!0),function(){i.ZrusKontrolu(),i.click_func("cards","cmd=lock")}),new ASC.ui.RibbonButton(e,ASC.ttls(1619),I.GetIconLocked(!1),function(){i.ZrusKontrolu(),i.click_func("cards","cmd=unlock")}),new ASC.ui.RibbonButton(e,ASC.ttls(1201),I.GetImage("remove_32"),function(){i.ZrusKontrolu(),i.click_func("cards","cmd=delete")}),t=this.ribbonMenu.addRibbon("options",ASC.ttls(1578).replace("&","")),e=new ASC.ui.RibbonGroup(t),this.InitRibbon_back(e),e=new ASC.ui.RibbonGroup(t),new ASC.ui.RibbonButton(e,ASC.ttls(3148),I.GetImage("school_32"),function(){i.ZrusKontrolu(),i.click_func("school","")}),new ASC.ui.RibbonButton(e,ASC.ttls(2968),"/global/pics/ui/classroom_32.png",function(){i.ZrusKontrolu(),m.showZadanieDiv(i,"buildings")}),e=new ASC.ui.RibbonGroup(t),new ASC.ui.RibbonButton(e,f.action_name("tools"),f.action_icon("tools"),null,{menu:[{text:ASC.ttls(3296),onclick:function(){return d.__awaiter(i,void 0,void 0,function(){return d.__generator(this,function(t){switch(t.label){case 0:return[4,Promise.resolve().then(function(){return require("./tools")})];case 1:return[2,t.sent().showMoveLessonsDlg(this.ttgpid)]}})})}}]}),e=new ASC.ui.RibbonGroup(t),new ASC.ui.RibbonButton(e,ASC.ttls(3316),I.GetImage("settings_basic_32"),function(){i.ZrusKontrolu(),i.click_func("settings","")}),t=this.ribbonMenu.addRibbon("help",ASC.ttls(2634).replace("&","")),e=new ASC.ui.RibbonGroup(t),this.InitRibbon_back(e),e=new ASC.ui.RibbonGroup(t),this.InitRibbon_demos(e),e=new ASC.ui.RibbonGroup(t),new ASC.ui.RibbonButton(e,ASC.ttls(3204),I.GetImage("onlinehelp_32"),function(){window.open("http://help.asctimetables.com/","_blank")}),this.InitRibbon_feedback(e),this.jsc.asc_menu&&(e=new ASC.ui.RibbonGroup(t),new ASC.ui.RibbonButton(e,"ASC tools","/agenda/pics/online/files_back_32.png",null,{menu:d.__spreadArrays(this.jsc.asc_menu,[[],{text:"New dbForGen",onclick:function(){return d.__awaiter(i,void 0,void 0,function(){var e,i;return d.__generator(this,function(t){switch(t.label){case 0:return i=(e=console).log,[4,Promise.resolve().then(function(){return require("./server/generator")})];case 1:return[4,t.sent().ttdocDbForGen(null,this.ttgpid)];case 2:return[2,i.apply(e,[t.sent()])]}})})}}])})),e=new ASC.ui.RibbonGroup(t,{right:!0}),this.InitRibbon_close(e)}if(t=this.ribbonMenu.addRibbon("printpreview",ASC.ttls(3351)),this.ribbonMenu.$labels.printpreview.addClass("special"),this.ribbonMenu.$labels.printpreview.hide(),this.ttviewer||(e=new ASC.ui.RibbonGroup(t),new ASC.ui.RibbonButton(e,ASC.ttls(3349).replace(" ","\n"),I.GetImage("preview_back_32"),function(){i.m_pPrintPreview.PrevPage()},{cmd:"printpreview_prev"}),new ASC.ui.RibbonButton(e,ASC.ttls(3350).replace(" ","\n"),I.GetImage("preview_forward_32"),function(){i.m_pPrintPreview.NextPage()},{cmd:"printpreview_next"})),e=new ASC.ui.RibbonGroup(t),new ASC.ui.RibbonButton(e,ASC.ls(1638).replace(" ","\n"),I.GetImage("printer_32"),function(){i.m_pPrintPreview.Print()}),this.$rg_printpreview_div=$j(e.addDiv()).css("width","250px"),this.ttviewer||(e=new ASC.ui.RibbonGroup(t),new ASC.ui.RibbonButton(e,ASC.ttls(3508),I.GetImage("filter_32"),function(){i.m_pPrintPreview.ClickFilter()}),e=new ASC.ui.RibbonGroup(t),new ASC.ui.RibbonButton(e,ASC.ttls(3343),I.GetImage("preview_global_32"),function(){i.click_func("print_globalsettings","tzid="+i.m_pPrintPreview.m_pTlacZostava.m_Id)}),new ASC.ui.RibbonButton(e,ASC.ttls(3342),I.GetImage("preview_modify_32"),function(){i.click_func("print_structure","tzid="+i.m_pPrintPreview.m_pTlacZostava.m_Id)}),e=new ASC.ui.RibbonGroup(t),new ASC.ui.RibbonButton(e,ASC.ttls(1324),I.GetImage("preview_style_32"),function(){i.click_func("print_style")}),new ASC.ui.RibbonButton(e,ASC.ttls(3345),I.GetImage("preview_sizes_32"),function(){i.click_func("print_sizes","tzid="+i.m_pPrintPreview.m_pTlacZostava.m_Id)}),new ASC.ui.RibbonButton(e,ASC.ttls(3124),I.GetImage("preview_design_32"),function(){i.click_func("print_design","tzid="+i.m_pPrintPreview.m_pTlacZostava.m_Id)}),new ASC.ui.RibbonButton(e,ASC.ttls(3346),I.GetImage("preview_color_32"),function(){i.click_func("print_colors","tzid="+i.m_pPrintPreview.m_pTlacZostava.m_Id)}),e=new ASC.ui.RibbonGroup(t),new ASC.ui.RibbonButton(e,ASC.ttls(3348),I.GetImage("turn_off_32"),function(){i.ZrusPrintPreview()})),this.ttviewer){t=this.ribbonMenu.addRibbon("ttviewer","Timetable viewer (aSc)"),this.ribbonMenu.$labels.ttviewer.addClass("special"),this.ribbonMenu.$labels.ttviewer.hide(),this.ttviewer_ribbon=t,e=new ASC.ui.RibbonGroup(t),new ASC.ui.RibbonButton(e,ASC.ls(1170),I.GetImage("preview_back_32"),function(){i.m_pPrintPreview.PrevPage()},{mini:!0,cmd:"printpreview_prev"}),new ASC.ui.RibbonButton(e,ASC.ls(1171),I.GetImage("preview_forward_32"),function(){i.m_pPrintPreview.NextPage()},{mini:!0,cmd:"printpreview_next"}),this.ttviewer_options.kiosk||new ASC.ui.RibbonButton(e,ASC.ls(1638).replace(" ","\n"),I.GetImage("printer_32"),function(){i.m_pPrintPreview.Print({selected_page:!0})},{mini:!0}),e=new ASC.ui.RibbonGroup(t);for(var n=0,s=["subjects","classes","teachers","classrooms","students"];n<s.length;n++){var r=s[n];new ASC.ui.RibbonButton(e,I.GetTableName(r),I.GetTableIcon(r),null,{menu:[],cmd:"ttviewer_"+r})}e=new ASC.ui.RibbonGroup(t),new ASC.ui.RibbonButton(e,ASC.ls(1250),"/global/pics/ui/summarytt_32.png",null,{menu:[],cmd:"ttviewer_summary"}),this.ttviewer_options.version_menu&&(e=new ASC.ui.RibbonGroup(t),new ASC.ui.RibbonButton(e,this.ttviewer_options.version_menu_label,"/global/pics/ui/ttversion_32.png",null,{menu:this.ttviewer_options.version_menu})),0<=["ascpalo","democz","test-democz","gjj","gvmyto","skolabn","spschrudim","zsnezamyslice","zsbrankovice"].indexOf(_.client_req.edupage)||["de","cz","at","ch","sk"].indexOf(_.client_req.school_country),this.ttviewer_options&&!this.ttviewer_options.kiosk&&(e=new ASC.ui.RibbonGroup(t),new ASC.ui.RibbonButton(e,_.client_req.ls(3964),"/global/pics/ui/try_new_32.svg",function(){return d.__awaiter(i,void 0,void 0,function(){var e,i;return d.__generator(this,function(t){switch(t.label){case 0:switch(i="",_.client_req.lang){case"sk":e=o.createElement("div",null,"DovoÄľte, aby sme vĂˇm predstavili novĂ© zobrazenie rozvrhu. Odteraz v Ĺom neuvidĂ­te len ĹˇtandardnĂ˝ rozvrh, ale aj udalosti, suplovanie a odpadnutĂ© hodiny. Dokonca aj krĂşĹľky a ĹˇkolskĂ˝ klub detĂ­ si viete jednoducho zobraziĹĄ v pohÄľade uÄŤiteÄľ, Ĺľiak, trieda. Tento novĂ˝ pohÄľad postupne nahradĂ­ ten pĂ´vodnĂ˝.",o.createElement("br",null),"TeĹˇĂ­me sa na vaĹˇe postrehy."),i="https://help.edupage.org/text.php?id=3161&lang=sk";break;case"cz":e=o.createElement("div",null,"Dovolte, abychom vĂˇm pĹ™edstavili novĂ© zobrazenĂ­ rozvrhu. OdteÄŹ v nÄ›m neuvidĂ­te jen standardnĂ­ rozvrh, ale i udĂˇlosti, suplovĂˇnĂ­ a odpadlĂ© hodiny. Dokonce i krouĹľky a ĹˇkolnĂ­ klub dÄ›tĂ­ si umĂ­te jednoduĹˇe zobrazit v pohledu uÄŤitel, ĹľĂˇk, tĹ™Ă­da. Tento novĂ˝ pohled postupnÄ› nahradĂ­ ten pĹŻvodnĂ­. ",o.createElement("br",null),"TÄ›ĹˇĂ­me se na vaĹˇe postĹ™ehy."),i="https://help.edupage.org/text.php?id=3161&lang=sk";break;case"de":e=o.createElement("div",null,"Es ist soweit! Wir freuen uns, Ihnen hier unsere neue Stundenplanansicht zu prĂ¤sentieren.",o.createElement("br",null),"Ab sofort sehen Sie nicht nur die Stunden aus dem Stundenplan, sondern auch Termine, Vertretungen und entfallene Stunden. Auch die Interessensgruppen/AGs sehen Sie in der Lehrer-, SchĂĽler und Klassenansicht auf einen Blick. In KĂĽrze wird diese Ansicht die alte Ansicht ersetzen.",o.createElement("br",null),"Wir freuen uns auf Ihr Feedback. (asc@raabe.de)"),i="https://help.edupage.org/text.php?id=3161&lang=de";break;default:e=o.createElement("div",null,"Let us introduce you to the new timetable viewer. From now you will not only be be able to view the standard timetable lessons but also events, substitution or cancelled lessons. Even interest or after-schoool clubs are available in the teacher, student or class view. This new viewer will eventualy replace the original one."),i="https://h.edupage.org/?p=u1/u3/u338/e3161"}return[4,h.RDialog.showConfirm(e,{width:500,footer:i&&(_.client_req.isAdmin()||_.client_req.isUcitel())?o.createElement(h.RButton,{label:f.action_name("help"),onClick:function(){return window.open(i,"_blank")}}):void 0})];case 1:return t.sent()&&(document.location.href="/timetable/current.php"),[2]}})})}))}this.ttviewer&&this.ribbonMenu.$top.hide()},k.prototype.UpdateButtons=function(){},k.prototype.ClickNew=function(){window.open("/timetable/online.php?cmd=new","_blank")},k.prototype.click_func=function(t,e){if(void 0===e&&(e=""),e+="&sync="+JSON.stringify(this.m_pSync.SendSyncData()),!this.m_pRadSelector.JeCelok()){for(var i=[],n=0,s=this.m_pRadSelector.m_Objects;n<s.length;n++){var r=s[n];i.push(r.m_Table+":"+r.m_Id)}e+="&rad_sel="+i.join(",")}this.jsc.ASC_action(t,e)},k.prototype.Sync=function(t){var e=this;"modified"in t&&(this.m_bModified=t.modified),"name"in t&&(this.m_DocName=t.name),"ss_ver"in t&&(this.m_ss_ver=t.ss_ver),this.m_pSync.ReceiveSyncData(t),this.UpdateWindowTitle(),this.ttviewer||(t.ce_ttdoc_last&&ASC.changeEvents.on(this.$content_d,"ttdoc:"+this.ttgpid,function(){e.SyncNow()},t.ce_ttdoc_last),t.ce_ttnum_last&&t.ttnum&&ASC.changeEvents.on(this.$content_d,"ttnum:"+t.ttnum,function(){e.SyncNow()},t.ce_ttnum_last))},k.prototype.SyncNow=function(){var e=this;return new Promise(function(t){e.jsc.closing?console.log("can't sync, closing."):(e.m_pSync.SetNeedsSync(),e.m_pSync.m_SyncCallbacks.push(t),e.m_pSync.SyncIfNeeded())})},k.prototype.OnResize=function(){},k.prototype.OnKeyDown=function(t){switch(t.keyCode){case 32:ASC.isBlockedUI()||this.ClickVerification("verification");break;case 65:if(t.ctrlKey)break;return!1;case 83:case 83:if(t.ctrlKey){this.click_func("save");break}return!1;case 84:if(t.ctrlKey){this.m_pPohladSwitcher.SetEnabled(!this.m_pPohladSwitcher.m_bEnabled);break}return!1;case 89:if(t.ctrlKey){this.click_func("undo","redo=1");break}return!1;case 90:if(t.ctrlKey){this.click_func("undo");break}return!1;default:return!1}return t.preventDefault(),t.stopPropagation(),!0},k.prototype.Zoom=function(t){this.m_pTriedyView.Zoom(t)},k.prototype.VerticalCenter=function(t){t||ASC.dieError("9329337586"),this.m_VerticalCenter.push(t)},k.prototype.VerticalCenterFinish=function(){for(var t=this.m_VerticalCenter,e=[],i=0;i<t.length;i++){var n=t[i];e[i]=n.clientHeight}for(i=0;i<t.length;i++)(n=t[i]).style.paddingTop="100px";var s=[];for(i=0;i<t.length;i++){n=t[i];var r=e[i],o=n.scrollHeight-100,a=0;o<r&&(a=(r-o)/2),s[i]=a}for(i=0;i<t.length;i++)(n=t[i]).style.paddingTop=s[i]+"px";t.length=0},k.prototype.PodKurzorom=function(t){this.m_PodKurzoromMHodina.Equals(t)||(this.m_PodKurzoromMHodina.Set(t),this.m_pRozView.m_bInvalidPodKurzorom=!0,this.m_pTriedyView.m_bPreviewPodKurzorom&&(this.m_pTriedyView.m_bInvalidFarbyStlpcov=!0),this.Invalidate())},k.prototype.PodKurzoromClear=function(){var t=new u.CMHodina(this.m_pRok);this.PodKurzorom(t)},k.prototype.SetPreviewPodKurzorom=function(t){t!=this.m_pTriedyView.m_bPreviewPodKurzorom&&(this.m_pTriedyView.m_bPreviewPodKurzorom=t,this.m_pTriedyView.m_bInvalidFarbyStlpcov=!0,this.Invalidate())},k.prototype.OdhodKartu=function(){var t=new u.CMHodina(this.m_pRok);this.Chyt(t)},k.prototype.Chyt=function(t){this.PodKurzoromClear(),t.Equals(this.m_TahanaMHodina)||(this.m_TahanaMHodina.Set(t),this.InvalidateTahanaMHodina(),this.m_bTahanaDajKontrolu=!1)},k.prototype.ChytKartu=function(t,e){if(t){var i=new u.CMHodina(this.m_pRok);null!=e&&i.SetPozicia(e),i.Add(t),i.FinishAdding(),this.Chyt(i)}else this.OdhodKartu()},k.prototype.ChytKarty=function(t,e){if(0!=t.length){var i=new u.CMHodina(this.m_pRok);null!=e&&i.SetPozicia(e),i.Add_array(t),i.FinishAdding(),this.Chyt(i)}else this.OdhodKartu()},k.prototype.ChytSeminar=function(t,e){},k.prototype.SelectRiadok=function(t){this.m_pRadSelector.SetCelok(),t&&this.m_pRadSelector.AddRadObject(t)},k.prototype.ScrollToRiadok=function(e){if(e){var t=this.m_pTriedyView,i=t.GetPohladForTable(e.m_Table);i&&i!=t.m_pAktPohlad&&t.SetAktPohlad(i);var n=t.m_Riadky.find(function(t){return t.m_pRokObject==e});n&&t.ScrollToRiadky([n])}},k.prototype.InvalidateTahanaMHodina=function(){this.UpdateCursor(),this.m_pTriedyView.m_bInvalidFarbyRiadkov=!0,this.m_pTriedyView.m_bInvalidFarbyStlpcov=!0,this.Invalidate()},k.prototype.UpdateCursor=function(){var t=this.m_TahanaMHodina;if(!this.Cursor_Canvas){var e=ASC.createChild(document.body,"canvas","","display:none;position:absolute; pointer-events:none; z-index:1");this.Cursor_Canvas=e,this.Cursor_Canvas.width=32,this.Cursor_Canvas.height=32}if(t.IsEmpty())this.Cursor_Canvas.style.display="none",this.$content_d.css("cursor","default");else{var i=this.Cursor_Canvas.getContext("2d"),n=Math.min(this.m_pTriedyView.m_nSirkaPolicko,this.Cursor_Canvas.width-2),s=Math.min(this.m_pTriedyView.m_nVyskaRiadokTrieda,this.Cursor_Canvas.height-2);this.Cursor_Hotspot[0]=1+n/2,this.Cursor_Hotspot[1]=1+s/2,i.globalCompositeOperation="destination-out",i.fillRect(0,0,this.Cursor_Canvas.width,this.Cursor_Canvas.height),i.globalCompositeOperation="source-over",i.fillStyle="#808080",i.fillRect(0,0,n+2,s+2),i.globalCompositeOperation="destination-out",i.fillRect(1,1,n,s),i.globalCompositeOperation="source-over",this.m_pTriedyView.PaintMH(i,1,1,n,s,t);var r=this.$content_d.get(0),o="url("+this.Cursor_Canvas.toDataURL()+") "+this.Cursor_Hotspot[0]+" "+this.Cursor_Hotspot[1]+", crosshair";r.style.cursor=o}document.body.style.cursor="default"},k.prototype.CursorMove=function(t){this.CursorMove_Event=t,this.CursorMove_Validate()},k.prototype.CursorMove_Validate=function(){if(null!=this.CursorMove_Event){var t=this.CursorMove_Event;t.clientX,t.clientY,this.Cursor_Canvas&&(this.$content_d.css("cursor"),this.Cursor_Canvas.style.display="none"),this.CursorMove_Event=null}},k.prototype.InvalidateKarta=function(t,e){var i=new u.CMHodina(this.m_pRok);i.Add(t),i.FinishAdding(),this.InvalidateMHodina(i,e)},k.prototype.InvalidateDozor=function(t,e){this.m_pTriedyView.InvalidateObject(t.m_pUcebna),t.m_pUcitel&&this.m_pTriedyView.InvalidateObject(t.m_pUcitel),this.Invalidate(),e||this.m_pSync.AddLocalChange(t)},k.prototype.InvalidateHodina=function(t){var e=this;t.m_Karty.forEach(function(t){e.InvalidateKarta(t)})},k.prototype.InvalidateObject=function(t,e){t&&(t instanceof c.CKarta?this.InvalidateKarta(t,e):t instanceof c.CDozor?this.InvalidateDozor(t,e):t instanceof c.CHodina?this.InvalidateHodina(t):t instanceof c.CZiakPredmet?this.InvalidateObject(t.m_pZiak,e):(t instanceof A&&this.InvalidatePohladSwitcher(),this.m_pTriedyView.InvalidateObject(t)),0<=["ttreports","periods","breaks","cards","subjects"].indexOf(t.m_Table)&&this.InvalidatePrintPreview(),"globals"==t.m_Table&&this.InvalidatePrintPreview(),"classrooms"==t.m_Table&&this.m_pTriedyView.JePohladDozory()&&this.InvalidateTriedyView(),this.Invalidate(),e||this.m_pSync.AddLocalChange(t))},k.prototype.InvalidatePending=function(){this.m_pRozView.m_bInvalid=!0,this.Invalidate()},k.prototype.InvalidateTriedyView=function(){this.m_pTriedyView.m_bInvalidAll=!0,this.Invalidate()},k.prototype.InvalidateTriedyViewRiadky=function(){for(var t=0,e=this.m_pTriedyView.m_Riadky;t<e.length;t++)e[t].m_bInvalid=!0;this.Invalidate()},k.prototype.InvalidatePohladSwitcher=function(){this.m_pPohladSwitcher.m_bInvalid=!0,this.Invalidate()},k.prototype.InvalidatePrintPreview=function(){this.m_pPrintPreview&&(this.m_pPrintPreview.m_bInvalid=!0,this.Invalidate())},k.prototype.InvalidateSelector=function(){this.m_pTriedyView.m_bInvalidFarbyRiadkov=!0,this.InvalidatePending()},k.prototype.InvalidateMHodina=function(t,e){var i=this;this.m_pTriedyView.InvalidateMHodina(t),this.m_pRozView.m_bInvalid=!0,this.Invalidate(),e||t.Karty().forEach(function(t){i.m_pSync.AddLocalChange(t)})},k.prototype.Validate=function(){this.CursorMove_Validate(),this.m_pPohladSwitcher.Validate(),this.m_pTriedyView.Validate(),this.m_pRozView.Validate(),this.VerticalCenterFinish(),this.m_pSync.Validate(),this.m_pSync.UpdateDebug(),this.m_pPrintPreview&&this.m_pPrintPreview.Validate(),this.UpdateButtons()},k.prototype.Invalidate=function(){var t=this;this.Validate_scheduled||(window.setTimeout(function(){t.Validate_scheduled=!1,t.Validate()},0),this.Validate_scheduled=!0)},k.prototype.ShowAlgData=function(){this.jsc.ASC_action("algdata","")},k.prototype.ZobrazKontrolu=function(t,e){var i=this;this.Validate(),this.ZrusKontrolu(),this.m_nKontrolaMode=p.KONTROLAMODE_KONTROLA,"listconstraints"==e&&(this.m_nKontrolaMode=p.KONTROLAMODE_PODMIENKY),"change"==e&&(this.m_nKontrolaMode=p.KONTROLAMODE_CHANGE);var n=[];this.m_ChybaItemsI={},t.forEach(function(t){var e=new l.CChybaItem(i.m_pRok,t);n.push(e)}),this.m_pRozView.ZobrazKontrolu(n,e),this.InvalidateTriedyView(),this.ribbonMenu.findButtonsByCmd("verification").forEach(function(t){t.selected(i.m_nKontrolaMode==p.KONTROLAMODE_KONTROLA)}),this.ribbonMenu.findButtonsByCmd("listconstraints").forEach(function(t){t.selected(i.m_nKontrolaMode==p.KONTROLAMODE_PODMIENKY)}),this.trackEvent("Verification",e)},k.prototype.JeKontrola=function(){return this.m_nKontrolaMode!=p.KONTROLAMODE_VYPNUTA},k.prototype.ZrusKontrolu=function(){this.JeKontrola()&&(this.m_nKontrolaMode=p.KONTROLAMODE_VYPNUTA,this.m_pRozView.ZrusKontrolu(),this.ribbonMenu.findButtonsByCmd("verification").forEach(function(t){t.selected(!1)}),this.ribbonMenu.findButtonsByCmd("listconstraints").forEach(function(t){t.selected(!1)}),this.m_ChybaItemsI={},this.m_pKontrolaItem=null,this.InvalidateTriedyView())},k.prototype.EnsureSynced=function(){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(t){switch(t.label){case 0:return 0<this.m_pSync.CountChanges()?[4,this.SyncNow()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},k.prototype.ClickGenerate=function(n){return void 0===n&&(n={}),d.__awaiter(this,void 0,void 0,function(){var e,i;return d.__generator(this,function(t){return e=void 0,n.sel&&(e=Array.isArray(n.sel)?n.sel:(i=this.m_pRadSelector).JeCelok()?void 0:i.m_Objects.map(function(t){return[i.m_Table,t.m_Id]})),v.showStartGenerDlg(this.ttgpid,{sel:e}),[2]})})},k.prototype.ClickTest=function(){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(t){switch(t.label){case 0:return this.ZrusKontrolu(),[4,this.checkPurchased()];case 1:return t.sent()&&g.showTestDlg(this),[2]}})})},k.prototype.ClickVerification=function(n,s){return void 0===s&&(s="all"),d.__awaiter(this,void 0,void 0,function(){var e,i;return d.__generator(this,function(t){switch(t.label){case 0:return this.JeKontrola()?(this.ZrusKontrolu(),[2]):this.JeKontrola()?(this.ZrusKontrolu(),[2]):[4,this.EnsureSynced()];case 1:return t.sent(),e=this.m_pRadSelector,[4,ASC.blockUI(r.runTTVerification(null,this.ttgpid,n,{sel:"sel"!=s||e.JeCelok()?void 0:e.m_Objects.map(function(t){return[e.m_Table,t.m_Id]})}))];case 2:return i=t.sent(),this.ZobrazKontrolu(i.listNajdeneChyby,n),[2]}})})},k.prototype.GenerStarted=function(t){new e.CGenerProgressDlg(this,t)},k.prototype.GenerStatus=function(t){this.m_pGenerProgressDlg&&this.m_pGenerProgressDlg.SetProgress(t)},k.prototype.GenerEnd=function(t){this.m_pGenerProgressDlg&&(this.m_pGenerProgressDlg.Close(),this.SyncNow())},k.prototype.TestStarted=function(){new e.CTestGenDlg(this)},k.prototype.TestStatus=function(t){this.m_pTestGenDlg&&this.m_pTestGenDlg.SetStatus(t)},k.prototype.TestActionAccepted=function(){this.m_pTestGenDlg&&this.m_pTestGenDlg.ActionAccepted()},k.prototype.ClickPrintPreview=function(t){void 0===t&&(t={}),this.m_bPrintPreview?this.ZrusPrintPreview():this.PrintPreview(t)},k.prototype.PrintPreview=function(t){if(void 0===t&&(t={}),this.ZrusKontrolu(),!this.m_bPrintPreview){this.m_bPrintPreview=!0;var e="printpreview";t.ttviewer&&(e="ttviewer"),this.$content_d.hide(),this.$printpreview_d.show().toggleClass("ttviewer","ttviewer"==e),this.ribbonMenu.findButtonsByCmd(e).forEach(function(t){t.selected(!0)}),this.ribbonMenu.select(e),this.ribbonMenu.$labels[e].show(),new i.CPrintPreview(this,t)}},k.prototype.ZrusPrintPreview=function(){if(this.m_bPrintPreview){this.$printpreview_d.hide(),this.$content_d.show(),this.m_bPrintPreview=!1;for(var t=0,e=["printpreview","ttviewer"];t<e.length;t++){var i=e[t];this.ribbonMenu.findButtonsByCmd(i).forEach(function(t){t.selected(!1)}),this.ribbonMenu.findButtonsByCmd(i).forEach(function(t){t.selected(!1)}),this.ribbonMenu.active==i&&this.ribbonMenu.select("main");var n=this.ribbonMenu.$labels[i];n&&n.hide()}this.m_pPrintPreview&&this.m_pPrintPreview.Destroy(),this.m_pPrintPreview=null,this.InvalidateTriedyView()}},k.prototype.UpdateWindowTitle=function(){if(!this.ttviewer){var t=ASC.ttls(1079);this.m_DocName&&(t=this.m_DocName+(this.m_ss_ver?" #"+this.m_ss_ver:"")+" - "+t),this.m_bModified&&(t="*"+t),$j("head title").text(t),$j("head link[rel='shortcut icon']").attr("href","/global/pics/ui/timetables_64.png")}},k.prototype.Fail=function(t){t=t||"Unknown error (9095935213)",this.m_pGenerProgressDlg&&this.m_pGenerProgressDlg.Close(),this.m_pTestGenDlg&&this.m_pGenerProgressDlg.Close(),ASC.ASC_messageBox(t)},k.prototype.ShowHelp=function(t){void 0===t&&(t="");var e="http://help.asctimetables.com/text.php?text="+t;ASC.windowOpenINP(e)},k.prototype.PrintSetFilter=function(t){this.m_pPrintPreview.SetFilter(t)},k.prototype.PrintSettingsChanged=function(){this.m_pPrintPreview.SettingsChanged()},k);function k(t){var m=this;this.ttviewer=!1,this.ttviewer_options=null,this.ttviewer_ribbon=null,this.$rg_pohlad_div=null,this.m_bModified=!1,this.m_DocName="",this.m_ss_ver="",this.Cursor_Canvas=null,this.Cursor_Hotspot=[0,0],this.m_nRozViewHeight=110,this.m_nKontrolaMode=p.KONTROLAMODE_VYPNUTA,this.m_bTahanaDajKontrolu=!1,this.m_pPrintPreview=null,this.m_VerticalCenter=[],this.Validate_scheduled=!1,this.formatLesson=null,this.CursorMove_Event=null,this.m_ChybaItemsI={},this.m_pKontrolaItem=null,this.m_bPrintPreview=!1,this.jsc=t,(this.jsc.app=this).ttgpid=t.ttgpid,a.farby=t.farby,t.ttviewer&&(this.ttviewer=!0,this.ttviewer_options=t.ttviewer_options),this.$dcvar=$j(this.jsc.dcvar),this.$dcvar.css("padding","0px");var e=$j("<div class='ttonline' style='min-height:80vh'><div id='ttonline_ribbon'/><div id='ttonline_content'/><div id='ttonline_printpreview' style='display:none'/></div></div>").appendTo(this.$dcvar);this.ttviewer?e.css("height","100%"):e.css("height","100vh"),"ie11"==ASC.browser&&e.css("display","block"),this.ribbonMenu=new ASC.ui.RibbonMenu(this.$dcvar.find("#ttonline_ribbon")),this.$content_d=this.$dcvar.find("#ttonline_content"),this.$printpreview_d=this.$dcvar.find("#ttonline_printpreview"),$j("<div class='asc-gadget-jsc' style='display:none'/>").appendTo(this.$dcvar)[0].ASC_gjsc={ASC_gpid:this.ttgpid},this.m_pRok=new c.CRok,(this.m_pRok.m_pRozApp=this).dbi=this.m_pRok.dbi,this.m_pSync=new C(this),this.m_pRadSelector=new l.CRadSelector(this),this.m_PodKurzoromMHodina=new u.CMHodina(this.m_pRok),this.m_TahanaMHodina=new u.CMHodina(this.m_pRok);var i=$j("<div style='flex: 1 1 0px;min-height:0px;display:flex;flex-direction:row;'>").appendTo(this.$content_d),n=$j("<div style=''>").appendTo(i),s=$j("<div style='flex: 1 1 0px; min-width: 0px'>").appendTo(i);this.m_pPohladSwitcher=new u.CPohladSwitcher(this,n),this.m_pTriedyView=new u.CTriedyView(this,s);var r=new ASC.ui.FlexSplitPane(this.$content_d,{vertical:!1});this.m_pRozView=new l.CRozView(this,$j("<div>").appendTo(this.$content_d)),r.$div.on("moved",function(t){m.m_nRozViewHeight=parseInt(m.m_pRozView.$div.get(0).style.height),m.Invalidate()}),this.InitRibbon(),this.m_pTriedyView.FillRibbonCombos();var o=this;this.m_OnMouseOverKarta=function(){var t=function(t){var e=t.ASC_karta;if(e)return(i=new u.CMHodina(m.m_pRok)).Add(e),i.FinishAdding(),i;if(t.ASC_dozor){var i,n=t.ASC_dozor;return(i=new u.CMHodina(m.m_pRok)).Add(n),i.FinishAdding(),i}return t.ASC_mh?t.ASC_mh:void 0}(this);t&&o.PodKurzorom(t)},this.m_OnMouseOutKarta=function(){o.PodKurzoromClear()},this.m_OnMouseClickKarta=function(t){var e=this.ASC_karta;if(o.m_TahanaMHodina.IsEmpty()){o.ZrusKontrolu();var i=o.m_pTriedyView.GetPolickoE(t);if(!i)return;this.parentNode.ASC_vriadok.m_pRokObject.UI_KartaVyberOdtialto(o,i,e,t),ASC.hideContextMenu(),o.m_OnMouse_StopEvent(t)}},this.m_OnMouseRightClickKarta=function(t){if(o.ZrusKontrolu(),!o.m_TahanaMHodina.IsEmpty())return o.OdhodKartu(),void o.m_OnMouse_StopEvent(t);var e=this.ASC_karta;e&&(o.m_pTriedyView.RightClickKarta($j.event.fix(t),e),o.m_OnMouse_StopEvent(t))},this.m_OnMouseRightClickDozor=function(t){if(o.ZrusKontrolu(),!o.m_TahanaMHodina.IsEmpty())return o.OdhodKartu(),void o.m_OnMouse_StopEvent(t);var e=this.ASC_dozor;e&&(o.m_pTriedyView.RightClickDozor($j.event.fix(t),e),o.m_OnMouse_StopEvent(t))},this.m_OnMouse_StopEvent=function(t){t.stopPropagation(),t.preventDefault()},this.ttviewer||($j(document).on("keyup keydown",function(t){return m.SetPreviewPodKurzorom(!!t.shiftKey),!0}),$j(document).on("keydown",function(t){if(!ASC.ui.getFocusedDialog())return!m.OnKeyDown(t)&&void 0}),$j(window).on("beforeunload",function(){if(!m.jsc.closing){var t=!1;return m.m_bModified&&(t=!0),0<m.m_pSync.CountChanges()&&(t=!0),m.m_pGenerProgressDlg&&(t=!0),m.m_pTestGenDlg&&(t=!0),t?ASC.ls(6122):void 0}})),this.formatLesson=function(t,e,i,n){var s=$j(t).empty().css("padding","1px 3px"),r=n.lrow,o=new u.CMHodina(m.m_pRok);o.Add0_id("subjects",r.subjectid),o.Add0_ids("teachers",r.teacherids);var a=22*Math.min(2,parseInt(r.durationperiods)),l=$j("<div class=''>").css({position:"relative",width:a,height:22}).appendTo(s),c=$j("<div class=''>").appendTo(l);c.css({position:"absolute",left:"0px",right:"0px",top:"0%",bottom:"0%",fontSize:"10px",textAlign:"center",overflow:"hidden",color:"#000"}).text(o.GetTexty(["subjects"]));var d=o.GetFarby("teachers");d&&0!=d.length||(d=["#ffffff"]),ASC.strippedBackground(c.get(0),d),m.VerticalCenter(c.get(0)),m.VerticalCenterFinish()},this.InvalidatePending(),this.Invalidate(),this.ttviewer||this.m_pSync.StartUpdater(),this.trackEvent("App","initialized")}a.CRozApp=y;var C=(S.prototype.AddLocalChange=function(t){var e=t.m_Table;if(e in this.m_Local_Changes){this.m_Local_ModCount++,this.m_Local_Changes[e][t.m_Id]=!0;var i=this.m_pRozApp.ribbonMenu;i.findButton("undo").enabled(!0),i.findButton("redo").enabled(!1)}},S.prototype.SendSyncData=function(){var t=this.m_pRok,e={modCount:this.m_Remote_ModCount,localModCount:this.m_Local_ModCount,changes:{}};for(var i in this.m_Local_Changes)if(ASC.count(this.m_Local_Changes[i])){var n=S.change_cols[i];if(n)for(var s in e.changes[i]={},this.m_Local_Changes[i]){var r=t.m_ObjectsI[i][s];if(r){var o=r.m_Data,a={};n.forEach(function(t){t in o&&(a[t]=o[t])}),e.changes[i][s]=a}}}return this.m_bVerbose&&0<ASC.count(e.changes)&&console.log("SendSyncData: "+JSON.stringify(e)),this.UpdateDebug(),e},S.prototype.ReceiveSyncData=function(t){var u=this.m_pRok,p=this.m_pRozApp,e=t.localModCount==this.m_Local_ModCount,n={};if(t.changes&&t.changes.forEach(function(t){var r=t.table,e=t.rows;0!=e.length&&(n[r]=!0,e.forEach(function(t){var e=t.id,i=u.m_ObjectsI[r][e];if(i){for(var n in p.InvalidateObject(i,!0),i.BeforeRemove(),t)i.m_Data[n]=t[n];i.InitFromData(),p.InvalidateObject(i,!0)}else{var s=ASC.clone(t);s.id=""+e,i=u.addRow(r,s),u.dbi.addOrUpdateRow(r,s),p.InvalidateTriedyView(),p.InvalidatePending(),p.InvalidateObject(i,!0)}}))}),t.deletes&&t.deletes.forEach(function(t){var e=t.table,i=t.ids;0!=i.length&&(n[e]=!0,i.forEach(function(t){u.m_ObjectsI[e][t]&&(u.deleteRow(e,t),p.InvalidateTriedyView(),p.InvalidatePending())}))}),t.orders&&t.orders.forEach(function(t){for(var e=t.table,i=t.ids,n=u.m_ObjectsO[e],s=n.slice(0,n.length),r={},o=n.length=0,a=i;o<a.length;o++){var l=a[o];if(!(m=u.m_ObjectsI[e][l]))return;n.push(m),r[l]=!0}for(var c=0,d=s;c<d.length;c++){var m;r[(m=d[c]).m_Id]||n.push(m)}p.m_pTriedyView.m_pAktPohlad&&p.m_pTriedyView.m_pAktPohlad.m_RowTable==e&&p.InvalidateTriedyView(),"groups"==e&&(u.m_ObjectsO.classes.forEach(function(t){t.m_Delenia.forEach(function(t){t.UpdatePoradieSkupin()})}),p.InvalidateTriedyView())}),(n.periods||n.daysdefs||n.weeksdefs||n.termsdefs||n.ttviews)&&(u.StructureFromData(),p.InvalidateTriedyView()),!p.ttviewer){var i=p.ribbonMenu;"undo_enabled"in t&&i.findButton("undo").enabled(t.undo_enabled),"redo_enabled"in t&&i.findButton("redo").enabled(t.redo_enabled)}if(e)for(var s in this.m_Local_Changes)this.m_Local_Changes[s]={};this.m_Remote_ModCount=t.modCount,this.m_bVerbose,t.apps&&JSON.stringify(t.apps)!=JSON.stringify(this.m_Apps)&&(this.m_Apps=t.apps,this.m_bInvalid_otherUsers=!0,this.m_pRozApp.m_pTriedyView.m_bInvalidFarbyRiadkov=!0,this.m_pRozApp.Invalidate(),this.m_bVerbose&&console.log("NewApps: "+JSON.stringify(this.m_Apps))),this.UpdateDebug()},S.prototype.CountChanges=function(){var t=0;for(var e in this.m_Local_Changes)t+=ASC.count(this.m_Local_Changes[e]);return t},S.prototype.UpdateDebug=function(){var t=this.$debug;t&&(t.css("white-space","pre"),t.text("remoteModCount="+this.m_Remote_ModCount+"\nlocalModCount="+this.m_Local_ModCount+"\nchanges="+this.CountChanges()+"\n"))},S.prototype.SyncIfNeeded=function(i){var n=this;if(void 0===i&&(i=0),!this.m_bSyncing&&this.m_bNeedsSync){var s=this.m_SyncCallbacks;this.m_SyncCallbacks=[],this.m_bNeedsSync=!1,this.m_bSyncing=!0;var t=this.SendSyncData();if(0<ASC.count(t.changes)){var e="";for(var r in t.changes)e+=(e?"_":"")+r;e&&this.m_pRozApp.trackEvent("SyncLocal",e)}this.m_pRozApp.jsc.ASC_action("sync","sync="+encodeURIComponent(JSON.stringify(t)),{modal:!1,timeout:6e4,success2:function(){n.m_bSyncing=!1;for(var t=0,e=s;t<e.length;t++)(0,e[t])();n.m_bNeedsSync&&i<3&&n.SyncIfNeeded(i+1)},failure:function(){n.m_bSyncing=!1}})}},S.prototype.SetNeedsSync=function(){this.m_bNeedsSync=!0},S.prototype.StartUpdater=function(){var e=this,i=!0,n=function(){var t=5e3;(i||1<e.m_Apps.length)&&(t=1e3),window.setTimeout(function(){0<e.CountChanges()&&(e.SetNeedsSync(),e.SyncIfNeeded()),i=!1,n()},t)};n()},S.prototype.UpdateOtherUsers=function(){var n=this;this.$other_users.empty();var s=[],r=[];if(this.m_Apps.forEach(function(t){if(t.my)r.push(t);else{var e=t.sh;if(!(0<=s.indexOf(e))){s.push(e);var i=$j("<span class='user'>").appendTo(n.$other_users);i.text(t.un),i.css("background-color",t.c)}}}),0<r.length&&1<r.length){var t=r[0],e=$j("<span class='user'>").appendTo(this.$other_users);e.text(ASC.ls(1751)+(1<r.length?" ("+r.length+")":"")),e.css("background-color",t.c)}this.m_bInvalid_otherUsers=!1},S.prototype.Validate=function(){this.m_bInvalid_otherUsers&&this.UpdateOtherUsers()},S.prototype.GetFarbyUserov=function(t){var e=t.m_Table,i=t.m_Id,n=null;return this.m_Apps.forEach(function(t){!t.my&&t.cr&&e in t.cr&&(ASC.indexOf(t.cr[e],i)<0||(n?n.push(t.c):n=[t.c]))}),n},S.change_cols={cards:["period","days","weeks","terms","classroomids","locked"],lessons:["terms"],classes:["timeoff"],teachers:["timeoff"],classrooms:["timeoff"],subjects:["timeoff"],studentsubjects:["locked","seminargroup"],classroomsupervisions:["teacherid","locked"]},S);function S(t){this.m_Local_ModCount=0,this.m_Local_Changes={cards:{},lessons:{},classes:{},teachers:{},classrooms:{},subjects:{},studentsubjects:{},classroomsupervisions:{}},this.m_Remote_ModCount=0,this.m_Apps=[],this.m_bVerbose=!0,this.m_bSyncing=!1,this.m_bNeedsSync=!1,this.m_SyncCallbacks=[],this.m_bInvalid_otherUsers=!1,this.m_pRozApp=t,this.m_pRok=t.m_pRok,this.$other_users=this.m_pRozApp.ribbonMenu.$right}var w,A=(w=c.CRokObject,d.__extends(R,w),R.prototype.GetNazov=function(){return this.m_Data.name},R.prototype.InitFromData=function(){var t=this.m_Data;this.m_Typ=t.typ,this.texttables=t.texttables,this.colortable=t.colortables.length?t.colortables[0]:"",this.m_RowTable=t.table,this.m_Icon=t.icon,this.m_Hidden=ASC.boolVal(t.hidden)},R.prototype.GetRiadkyObjects=function(){if("classroomsupervision"!=this.m_Typ)return"custom"==this.m_Typ?"classes"==this.m_RowTable?this.m_pRok.ids2ro("classes",this.m_Data.classids):"teachers"==this.m_RowTable?this.m_pRok.ids2ro("teachers",this.m_Data.teacherids):[]:this.m_pRok.m_ObjectsO[this.m_RowTable];for(var t=[],e=0,i=this.m_pRok.TableObjects("classrooms");e<i.length;e++){var n=i[e];ASC.boolVal(n.m_Data.needssupervision)&&t.push(n)}return t},R.prototype.GetRiadkyTable=function(){return this.m_RowTable},R.prototype.UI_VhodnostTahanejMHodiny=function(t,i){if("classrooms"==this.m_RowTable){for(var e=0,n=t.Karty();e<n.length;e++)if(n[e].JeTu_Policko(i))return"1";return"0"}var s="1";t.Karty().forEach(function(t){if(!t.Obdobia_MozeSem_TWDH(i.m_nTerm,i.m_nWeek,i.m_nDay,-1))return"0";t.Obdobia_MozeSem_TWDH(i.m_nTerm,-1,-1,-1,!0)||(s="?")});var r=[];if(t.Ucitelia().forEach(function(t){r.push(t.m_pVolno)}),t.Predmety().forEach(function(t){r.push(t.m_pVolno)}),r.forEach(function(t){var e=t.GetTWDH(i.m_nTerm,i.m_nWeek,i.m_nDay,i.period);s=O.vhod_min(e,s)}),"0"!=s){var o=[];"classes"!=this.m_RowTable&&"classrooms"!=this.m_RowTable||t.Ucitelia().forEach(function(t){t.AddKartyTu(o,i.m_nTerm,i.m_nWeek,i.m_nDay,i.period,0)}),0!=o.length&&(s="x")}return s},R);function R(t,e){var i=w.call(this,t,"ttviews",e)||this;return i.m_Typ="",i.texttables=[],i.colortable="",i.m_RowTable="classes",i.m_Hidden=!1,i.m_pRozApp=t.m_pRozApp,i.m_pTriedyView=t.m_pRozApp.m_pTriedyView,i.InitFromData(),i}a.CPohlad=A;var I=(D.RovnakyList=function(t,e){if(t.length!=e.length)return!1;for(var i=0;i<t.length;i++)if(t[i]!=e[i])return!1;return!0},D.GetImage=function(t){return ASC.tt.GetImage(t)},D.GetTableIcon=function(t){return ASC.tt.GetTableIcon(t)},D.GetTableName=function(t){switch(t){case"classes":return ASC.ls(1194);case"classrooms":return ASC.ls(1007);case"teachers":return ASC.ls(1005);case"subjects":return ASC.ls(1008);case"students":return ASC.ls(1006);case"lessons":return ASC.ls(1460)}return""},D.PaintFarbyToRect=function(t,e,i,n,s,r){var o=0<t.length?t[0]:"#ffffff";e.fillStyle=o,e.fillRect(i,n,s,r)},D.GetTextExtent=function(t,e){var i=t.measureText(e),n=t.measureText("M");return{cx:i.width,cy:n.width}},D.PaintTextToRect=function(t,e,i,n,s,r,o,a){if(void 0===o&&(o=0),void 0===a&&(a=0),0!=t.length){e.textBaseline="top",e.textAlign="left";var l=s,c=r;c+=1;var d=t,m=t.length,u=[],p=[],h=0,_=0,f=0,v=0;for(u[h=0]=v,p[0]=m;!(m<=v);){for(var b=v,g=b,y=!1;;){var k,C;if(y)for(var S=b;;){if(" "==d[S]){k=S+1,C=S;break}if(m<=(S+=1)){C=k=S;break}}else k=b+1," "==d[b]?(C=b,y=!0):C=k;if(v<b&&(A=D.GetTextExtent(e,t.substring(v,C))).cx>l)break;if(g=C,m<=(b=k))break}if((A=D.GetTextExtent(e,t.substring(v,g))).cx-=1,_+A.cy>c&&1<=h)break;if(f=Math.max(f,A.cx),_+=A.cy,p[h]=g-u[h],u[h+1]=b,p[h+1]=m-b,v=b,10<=++h)break}var T=i;0==o&&(T+=(l-f)/2),0<o&&(T+=l-f);var w=n;for(0==a&&(w+=(c-_)/2),0<a&&(w+=c-_),w-=2,S=0;;){var A,R=u[S];if(m=p[S],e.fillText(t.substr(R,m),T,w),h<=++S)break;(A=D.GetTextExtent(e,t.substr(R,m))).cy-=1,w+=A.cy}}},D.IsEventInside=function(t,e){var i=t.pageX-e.offset().top,n=t.pageY-e.offset().left;return 0<=i&&0<=n&&i<e.width()&&n<e.height()},D.FastRemove=function(t,e){var i=t.indexOf(e);0<=i&&(t[i]=t[t.length-1],t.length--)},D.IsEventRightButton=function(t){return 2==t.button},D.AddToSet=function(t,e){e.indexOf(t)<0&&e.push(t)},D.AddListToSet=function(t,e){for(var i=0;i<t.length;i++)D.AddToSet(t[i],e)},D.OpenDialog=function(t,e){void 0===e&&(e={}),e.modal=!0,t=t||ASC.ttls(1079),e.title=ASC.escapeHTML(t);var i=new ASC.ui.Dialog(e);return i.center(),i.show(),i},D.GetUINazov=function(t,e){return void 0===e&&(e="name"),D.GetUINazov2(t,null,e)},D.GetUINazov2=function(t,e,i){if(void 0===e&&(e=null),void 0===i&&(i="short_name"),!t)return"";if(e)return"short_name"==i&&"classes"==t.m_Table&&"subjects"==e.m_Table?"("+t.GetSkratka()+":"+e.GetSkratka()+") "+t.GetNazov()+": "+e.GetNazov():D.GetUINazov(t,i)+" : "+D.GetUINazov(e,i);var n=t.m_pRok;switch(t.m_Table){case"cards":var s=t,r=D.GetUINazov(s.m_pHodina)+" - ";return s.JeUmiestnena()?r+=D.GetUINazov(n.GetDen_bits(s.days()),"short")+":"+D.GetUINazov(n.GetPeriod(s.GetHodina()),"short"):r+=ASC.ttls(1765),r;case"lessons":var o=t,a=new u.CMHodina(n);return a.Add(o),a.FinishAdding(),r=a.GetText("subjects"),0<a.m_nPoradieSeminaru&&(r+=" "+a.GetText("seminargroup")),r+=" (",0==a.m_Objects.classes.length?r+="Without class":r+=a.GetText("classes","short"),r+=")",0!=a.m_Skupiny.length&&(r+=" "+a.GetText("groups")),r;case"daysdefs":case"weeksdefs":case"termsdefs":case"periods":case"classes":case"teachers":case"subjects":case"classrooms":return"short_name"==i?"("+t.GetSkratka()+") "+t.GetNazov():t.GetNazov(i);case"students":return t.m_pTrieda.GetSkratka()+" - "+t.GetNazov();case"globals":return ASC.ttls(3756)}return"???"+t.m_Table},D.GetUINazvy=function(t,e){void 0===e&&(e="short");var i="";return t.forEach(function(t){""!=i&&(i+=", "),i+=D.GetUINazov(t,e)}),i},D.GetIconTimeOff=function(){return D.GetImage("timeoff_32")},D.GetIconConstraints=function(){return D.GetImage("constraints_32")},D.GetIconDivision=function(){return D.GetImage("division_32")},D.GetIconLessons=function(){return D.GetTableIcon("lessons")},D.GetIconNic=function(){return"/global/pics/ui/nic_32.png"},D.GetIconLocked=function(t,e){return void 0===e&&(e=!1),t?D.GetImage("lock_32"):e?"":D.GetImage("unlock_32")},D.GetIconOK=function(){return"/timetable/pics/app/ok_32.png"},D.GetIconVhodnost=function(t){switch(t){case"1":return D.GetImage("ok_32");case"?":return D.GetImage("question_32");case"0":return D.GetImage("no_32")}return""},D.AddMenuItemSmart=function(t,e,i){void 0===i&&(i={});var n=i.data,s={text:"",cmd:e};switch(void 0!==n&&(s.data=n),e){case"edit":s.text=ASC.ttls(1017);break;case"timeoff":s.text=ASC.ttls(1118),s.icon=D.GetIconTimeOff();break;case"timeoff:0":s.text=ASC.ttls(1122),s.icon=D.GetImage("no_32");break;case"timeoff:?":s.text=ASC.ttls(1121),s.icon=D.GetImage("question_32");break;case"timeoff:1":s.text=ASC.ttls(1120),s.icon=D.GetImage("ok_32");break;case"constraints":s.text=ASC.ttls(3071),s.icon=D.GetIconConstraints();break;case"lessons":s.text=ASC.ttls(1032),s.icon=D.GetIconLessons();break;case"divisions":s.text=ASC.ttls(1031),s.icon=D.GetIconDivision();break;case"deletecards":s.text=ASC.ttls(1712),s.icon=D.GetIconNic();break;case"unlockcard":s.icon=D.GetIconLocked(!1);break;case"lockcard":s.icon=D.GetIconLocked(!0);break;case"putcard":n instanceof c.CRokObject&&(s.text=D.GetUINazov(n));break;case"editlesson":s.text=ASC.ttls(1059),s.icon=D.GetImage("edit_32");break;case"test":s.text=ASC.ttls(2047),s.icon=D.GetImage("test_32");break;case"verification":s.text=ASC.ttls(1616),s.icon=D.GetImage("verification_32");break;case"listconstraints":s.text=ASC.ttls(3719),s.icon=D.GetImage("constraints_32");break;case"printpreview":s.text=ASC.ls(1837),s.icon=D.GetImage("print_preview_32")}n instanceof c.CRokObject&&(s.icon=D.GetTableIcon(n.m_Table),s.text||(s.text=D.GetUINazov(n))),"icon"in i&&(s.icon=i.icon),"text"in i&&(s.text=i.text),"disabled"in i&&(s.disabled=i.disabled),"submenu"in i&&(s.submenu=i.submenu),"checked"in i&&(s.checked=i.checked),"onclick"in i&&(s.onclick=i.onclick),s.icon||(s.icon=D.GetIconNic()),s.text||(s.text="???"+e),t.push(s)},D.GetTableItemTypNazov=function(t,e){switch(t){case"classrooms":return 1==e?ASC.ttls(1092):ASC.ttls(1085);case"teachers":return 1==e?ASC.ttls(1048):ASC.ttls(1038);case"subjects":return 1==e?ASC.ttls(1011):ASC.ttls(1021);case"classes":return 1==e?ASC.ttls(1035):ASC.ttls(1026);case"lessons":return 1==e?ASC.ttls(1063):ASC.ttls(2531);case"students":return 1==e?ASC.ttls(2956):ASC.ttls(2604);case"days":case"daysdefs":return 1==e?ASC.ls(1465):ASC.ls(1693);case"studentsubjects":return D.GetTableItemTypNazov("students",e)+"/"+D.GetTableItemTypNazov("subjects",e)}return D.GetTableName(t)},D.ZasedniColor=function(t){var e=D.ZasedniColor_cache[t];if(!e){var i=parseInt(t.substr(1,2),16)+parseInt(t.substr(1,2),16)+parseInt(t.substr(1,2),16),n=(Math.round(50*i/765)+200).toString(16);1==n.length&&(n="0"+n),e="#"+n+n+n,D.ZasedniColor_cache[t]=e}return e},D.ZasedniColors=function(t){for(var e=[],i=0,n=t;i<n.length;i++){var s=n[i];e.push(D.ZasedniColor(s))}return e},D.StringHash=function(t){var e,i,n=0;if(0===t.length)return n;for(e=0,i=this.length;e<i;e++)n=(n<<5)-n+t.charCodeAt(e),n|=0;return n},D.GetIconImportance=function(t){return"/timetable/pics/app/relations/importance_"+t+"_16.png"},D.AdvFilterPopis=function(t){var e="",i=t&D.VZTAH_ADV_OPTIONS_MASK_LENGTH;switch(0!=i&&(""!=e&&(e+=", "),e+=ASC.ttls(1640)+": "+i),t&D.VZTAH_ADV_OPTIONS_ENTIRECLASS&&(""!=e&&(e+=", "),e+=ASC.ttls(1643)),t&D.VZTAH_ADV_OPTIONS_DIVIDED&&(""!=e&&(e+=", "),e+=ASC.ttls(1178)),t&D.VZTAH_ADV_OPTIONS_SEMINAR&&(""!=e&&(e+=", "),e+=ASC.ttls(2609)),t&D.VZTAH_ADV_OPTIONS_MASK_CLASSCOUNT){case D.VZTAH_ADV_OPTIONS_NOCLASS:""!=e&&(e+=", "),e+=ASC.ttls(2825);break;case D.VZTAH_ADV_OPTIONS_ONECLASS:""!=e&&(e+=", "),e+=ASC.ttls(3844);break;case D.VZTAH_ADV_OPTIONS_JOINEDCLASSES:""!=e&&(e+=", "),e+=ASC.ttls(3845)}switch(t&D.VZTAH_ADV_OPTIONS_MASK_DAYS){case D.VZTAH_ADV_OPTIONS_EVERY_DAY:""!=e&&(e+=", "),e+=ASC.ttls(3549);break;case D.VZTAH_ADV_OPTIONS_NOT_EVERY_DAY:""!=e&&(e+=", "),e+="!"+ASC.ttls(3549)}var n=(t&D.VZTAH_ADV_OPTIONS_MASK_SEMINARGROUPSCOUNT)>>11;return 0<n&&(""!=e&&(e+=", "),e+=ASC.ttls(3622)+": ",t&D.VZTAH_ADV_OPTIONS_MASK_SEMINARGROUPSCOUNT_ORLESS&&(e+="<="),e+=n),e},D.AdvFilterMenuBuild=function(t){var e,i,n,s=[],r="advfilter";s.push([]),e=[],i={text:ASC.ttls(1640),submenu:e};for(var o=1;o<=32;o++)n={text:""+o,cmd:r,data:2e3+o},(t&D.VZTAH_ADV_OPTIONS_MASK_LENGTH)==o&&(n.checked=!0,i.checked=!0),e.push(n);s.push(i),s.push([]),s.push({text:ASC.ttls(1643),cmd:r,data:1010,checked:0!=(t&D.VZTAH_ADV_OPTIONS_ENTIRECLASS)}),s.push({text:ASC.ttls(1178),cmd:r,data:1011,checked:0!=(t&D.VZTAH_ADV_OPTIONS_DIVIDED)}),s.push({text:ASC.ttls(2609),cmd:r,data:1012,checked:0!=(t&D.VZTAH_ADV_OPTIONS_SEMINAR)}),s.push([]),s.push({text:ASC.ttls(2825),cmd:r,data:1013,checked:(t&D.VZTAH_ADV_OPTIONS_MASK_CLASSCOUNT)==D.VZTAH_ADV_OPTIONS_NOCLASS}),s.push({text:ASC.ttls(3844),cmd:r,data:1014,checked:(t&D.VZTAH_ADV_OPTIONS_MASK_CLASSCOUNT)==D.VZTAH_ADV_OPTIONS_ONECLASS}),s.push({text:ASC.ttls(3845),cmd:r,data:1015,checked:(t&D.VZTAH_ADV_OPTIONS_MASK_CLASSCOUNT)==D.VZTAH_ADV_OPTIONS_JOINEDCLASSES}),s.push([]);var a=(t&D.VZTAH_ADV_OPTIONS_MASK_SEMINARGROUPSCOUNT)>>11;for(e=[],i={text:ASC.ttls(3622),submenu:e,checked:0<a},s.push(i),o=1;o<=7;o++)e.push({text:""+o,cmd:r,data:3e3+o,checked:o==a});return e.push([]),e.push({text:"<=",checked:0!=(t&D.VZTAH_ADV_OPTIONS_MASK_SEMINARGROUPSCOUNT_ORLESS),cmd:r,data:1016}),e=[],i={text:ASC.ttls(2532),submenu:e,checked:0!=(t&D.VZTAH_ADV_OPTIONS_MASK_DAYS)},s.push(i),e.push({text:ASC.ttls(3549),checked:(t&D.VZTAH_ADV_OPTIONS_MASK_DAYS)==D.VZTAH_ADV_OPTIONS_EVERY_DAY,cmd:r,data:4001}),e.push({text:ASC.ttls(2708),checked:(t&D.VZTAH_ADV_OPTIONS_MASK_DAYS)==D.VZTAH_ADV_OPTIONS_NOT_EVERY_DAY,cmd:r,data:4002}),s.push([]),s.push({text:ASC.ttls(2823),cmd:r,data:1e3}),s},D.AdvFilterMenuHandle=function(t,e){var i=parseInt(t.data),n=0,s=0;switch(i){case 1e3:e=0;break;case 1010:n=D.VZTAH_ADV_OPTIONS_MASK_DIVIDED,s=D.VZTAH_ADV_OPTIONS_ENTIRECLASS;break;case 1011:n=D.VZTAH_ADV_OPTIONS_MASK_DIVIDED,s=D.VZTAH_ADV_OPTIONS_DIVIDED;break;case 1012:n=D.VZTAH_ADV_OPTIONS_MASK_DIVIDED,s=D.VZTAH_ADV_OPTIONS_SEMINAR;break;case 1013:n=D.VZTAH_ADV_OPTIONS_MASK_CLASSCOUNT,s=D.VZTAH_ADV_OPTIONS_NOCLASS;break;case 1014:n=D.VZTAH_ADV_OPTIONS_MASK_CLASSCOUNT,s=D.VZTAH_ADV_OPTIONS_ONECLASS;break;case 1015:n=D.VZTAH_ADV_OPTIONS_MASK_CLASSCOUNT,s=D.VZTAH_ADV_OPTIONS_JOINEDCLASSES;break;case 1016:s=n=D.VZTAH_ADV_OPTIONS_MASK_SEMINARGROUPSCOUNT_ORLESS;break;case 4001:n=D.VZTAH_ADV_OPTIONS_MASK_DAYS,s=D.VZTAH_ADV_OPTIONS_EVERY_DAY;break;case 4002:n=D.VZTAH_ADV_OPTIONS_MASK_DAYS,s=D.VZTAH_ADV_OPTIONS_NOT_EVERY_DAY}return 2001<=i&&i<2100&&(n=D.VZTAH_ADV_OPTIONS_MASK_LENGTH,s=i-2e3),3e3<=i&&i<3100&&(n=D.VZTAH_ADV_OPTIONS_MASK_SEMINARGROUPSCOUNT,s=i-3e3<<11),(e&n)==s?e&=~n:e=e&~n|s,e},D.AdvFilterPass=function(t,e,i){if(void 0===i&&(i=null),0!=t){if(t&D.VZTAH_ADV_OPTIONS_INVERT)return!D.AdvFilterPass(t&~D.VZTAH_ADV_OPTIONS_INVERT,e,i);var n=t&D.VZTAH_ADV_OPTIONS_MASK_LENGTH;if(0!=n&&e.GetDlzka()+1!=n)return!1;var s=t&D.VZTAH_ADV_OPTIONS_MASK_DIVIDED;if(s){var r=!1;if(s&D.VZTAH_ADV_OPTIONS_SEMINAR)if(i)for(var o=0,a=i;o<a.length;o++){var l=a[o];if(0<=e.m_KurzyPreTriedy.indexOf(l)){r=!0;break}}else 0<e.m_KurzyPreTriedy.length&&(r=!0);for(var c=0,d=e.m_Skupiny;c<d.length;c++){var m=d[c];if(!(i&&i.indexOf(m.m_pTrieda)<0)){if(s&D.VZTAH_ADV_OPTIONS_ENTIRECLASS&&m.m_bCelaTrieda){r=!0;break}if(s&D.VZTAH_ADV_OPTIONS_DIVIDED&&!m.m_bCelaTrieda&&!m.m_bKurz){r=!0;break}}}if(!r)return!1}var u=(t&D.VZTAH_ADV_OPTIONS_MASK_SEMINARGROUPSCOUNT)>>11;if(0<u){if(0==e.m_KurzyPreTriedy.length)return!1;var p=[];i?$j.merge(p,i):$j.merge(p,e.m_KurzyPreTriedy),r=!1;for(var h=0,_=p;h<_.length;h++)if(l=_[h],!(e.m_KurzyPreTriedy.indexOf(l)<0)){for(var f=[],v=0,b=e.m_pPredmet.m_Hodiny;v<b.length;v++){var g=b[v];if(!(g.m_KurzyPreTriedy.indexOf(l)<0)){var y=g.m_nPoradieSeminaru;T(0<y),f.indexOf(y)<0&&f.push(y)}}var k=f.length;if(T(0<k),0!=(t&D.VZTAH_ADV_OPTIONS_MASK_SEMINARGROUPSCOUNT_ORLESS)?k<=u&&(r=!0):k==u&&(r=!0),r)break}if(!r)return!1}var C=t&D.VZTAH_ADV_OPTIONS_MASK_CLASSCOUNT;if(0<C){switch(p=e.m_Triedy,C){case D.VZTAH_ADV_OPTIONS_NOCLASS:return 0==p.length;case D.VZTAH_ADV_OPTIONS_ONECLASS:return 1==p.length;case D.VZTAH_ADV_OPTIONS_JOINEDCLASSES:return 1<p.length}return T(!1),!1}var S=t&D.VZTAH_ADV_OPTIONS_MASK_DAYS;if(S==D.VZTAH_ADV_OPTIONS_EVERY_DAY&&"all"!=e.m_pDenMozny.m_Typ)return!1;if(S==D.VZTAH_ADV_OPTIONS_NOT_EVERY_DAY&&"all"==e.m_pDenMozny.m_Typ)return!1}return!0},D.AdvFilterField=function(t,e,i,n){n=parseInt(n+"");var s=$j("<span>").appendTo(t),r=$j("<input>").appendTo(t).hide(),o=function(){var t=D.AdvFilterMenuBuild(n);ASC.ui.Menu.addHandler(t,function(t){n=D.AdvFilterMenuHandle(t,n),o()}),s.empty(),new ASC.ui.Button({container:s,label:e,menu:t}),$j(i).text(D.AdvFilterPopis(n)),r.val(n+"")};return o(),r[0]},D.bits2index=function(t){return t.indexOf("0")<0?-1:t.indexOf("1")},D.blank2minus=function(t){return ASC.strEmpty(t)?-1:parseInt(t)},D.minus2blank=function(t){return t<0?-1:t},D.StripStringTab=function(t){var e=t.indexOf("\t");return e<=0&&(e=t.indexOf("\\t")),0<=e&&(t=t.substr(0,e)),t=t.replace("&","")},D.minutes=function(t){var e=t.split(":");return 60*parseInt(e[0])+parseInt(e[1])},D.GetFarbaFazy=function(t,e){if(e<=1)return"";var i=Math.round(255*t/(e-1));return"rgb("+i+","+i+","+i+")"},D.ZasedniColor_cache={},D.VZTAH_ADV_OPTIONS_MASK_LENGTH=31,D.VZTAH_ADV_OPTIONS_ENTIRECLASS=256,D.VZTAH_ADV_OPTIONS_DIVIDED=512,D.VZTAH_ADV_OPTIONS_SEMINAR=1024,D.VZTAH_ADV_OPTIONS_MASK_DIVIDED=1792,D.VZTAH_ADV_OPTIONS_MASK_SEMINARGROUPSCOUNT=14336,D.VZTAH_ADV_OPTIONS_MASK_SEMINARGROUPSCOUNT_ORLESS=16384,D.VZTAH_ADV_OPTIONS_NOCLASS=32768,D.VZTAH_ADV_OPTIONS_ONECLASS=65536,D.VZTAH_ADV_OPTIONS_JOINEDCLASSES=98304,D.VZTAH_ADV_OPTIONS_MASK_CLASSCOUNT=98304,D.VZTAH_ADV_OPTIONS_EVERY_DAY=131072,D.VZTAH_ADV_OPTIONS_NOT_EVERY_DAY=262144,D.VZTAH_ADV_OPTIONS_MASK_DAYS=393216,D.VZTAH_ADV_OPTIONS_INVERT=2147483648,D);function D(){ASC.assert(!1)}a.CUtils=I;var O=(x.vhod_max=function(t,e){return"1"==t||"1"==e?"1":"?"==t||"?"==e?"?":"0"==t||"0"==e?"0":""},x.vhod_min=function(t,e){return"0"==t||"0"==e?"0":"?"==t||"?"==e?"?":"1"==t||"1"==e?"1":""},x.prototype.timeoff=function(){return this.m_pParent.m_Data.timeoff},x.prototype.GetTWDH=function(t,e,i,n){return ASC.tt.timeOff_get(this.timeoff(),t,e,i,n,x.vhod_max)},x.prototype.SetTWDH=function(t,e,i,n,s){var r=this.timeoff();r=ASC.tt.timeOff_set(r,t,e,i,n,s,this.DB4TimeOff()),this.m_pParent.m_Data.timeoff=r},x.prototype.DB4TimeOff=function(){for(var t=this.m_pParent.m_pRok,e={periods:[],days:[],weeks:[],terms:[]},i=0,n=t.TableObjects("periods");i<n.length;i++){var s=n[i];e.periods[parseInt(s.m_Id)]=s}for(var r=0,o=["days","weeks","terms"];r<o.length;r++)for(var a=o[r],l=0,c=t.TableObjects(a+"defs");l<c.length;l++){var d=s=c[l];"one"==d.m_Typ&&(e[a][d.m_Val]=d)}return e},x.prototype.GetKarta=function(t){for(var e=t.terms(),i=t.weeks(),n=t.days(),s=t.GetHodina(),r=s+t.m_pHodina.GetDlzka(),o="1",a=this.timeoff(),l=s;l<=r;l++)for(var c=0;c<a.length;c++)if(!(1<a.length&&"1"!=e.charAt(c)))for(var d=a[c],m=0;m<d.length;m++)if(!(1<d.length&&"1"!=i.charAt(m)))for(var u=d[m],p=0;p<u.length;p++)1<u.length&&"1"!=n.charAt(p)||(o=x.vhod_min(o,u[p].charAt(l)));return o},x);function x(t){this.m_pParent=t}a.CVolno=O,a.formatDivision=function(t,e,i,n){var s=i.table._oRecordSet._records.indexOf(e),r=$j(t);r.empty();for(var o=$j("<div class='ttonline_delenie'>").appendTo(r).data("rec",e),a=0,l=n;a<l.length;a++){var c=l[a],d=$j("<div class='ttonline_skupina'>").appendTo(o).css({backgroundColor:s%2==0?"#b1febb":"#93fe93"}).text(c.name).data("grow",c);$j("<span class='students_count'>").text(c.students_count).appendTo(d)}e.getData("entireclass")||o.sortable({connectWith:".ttonline_delenie",update:function(t,e){if(!e.sender){var i=e.item,n=i.data("grow").id,s=i.parent().data("rec").getData("division"),r=i.index();i.parents(".ui-dialog").find(".asc-gadget-jsc").get(0).ASC_gjsc.ASC_action("move","groupid="+n+"&division="+s+"&index="+r)}}})},a.SortovacieSipocky=function(e,i,t,n){function s(){n.ASC_action("order","order="+e.GetAllIds().join(","),{modal:!1})}var r=[],o=!1,a=function(){o=0<e.sortedBy.length,r[0].attr("src",o?"/global/pics/ui/sipkaKluc.png":"/global/pics/ui/sipkaHore.png"),r[1].attr("src",o?"/global/pics/ui/sipkaReset.png":"/global/pics/ui/sipkaDole.png")};[0,1].forEach(function(t){r[t]=$j("<img>").appendTo(i).css({width:"19px",height:"20px",cursor:"pointer",display:"block",marginTop:"5px"}).click(function(){!function(t){o?0==t?(s(),e.setSortedBy([]),a()):(e.ASC_deleteAll(),e.setSortedBy([]),a(),n.ASC_action("refresh","")):(e.moveSelectedRow(0==t),s())}(t)})}),a(),e.subscribe("columnSortEvent",a)}}),ASC.setModuleSourceFunc("/timetable/app/rozview.js",function(t,require,e){t.__esModule=!0;var h=require("./online"),c=require("./rokobject"),k=require("./tview"),i=(n.prototype.UpdateHeight=function(){this.$div.css("height",this.m_pRozApp.m_nRozViewHeight+"px")},n.prototype.Update=function(){this.UpdateHeight(),this.PaintRadKarticiek0(),this.UpdatePodKurzorom(),this.m_pRozApp.VerticalCenterFinish(),this.m_bInvalid=!1},n.prototype.Validate=function(){this.m_pRozApp.ttviewer||(this.m_bInvalid&&this.Update(),this.m_bInvalidPodKurzorom&&this.UpdatePodKurzorom())},n.prototype.PaintRadKarticiek0=function(){var n=this,s=this.m_pRozApp,t=this.$pending_d;t.empty();var e=s.m_pRadSelector,i="";e.JeCelok()||(""!=i&&(i+=", "),i+=e.GetSimplePopis(!0)),""!=i&&$j("<div style='padding:2px 0px 0px 3px;font-weight:bold;color:#404040'>").appendTo(t).text(ASC.ttls(3508)+": "+i);var r=this.$rad_icons_d;r.empty(),["globals","classes","teachers","subjects","classrooms"].forEach(function(i){var t="globals"==i?"/timetable/pics/app/settings_32.png":h.CUtils.GetTableIcon(i),e=$j("<span>").appendTo(r);"globals"!=i&&e.text(n.m_pRadSelector.GetRadStr(i)),$j("<img>").prependTo(e).attr("src",t),e.click(function(t){if("globals"==i)n.m_pRadSelector.SetCelok(),s.InvalidateSelector();else{var e=n.OblastMenu(i);0<e.length&&ASC.showContextMenu(e,t)}})}),this.PripravList0();for(var o=null,a=0,l=this.m_List;a<l.length;a++){var c=l[a],d=this.m_pRozApp.m_pTriedyView.BuildRVKarta(c);d.onclick=this.m_OnMouseClickKarta;var m=c.m_nRozView_Ciselko;if(1<m){m=Math.min(m,5);for(var u=d;1<m;)u=ASC.createDiv(u,"viac"),m--}t.append(d),o&&(c.m_bRozView_Zasednut==o.m_bRozView_Zasednut&&c.m_nRozView_TypKarty==o.m_nRozView_TypKarty||$j(d).css("margin-left","10px")),d.ASC_mh=c,d.onmouseover=s.m_OnMouseOverKarta,d.onmouseout=s.m_OnMouseOutKarta,d.onclick=this.m_OnMouseClickKarta,d.oncontextmenu=this.m_OnMouseRightClickKarta,o=c}},n.prototype.PripravList0=function(){var e=this,t=this.m_pRozApp,i=t.m_pTriedyView;if(i&&i.m_pAktPohlad){var n=this.m_pRadSelector.GetVybraneHodiny(t.m_pTriedyView.m_nROJTF|k.ROJTF_FILTER_AKT_TWD),s=this.PripravList0_Obycajne(n),r=this.PripravList0_Ucebne(n),o=[],a=[],l=[];switch(i.m_pAktPohlad.GetRiadkyTable()){case"students":$j.merge(a,o),$j.merge(l,s),$j.merge(l,r);break;case"classrooms":$j.merge(a,r),$j.merge(a,s),$j.merge(l,o);break;default:$j.merge(a,s),$j.merge(l,r),$j.merge(l,o)}this.m_List=[],a.forEach(function(t){t.m_bRozView_Zasednut||e.m_List.push(t)}),a.forEach(function(t){t.m_bRozView_Zasednut&&e.m_List.push(t)}),l.forEach(function(t){t.m_bRozView_Zasednut=!0,e.m_List.push(t)})}},n.prototype.PripravList0_Obycajne=function(t){for(var e=this.m_pRozApp.m_pTriedyView.m_pAktPohlad,i=[],n={},s=0;s<t.length;s++)for(var r=t[s],o=0;o<r.m_Karty.length;o++)(d=r.m_Karty[o]).JeUmiestnena()||(i.push(d),n[d.m_Id]=!0);for(var a=[],l={},c=0;c<i.length;c++){var d;if(!l[(d=i[c]).m_Id]){l[d.m_Id]=!0;var m=new k.CMHodina(this.m_pRok);(m.m_nRozView_TypKarty=0)<d.m_pHodina.m_Triedy.length&&m.SetPozicia(d.m_pHodina.m_Triedy[0]),m.Add(d),m.FinishAdding(),a.push(m);var u=null,p=m.m_Objects.classes;for(s=0;s<p.length;s++){var h=p[s];u=u||h}for(u&&"classes"==e.m_Table&&m.SetPozicia(u),m.m_nRozView_Ciselko=1;;){for(var _=!1,f=[],v=0;v<m.m_Objects.lessons.length;v++){r=m.m_Objects.lessons[v];for(var b=!1,g=0;g<r.m_Karty.length;g++)if(!l[(y=r.m_Karty[g]).m_Id]&&n[y.m_Id]){f.push(y),b=!0;break}if(!b){_=!0;break}}if(_)break;for(m.m_nRozView_Ciselko++,g=0;g<f.length;g++){var y;l[(y=f[g]).m_Id]=!0}}}}return a},n.prototype.PripravList0_Ucebne=function(t){var n=[],s=this.m_pRok;return t.forEach(function(e){var i=null;e.m_Karty.forEach(function(t){e.IsUvazujUcebne()&&t.JeUmiestnena()&&!t.VsetkyUcebneValid()&&(null==i&&((i=new k.CMHodina(s)).m_nRozView_TypKarty=1,n.push(i)),i.Add(t),i.m_nRozView_Ciselko++,i.FinishAdding())})}),n},n.prototype.UpdatePodKurzorom=function(){var t=this.$podkurzorom_d,e=this.$kontrola_podkurzorom_d,i=this.m_pRozApp.m_PodKurzoromMHodina;if(t.empty(),e.empty(),i.IsEmpty())t.css("visibility","hidden"),e.hide();else{if(t.css("visibility","visible"),e.show(),"classroomsupervisions"!=i.m_ModeTable){var n=this.m_pRozApp.m_pTriedyView.BuildRVKarta(i);t.append(n)}for(var s=["subjects","classes","teachers","classrooms"],r=0;r<s.length;r++){var o=s[r];n=ASC.createDiv(t.get(0),"detail"),ASC.createChild(n,"img").src=h.CUtils.GetTableIcon(o),$j("<img>").appendTo(e).attr("src",h.CUtils.GetTableIcon(o));var a=c.CRokObject.ListIds(i.m_Objects[o]),l=this.m_pRok.dbi.rowNames(o,a,"short");1==a.length&&"classes"!=o&&"classrooms"!=o&&(l=l+" - "+this.m_pRok.dbi.rowNames(o,a)),"classes"==o&&(0<i.m_Skupiny.length&&(l+=" "+i.m_Skupiny.join(", ")),i.m_bSeminar&&(l+=" "+ASC.ttls(2609))),"subjects"==o&&"classroomsupervisions"==i.m_ModeTable&&(l=ASC.ttls(3294)),ASC.createText(n,l),$j("<span style='margin-right:5px'>").appendTo(e).text(l)}}this.m_bInvalidPodKurzorom=!1},n.prototype.ZobrazKontrolu=function(t,e){var n=this;this.m_pRozApp.m_nRozViewHeight<180&&(this.m_pRozApp.m_nRozViewHeight=180,this.UpdateHeight()),this.$kontrola_d.show(),this.$kontrola_chyby_d.empty();var i={width:"100%",height:"100%",cssClass:"base-dt",selectionMode:"single",idcol:"id",formatRow:function(t,e){$j(t).toggleClass("inactive",!!e.getData("locked"))}},s=[];t.forEach(function(t){s.push(t.GridRow())});for(var r={},o=0,a=["teachers","classes","classrooms","subjects","students","lessons","cards","classsubjects","globals"];o<a.length;o++){var l=a[o];r[l]=h.CUtils.GetTableIcon(l)}var c=[{key:"zgrc",width:16,label:" ",formatter:function(l,c,d,t){var e=$j(l);e.empty().css({textAlign:"center"}).off();var m=n.m_pRozApp.m_ChybaItemsI[c.getData("id")],i="";if(m.IsZgrcnuta()){var u=d.table;e.css("cursor","pointer"),"+"==t?(i="/global/pics/ui/tree_plus.png",e.click(function(t){c.setData("zgrc","-"),d.formatter(l,c,d,c.getData("zgrc")),t.stopPropagation();for(var e=u.rows.indexOf(u.findDataRow(""+m.m_Id))+1,i=0,n=m.m_ZgrcnuteChyby;i<n.length;i++){var s=n[i];u.addRow(s.GridRow(),e++)}})):(i="/global/pics/ui/tree_minus.png",e.click(function(t){c.setData("zgrc","+"),d.formatter(l,c,d,c.getData("zgrc")),t.stopPropagation();for(var e=[],i=0,n=m.m_ZgrcnuteChyby;i<n.length;i++){var s=n[i];e.push(s.m_Id)}for(var r=0,o=e;r<o.length;r++){var a=o[r];u.ASC_deleteRow(a)}}))}else m.m_pZgrcParent&&(i="/global/pics/ui/tree_sub.png");i&&$j("<img>").appendTo(e).attr("src",i)}},{key:"icon",width:16,label:" ",icons:r},{key:"object",width:170,label:ASC.ttls(3181)},{key:"icon2",width:16,label:" ",icons:{bad:"/timetable/pics/app/bug_small_16.png",ok:"/timetable/pics/app/ok_small_16.png",optimize:"/timetable/pics/app/importance_optimize_16.png",warning:"/timetable/pics/app/warning_32.png"}},{key:"description",width:500,label:ASC.ttls(1276),resizable:!0}],d=new ASC.ui.dt.DataTable($j("<div>").appendTo(this.$kontrola_chyby_d),c,new ASC.ui.dt.DataSource(s),i);d.fitWidth(),d.subscribe("select",function(){var t=n.m_pRozApp,e=d.ASC_getSelectedRowId();if(e){var i=t.m_ChybaItemsI[e];if(!e)throw"Error 9199507004";n.SetKontrolaItem(i)}});var m=ASC.ttls(1269),u="/timetable/pics/app/verification_128.png";"compare"==e&&(m=ASC.ttls(2819),u="/timetable/pics/app/office/compare_64.png"),this.$kontrola_detail_d.empty();var p=$j("<div style='text-align: center'>").appendTo(this.$kontrola_detail_d);p.text(m),p.append("<br>"),p.append("<img src='"+u+"' style='margin-top:20px'>"),this.$kontrola_podkurzorom_d.empty()},n.prototype.ZrusKontrolu=function(){this.$kontrola_d.hide()},n.prototype.SetKontrolaItem=function(t){var e=this,i=this.m_pRozApp,n=i.m_pTriedyView;if(i.m_pKontrolaItem!=t){i.m_pKontrolaItem=t,i.InvalidateTriedyViewRiadky(),this.$kontrola_detail_d.empty(),$j("<div style='color:#0a539a;font-weight:bold;margin-bottom:5px'>").appendTo(this.$kontrola_detail_d).html(ASC.ttls(1034));var s=t.m_TextDetaily,r=ASC.escapeHTML(s);r=r.split("&lt;imgchyba&gt;").join("<img src='/timetable/pics/app/bug_small_16.png'>"),$j("<div>").appendTo(this.$kontrola_detail_d).html(r);var o=$j("<div style='position:absolute;right:5px;bottom:0px'>").appendTo(this.$kontrola_detail_d);t.m_HelpID&&$j("<a style='cursor:pointer;margin-left:10px'>").prependTo(o).click(function(){e.m_pRozApp.ShowHelp(t.m_HelpID)}).text(ASC.ttls(3050)).prepend("<img src='/global/pics/ui/help_32.png' style='vertical-align:middle;margin-right:3px'>");var a=null,l=t.m_pNastavObject;switch(t.m_Nastav){case"edit":case"timeoff":case"constraints":l&&(a=function(){e.m_pRozApp.click_func(t.m_Nastav,"table="+l.m_Table+"&id="+l.m_Id)});break;case"constraints-advanced":"classes"==l.m_Table&&l&&(a=function(){e.m_pRozApp.click_func("constraints","table="+l.m_Table+"&id="+l.m_Id)});break;case"vztahadv":l&&(a=function(){e.m_pRozApp.click_func("edit","table="+l.m_Table+"&id="+l.m_Id)})}if(a&&$j("<a style='cursor:pointer'>").prependTo(o).click(function(){a()}).text(ASC.ttls(1680)).prepend("<img src='/global/pics/ui/settings_32.png' style='vertical-align:middle;margin-right:3px'>"),!t.ScrollTo()){var c=n.GetPohladForTable(t.GetIdealPohladTable());c&&(n.SetAktPohlad(c),t.ScrollTo())}}},n.prototype.RightClickPendingArea=function(t){var e=this,i=[],n=this.m_pRozApp.m_pRadSelector;h.CUtils.AddMenuItemSmart(i,"",{text:ASC.ttls(1607),checked:n.JeCelok(),onclick:function(){n.SetCelok(),e.m_pRozApp.InvalidateSelector()}}),i.push([]);for(var s=0,r=["classes","teachers","subjects","classrooms"];s<r.length;s++){var o=r[s];h.CUtils.AddMenuItemSmart(i,"",{text:h.CUtils.GetTableName(o),checked:n.m_Table==o,submenu:this.OblastMenu(o)})}i.push([]),h.CUtils.AddMenuItemSmart(i,"filter",{text:ASC.ttls(3508),submenu:h.CUtils.AdvFilterMenuBuild(n.m_nAdvFilterOptions),checked:0!=n.m_nAdvFilterOptions}),i.push([]),h.CUtils.AddMenuItemSmart(i,"test",{onclick:function(){e.m_pRozApp.click_func("generate",n.JeCelok()?"":"mode=test_sel")}}),ASC.showContextMenu(i,t,{handler:function(t){"advfilter"==t.cmd&&(n.m_nAdvFilterOptions=h.CUtils.AdvFilterMenuHandle(t,n.m_nAdvFilterOptions),e.m_pRozApp.InvalidateSelector())}})},n.prototype.OblastMenu=function(t){var e=this,i=[],n=this.m_pRozApp.m_pRadSelector;return this.m_pRok.TableObjects(t).forEach(function(t){h.CUtils.AddMenuItemSmart(i,"",{text:h.CUtils.GetUINazov(t),data:t,checked:n.IsInRad(t),onclick:function(){n.SetCelok(),n.AddRadObject(t),e.m_pRozApp.InvalidateSelector()}})}),i},n.prototype.RightClickKarta=function(t,e){var i=[],n=this.m_pRozApp,s=e.GetJedinaKarta(),r=n.m_pTriedyView,o="";switch(o=s?h.CUtils.GetUINazov(s,"short"):h.CUtils.GetUINazvy(e.Predmety(),"short"),e.m_nRozView_TypKarty){case 0:o=ASC.ttls(3497)+" - "+o;break;case 1:o=ASC.ttls(3499)+" - "+o;break;case 2:o=ASC.ttls(3493)+" - "+o}var a=o;switch(1<e.m_nRozView_Ciselko&&(o+=" ("+e.m_nRozView_Ciselko+"x)"),e.m_nRozView_TypKarty){case 0:if(h.CUtils.AddMenuItemSmart(i,"",{text:ASC.ttls(4054),onclick:function(){n.Chyt(e)}}),1<e.Karty().length){i.push([]);var l=[];e.Karty().forEach(function(t){h.CUtils.AddMenuItemSmart(l,"",{text:h.CUtils.GetUINazov(t),data:t,onclick:function(){n.ChytKartu(t)}})}),h.CUtils.AddMenuItemSmart(i,"",{text:ASC.ttls(2958),submenu:l})}break;case 1:h.CUtils.AddMenuItemSmart(i,"",{text:ASC.ttls(1761),onclick:function(){n.Chyt(e)}})}i.push([]),e.Hodiny().length&&e.GetJedinaHodina()&&e.GetJedinaHodina().UI_HodinaPopup(i,r),ASC.showContextMenu(i,t,{header:ASC.escapeHTML(a)})},n);function n(i,t){var e=this;this.m_bInvalid=!1,this.m_bInvalidPodKurzorom=!1,this.m_List=[],this.m_pRozApp=i,this.$div=t,this.m_pRadSelector=this.m_pRozApp.m_pRadSelector,this.m_pRok=this.m_pRozApp.m_pRok,this.$div.addClass("rozview"),this.$pending_d=$j("<div class='pending-area'>").appendTo(this.$div),this.$podkurzorom_d=$j("<div class='podkurzorom'>").appendTo(this.$div),this.$rad_icons_d=$j("<div class='rad_icons'>").appendTo(this.$div),this.$kontrola_d=$j("<div class='kontrola'>").appendTo(this.$div).hide(),this.$kontrola_detail_d=$j("<div class='detail'>").appendTo(this.$kontrola_d),this.$kontrola_chyby_d=$j("<div class='chyby'>").appendTo(this.$kontrola_d),this.$kontrola_podkurzorom_d=$j("<div class='kontrola_podkurzorom'>").appendTo(this.$kontrola_d),this.$div.mousemove(function(t){e.m_pRozApp.CursorMove(t)}),this.$pending_d.click(function(t){e.m_pRozApp.OdhodKartu()}),this.$pending_d.on("contextmenu",function(t){ASC.hideContextMenu(),i.m_TahanaMHodina.IsEmpty()?e.RightClickPendingArea(t):i.OdhodKartu(),t.stopPropagation(),t.preventDefault()});var n=this;this.m_OnMouseClickKarta=function(t){if(ASC.hideContextMenu(),i.m_TahanaMHodina.IsEmpty()){var e=this.ASC_mh;e.m_bRozView_Zasednut?n.RightClickKarta(t,e):n.m_pRozApp.Chyt(e)}else i.OdhodKartu();t.stopPropagation()},this.m_OnMouseRightClickKarta=function(t){if(ASC.hideContextMenu(),i.m_TahanaMHodina.IsEmpty()){var e=this.ASC_mh;n.RightClickKarta(t,e)}else i.OdhodKartu();t.stopPropagation(),t.preventDefault()}}t.CRozView=i;var s,r,o,a=(l.prototype.SetCelok=function(){this.m_Table="globals",this.m_Objects.length=0,this.m_nAdvFilterOptions=0},l.prototype.JeCelok=function(){return"globals"==this.m_Table&&0==this.m_nAdvFilterOptions},l.prototype.AddRadObject=function(t){var e=t.m_Table;e!=this.m_Table&&(this.m_Table=e,this.m_Objects.length=0),this.m_Objects.indexOf(t)<0&&this.m_Objects.push(t)},l.prototype.RemoveRadObject=function(t){t.m_Table==this.m_Table&&(h.CUtils.FastRemove(this.m_Objects,t),0==this.m_Objects.length&&(this.m_Table="globals"))},l.prototype.IsInRad=function(t){return this.m_Table==t.m_Table&&0<=this.m_Objects.indexOf(t)},l.prototype.GetVybraneHodiny=function(t){var e=[],i=this.m_pRok.m_ObjectsO.lessons;switch(this.m_Table){case"classes":case"teachers":case"subjects":for(var n=0;n<this.m_Objects.length;n++)h.CUtils.AddListToSet(this.m_Objects[n].GetHodinyMozuSem(t),e);break;default:for(n=0;n<i.length;n++){var s=i[n];e.push(s)}}for(var r=[],o=0,a=e;o<a.length;o++)s=a[o],h.CUtils.AdvFilterPass(this.m_nAdvFilterOptions,s,null)&&r.push(s);return r},l.prototype.GetJediny=function(){return 1==this.m_Objects.length?this.m_Objects[0]:null},l.prototype.GetRadList=function(){return ASC.cloneArray(this.m_Objects)},l.prototype.GetRadStr=function(t){return t!=this.m_Table?"":h.CUtils.GetUINazvy(this.m_Objects,"short")},l.prototype.GetSimplePopis=function(t){void 0===t&&(t=!1);var e="";if("globals"==this.m_Table)t&&0!=this.m_nAdvFilterOptions||(e="All");else{var i=this.GetRadList();if(!i)return"???";e=i.length<=4?h.CUtils.GetUINazvy(i,i.length<=1?"short_name":"short"):i.length+" "+h.CUtils.GetTableItemTypNazov(this.m_Table,i.length)}return e=e.replace("\t"," "),t&&0!=this.m_nAdvFilterOptions&&(""!=e&&(e+=", "),e+=h.CUtils.AdvFilterPopis(this.m_nAdvFilterOptions)),e},l);function l(t){this.m_Table="globals",this.m_Objects=[],this.m_nAdvFilterOptions=0,this.m_pRozApp=t,this.m_pRok=this.m_pRozApp.m_pRok}t.CRadSelector=a,(r=s=t.CHYBAITEMIKONA||(t.CHYBAITEMIKONA={}))[r.CHYBAITEMIKONA_OK=0]="CHYBAITEMIKONA_OK",r[r.CHYBAITEMIKONA_CHYBA=1]="CHYBAITEMIKONA_CHYBA",r[r.CHYBAITEMIKONA_WARNING=2]="CHYBAITEMIKONA_WARNING",r[r.CHYBAITEMIKONA_OPTIMIZE=3]="CHYBAITEMIKONA_OPTIMIZE",(o=t.WARNINGTTYPE||(t.WARNINGTTYPE={}))[o.WT_NIC=0]="WT_NIC",o[o.WT_NESPLNITELNA=1]="WT_NESPLNITELNA",o[o.WT_NEIMPLEMENTOVANA_VIACDELENI=2]="WT_NEIMPLEMENTOVANA_VIACDELENI",o[o.WT_NEIMPLEMENTOVANA_CYKLUSVTRIEDE=3]="WT_NEIMPLEMENTOVANA_CYKLUSVTRIEDE",o[o.WT_VYPNUTA=4]="WT_VYPNUTA",o[o.WT_NEIMPLEMENTOVANA_CYKLUSHODINY=5]="WT_NEIMPLEMENTOVANA_CYKLUSHODINY",o[o.WT_CHYBNA=6]="WT_CHYBNA",o[o.WT_NEIMPLEMENTOVANA=7]="WT_NEIMPLEMENTOVANA",o[o.WT_VYPNUTA_VELA_KARIET=8]="WT_VYPNUTA_VELA_KARIET";var d=(m.prototype.FindRiadok=function(t){for(var e=0,i=this.m_Riadky;e<i.length;e++){var n=i[e];if(n.m_pRiadokObject==t)return n}return null},m.prototype.GridRow=function(){var t={id:this.m_Id,zgrc:"",icon:this.m_pKde?this.m_pKde.m_Table:"",object:h.CUtils.GetUINazov2(this.m_pKde,this.m_pKde2,"short_name"),icon2:"",description:this.m_Text,locked:this.m_bLocked};switch(this.m_nIkona){case s.CHYBAITEMIKONA_CHYBA:t.icon2="bad";break;case s.CHYBAITEMIKONA_OK:t.icon2="ok";break;case s.CHYBAITEMIKONA_OPTIMIZE:t.icon2="optimize";break;case s.CHYBAITEMIKONA_WARNING:t.icon2="warning"}if(this.IsZgrcnuta()){t.object=this.m_ZgrcnuteChyby.length+"x",t.zgrc="+";var e=this.m_ZgrcnuteChyby[0];t.icon=e.m_pKde?e.m_pKde.m_Table:""}else this.m_pZgrcParent&&(t.zgrc=".");return this.m_bHeuristika&&(t.description=ASC.ttls(3635)+": "+t.description),""!=this.m_TextAppend&&(t.description+=": "+this.m_TextAppend),t},m.prototype.ScrollTo=function(){var t=this.m_pRok.m_pRozApp,e=t.m_pTriedyView;t.Validate();for(var i=[],n=0,s=e.m_Riadky;n<s.length;n++){var r=s[n];this.FindRiadok(r.m_pRokObject)&&i.push(r)}return 0!=i.length&&(e.ScrollToRiadky(i),!0)},m.prototype.GetIdealPohladTable=function(){for(var t=["teachers","classes","students","classrooms","subjects"],e=0,i=this.m_Riadky;e<i.length;e++){var n=i[e].m_pRiadokObject.m_Table;if(0<=t.indexOf(n))return n}return""},m.prototype.GetKdeTable=function(){return this.m_pKde?this.m_pKde2&&"classes"==this.m_pKde.m_Table&&"subjects"==this.m_pKde2.m_Table?"classsubjects":this.m_pKde.m_Table:""},m.prototype.IsZgrcnuta=function(){return 0<this.m_ZgrcnuteChyby.length},m.nextId=1,m);function m(t,e){if(this.m_pKde=null,this.m_pKde2=null,this.m_PodmienkaNazov="",this.m_HelpID="",this.m_Text="",this.m_TextAppend="",this.m_TextDetaily="",this.m_bLocked=!1,this.m_bHeuristika=!1,this.m_nIkona=-1,this.m_nWarningType=-1,this.m_Nastav="",this.m_pNastavObject=null,this.m_ZgrcnuteChyby=[],this.m_pZgrcParent=null,this.m_Riadky=[],this.m_pRok=t,this.m_Id=""+m.nextId++,t.m_pRozApp.m_ChybaItemsI[this.m_Id]=this,e){this.m_PodmienkaNazov=e.m_PodmienkaNazov,this.m_HelpID=e.m_HelpID,this.m_Text=e.m_Text,this.m_TextAppend=e.m_TextAppend,this.m_TextDetaily=e.m_TextDetaily,this.m_bLocked=e.m_bLocked,this.m_bHeuristika=e.m_bHeuristika,this.m_nIkona=e.m_nIkona,this.m_nWarningType=e.m_nWarningType,this.m_pKde=t.decodeRo(e.m_pKde),this.m_pKde2=t.decodeRo(e.m_pKde2),this.m_Nastav=e.m_Nastav,this.m_pNastavObject=t.decodeRo(e.m_pNastavObject);for(var i=0,n=e.m_Riadky;i<n.length;i++){var s=n[i];this.m_Riadky.push(new u(this,s))}if(e.m_ZgrcnuteChyby)for(var r=0,o=e.m_ZgrcnuteChyby;r<o.length;r++){var a=new m(t,o[r]);this.m_ZgrcnuteChyby.push(a),a.m_pZgrcParent=this}}}t.CChybaItem=d;var u=function(t,e){this.m_RelevantneHodiny={},this.m_ZleKarty={},this.m_pChybaItem=t,this.m_pRiadokObject=t.m_pRok.decodeRo(e.m_pRiadokObject);for(var i=0,n=e.m_RelevantneHodiny;i<n.length;i++){var s=n[i];this.m_RelevantneHodiny[s]=!0}for(var r=0,o=e.m_ZleKarty;r<o.length;r++)s=o[r],this.m_ZleKarty[s]=!0;this.m_pVysvietZle=e.m_pVysvietZle,this.m_pVysviet1=e.m_pVysviet1,this.m_pVysviet2=e.m_pVysviet2};t.CChybaItemRiadok=u}),ASC.setModuleSourceFunc("/timetable/app/rokobject.js",function(n,require,t){n.__esModule=!0;var e=require("tslib");n.nMaxVyucHodin=32,n.nMaxDniVTyzdni=10,n.nMaxTyzdnov=20,n.nMaxTermov=12,n.nMaxDuration=8,n.ttapp_needed_part={globals:["name","settings","year","reg_name"],ttreports:["typ","name","page_tables","row_tables","column_tables","celltype","cellwidth","cellheight","fitwidth","fitheight","landscape","repeatpage","splitpage_w","splitpage_h","withclassroomtt","hideemptyrows","hideemptycolumns","headerwidth","headerheight","cardstyles","cardcolorenabled","cardcolortable1","cardcolortable2","cardcolorpos","classroomsupervisionstyle","gridheadertexts","pageheader","pageheaderprefixenabled","userheader","printlogo","settings"],periods:["period","name","short","starttime","endtime","daydata","printinsummary","printinteacher","printinclass","printinclassroom","printonlyinbell"],breaks:["break","name","short","starttime","endtime","daydata","printinsummary","printinteacher","printinclass","printinclassroom","printonlyinbell"],bells:["bell","perioddata","breakdata"],daysdefs:["name","short","typ","vals","val"],weeksdefs:["name","short","typ","vals","val"],termsdefs:["name","short","typ","vals","val"],teachers:["firstname","lastname","nameprefix","namesuffix","short","bell","color","fontcolorprint","fontcolorprint2","fontcolorscreen","timeoff"],classes:["name","short","teacherid","classroomids","bell","color","timeoff","printsubjectpictures"],groups:["name","classid","entireclass","ascttdivision","okgroup","students_count"],subjects:["name","short","color","picture","timeoff"],buildings:["name","short","color"],classrooms:["name","short","sharedroom","buildingid","needssupervision","color","nearbyclassroomids"],students:["firstname","lastname","classid","groupids","short"],lessons:["subjectid","teacherids","groupids","classids","count","durationperiods","classroomidss","termsdefid","weeksdefid","daysdefid","terms","seminargroup","bell"],cards:["lessonid","period","days","weeks","classroomids"],studentsubjects:["studentid","subjectid","seminargroup","importance","locked"],classroomsupervisions:["classroomid","teacherid","day","week","term","period","break","locked"]};var s=(i.prototype.InitFromData=function(){},i.prototype.BeforeRemove=function(){},i.prototype.GetNazov=function(t){return void 0===t&&(t="name"),this.m_pRok.dbi.rowName(this.m_Table,this.m_Id,t)},i.prototype.GetSkratka=function(){return this.m_pRok.dbi.rowName(this.m_Table,this.m_Id,"short")},i.prototype.GetColor=function(){return""+this.m_Data.color},i.prototype.GetDBIndex=function(){return this.m_pRok.m_ObjectsO[this.m_Table].indexOf(this)},i.prototype.HodinaMozeSem=function(t,e){return!0},i.prototype.GetHodinyMozuSem=function(t){var e=this.m_pRok.m_ObjectsI.lessons,i=[];for(var n in e){var s=e[n];this.HodinaMozeSem(s,t)&&i.push(s)}return i},i.prototype.GetKartyMozuSem=function(t){var e=[];return this.GetHodinyMozuSem(t).forEach(function(t){$j.merge(e,t.m_Karty)}),e},i.prototype.GetKartyTu=function(t){var e=this.GetHodinyMozuSem(t),i=[];for(var n in e){var s=e[n];for(var r in s.m_Karty){var o=s.m_Karty[r];this.KartaJeTu(o,t)&&i.push(o)}}return i},i.prototype.GetKartyTuTWDH=function(t,e,i,n,s){for(var r=this.GetKartyTu(s),o=[],a=0;a<r.length;a++){var l=r[a];l.JeTu_TWDH(t,e,i,n)&&o.push(l)}return o},i.prototype.KartaJeTu=function(t,e){return!!t.JeUmiestnena()&&this.HodinaMozeSem(t.m_pHodina,e)},i.ListIds=function(t){for(var e=[],i=0;i<t.length;i++)e.push(t[i].m_Id);return e},i.prototype.UI_KartaVyberOdtialto=function(t,e,i,n){return!i.IsLocked()&&(t.InvalidateKarta(i),i.DeUmiestniKarta(),t.InvalidatePending(),t.ChytKartu(i,this),t.CursorMove(n),!0)},i.prototype.UI_KartaUmiestni=function(e,t,i,n){for(var s=e.m_pRok,r=t.m_Objects.cards,o=null,a=0;a<r.length;a++)if(!(f=r[a]).JeUmiestnena()){if(!this.HodinaMozeSem(f.m_pHodina,e.m_pTriedyView.m_nROJTF))return;o=o||f}if(o&&o.Obdobia_MozeSem_TWDH(i.m_nTerm,i.m_nWeek,i.m_nDay,i.period)){var l=o.m_pHodina.GetTermPrvyDobry(i.m_nTerm),c=o.m_pHodina.GetWeekPrvyDobry(i.m_nWeek),d=o.m_pHodina.GetDenPrvyDobry(i.m_nDay),m=i.period;if(1<o.m_pHodina.m_pTermMozny.m_BitovePole.length){var u=[];for(a=0;a<r.length;a++)if((f=r[a]).m_pHodina.GetTerm()!=l)for(var p=0;p<f.m_pHodina.m_Karty.length;p++){var h=f.m_pHodina.m_Karty[p];h.JeUmiestnena&&u.push(h)}if(0<u.length)return void alert("Lesson is already in another term")}u=[];var _=[];for(a=0;a<r.length;a++){var f=r[a];s.ChangePosKarta_TWDH(f,l,c,d,m,!1),f.SimpleKolizie(u),f.SimpleKolizie(_,!0),f.DeUmiestniKarta()}var v=function(){r.forEach(function(t){s.ChangePosKarta_TWDH(t,l,c,d,m,!0),e.InvalidateKarta(t)}),e.InvalidatePending();var t=e.m_bTahanaDajKontrolu;e.OdhodKartu(),t&&(e.m_bTahanaDajKontrolu=!1,e.ClickVerification("verification","sel"))},b=function(){u.forEach(function(t){t.IsLocked()||(t.DeUmiestniKarta(),e.InvalidateKarta(t))}),v()};if(0!=u.length){for(var g=!1,y=0,k=u;y<k.length;y++)k[y].IsLocked()&&(g=!0);if(1==u.length&&!g&&this.KartaJeTu(u[0],e.m_pTriedyView.m_nROJTF)&&!n.shiftKey)return b(),void e.ChytKartu(u[0]);var C=[];u.forEach(function(t){C.push({text:Q.CUtils.GetUINazov(t),icon:Q.CUtils.GetIconLocked(t.IsLocked(),!0)||Q.CUtils.GetIconNic(),disabled:g,onclick:function(){b(),e.ChytKartu(t)}})}),C.push([]),g||C.push({text:ASC.ttls(3448),icon:Q.CUtils.GetIconOK(),onclick:function(){b()}}),C.push({text:ASC.ttls(1007),icon:Q.CUtils.GetIconNic(),onclick:function(){}}),C.push([]),C.push({text:ASC.ttls(3449),icon:Q.CUtils.GetIconNic(),onclick:function(){v()}}),ASC.showContextMenu(C,n,{header:ASC.ttls(3447)+":"})}else v()}},i.prototype.UI_RiadokPopup=function(t,e){},i.prototype.UI_OnCommand=function(e,t,i){var n=this;void 0===i&&(i=null);var s=t.m_pRozApp;switch(e){case"edit":case"timeoff":case"lessons":return s.click_func(e,"table="+this.m_Table+"&id="+this.m_Id),!0;case"constraints":return Promise.resolve().then(function(){return require("./constraints")}).then(function(t){return t.showTTDocConstraintsDlg(n.m_pRok.m_pRozApp.ttgpid,n.m_Table,n.m_Id)}),!0;case"deletecards":case"lockcards":case"unlockcards":return this.GetKartyTu(t.m_nROJTF).forEach(function(t){switch(e){case"deletecards":t.IsLocked()||(s.InvalidateKarta(t),t.DeUmiestniKarta());break;case"lockcards":t.IsLocked()||(s.InvalidateKarta(t),t.SetLocked(!0));break;case"unlockcards":t.IsLocked()&&(s.InvalidateKarta(t),t.SetLocked(!1))}}),!0;case"removecard":var r=i;s.InvalidateKarta(r),r.DeUmiestniKarta();break;case"lockcard":r=i,s.InvalidateKarta(r),r.SetLocked(!0);break;case"unlockcard":r=i,s.InvalidateKarta(r),r.SetLocked(!1)}return!1},i.prototype.AddKartyTuK=function(t,e,i){if(e.JeUmiestnena())for(var n=e.GetHodinaOd();n<=e.GetHodinaDo();n++)for(var s=0;s<=this.m_pRok.m_nTermov;s++)for(var r=0;r<this.m_pRok.m_nTyzdnov;r++)for(var o=0;o<this.m_pRok.m_nDni;o++)e.JeTu_TWDH(s,r,o,n)&&this.AddKartyTu(t,s,r,o,n,i)},i.prototype.AddKartyTu=function(t,e,i,n,s,r){for(var o=this.GetKartyTu(r),a=0;a<o.length;a++){var l=o[a];l.JeTu_TWDH(e,i,n,s)&&t.indexOf(l)<0&&t.push(l)}},i.prototype.GetObsadenieK=function(t){var e=[];return this.AddKartyTuK(e,t,0),e},i.prototype.UI_KartaMozeSem=function(t,e){for(var i=e.m_Objects.cards,n=0;n<i.length;n++){var s=i[n];if(!s.JeUmiestnena()&&this.HodinaMozeSem(s.m_pHodina,t.m_pTriedyView.m_nROJTF))return!0}return!1},i.prototype.UI_GetKartyNaPolicko=function(t,a){var l=this,c=[];return this.GetKartyMozuSem(t.m_nROJTF).forEach(function(t){if(!t.JeUmiestnena()&&t.Obdobia_MozeSem_TWDH(a.m_nTerm,a.m_nWeek,a.m_nDay,a.period,!0)){var e=t.m_pHodina.GetTermPrvyDobry(a.m_nTerm),i=t.m_pHodina.GetWeekPrvyDobry(a.m_nWeek),n=t.m_pHodina.GetDenPrvyDobry(a.m_nDay),s=a.period,r=[];l.m_pRok.ChangePosKarta_TWDH(t,e,i,n,s,!1);var o=l.m_pRok.VhodnostKarty_PUT(t);t.SimpleKolizie(r),t.DeUmiestniKarta(),"0"!=o&&(0<r.length||c.push(t))}}),c},i.prototype.GetSaveID=function(){return this.m_pRok.m_ObjectsO[this.m_Table].indexOf(this)},i);function i(t,e,i){this.m_pRok=t,this.m_Table=e,this.m_Id=""+i.id,this.m_Data=i,0<=["teachers","classes","classrooms","subjects"].indexOf(this.m_Table)&&(this.m_pVolno=new Q.CVolno(this))}n.CRokObject=s;var r,o=(r=s,e.__extends(a,r),a.prototype.StructureFromData=function(){this.m_nHodinyOd=32;for(var t=this.m_nHodinyDo=0;t<n.nMaxVyucHodin;t++)this.GetPeriod(t)&&(this.m_nHodinyOd=Math.min(this.m_nHodinyOd,t),this.m_nHodinyDo=Math.max(this.m_nHodinyDo,t));var e={terms:"",weeks:"",days:""};for(var i in e)for(;this.GetObdobie_One(i,e[i].length);)e[i]+="1";this.m_nDni=e.days.length,this.m_nTyzdnov=e.weeks.length,this.m_nTermov=e.terms.length,this.m_DaysAll=e.days,this.m_WeeksAll=e.weeks,this.m_TermsAll=e.terms},a.prototype.addRow=function(t,e){var i;switch(t){case"cards":i=new j(this,e);break;case"lessons":i=new E(this,e);break;case"classes":i=new m(this,e);break;case"teachers":i=new b(this,e);break;case"subjects":i=new k(this,e);break;case"students":i=new T(this,e);break;case"studentsubjects":i=new R(this,e);break;case"classrooms":i=new O(this,e);break;case"groups":i=new d(this,e);break;case"termsdefs":case"weeksdefs":case"daysdefs":i=new U(this,t,e);break;case"periods":i=new L(this,e);break;case"breaks":i=new J(this,e);break;case"ttreports":i=new et.CTlacZostava(this,e);break;case"ttviews":i=new Q.CPohlad(this,e);break;case"classroomsupervisions":i=new X(this,e);break;default:i=new s(this,t,e)}return this.m_ObjectsO[t].push(i),this.m_ObjectsI[t][e.id]=i},a.prototype.deleteRow=function(t,e){var i=this.m_ObjectsI[t][e];if(i){i.BeforeRemove(),delete this.m_ObjectsI[t][e];var n=this.m_ObjectsO[t],s=n.indexOf(i);n.splice(s,1)}},a.prototype.ids2ro=function(t,e){for(var i=[],n=0;n<e.length;n++)i.push(this.m_ObjectsI[t][e[n]]);return i},a.prototype.ChangePosKarta_TWDH=function(t,e,i,n,s,r){void 0===r&&(r=!1);var o=t.m_pHodina;ASC.assert(o.m_pTermMozny.IsCompatible(e)),ASC.assert(o.m_pTyzdenMozny.IsCompatible(i)),ASC.assert(o.m_pDenMozny.IsCompatible(n)),t.SetPosition(n,s,e,i),r&&t.DajUcebnu()},a.prototype.GetObdobie_bits=function(t,e){for(var i=this.m_ObjectsO[t+"defs"],n=0;n<i.length;n++){var s=i[n];if(1==s.m_BitovePole.length&&s.m_BitovePole[0]==e)return s}return null},a.prototype.GetDen_bits=function(t){return this.GetObdobie_bits("days",t)},a.prototype.GetObdobieCount=function(t){switch(t){case"terms":return this.m_nTermov;case"weeks":return this.m_nTyzdnov;case"days":return this.m_nDni}throw"Error 2260283089"},a.prototype.GetObdobie_One=function(t,e){for(var i=this.m_ObjectsO[t+"defs"],n=0;n<i.length;n++){var s=i[n];if("one"==s.m_Typ&&s.m_Val==e)return s}return null},a.prototype.GetPeriod=function(t,e){return void 0===e&&(e=!1),e?this.m_ObjectsI.breaks[t]:this.m_ObjectsI.periods[t]},a.prototype.VhodnostKarty_PUT=function(e){var t=e.m_pHodina,i=t.m_pPredmet.m_pVolno.GetKarta(e);return t.m_Triedy.forEach(function(t){i=Q.CVolno.vhod_min(i,t.m_pVolno.GetKarta(e))}),t.m_Ucitelia.forEach(function(t){i=Q.CVolno.vhod_min(i,t.m_pVolno.GetKarta(e))}),i},a.prototype.TableObjects=function(t){switch(t){case"days":case"weeks":case"terms":for(var e=[],i=0,n=this.m_ObjectsO[t+"defs"];i<n.length;i++){var s=n[i];"one"==s.m_Typ&&e.push(s)}return e;default:return this.m_ObjectsO[t].slice()}},a.prototype.Obdobia=function(t){switch(t){case"termsdefs":case"weeksdefs":case"daysdefs":return this.TableObjects(t)}throw"Error 8110791570"},a.prototype.GetRegName=function(t){void 0===t&&(t=!1);var e="";this.m_pRozApp&&(e=this.m_pRozApp.jsc.reg_name);var i=this.dbi.rowData("globals","1");return i&&i.reg_name&&(e=i.reg_name),e||"Unregistered version"},a.prototype.decodeRo=function(t){if(!t)return null;var e=t[0],i=t[1];return"globals"==e?this:this.m_ObjectsI[e][i]},a.prototype.object2ro=function(t){return t?this.decodeRo([t.table,t.id]):null},a.prototype.FindTableTlacZostava=function(t){for(var e=0,i=this.m_ObjectsO.ttreports;e<i.length;e++){var n=i[e];if(0<=n.m_PageTables.indexOf(t))return n}return null},a.prototype.GetDozoryTWDH=function(t,e,i,n,s,r){for(var o=[],a=0,l=this.m_ObjectsO.classroomsupervisions;a<l.length;a++){var c=l[a];c.m_pUcitel!=t&&c.m_pUcebna!=t||(n<0||c.m_Den<0||c.m_Den==n)&&c.m_Hodina==s&&c.m_Prestavka==r&&(i<0||c.m_Tyzden<0||i==c.m_Tyzden)&&(e<0||c.m_Term<0||e==c.m_Term)&&o.push(c)}return o},a.prototype.GetPeriodTime=function(t,e){for(var i=null,n=null,s=null,r=null,o=0,a=t;o<a.length;o++){var l=a[o];l instanceof m&&(i=l),l instanceof T&&(i=l.m_pTrieda),l instanceof b&&(n=l),l instanceof K&&(s=l),"daysdefs"==l.m_Table&&(r=l)}return!i&&e&&0<e.m_Triedy.length&&(i=e.m_Triedy[0]),null==s?{starttime:"00:00",endtime:"00:00"}:s.GetTime(r?r.m_Val:-1,i,n,e)},a.prototype.GetHodinaNazov=function(t,e){void 0===e&&(e=!1);var i=this.GetPeriod(t,e);return i?i.GetSkratka():e?(0<t?this.GetHodinaNazov(t-1,!1):"")+"/"+this.GetHodinaNazov(t,!1):"???"+t},a.prototype.GlobalData=function(){return this.m_ObjectsI.globals[1].m_Data},a.prototype.GetJoinNames=function(t){try{return this.GlobalData().settings.name_format}catch(t){return"FSL"}},a.prototype.FormatTime=function(t){if(!t)return"";var e=t.split(":"),i=parseInt(e[0]),n=parseInt(e[1]),s=i<12?"AM":"PM",r=12<i?i-12:i;function o(t){return t<10?"0"+t:t}switch(parseInt(this.GlobalData().settings.m_nTimeFormat)){case 0:default:return i+":"+o(n);case 1:return o(i)+":"+o(n);case 2:return r+":"+o(n)+" "+s;case 3:return o(r)+":"+o(n)+s;case 4:return r+":"+o(n);case 5:return o(r)+":"+o(n)}},a.prototype.FormatTimeFromTo=function(t,e){for(var i=this.FormatTime(t),n=this.FormatTime(e),s=0,r=["AM","PM"];s<r.length;s++){var o=r[s];0<=n.indexOf(o)&&(i=i.replace(o,""))}return i.trim()+" - "+n.trim()},a);function a(){var t=r.call(this,null,"globals",{})||this;for(var e in t.m_ObjectsO={globals:[],termsdefs:[],weeksdefs:[],daysdefs:[],periods:[],breaks:[],bells:[],teachers:[],classes:[],groups:[],buildings:[],classrooms:[],subjects:[],students:[],lessons:[],cards:[],ttviews:[],ttreports:[],studentsubjects:[],classroomsupervisions:[],cardrelationships:[]},t.m_ObjectsI={globals:[],termsdefs:{},weeksdefs:{},daysdefs:{},periods:{},breaks:{},bells:{},teachers:{},classes:{},groups:{},buildings:{},classrooms:{},subjects:{},students:{},lessons:{},cards:{},ttviews:{},ttreports:{},studentsubjects:{},classroomsupervisions:{},cardrelationships:[]},t.m_nHodin=10,t.m_nDni=5,t.m_DaysAll="11111",t.m_nTyzdnov=1,t.m_WeeksAll="1",t.m_nTermov=1,t.m_TermsAll="1",t.m_nHodinyOd=0,t.m_pRozApp=null,t.dbi=new it.MutableDBI(nt.client_req),t.m_ObjectsO)new it.DBITable(t.dbi,{id:e});return t.m_nHodinyDo=t.m_nHodin-1,t}n.CRok=o;var u,m=(u=s,e.__extends(l,u),l.prototype.InitFromData=function(){var t=this.m_Data;this.m_nZvonenieID=parseInt(t.bell),this.m_pUcitel=this.m_pRok.m_ObjectsI.teachers[t.teacherid]},l.prototype.HodinaMozeSem=function(t,e){return 0<=t.m_Triedy.indexOf(this)},l.prototype.FindDelenie=function(t,e){for(var i=0;i<this.m_Delenia.length;i++)if((n=this.m_Delenia[i]).divisiontag==t)return n;var n;return e?n=new _(this,t):null},l.prototype.UI_KartaVyberOdtialto=function(t,e,i,n){if(i.IsLocked())return!1;var s=n.ctrlKey,r=n.shiftKey;if(s||r){if(!s){ASC.assert(r);var o=i.m_pHodina.GetPrvaNeumiestnenaKarta();return t.ChytKartu(o,this),!0}for(var a=this.GetKartyTuTWDH(e.m_nTerm,e.m_nWeek,e.m_nDay,e.period,t.m_pTriedyView.m_nROJTF),l=[],c=0;c<a.length;c++)(o=a[c]).IsLocked()||o!=i&&!i.ChytCtrlPridaj_Moze(o)||l.push(o);if(0==l.length)return!1;if(r){var d=[];for(c=0;c<l.length;c++){var m=(o=l[c]).m_pHodina.GetPrvaNeumiestnenaKarta();m&&d.push(m)}return 0<d.length&&t.ChytKarty(d,this),!0}for(c=0;c<l.length;c++)o=l[c],t.InvalidateKarta(o),o.DeUmiestniKarta();return t.ChytKarty(l,this),t.Validate(),t.CursorMove(n),!0}return u.prototype.UI_KartaVyberOdtialto.call(this,t,e,i,n)},l.prototype.UI_RiadokPopup=function(t,e){Q.CUtils.AddMenuItemSmart(t,"edit",{icon:Q.CUtils.GetTableIcon(this.m_Table)}),Q.CUtils.AddMenuItemSmart(t,"timeoff"),Q.CUtils.AddMenuItemSmart(t,"constraints"),Q.CUtils.AddMenuItemSmart(t,"lessons"),Q.CUtils.AddMenuItemSmart(t,"divisions")},l.prototype.UI_OnCommand=function(t,e,i){if(void 0===i&&(i=null),u.prototype.UI_OnCommand.call(this,t,e,i))return!0;var n=e.m_pRozApp;switch(t){case"divisions":return n.click_func("divisions","classid="+this.m_Id),!0}return!1},l.prototype.GetSkupinaCelaTrieda=function(){for(var t=0,e=this.m_Delenia;t<e.length;t++)for(var i=0,n=e[t].m_Skupiny;i<n.length;i++){var s=n[i];if(s.m_bCelaTrieda)return s}return null},l.prototype.GetUcebna=function(){var t=this.m_Data.classroomids[0];return t?this.m_pRok.m_ObjectsI.classrooms[t]:null},l.prototype.JeObed=function(t){var e=this.m_Data.constraints;return"d"!=e.lunch_periodfrom&&"d"!=e.lunch_periodto&&t>=parseInt(e.lunch_periodfrom)&&t<=parseInt(e.lunch_periodto)},l);function l(t,e){var i=u.call(this,t,"classes",e)||this;return i.m_Delenia=[],i.m_Skupiny=[],i.m_nZvonenieID=0,i.m_pUcitel=null,i.InitFromData(),i}n.CTrieda=m;var c,d=(c=s,e.__extends(p,c),p.prototype.GetNazov=function(){return this.m_bCelaTrieda?ASC.ttls(1643):this.m_Data.name},p.prototype.GetColor=function(){var t=this.m_pTrieda.m_Skupiny.indexOf(this),e=Q.farby;return e[t%e.length]},p.prototype.InitFromData=function(){var t=this.m_Data;this.m_pTrieda=this.m_pRok.m_ObjectsI.classes[t.classid],this.m_pDelenie=this.m_pTrieda.FindDelenie(this.m_Data.ascttdivision,!0),0<=this.m_pDelenie.m_Skupiny.indexOf(this)&&this.m_pRok.m_pRozApp.Fail("Error 0188464415"),this.m_nPoradieVDeleni=this.m_pDelenie.m_Skupiny.length,this.m_pDelenie.m_Skupiny.push(this),this.m_pTrieda.m_Skupiny.push(this),this.m_bCelaTrieda=ASC.boolVal(t.entireclass),this.m_bOkGroup=ASC.boolVal(t.okgroup)},p.prototype.BeforeRemove=function(){ASC.remove(this.m_pDelenie.m_Skupiny,this),ASC.remove(this.m_pTrieda.m_Skupiny,this)},p.prototype.HodinaMozeSem=function(t,e){for(var i=0;i<t.m_Skupiny.length;i++){var n=t.m_Skupiny[i];if(n.m_pTrieda==this.m_pTrieda){if(n==this)return!0;if(n.m_pDelenie!=this.m_pDelenie)return!0}}return!1},p);function p(t,e){var i=c.call(this,t,"groups",e)||this;return i.m_bCelaTrieda=!1,i.m_bOkGroup=!1,i.m_bKurz=!1,i.m_Ziaci=[],i.InitFromData(),i}n.CSkupina=d;var h,_=(h=s,e.__extends(f,h),f.prototype.UpdatePoradieSkupin=function(){if(1<this.m_Skupiny.length){this.m_Skupiny.sort(function(t,e){return t.GetDBIndex()-e.GetDBIndex()});var e=0;this.m_Skupiny.forEach(function(t){t.m_nPoradieVDeleni=e++})}},f);function f(t,e){var i=h.call(this,t.m_pRok,"divisions",{})||this;return i.m_Skupiny=[],i.m_pTrieda=t,i.divisiontag=e,i.m_pTrieda.m_Delenia.push(i),i}n.CDelenie=_;var v,b=(v=s,e.__extends(g,v),g.prototype.GetNazov=function(t){return void 0===t&&(t="name"),t&&"name"!=t||(t=this.m_pRok.GetJoinNames(this.m_Table)),v.prototype.GetNazov.call(this,t)},g.prototype.HodinaMozeSem=function(t,e){return 0<=t.m_Data.teacherids.indexOf(this.m_Id)},g.prototype.UI_RiadokPopup=function(t,e){Q.CUtils.AddMenuItemSmart(t,"edit",{icon:Q.CUtils.GetTableIcon(this.m_Table)}),Q.CUtils.AddMenuItemSmart(t,"timeoff"),Q.CUtils.AddMenuItemSmart(t,"constraints"),Q.CUtils.AddMenuItemSmart(t,"lessons")},g.prototype.GetDozory=function(){for(var t=[],e=0,i=this.m_pRok.TableObjects("classroomsupervisions");e<i.length;e++){var n=i[e];n.m_pUcitel==this&&t.push(n)}return t},g.prototype.GetPocetDozorov=function(){for(var t=0,e=0,i=0,n=this.GetDozory();i<n.length;i++)t++,e+=n[i].GetDlzkaVMinutach();return{count:t,minutes:e}},g);function g(t,e){return v.call(this,t,"teachers",e)||this}n.CUcitel=b;var y,k=(y=s,e.__extends(C,y),C.prototype.HodinaMozeSem=function(t,e){return ASC.strEquals(t.m_Data.subjectid,this.m_Id)},C.prototype.UI_RiadokPopup=function(t,e){Q.CUtils.AddMenuItemSmart(t,"edit",{icon:Q.CUtils.GetTableIcon(this.m_Table)}),Q.CUtils.AddMenuItemSmart(t,"timeoff"),Q.CUtils.AddMenuItemSmart(t,"constraints"),Q.CUtils.AddMenuItemSmart(t,"lessons")},C);function C(t,e){var i=y.call(this,t,"subjects",e)||this;return i.m_Hodiny=[],i}n.CPredmet=k;var S,T=(S=s,e.__extends(w,S),w.prototype.GetNazov=function(t){return void 0===t&&(t="name"),t&&"name"!=t||(t=this.m_pRok.GetJoinNames(this.m_Table)),S.prototype.GetNazov.call(this,t)},w.prototype.LinkSkupina=function(t,e){void 0===e&&(e=!0),t&&(e?(this.m_Skupiny.indexOf(t)<0&&this.m_Skupiny.push(t),t.m_Ziaci.indexOf(this)<0&&t.m_Ziaci.push(this)):(ASC.remove(this.m_Skupiny,t),ASC.remove(t.m_Ziaci,this)))},w.prototype.InitFromData=function(){var t=this.m_Data;this.m_pTrieda=this.m_pRok.m_ObjectsI.classes[t.classid],this.LinkSkupina(this.m_pTrieda.GetSkupinaCelaTrieda());for(var e=0,i=t.groupids;e<i.length;e++){var n=i[e],s=this.m_pRok.m_ObjectsI.groups[n];this.LinkSkupina(s)}},w.prototype.HodinaMozeSem=function(t,e){if(t.m_Triedy.indexOf(this.m_pTrieda)<0)return!1;if(e&tt.ROJTF_PRIBLIZNE)return this.m_pTrieda.HodinaMozeSem(t,e);if(this.GetZiakPredmet(t))return!0;for(var i=0,n=t.m_Skupiny;i<n.length;i++){var s=n[i];if(this.SkupinaStatus(s)>=(s.m_bOkGroup?1:0))return!0}return!1},w.prototype.GetZiakPredmet=function(t){if(t.m_KurzyPreTriedy.indexOf(this.m_pTrieda)<0)return null;if(t.m_nPoradieSeminaru<0)return null;for(var e=0,i=this.m_ZiakPredmety;e<i.length;e++){var n=i[e];if(n.m_pPredmet==t.m_pPredmet&&n.m_nPoradieSeminaru==t.m_nPoradieSeminaru)return n}return null},w.prototype.SkupinaStatus=function(t){if(t.m_pTrieda!=this.m_pTrieda)return-1;if(t.m_bCelaTrieda)return 1;for(var e=0,i=0,n=this.m_Skupiny;i<n.length;i++){var s=n[i];if(s==t)return 1;s.m_pDelenie==t.m_pDelenie&&(e=-1)}return e},w.prototype.UI_RiadokPopup=function(t,e){},w.prototype.UI_KartaVyberOdtialto=function(t,e,i,n){var s=this.GetZiakPredmet(i.m_pHodina);return s?!s.m_bLocked&&!!s.SetPoradieSeminaru(-1)&&(t.InvalidateObject(s),t.ChytSeminar(i.m_pHodina.m_pPredmet,this.m_pTrieda),!0):(ASC.showContextMenu([],n,{header:ASC.escapeHTML(Q.CUtils.GetUINazov(i.m_pHodina,"short"))}),!1)},w.prototype.UI_OnCommand=function(i,t,e){var n=this;void 0===e&&(e=null);var s=t.m_pRozApp;switch(i){case"lockcard":case"unlockcard":var r=e;return(o=this.GetZiakPredmet(r.m_pHodina))&&(o.SetLocked("lockcard"==i),s.InvalidateObject(o)),!0;case"removecard":var o;return r=e,(o=this.GetZiakPredmet(r.m_pHodina))&&(o.SetPoradieSeminaru(-1),s.InvalidateObject(o)),!0;case"deletecards":case"lockcards":case"unlockcards":return this.GetKartyTu(t.m_nROJTF).forEach(function(t){var e=n.GetZiakPredmet(t.m_pHodina);if(e){switch(i){case"deletecards":e.m_bLocked||e.SetPoradieSeminaru(-1);break;case"lockcards":0<e.m_nPoradieSeminaru&&e.SetLocked(!0);break;case"unlockcards":e.SetLocked(!1)}s.InvalidateObject(e)}}),!0}return!1},w);function w(t,e){var i=S.call(this,t,"students",e)||this;return i.m_pTrieda=null,i.m_ZiakPredmety=[],i.m_Skupiny=[],i.InitFromData(),i}n.CZiak=T;var A,R=(A=s,e.__extends(I,A),I.prototype.InitFromData=function(){var t=this.m_Data;this.m_pZiak=this.m_pRok.m_ObjectsI.students[t.studentid],this.m_pPredmet=this.m_pRok.m_ObjectsI.subjects[t.subjectid];var e=t.seminargroup;this.m_nPoradieSeminaru=e?parseInt(e):-1,this.m_bLocked=!!t.locked,this.m_pZiak.m_ZiakPredmety.push(this)},I.prototype.BeforeRemove=function(){ASC.remove(this.m_pZiak.m_ZiakPredmety,this)},I.prototype.SetPoradieSeminaru=function(t){return this.m_nPoradieSeminaru=t,this.m_Data.seminargroup=this.m_nPoradieSeminaru<0?"":this.m_nPoradieSeminaru,!0},I.prototype.SetLocked=function(t){this.m_bLocked=t,this.m_Data.locked=this.m_bLocked?1:0},I);function I(t,e){var i=A.call(this,t,"studentsubjects",e)||this;return i.m_nPoradieSeminaru=-1,i.m_bLocked=!1,i.InitFromData(),i}n.CZiakPredmet=R;var D,O=(D=s,e.__extends(x,D),x.prototype.InitFromData=function(){this.m_pBudova=this.m_pRok.m_ObjectsI.buildings[this.m_Data.buildingid]},x.prototype.HodinaMozeSem=function(t,e){var i=t.m_Data.classroomidss;if(!i)return console.log("missing classroomidsss for lesson "+t.m_Id),!1;for(var n=0;n<i.length;n++)if(0<=i[n].indexOf(this.m_Id))return!0;return!1},x.prototype.JeKmenovaPre=function(t){return 0<=t.m_Data.classroomids.indexOf(this.m_Id)},x.prototype.KartaJeTu=function(t){return 0<=t.m_Data.classroomids.indexOf(this.m_Id)},x.prototype.UI_RiadokPopup=function(t,e){Q.CUtils.AddMenuItemSmart(t,"edit",{icon:Q.CUtils.GetTableIcon(this.m_Table)}),Q.CUtils.AddMenuItemSmart(t,"timeoff"),Q.CUtils.AddMenuItemSmart(t,"constraints"),Q.CUtils.AddMenuItemSmart(t,"lessons")},x.prototype.IsVolno=function(t){for(var e=0,i=this.GetObsadenieK(t);e<i.length;e++){var n=i[e];if(!t.MozeKolidovat(n))return!1}return!0},x.prototype.UI_KartaVyberOdtialto=function(t,e,i,n){return!!i.JeUmiestnena()&&!i.IsLocked()&&(t.InvalidateKarta(i),i.FreeUcebnaU(this),t.ChytKartu(i),!0)},x.prototype.UI_KartaMozeSem=function(t,e){for(var i=0,n=e.Karty();i<n.length;i++){var s=n[i],r=s.m_pHodina;if(s.JeUmiestnena()){for(var o=0;o<r.m_nPotrebujeUcebni;o++)if(!s.Ucebna(o)&&0<=r.GetUcebneV(o).indexOf(this))return!0}else if(this.HodinaMozeSem(s.m_pHodina,t.m_pTriedyView.m_nROJTF))return!0}return!1},x.prototype.UI_KartaUmiestni=function(t,e,i,n){for(var s=null,r=0,o=e.Karty();r<o.length;r++){var a=o[r];if(!a.JeUmiestnena||a.JeTu_Policko(i)){s=a;break}}if(!s)return!1;if(!s.JeUmiestnena){var l=s.m_pHodina.GetTermPrvyDobry(i.m_nTerm),c=s.m_pHodina.GetWeekPrvyDobry(i.m_nWeek),d=s.m_pHodina.GetDenPrvyDobry(i.m_nDay),m=i.period;this.m_pRok.ChangePosKarta_TWDH(s,l,c,d,m,!1);var u=[];if(s.SimpleKolizie(u),u.length)return s.DeUmiestniKarta(),!1}for(var p=-1,h=s.m_pHodina,_=0;_<h.m_nPotrebujeUcebni;_++)if(!s.Ucebna(_)&&0<=h.GetUcebneV(_).indexOf(this)){p=_;break}if(p<0)return!1;if(!s.JeTu_Policko(i))return!1;var f=[];return this.AddKartyTuK(f,s,t.m_pTriedyView.m_nROJTF),1<this.m_nHodinNaraz&&(f=[]),s.RemoveMozuKolidovat(f),s.SetUcebna(this,p),t.InvalidateKarta(s),t.OdhodKartu(),!0},x.prototype.UI_OnCommand=function(t,e,i){var n=this;void 0===i&&(i=null);var s=e.m_pRozApp;switch(t){case"deletecards":return this.GetKartyTu(e.m_nROJTF).forEach(function(t){t.IsLocked()||(s.InvalidateKarta(t),t.FreeUcebnaU(n))}),!0}return!!D.prototype.UI_OnCommand.call(this,t,e,i)},x.prototype.JeBlizkaUcebna=function(t){if(t)return 0<=this.m_Data.nearbyclassroomids.indexOf(t.m_Id)},x.prototype.GetDozory=function(){for(var t=[],e=0,i=this.m_pRok.TableObjects("classroomsupervisions");e<i.length;e++){var n=i[e];n.m_pUcebna==this&&t.push(n)}return t},x);function x(t,e){var i=D.call(this,t,"classrooms",e)||this;return i.m_nHodinNaraz=1,i.m_pBudova=null,i.InitFromData(),i}n.CUcebna=O;var P,E=(P=s,e.__extends(z,P),z.prototype.InitFromData=function(){var e=this,t=this.m_Data,i=this.m_pRok;this.m_Skupiny=[],this.m_Triedy=[],this.m_Delenia=[],this.m_nPoradieSeminaru=-1;for(var n=0;n<t.groupids.length;n++){var s=this.m_pRok.m_ObjectsI.groups[t.groupids[n]];this.m_Skupiny.push(s),ASC.indexOf(this.m_Delenia,s.m_pDelenie)<0&&(this.m_Delenia.push(s.m_pDelenie),ASC.indexOf(this.m_Triedy,s.m_pTrieda)<0&&this.m_Triedy.push(s.m_pTrieda))}t.seminargroup&&(this.m_nPoradieSeminaru=parseInt(t.seminargroup),i.ids2ro("classes",t.classids).forEach(function(t){0<=e.m_Triedy.indexOf(t)||(e.m_Triedy.push(t),e.m_KurzyPreTriedy.push(t))})),this.m_Ucitelia=i.ids2ro("teachers",t.teacherids),this.m_pPredmet=i.m_ObjectsI.subjects[t.subjectid],this.m_pPredmet&&this.m_pPredmet.m_Hodiny.push(this),this.m_pTermMozny=i.m_ObjectsI.termsdefs[t.termsdefid],this.m_pTyzdenMozny=i.m_ObjectsI.weeksdefs[t.weeksdefid],this.m_pDenMozny=i.m_ObjectsI.daysdefs[t.daysdefid],ASC.assert(!!(this.m_pTermMozny&&this.m_pTyzdenMozny&&this.m_pDenMozny)),t.classroomidss?this.m_nPotrebujeUcebni=t.classroomidss.length:console.log("missing classroomidss in lesson "+this.m_Id)},z.prototype.BeforeRemove=function(){this.m_pPredmet&&ASC.remove(this.m_pPredmet.m_Hodiny,this)},z.prototype.JeSeminar=function(){return 0<this.m_KurzyPreTriedy.length},z.prototype.IsBezTriedy=function(){return!(0<this.m_KurzyPreTriedy.length||0<this.m_Skupiny.length)},z.prototype.IsBezUcitela=function(){return 0==this.m_Ucitelia.length},z.prototype.GetDelenie=function(t){for(var e=0;e<this.m_Delenia.length;e++){var i=this.m_Delenia[e];if(i.m_pTrieda==t)return i}return null},z.prototype.GetDelenieSkupinyBity=function(t){for(var e=0,i=0;i<this.m_Skupiny.length;i++){var n=this.m_Skupiny[i];n.m_pTrieda==t&&(e|=1<<n.m_nPoradieVDeleni)}return e},z.prototype.GetDlzka=function(){return this.m_Data.durationperiods-1},z.prototype.GetPocet=function(){return this.m_Karty.length},z.prototype.GetPrvaNeumiestnenaKarta=function(){for(var t=0;t<this.m_Karty.length;t++){var e=this.m_Karty[t];if(!e.JeUmiestnena())return e}return null},z.prototype.GetPrvaUmiestnenaKarta=function(){for(var t=0;t<this.m_Karty.length;t++){var e=this.m_Karty[t];if(e.JeUmiestnena())return e}return null},z.prototype.ChytCtrlPridaj_Moze=function(t){var e=this,i=t;if(e==i)return!1;if(e.m_pTermMozny!=i.m_pTermMozny)return!1;if(e.m_pTyzdenMozny!=i.m_pTyzdenMozny)return!1;if(e.m_pDenMozny!=i.m_pDenMozny)return!1;if(e.GetDlzka()!=i.GetDlzka())return!1;for(var n=0;n<e.m_Ucitelia.length;n++)if(0<=i.m_Ucitelia.indexOf(e.m_Ucitelia[n]))return!1;var s=!1;for(n=0;n<e.m_Skupiny.length;n++)for(var r=e.m_Skupiny[n],o=0;o<i.m_Skupiny.length;o++){var a=i.m_Skupiny[o];if(r.m_pTrieda==a.m_pTrieda){if(s=!0,r.m_pDelenie!=a.m_pDelenie)return!1;if(r==a)return!1}}return!!s},z.prototype.GetTermPrvyDobry=function(t){return-1==t&&this.m_pTermMozny.IsCompatible(this.GetTerm())?this.GetTerm():this.GetPrvaUmiestnenaKarta()?this.GetTerm():this.m_pTermMozny.GetPrveDobrePole(t)},z.prototype.GetWeekPrvyDobry=function(t){return this.m_pTyzdenMozny.GetPrveDobrePole(t)},z.prototype.GetDenPrvyDobry=function(t){return this.m_pDenMozny.GetPrveDobrePole(t)},z.prototype.GetTerm=function(){return this.m_Data.terms},z.prototype.SetTerm=function(t){ASC.assert(this.m_pTermMozny.IsCompatible(t)),this.m_Data.terms=t},z.prototype.GetUcebneV=function(t){return t<0||t>=this.m_nPotrebujeUcebni?[]:this.m_pRok.ids2ro("classrooms",this.m_Data.classroomidss[t])},z.prototype.IsUvazujUcebne=function(){return 0<this.m_nPotrebujeUcebni},z.prototype.UI_HodinaPopup=function(t,e){var i=this;Q.CUtils.AddMenuItemSmart(t,"editlesson",{onclick:function(){e.m_pRozApp.click_func("edit","table=lessons&id="+i.m_Id)}})},z.prototype.GetZiaci=function(){for(var t=[],e=0,i=this.m_KurzyPreTriedy;e<i.length;e++){var n=i[e].GetSkupinaCelaTrieda();if(n)for(var s=0,r=n.m_Ziaci;s<r.length;s++)for(var o=r[s],a=0,l=o.m_ZiakPredmety;a<l.length;a++){var c=l[a];if(c.m_pPredmet==this.m_pPredmet&&c.m_nPoradieSeminaru==this.m_nPoradieSeminaru){t.push(o);break}}}return t},z.prototype.GetPocetZiakov=function(){return this.GetZiaci().length},z);function z(t,e){var i=P.call(this,t,"lessons",e)||this;return i.m_Karty=[],i.m_Skupiny=[],i.m_Delenia=[],i.m_Triedy=[],i.m_KurzyPreTriedy=[],i.m_nPoradieSeminaru=-1,i.m_nPotrebujeUcebni=0,i.InitFromData(),i}n.CHodina=E;var G,j=(G=s,e.__extends(M,G),M.prototype.InitFromData=function(){var t=this.m_Data;this.m_pHodina=this.m_pRok.m_ObjectsI.lessons[t.lessonid],this.m_pHodina.m_Karty.push(this)},M.prototype.BeforeRemove=function(){ASC.remove(this.m_pHodina.m_Karty,this)},M.prototype.Ucebne=function(){var e=this,t=this.m_Data.classroomids,i=[];return t.forEach(function(t){t&&i.push(e.m_pRok.m_ObjectsI.classrooms[t])}),i},M.prototype.GetHodina=function(){return 0|this.m_Data.period},M.prototype.GetDlzka=function(){return this.m_pHodina.GetDlzka()},M.prototype.days=function(){return this.JeUmiestnena()?this.m_Data.days:""},M.prototype.weeks=function(){return this.JeUmiestnena()?this.m_Data.weeks:""},M.prototype.terms=function(){return this.JeUmiestnena()?this.m_pHodina.m_Data.terms:""},M.prototype.JeTu_Policko=function(t){return this.JeTu_TWDH(t.m_nTerm,t.m_nWeek,t.m_nDay,t.period)},M.prototype.JeTu_TWDH=function(t,e,i,n){if(!this.JeUmiestnena())return!1;if(0<=t&&"1"!=this.m_pHodina.m_Data.terms[t])return!1;if(0<=e&&"1"!=this.m_Data.weeks[e])return!1;if(0<=i&&"1"!=this.m_Data.days[i])return!1;if(0<=n){var s=this.GetHodina(),r=s+this.GetDlzka();if(n<s||r<n)return!1}return!0},M.prototype.GetTableIds=function(t){switch(t){case"subjects":return[this.m_pHodina.m_Data.subjectid];case"classes":return this.m_pHodina.m_Data.classids;case"teachers":return this.m_pHodina.m_Data.teacherids;case"classrooms":return this.m_Data.classroomids;case"buildings":for(var e=[],i=0;i<this.m_pHodina.m_nPotrebujeUcebni;i++){var n=this.Ucebna(i);n&&n.m_pBudova&&e.push(n.m_pBudova.m_Id)}return e;case"groups":return this.m_pHodina.m_Data.groupids}return[]},M.prototype.GetFarby=function(t){for(var e=[],i=this.GetTableIds(t),n=0;n<i.length;n++){var s=this.m_pRok.m_ObjectsI[t][i[n]];s&&e.push(s.GetColor())}return e},M.prototype.GetFarbyChyby=function(){var t=[];return this.VsetkyUcebneValid()||t.push("#ffffff"),"0"==this.m_pRok.VhodnostKarty_PUT(this)&&t.push("#ff0000"),t},M.prototype.GetTexty=function(t,e,i){void 0===e&&(e="short");for(var n="",s=0;s<t.length;s++){0<s&&(n+="\n");var r=t[s];switch(r){case"groupnames":for(var o=[],a=0,l=this.m_pHodina.m_Skupiny;a<l.length;a++){var c=l[a];if(!(c.m_bCelaTrieda||i instanceof m&&i!=c.m_pTrieda)){var d=c.GetNazov();o.indexOf(d)<0&&o.push(d)}}n+=o.join(" ");break;default:n+=this.m_pRok.dbi.rowNames(r,this.GetTableIds(r),e)}}return n},M.prototype.GetDelenieSkupin=function(t){var e=this.m_pHodina.GetDelenie(t);return e?e.m_Skupiny.length:-1},M.prototype.GetDelenieSkupinyBity=function(t){return this.m_pHodina.GetDelenieSkupinyBity(t)},M.prototype.JeUmiestnena=function(){return!!this.m_Data.days},M.prototype.CyklovaniePo=function(){var t=0;return this.m_Data.days!=this.m_pRok.m_DaysAll&&(t|=1),this.m_Data.weeks!=this.m_pRok.m_WeeksAll&&(t|=2),this.m_pHodina.m_Data.terms!=this.m_pRok.m_TermsAll&&(t|=4),t},M.prototype.DeUmiestniKarta=function(){this.m_Data.days="",this.m_Data.weeks="",this.m_Data.period=-1,this.m_Data.classroomids.length=0},M.prototype.IsLocked=function(){return ASC.boolVal(this.m_Data.locked)},M.prototype.SetLocked=function(t){this.m_Data.locked=t?1:0},M.prototype.ChytCtrlPridaj_Moze=function(t){return t!=this&&t.m_pHodina!=this.m_pHodina&&t.JeUmiestnena()==this.JeUmiestnena()&&this.m_pHodina.ChytCtrlPridaj_Moze(t.m_pHodina)},M.prototype.Obdobia_MozeSem_TWDH=function(t,e,i,n,s){if(void 0===s&&(s=!1),this.JeTu_TWDH(t,e,i,n))return!0;if(0<=t){if(s&&this.m_pHodina.GetPrvaUmiestnenaKarta()&&"1"!=this.m_pHodina.GetTerm()[t])return!1;if(!this.m_pHodina.m_pTermMozny.JeMoznyBit(t))return!1}if(0<=e&&!this.m_pHodina.m_pTyzdenMozny.JeMoznyBit(e))return!1;if(0<=i&&!this.m_pHodina.m_pDenMozny.JeMoznyBit(i))return!1;if(0<=n){if(n<this.m_pRok.m_nHodinyOd)return!1;if(n+this.m_pHodina.GetDlzka()>this.m_pRok.m_nHodinyDo)return!1}return!0},M.prototype.SetPosition=function(t,e,i,n){t&&i&&n||ASC.assert(!1),this.m_Data.days=t,this.m_Data.period=e,this.m_pHodina.SetTerm(i),this.m_Data.weeks=n},M.prototype.SimpleKolizie=function(t,e){void 0===e&&(e=!1);for(var i=0;i<this.m_pHodina.m_Ucitelia.length;i++)this.m_pHodina.m_Ucitelia[i].AddKartyTuK(t,this,0);for(i=0;i<this.m_pHodina.m_Skupiny.length;i++)this.m_pHodina.m_Skupiny[i].AddKartyTuK(t,this,0);Q.CUtils.FastRemove(t,this)},M.prototype.GetHodinaOd=function(){return parseInt(this.m_Data.period)},M.prototype.GetHodinaDo=function(){return this.GetHodinaOd()+this.m_pHodina.GetDlzka()},M.prototype.VsetkyUcebneValid=function(){for(var t=0;t<this.m_pHodina.m_nPotrebujeUcebni;t++)if(!this.Ucebna(t))return!1;return!0},M.prototype.Ucebna=function(t){if(void 0===t&&(t=0),t<0||t>=this.m_pHodina.m_nPotrebujeUcebni)return null;var e=this.m_Data.classroomids[t];return e?this.m_pRok.m_ObjectsI.classrooms[e]:null},M.prototype.MozeKolidovat=function(t){return t==this||(this.m_pHodina,t.m_pHodina,!1)},M.prototype.RemoveMozuKolidovat=function(t){for(var e=t.length-1;0<=e;e--)this.MozeKolidovat(t[e])&&t.splice(e,1)},M.prototype.SetUcebna=function(t,e){void 0===e&&(e=0),e<0||e>=this.m_pHodina.m_nPotrebujeUcebni||(this.m_Data.classroomids[e]=t?t.m_Id:"")},M.prototype.FreeUcebna=function(t){if(void 0===t&&(t=-1),-1!=t)t<0||t>=this.m_pHodina.m_nPotrebujeUcebni||this.Ucebna(t)&&(this.m_Data.classroomids[t]="");else for(t=0;t<this.m_pHodina.m_nPotrebujeUcebni;t++)this.FreeUcebna(t)},M.prototype.FreeUcebnaU=function(t){for(var e=0;e<this.m_pHodina.m_nPotrebujeUcebni;e++)this.Ucebna(e)==t&&this.FreeUcebna(e)},M.prototype.DajUcebnu=function(){if(!this.JeUmiestnena())return!0;for(var t=!0,e=0;e<this.m_pHodina.m_nPotrebujeUcebni;e++)if(!this.Ucebna(e)){var i=this.m_pHodina.GetUcebneV(e);if(0!=i.length){for(var n=null,s=0,r=i;s<r.length;s++){var o=r[s];if("0"!=o.m_pVolno.GetKarta(this)&&(1<o.m_nHodinNaraz||o.IsVolno(this))){n=o;break}}n?this.SetUcebna(o,e):t=!1}}return t},M);function M(t,e){var i=G.call(this,t,"cards",e)||this;return i.InitFromData(),i}n.CKarta=j;var V,U=(V=s,e.__extends(H,V),H.prototype.InitFromData=function(){var t=this.m_Data;this.m_BitovePole=t.vals},H.prototype.JeMoznyBit=function(t){for(var e=0;e<this.m_BitovePole.length;e++)if("1"==this.m_BitovePole[e][t])return!0;return!1},H.prototype.IsCompatible=function(t){for(var e=0;e<this.m_BitovePole.length;e++)if(this.m_BitovePole[e]==t)return!0;return!1},H.prototype.GetPrveDobrePole=function(t){if(t<0)return this.m_BitovePole[0];for(var e=0;e<this.m_BitovePole.length;e++)if("1"==this.m_BitovePole[e][t])return this.m_BitovePole[e];this.m_BitovePole[0]},H.prototype.GetNazov=function(t){if(void 0===t&&(t="name"),"number"==t){if("one"==this.m_Typ)return Q.CUtils.GetTableItemTypNazov(this.m_Table,1)+" "+(this.m_Val+1);t="short"}return V.prototype.GetNazov.call(this,t)},H.prototype.KartaJeTu=function(t,e){if(!t.JeUmiestnena())return!1;switch(this.m_Typ){case"all":case"any":return!0;case"one":var i=this.m_Val;switch(this.m_Table){case"daysdefs":return"1"==t.days()[i];case"weeksdefs":return"1"==t.weeks()[i]}}return!1},H.prototype.GetDlzka=function(){switch(this.m_Typ){case"one":case"any":return 1;case"all":return this.m_pRok.GetObdobieCount(this.m_ItemTable)}for(var t=0,e=this.m_BitovePole[0],i=0;i<e.length;i++)"1"==e[i]&&t++;return t},H.prototype.AvgPokrytieBitov=function(){return this.GetDlzka()/this.m_pRok.GetObdobieCount(this.m_ItemTable)},H);function H(t,e,i){var n=V.call(this,t,e,i)||this;return n.m_Val=null,n.m_BitovePole=[],n.m_ItemTable=e.substring(0,e.length-4),n.m_Typ=i.typ,"one"==n.m_Typ&&(n.m_Val=parseInt(i.val)),n.InitFromData(),n}n.CObdobie=U;var N,K=(N=s,e.__extends($,N),$.prototype.InitFromData=function(){this.m_nHodina=parseInt(this.m_Id)},$.prototype.GetTime=function(t,e,i,n){void 0===t&&(t=-1);var s=this.m_Data,r={starttime:s.starttime,endtime:s.endtime},o=null,a=0;if(e?a=e.m_nZvonenieID:i&&(a=parseInt(i.m_Data.bell)),n&&""!=ASC.strVal(n.m_Data.bell)&&(a=parseInt(n.m_Data.bell)),0<a){var l=this.m_pRok.m_ObjectsI.bells[a];l&&(o=l.m_Data["periods"==this.m_Table?"perioddata":"breakdata"][this.m_nHodina])}if(o&&(o.starttime&&(r.starttime=o.starttime),o.endtime&&(r.endtime=o.endtime)),0<=t){var c=s.daydata[t];o&&o.daydata&&(c=o.daydata[t]),c&&(c.starttime&&(r.starttime=c.starttime),c.endtime&&(r.endtime=c.endtime))}return r},$.prototype.GetDlzkaVMinutach=function(t){void 0===t&&(t=-1);var e=this.GetTime(t);return Q.CUtils.minutes(e.endtime)-Q.CUtils.minutes(e.starttime)},$.prototype.JeValidPreTriedu=function(t){var e=this.m_Data.printonlyinbell;return!!ASC.strEmpty(e)||parseInt(e)==t.m_nZvonenieID},$);function $(t,e,i){var n=N.call(this,t,e,i)||this;return n.InitFromData(),n}n.CPeriodOrBreak=K;var F,L=(F=K,e.__extends(B,F),B.prototype.KartaJeTu=function(t,e){if(!t.JeUmiestnena())return!1;var i=this.m_nHodina,n=t.GetHodinaOd(),s=t.GetHodinaDo();return n<=i&&i<=s},B.GetMedzera=function(t,e,i){var n=e.GetTime(t),s=i.GetTime(t);return Q.CUtils.minutes(s.starttime)-Q.CUtils.minutes(n.endtime)},B);function B(t,e){return F.call(this,t,"periods",e)||this}n.CPeriod=L;var Z,J=(Z=K,e.__extends(W,Z),W.prototype.KartaJeTu=function(t,e){return!1},W);function W(t,e){return Z.call(this,t,"breaks",e)||this}n.CBreak=J;var Y,X=(Y=s,e.__extends(q,Y),q.prototype.InitFromData=function(){var t=this.m_Data,e=this.m_pRok;this.m_pUcebna=e.m_ObjectsI.classrooms[t.classroomid],this.m_pUcitel=e.m_ObjectsI.teachers[t.teacherid],this.m_Den=Q.CUtils.blank2minus(t.day),this.m_Tyzden=Q.CUtils.blank2minus(t.week),this.m_Term=Q.CUtils.blank2minus(t.term),""!=ASC.strVal(t.break)?(this.m_Hodina=parseInt(t.break),this.m_Prestavka=!0):(this.m_Hodina=parseInt(t.period),this.m_Prestavka=!1),this.m_bLocked=ASC.boolVal(t.locked)},q.prototype.SetLocked=function(t){this.m_Data.locked=t?1:0,this.m_bLocked=ASC.boolVal(this.m_Data.locked)},q.prototype.SetUcitel=function(t){this.m_Data.teacherid=t?t.m_Id:"",this.m_pUcitel=t},q.prototype.GetHodinaText=function(){return this.m_pRok.GetHodinaNazov(this.m_Hodina,this.m_Prestavka)},q.prototype.GetDlzkaVMinutach=function(){if(this.m_Prestavka){var t=this.m_pRok.GetPeriod(this.m_Hodina,!0);if(t)return t.GetDlzkaVMinutach(this.m_Den);var e=this.m_pRok.GetPeriod(this.m_Hodina,!1),i=this.m_pRok.GetPeriod(this.m_Hodina-1,!1);return e&&i?L.GetMedzera(this.m_Den,i,e):10}return(e=this.m_pRok.GetPeriod(this.m_Hodina,!1))?e.GetDlzkaVMinutach(this.m_Den):10},q);function q(t,e){var i=Y.call(this,t,"classroomsupervisions",e)||this;return i.m_pUcitel=null,i.m_pUcebna=null,i.m_Den=-1,i.m_Tyzden=-1,i.m_Term=-1,i.m_Hodina=0,i.m_Prestavka=!1,i.m_bLocked=!1,i.m_bTemp=!1,i.InitFromData(),i}n.CDozor=X;var Q=require("./online"),tt=require("./tview"),et=require("./print"),it=require("../../rpr/dbi"),nt=require("../../asc/edurequest")}),ASC.setModuleSourceFunc("/timetable/app/tview.js",function(t,require,e){t.__esModule=!0;var p=require("tslib"),i=require("react"),b=require("react-dom"),V=require("./online"),U=require("./rokobject"),n=require("./ttrowrenderer"),s=require("../../asc/asc_react"),r=i.lazy(function(){return Promise.resolve().then(function(){return require("./lessongrid")})});t.ROJTF_PRIBLIZNE=1,t.ROJTF_SEMINARE_BEZ_ZIAKOV=2,t.ROJTF_SEMINARE_NESLIZUJ=4,t.ROJTF_FILTER_AKT_TWD=8,t.ROJTF_TERM=16,t.ROJTF_TERM_SHIFT=5,t.ROJTF_TERM_MASK=2032;var o=(a.prototype.RenderLessonGrid=function(){b.render(i.createElement(i.Suspense,{fallback:i.createElement(s.Loading,null)},i.createElement(r,{ttgpid:this.m_pRozApp.ttgpid,rowheight:this.m_nVyskaRiadokTrieda,pTView:this})),this.$div.get(0))},a.prototype.UpdateStruct=function(){var e=this;if(this.lastPohlad==this.m_pAktPohlad&&this.JePohladLessonGrid())this.RenderLessonGrid();else{if(this.m_Riadky.length=0,this.m_Policka.length=0,b.unmountComponentAtNode(this.$div.get(0)),this.$div.empty(),this.$div.off(),this.$content_d=null,this.$header_d=null,this.$toolbar_d=null,!this.m_pAktPohlad){for(var t=0,i=this.m_pRok.TableObjects("ttviews");t<i.length;t++){var n=i[t];if(!n.m_Hidden){this.m_pAktPohlad=n,this.m_pRozApp.InvalidatePohladSwitcher();break}}if(!this.m_pAktPohlad)return}if(this.lastPohlad=this.m_pAktPohlad,this.FillRibbonCombos(),this.JePohladLessonGrid())return this.RenderLessonGrid(),void this.$div.keydown(function(t){if([107,109].indexOf(t.keyCode)<0)return!0;e.OnKeyDown(t)});this.$toolbar_d=$j("<div class='toolbar'>").appendTo(this.$div),this.$header_d=$j("<div class='header'>").appendTo(this.$div),this.$content_d=$j("<div class='content'>").appendTo(this.$div),this.$header_d.css("height",this.m_nVyskaMenoDna-1+"px"),this.$content_d.mousemove(function(t){e.OnMouseMove(t),e.m_pRozApp.CursorMove(t)}),this.$content_d.on("scroll",function(){e.m_pRozApp.Invalidate()}),this.$div.keydown(function(t){if(e.JePohladLessonGrid()&&[107,109].indexOf(t.keyCode)<0)return!0;e.OnKeyDown(t)}),this.$div.mousedown(function(t){ASC.hidePopups(),e.$div.focus(),t.preventDefault()}),this.$div.mouseup(function(t){t.preventDefault()}),this.$div.click(function(t){return!!e.JePohladLessonGrid()||(ASC.hideContextMenu(),e.OnLButtonClick(t),!1)}),this.$div.on("contextmenu",function(t){return!!e.JePohladLessonGrid()||(e.OnRButtonClick(t),!1)});var s=this.m_pAktPohlad.GetRiadkyObjects();for(var r in s){var o=s[r];this.m_Riadky.push(new g(this,o))}for(var a=this.m_pRok,l={terms:-1,weeks:-1,days:-1},c={terms:-1,weeks:-1,days:-1},d=0,m=["terms","weeks","days"];d<m.length;d++){var u=m[d],p=this.m_pAktObdobie[u];p&&("one"==p.m_Typ&&(l[u]=c[u]=p.m_Val),"any"==p.m_Typ&&(l[u]=0,c[u]=this.m_pRok.GetObdobieCount(u)-1))}for(var h=l.terms;h<=c.terms;h++)for(var _=l.weeks;_<=c.weeks;_++)for(var f=l.days;f<=c.days;f++)for(var v=a.m_nHodinyOd;v<=a.m_nHodinyDo;v++)this.m_Policka.push(new y(this,h,_,f,v,this.m_Policka.length));for(var r in this.m_Policka)this.m_Policka[r].UpdateX();this.m_nSirkaPolicko=(this.$content_d.width()-this.m_nSirkaStlpecMenoTriedy)/Math.max(1,this.m_Policka.length),this.m_nSirkaPolicko||(this.m_nSirkaPolicko=20),this.m_Policka[this.m_Policka.length-1].$div.addClass("last"),this.m_nOldContentWidth=this.$content_d.get(0).clientWidth}},a.prototype.Zoom=function(t){switch(t){case"+":this.m_nVyskaRiadokTrieda*=2;break;case"-":this.m_nVyskaRiadokTrieda/=2;break;case"0":this.m_nVyskaRiadokTrieda=this.m_nDefaultVyskaRiadokTrieda;break;case"/":0<this.m_Riadky.length&&(this.m_nVyskaRiadokTrieda=Math.floor(this.$content_d.height()/this.m_Riadky.length)-1);break;default:"%"==t.charAt(t.length-1)&&(this.m_nVyskaRiadokTrieda=parseInt(t.substr(0,t.length-1))*this.m_nDefaultVyskaRiadokTrieda/100)}this.m_nVyskaRiadokTrieda=Math.min(2e3,Math.max(2,Math.round(this.m_nVyskaRiadokTrieda))),this.m_pRozApp.InvalidateTriedyView(),this.m_pRozApp.InvalidatePending()},a.prototype.Scroll=function(t){var e=0,i=this.m_nVyskaRiadokTrieda+1,n=Math.max(1,Math.floor(this.$content_d.height()/i))*i;switch(t){case"up":e=-i;break;case"down":e=+i;break;case"pgup":e=-n;break;case"pgdown":e=+n}this.$content_d.get(0).scrollTop+=e},a.prototype.SetCursor=function(t,e){void 0!==t&&(this.m_pCursorRiadok&&this.m_pCursorRiadok.$div.removeClass("cursor"),this.m_pCursorRiadok=t||null,this.m_pCursorRiadok&&this.m_pCursorRiadok.$div.addClass("cursor")),void 0!==e&&(this.m_pCursorPolicko&&this.m_pCursorPolicko.$div.removeClass("cursor"),this.m_pCursorPolicko=e||null,this.m_pCursorPolicko&&this.m_pCursorPolicko.$div.addClass("cursor"))},a.prototype.OnMouseMove=function(t){this.SetCursor(this.GetRiadokE(t),this.GetPolickoE(t))},a.prototype.OnKeyDown=function(t){switch(t.keyCode){case 107:this.Zoom("+");break;case 109:this.Zoom("-");break;case 111:this.Zoom("/");break;case 38:this.Scroll("up");break;case 40:this.Scroll("down");break;case 33:this.Scroll("pgup");break;case 34:this.Scroll("pgdown");break;case 68:t.ctrlKey&&t.shiftKey;break;default:return}t.stopPropagation()},a.prototype.OnLButtonClick=function(t){this.$div.focus(),this.m_pRozApp.ZrusKontrolu(),this.ClickRiadok(t)||this.ClickRozvrh(t)||(t.stopPropagation(),t.preventDefault())},a.prototype.OnRButtonClick=function(t){this.RightClickRiadok(t)||(this.m_pRozApp.m_TahanaMHodina.IsEmpty()?this.RightClickRozvrhVolno(t):this.m_pRozApp.OdhodKartu())},a.prototype.ClickRiadok=function(t){var e=this.Event2XY(t);if(e.x<0||e.x>=this.m_nSirkaStlpecMenoTriedy||e.y<this.m_nVyskaMenoDna)return!1;var i=this.GetRiadokE(t).m_pRokObject,n=this.m_pRozApp.m_pRadSelector;if(t.shiftKey){n.m_Table!=i.m_Table&&n.AddRadObject(i);var s,r,o=[];r=s=!1;for(var a=this.m_Riadky.length-1;0<=a;a--)if((l=this.m_Riadky[a].m_pRokObject)==i&&(s=!0),s&&(o.indexOf(l)<0&&o.push(l),n.IsInRad(l))){r=!0;break}if(!r)for(r=s=!1,a=o.length=0;a<this.m_Riadky.length;a++)if((l=this.m_Riadky[a].m_pRokObject)==i&&(s=!0),s&&(o.indexOf(l)<0&&o.push(l),n.IsInRad(l))){r=!0;break}if(r)for(a=0;a<o.length;a++){var l=o[a];n.AddRadObject(l)}return this.m_pRozApp.InvalidateSelector(),!0}return t.ctrlKey?n.IsInRad(i)?n.RemoveRadObject(i):n.AddRadObject(i):(n.SetCelok(),n.AddRadObject(i)),this.m_pRozApp.InvalidatePending(),this.m_bInvalidFarbyRiadkov=!0},a.prototype.JePohladDozory=function(){return this.m_pAktPohlad&&"classroomsupervision"==this.m_pAktPohlad.m_Typ},a.prototype.JePohladLessonGrid=function(){return this.m_pAktPohlad&&"lessongrid"==this.m_pAktPohlad.m_Typ},a.prototype.RightClickRiadok=function(t){var o=this,e=this.Event2XY(t);if(e.x<0||e.x>=this.m_nSirkaStlpecMenoTriedy||e.y<this.m_nVyskaMenoDna)return!1;var i=this.GetRiadokE(t);if(!i)return!1;var n=i.m_pRokObject,a=this.m_pRozApp,s=a.m_pRadSelector;if(!s.IsInRad(n)&&!this.ClickRiadok(t))return!1;a.ZrusKontrolu();var l=s.GetJediny(),c=s.GetRadList(),d=null;c.length&&(d=c[0]);var r=[];if(V.CUtils.AddMenuItemSmart(r,"test"),r.push([]),(l||d)&&l&&l.UI_RiadokPopup(r,this),r.push([]),V.CUtils.AddMenuItemSmart(r,"printpreview"),r.push([]),this.JePohladDozory())1==c.length&&(V.CUtils.AddMenuItemSmart(r,"",{text:ASC.ttls(3123),onclick:function(){a.click_func("dozor","cmd=remove&classroomid="+d.m_Id)}}),V.CUtils.AddMenuItemSmart(r,"",{text:ASC.ttls(3123)+" - "+V.CUtils.GetTableName("teachers"),onclick:function(){for(var t=0,e=d.GetDozory();t<e.length;t++){var i=e[t];a.InvalidateDozor(i),i.SetUcitel(null)}}}));else{V.CUtils.AddMenuItemSmart(r,"verification"),V.CUtils.AddMenuItemSmart(r,"listconstraints"),r.push([]),V.CUtils.AddMenuItemSmart(r,"deletecards"),V.CUtils.AddMenuItemSmart(r,"lockcards",{text:ASC.ttls(1713),icon:V.CUtils.GetIconLocked(!0)}),V.CUtils.AddMenuItemSmart(r,"unlockcards",{text:ASC.ttls(1729),icon:V.CUtils.GetIconLocked(!1)});var m=s.GetVybraneHodiny(a.m_pTriedyView.m_nROJTF).map(function(t){return t.m_Id});if(0<m.length){r.push([]);var u=[];V.CUtils.AddMenuItemSmart(u,"",{text:ASC.ttls(4344),onclick:function(){return p.__awaiter(o,void 0,void 0,function(){return p.__generator(this,function(t){switch(t.label){case 0:return[4,Promise.resolve().then(function(){return require("./server/refactor")})];case 1:return t.sent().refactorSinglesToDoubles(null,a.ttgpid,m),[2]}})})}}),r.push({text:ASC.ttls(4029),submenu:u})}}return ASC.showContextMenu(r,t,{header:ASC.escapeHTML(s.GetSimplePopis()),handler:function(t){var e=t.cmd;if(!l||!l.UI_OnCommand(e,o))switch(e){case"deletecards":case"lockcards":case"unlockcards":return void c.forEach(function(t){t.UI_OnCommand(e,o)});case"test":return void a.ClickGenerate({sel:!0});case"verification":return void a.ClickVerification("verification","sel");case"listconstraints":return void a.ClickVerification("listconstraints","sel");case"printpreview":for(var i={},n=0,s=c;n<s.length;n++){var r=s[n];i[r.m_Table]||(i[r.m_Table]=[]),i[r.m_Table].push(r.m_Id)}return a.PrintPreview(),a.m_pPrintPreview.SetZostava(d.m_Table),void a.PrintSetFilter(i)}}}),!0},a.prototype.RightClickRozvrhVolno=function(s){var r=this,t=this.GetRiadokE(s),o=this.GetPolickoE(s);if(!t||!o)return!1;var a=t.m_pRokObject,e=this.m_pRok;if(!this.JePohladDozory()){var i,n=[],l=a.UI_GetKartyNaPolicko(this,o),c=[],d=[];if(l.forEach(function(t){t.JeUmiestnena()?d.push(t):c.indexOf(t.m_pHodina)<0&&(c.push(t.m_pHodina),d.push(t))}),0==d.length?V.CUtils.AddMenuItemSmart(n,"",{text:ASC.ttls(1711),disabled:!0}):d.forEach(function(t){V.CUtils.AddMenuItemSmart(n,"putcard",{data:t})}),n.push([]),V.CUtils.AddMenuItemSmart(n,"deletecards"),a.m_pVolno){var m=a.m_pVolno.GetTWDH(o.m_nTerm,o.m_nWeek,o.m_nDay,o.period);i=[],["0","?","1"].forEach(function(t){V.CUtils.AddMenuItemSmart(i,"timeoff:"+t,{checked:t==m})}),n.push([]),V.CUtils.AddMenuItemSmart(n,"timeoff",{submenu:i})}return ASC.showContextMenu(n,s,{header:ASC.escapeHTML(V.CUtils.GetUINazov(a,"short_name")),handler:function(t){var e=t.cmd;switch(e){case"putcard":var i=t.data,n=new k(r.m_pRok);return n.Add(i),n.FinishAdding(),void a.UI_KartaUmiestni(r.m_pRozApp,n,o,s);case"deletecards":return void a.UI_OnCommand(e,r);case"timeoff:0":case"timeoff:?":case"timeoff:1":return a.m_pVolno.SetTWDH(o.m_nTerm,o.m_nWeek,o.m_nDay,o.period,e.substr(8)),void r.m_pRozApp.InvalidateObject(a)}}}),!0}for(var u=[],p=this.Event2XY(s).x>(o.x1+o.x2)/2,h=0,_=[!0,!1];h<_.length;h++){var f=_[h],v=new U.CDozor(this.m_pRok,{classroomid:a.m_Id,teacherid:"",term:V.CUtils.minus2blank(o.m_nTerm),week:V.CUtils.minus2blank(o.m_nWeek),day:V.CUtils.minus2blank(o.m_nDay),period:f?"":o.period,break:f?o.period+(p?1:0):""});v.m_Hodina<e.m_nHodinyOd||v.m_Hodina>e.m_nHodinyDo||(v.m_bTemp=!0,u.push(v))}this.RightClickDozor(s,u[0],{adddozory:u})},a.prototype.ClickRozvrh=function(t){var e=this.GetRiadokE(t),i=this.GetPolickoE(t);if(!e||!i)return!1;var n=e.m_pRokObject;if(!this.m_pRozApp.m_TahanaMHodina.IsEmpty())return n.UI_KartaUmiestni(this.m_pRozApp,this.m_pRozApp.m_TahanaMHodina,i,t),!0;var s=this.GetKartaOnPositionE(t);return!!s&&(n.UI_KartaVyberOdtialto(this.m_pRozApp,i,s,t),!0)},a.prototype.RightClickKarta=function(t,l){var i=this,e=l.m_pHodina,n=this.GetRiadokE(t);if(!n)return!1;if(!this.GetPolickoE(t))return!1;var c=this.m_pRozApp,s=c.m_pRok,r=n.m_pRokObject,o=new k(s);o.SetPozicia(r),o.Add(l),o.FinishAdding();var a=o.IsLocked(!0),d=[];d.push(e.m_pPredmet),$j.merge(d,e.m_Triedy),$j.merge(d,e.m_Ucitelia);var m,u=[];a?V.CUtils.AddMenuItemSmart(u,"unlockcard",{text:ASC.ttls(1619)}):(V.CUtils.AddMenuItemSmart(u,"removecard",{text:ASC.ttls(1025)}),V.CUtils.AddMenuItemSmart(u,"lockcard",{text:ASC.ttls(1618)})),u.push([]),V.CUtils.AddMenuItemSmart(u,"deletecards"),u.push([]),m=[];for(var p=0;p<e.m_nPotrebujeUcebni;p++)!function(o){var a=l.Ucebna(o);e.GetUcebneV(o).forEach(function(e){var t={};t.text=V.CUtils.GetUINazov(e),t.checked=e==a;var i=e.m_pVolno.GetKarta(l);"1"!=i&&(t.icon=V.CUtils.GetIconVhodnost(i));var n=[];if(e.AddKartyTuK(n,l,0),n.length){var s=!1,r=!0;n.forEach(function(t){t.IsLocked()&&(s=!0),l.MozeKolidovat(t)||(r=!1)}),r?"1"==i&&e!=a&&(t.icon=V.CUtils.GetIconVhodnost("1")):(t.icon=V.CUtils.GetIconVhodnost("0"),s&&(t.disabled=!0))}t.onclick=function(){c.InvalidateKarta(l),l.FreeUcebna(o),n.forEach(function(t){l.MozeKolidovat(t)||(c.InvalidateKarta(t),t.FreeUcebnaU(e))}),l.SetUcebna(e,o),c.InvalidateKarta(l)},V.CUtils.AddMenuItemSmart(m,"",t)}),m.push([])}(p);if(V.CUtils.AddMenuItemSmart(m,"",{text:ASC.ttls(1723),onclick:function(){c.InvalidateKarta(l),l.FreeUcebna()}}),V.CUtils.AddMenuItemSmart(u,"",{submenu:m,text:ASC.ttls(1092)}),u.push([]),V.CUtils.AddMenuItemSmart(u,"editlesson",{onclick:function(){c.click_func("edit","table=lessons&id="+e.m_Id)}}),0<e.m_KurzyPreTriedy.length){var h=ASC.ttls(2604),_=e.GetZiaci();h+=" ("+_.length+")",u.push([]),m=[];for(var f=0,v=_;f<v.length;f++){var b=v[f];V.CUtils.AddMenuItemSmart(m,"",{data:b})}V.CUtils.AddMenuItemSmart(u,"",{submenu:m,text:h})}u.push([]),m=[],d.forEach(function(t){V.CUtils.AddMenuItemSmart(m,"",{text:V.CUtils.GetUINazov(t),data:t,onclick:function(){c.click_func("zadanie","table="+t.m_Table+"&id="+t.m_Id)}})}),V.CUtils.AddMenuItemSmart(u,"",{submenu:m,text:ASC.ttls(3621)}),u.push([]),m=[],d.forEach(function(t){if(t.m_pVolno){var e=t.m_pVolno.GetKarta(l);V.CUtils.AddMenuItemSmart(m,"timeoff:"+e,{text:V.CUtils.GetUINazov(t),onclick:function(){c.click_func("timeoff","table="+t.m_Table+"&id="+t.m_Id)}})}}),V.CUtils.AddMenuItemSmart(u,"timeoff",{submenu:m}),ASC.showContextMenu(u,t,{header:ASC.escapeHTML(V.CUtils.GetUINazov(l,"short")),handler:function(t){var e=t.cmd;r.UI_OnCommand(e,i,l)}})},a.prototype.d2p=function(t,e){var i="";return i=t.m_Prestavka?"break="+t.m_Hodina:"period="+t.m_Hodina,t.m_bTemp||(i+="&id="+t.m_Id),0<=e.m_nDay&&(i+="&day="+e.m_nDay),0<=e.m_nWeek&&(i+="&week="+e.m_nWeek),0<=e.m_nTerm&&(i+="&term="+e.m_nTerm),i},a.prototype.RightClickDozor=function(t,i,e){var n=this;void 0===e&&(e={});var s=this.GetRiadokE(t);if(!s)return!1;var r=this.GetPolickoE(t);if(!r)return!1;var o=s.m_pRokObject,a=null;o instanceof U.CRokObject&&(a=o);var l,c=this.m_pRozApp,d=c.m_pRok,m=[],u=this.d2p(i,r);if(o instanceof U.CUcitel&&(u+="&teacherid="+o.m_Id),o instanceof U.CUcebna&&(u+="&classroomid="+o.m_Id),i.m_bTemp)for(var p=e.adddozory||[i],h=function(t){if(0<d.GetDozoryTWDH(a,r.m_nTerm,r.m_nWeek,r.m_nDay,t.m_Hodina,t.m_Prestavka).length)return"continue";if(r.m_nDay<0)return"continue";var e=_.d2p(t,r);m.push({text:ASC.ttls(3122)+" ("+t.GetHodinaText()+")",icon:V.CUtils.GetIconNic(),onclick:function(){c.click_func("dozor",e+"&cmd=add&classroomid="+o.m_Id)}})},_=this,f=0,v=p;f<v.length;f++)h(v[f]);else"teachers"==o.m_Table&&m.push({text:ASC.ttls(3123),onclick:function(){c.InvalidateDozor(i),i.SetUcitel(null)},icon:V.CUtils.GetIconNic()}),"classrooms"==o.m_Table&&m.push({text:ASC.ttls(3123),onclick:function(){c.click_func("dozor",u+"&cmd=remove")},icon:V.CUtils.GetIconNic()});if(!i.m_bTemp){if(i.m_bLocked?m.push({text:ASC.ttls(1619),icon:V.CUtils.GetIconLocked(!1),onclick:function(){i.SetLocked(!1),c.InvalidateDozor(i)}}):m.push({text:ASC.ttls(1618),icon:V.CUtils.GetIconLocked(!0),onclick:function(){i.SetLocked(!0),c.InvalidateDozor(i)}}),!i.m_bLocked&&a){p=d.GetDozoryTWDH(a,r.m_nTerm,r.m_nWeek,r.m_nDay,i.m_Hodina,i.m_Prestavka),l=[];for(var b=function(t){l.push({text:""+t,checked:t==p.length,onclick:function(){c.click_func("dozor",u+"&cmd=setcount&count="+t)}})},g=1;g<=5;g++)b(g);m.push({text:ASC.ttls(1266),submenu:l,icon:V.CUtils.GetIconNic()})}if(!i.m_bLocked){m.push([]),m.push({text:ASC.ttls(1090),icon:V.CUtils.GetIconNic(),onclick:function(){c.click_func("dozor",u+"&cmd=generate")}}),m.push({text:ASC.ttls(4267),icon:V.CUtils.GetIconNic(),onclick:function(){c.click_func("dozor",u+"&cmd=removeallteachers")}}),m.push([]),m.push({text:ASC.ttls(3118),icon:V.CUtils.GetIconNic(),onclick:function(){n.m_pRozApp.InvalidateDozor(i),i.SetUcitel(null)},selected:!i.m_pUcitel});for(var y=[],k=0,C=d.TableObjects("teachers");k<C.length;k++){var S=C[k];y.push(new R(i,S))}y.sort(function(t,e){return e.poradie-t.poradie});for(var T=0,w=y;T<w.length;T++){var A=w[T];m.push(A.MenuItem())}}}ASC.showContextMenu(m,t,{header:ASC.escapeHTML(i.GetHodinaText()+" ("+i.GetDlzkaVMinutach()+")"),handler:function(t){var e=t.cmd;o.UI_OnCommand(e,n,i)}})},a.prototype.GetKartaOnPositionE=function(t){var e=this.GetRiadokE(t);return e?e.GetKartaOnPositionE(t):null},a.prototype.Event2XY=function(t){var e=this.$div.offset();return{x:ertl(!0,!1)?t.pageX-e.left:e.left+this.$div.width()-t.pageX,y:t.pageY-e.top}},a.prototype.OnClick=function(t){var e=t.x-this.$content_d.offset().left,i=t.y-this.$content_d.offset().top+this.$content_d.get(0).scrollTop,n=this.GetRiadok(i),s=this.GetPolicko(e);n&&s&&(this.m_pRozApp.m_TahanaMHodina.IsEmpty()||n.m_pRokObject.UI_KartaUmiestni(this.m_pRozApp,this.m_pRozApp.m_TahanaMHodina,s,t))},a.prototype.FindRiadok=function(t){for(var e=0;e<this.m_Riadky.length;e++){var i=this.m_Riadky[e];if(i.m_pRokObject==t)return i}return null},a.prototype.GetRiadok=function(t){if(t<this.m_nVyskaMenoDna)return null;var e=Math.floor((t-this.m_nVyskaMenoDna+this.$content_d.get(0).scrollTop)/(this.m_nVyskaRiadokTrieda+1));return 0<=e&&e<this.m_Riadky.length?this.m_Riadky[e]:null},a.prototype.GetRiadokE=function(t){return this.GetRiadok(this.Event2XY(t).y)},a.prototype.GetPolicko=function(t){for(var e=0;e<this.m_Policka.length;e++){var i=this.m_Policka[e];if(t>=i.x1&&t<=i.x2+1)return i}return null},a.prototype.GetPolickoE=function(t){return this.GetPolicko(this.Event2XY(t).x)},a.prototype.FillRibbonCombos=function(){var e=this;if(!this.m_pRozApp.ttviewer){var i=this.m_pRozApp.$rg_pohlad_div,n="width:150px; display:block; margin-bottom: 2px";this.m_pComboPohlad||(this.m_pComboPohlad=new ASC.ui.ComboBox(i,this.m_pAktPohlad?this.m_pAktPohlad.m_Id:"",[],{style:n,fn:function(){"view_edit"==e.m_pComboPohlad.value?(e.m_pComboPohlad.ASC_set(e.m_pAktPohlad.m_Id),e.m_pRozApp.click_func("edit","table=ttviews&id="+e.m_pAktPohlad.m_Id)):e.SetAktPohlad(e.m_pComboPohlad.value)}})),["terms","weeks","days"].forEach(function(t){e.m_ComboObdobia[t]||(e.m_ComboObdobia[t]=new ASC.ui.ComboBox(i,"",[],{style:n,fn:function(){e.SetAktObdobie(t,e.m_ComboObdobia[t].value)}}))});for(var t=[],s=0,r=this.m_pRok.TableObjects("ttviews");s<r.length;s++){var o=r[s];o.m_Hidden||t.push({value:o.m_Id,name:o.GetNazov(),icon:o.m_Icon})}t.push([]),t.push({name:ASC.ttls(3303),value:"view_edit"}),this.m_pComboPohlad.setItems(t),this.m_pAktPohlad&&this.m_pComboPohlad.ASC_set(this.m_pAktPohlad.m_Id,!1);for(var a=0,l=["terms","weeks","days"];a<l.length;a++){var c=l[a],d=this.m_ComboObdobia[c],m=!1;"days"==c&&(m=!0),1==this.m_pRok.GetObdobieCount(c)&&(m=!0),m?d.$div.hide():d.$div.show();var u=c+"defs",p=!(t=[]),h=null,_=null,f=this.m_pRok.GetObdobieCount(c),v=f;v<2&&(v=2),4<v&&(v=4);for(var b=0,g=this.m_pRok.Obdobia(u);b<g.length;b++){var y=g[b];switch(y==this.m_pAktObdobie[c]&&(p=!0),y.m_Typ){case"one":var k="";2<=f&&f<=4&&("terms"==c&&(k="b_"+v+"_"+(y.m_Val+1)),"weeks"==c&&(k="g_"+v+"_"+(y.m_Val+1))),t.push({value:y.m_Id,name:y.GetNazov(),icon:k?"/timetable/pics/app/term_week_day/"+k+".png":null});break;case"all":var C=(h=y).GetNazov();k="","terms"==c&&(C=ASC.ttls(3552),k="b_"+v+"_A"),"weeks"==c&&(C=ASC.ttls(3444),k="g_"+v+"_A"),t.push({value:y.m_Id,name:C,icon:k?"/timetable/pics/app/term_week_day/"+k+".png":null});break;case"any":C=(_=y).GetNazov(),"terms"==c&&(C=ASC.ttls(3553),k="b_x"),"weeks"==c&&(C=ASC.ttls(3443),k="g_x"),t.push({value:y.m_Id,name:C,icon:k?"/timetable/pics/app/term_week_day/"+k+".png":null})}}p||(this.m_pAktObdobie[c]="days"==c?_:h),d.setItems(t),this.m_pAktObdobie[c]&&d.ASC_set(this.m_pAktObdobie[c].m_Id,!1)}}},a.prototype.SetAktPohlad=function(t){if(ASC.isString(t))for(var e=0,i=this.m_pRok.TableObjects("ttviews");e<i.length;e++){var n=i[e];if(n.m_Id==t){t=n;break}}var s=t;this.m_pAktPohlad=s,this.m_pComboPohlad&&this.m_pComboPohlad.ASC_set(s.m_Id,!1),this.m_pRozApp.InvalidateTriedyView(),this.m_pRozApp.InvalidatePending(),this.m_pRozApp.InvalidatePohladSwitcher()},a.prototype.SetAktObdobie=function(t,e){var i;i=ASC.isString(e)?this.m_pRok.m_ObjectsI[t+"defs"][e]:e,console.log([t,e,i,this.m_pAktObdobie]),i&&(this.m_pAktObdobie[t]=i,this.m_pRozApp.InvalidateTriedyView(),this.m_pRozApp.InvalidatePending())},a.prototype.GetPohladForTable=function(t){for(var e=0,i=this.m_pRok.TableObjects("ttviews");e<i.length;e++){var n=i[e];if(n.m_Data.table==t)return n}return null},a.prototype.InvalidateMHodina=function(t){for(var e=0;e<this.m_Riadky.length;e++){var i=this.m_Riadky[e],n=i.m_pRokObject;t.m_ObjectsI[n.m_Table][n.m_Id]&&(i.m_bInvalid=!0)}},a.prototype.InvalidateObject=function(o){var a=this;this.m_Riadky.forEach(function(t){if(!t.m_bInvalid){var e=t.m_pRokObject,i=!1;if(e==o)i=!0;else for(var n=e.GetHodinyMozuSem(a.m_nROJTF),s=0;s<n.length;s++){var r=n[s];switch(o.m_Table){case"classes":i=0<=r.m_Triedy.indexOf(o);break;case"teachers":i=0<=r.m_Ucitelia.indexOf(o);break;case"subjects":i=r.m_pPredmet==o}if(i)break}i&&(t.m_bInvalid=!0)}})},a.prototype.Validate=function(){if((this.m_bInvalidAll||this.$content_d&&this.$content_d.get(0).clientWidth!=this.m_nOldContentWidth)&&(this.UpdateStruct(),this.m_bInvalidAll=!1),!this.m_pRozApp.ttviewer){for(var t=this.m_nDefaultSirkaStlpecMenoTriedy,e=0,i=this.m_Riadky;e<i.length;e++){var n=i[e];n.m_bInvalid&&n.DrawMeno0()}for(var s=0,r=this.m_Riadky;s<r.length;s++){var o=r[s];o.$name_s&&(t=Math.max(t,o.$name_s.width()+4))}(t=Math.min(t,150))!=this.m_nSirkaStlpecMenoTriedy&&(this.m_nSirkaStlpecMenoTriedy=t,this.UpdateStruct());var a=[];if(50<=this.m_Riadky.length)for(var l=this.$content_d.scrollTop(),c=this.$content_d.height(),d=l-.3*c,m=l+1.3*c,u=0,p=this.m_Riadky;u<p.length;u++){var h=p[u];h.m_bInvalid&&!h.isOutOfView(d,m)&&a.push(h)}else $j.merge(a,this.m_Riadky);for(var _=0,f=a;_<f.length;_++){var v=f[_];v.m_bInvalid&&v.Draw()}this.m_bInvalidFarbyRiadkov&&this.UpdateFarbyRiadkov(),this.m_bInvalidFarbyStlpcov&&this.UpdateFarbyStlpcov()}},a.prototype.UpdateFarbyRiadkov=function(){this.m_Riadky.forEach(function(t){t.UpdateFarbaRiadku()}),this.m_bInvalidFarbyRiadkov=!1},a.prototype.UpdateFarbyStlpcov=function(){this.m_Policka.forEach(function(t){t.UpdateFarbaStlpca()}),this.m_bInvalidFarbyStlpcov=!1},a.prototype.BuildRVKarta=function(t){var e=this.m_pAktPohlad,i=this.m_pRozApp,n=document.createElement("div");n.className="rvcard";var s=this.m_nVyskaRiadokTrieda;50<s&&(s=50);var r=this.m_nSirkaPolicko;50<r&&(r=50),r*=t.GetMaxDlzka()+1,n.style.width=r+"px",n.style.height=s+"px";var o=this.m_pTTRowRenderer;o.Clear(),o.m_bIgnoreFilters=!0,o.m_bVsetkoNaJednuPoziciu=!0,o.m_SuggestedKarty=t.m_Objects.cards,o.m_pHorizontalRokObject=t.m_Pozicia.classes,0<t.m_nRozView_TypKarty&&1<o.m_SuggestedKarty.length&&(o.m_SuggestedKarty=[o.m_SuggestedKarty[0]]),o.Compute(),ASC.assert(0<o.m_Cells.length);for(var a=0;a<o.m_Cells.length;a++){var l=o.m_Cells[a],c=document.createElement("div");c.className="card",n.appendChild(c),c.innerHTML=ASC.escapeHTML(l.m_pKarta.GetTexty(e.texttables)),c.ASC_karta=l.m_pKarta,c.style.left="0px",c.style.right="0px",c.style.top=100*l.y1+"%",c.style.bottom=100-100*l.y2+"%";var d=l.m_pKarta.GetFarby(e.colortable);if(d&&0!=d.length||(d=["#ffffff"]),"teachers"==e.colortable){var m=l.m_pKarta.m_pHodina.m_Ucitelia[0];m&&m.m_Data.fontcolorscreen&&(c.style.color=m.m_Data.fontcolorscreen)}t.m_bRozView_Zasednut&&(d=V.CUtils.ZasedniColors(d)),ASC.strippedBackground(c,d),i.VerticalCenter(c)}return n},a.prototype.PaintMH=function(t,e,i,n,s,r){var o=this.m_pAktPohlad,a=this.m_pTTRowRenderer;a.Clear(),a.m_bIgnoreFilters=!0,a.m_bVsetkoNaJednuPoziciu=!0,a.m_SuggestedKarty=r.m_Objects.cards,a.m_pHorizontalRokObject=r.m_Pozicia.classes,a.Compute(),ASC.assert(0<a.m_Cells.length);for(var l=0;l<a.m_Cells.length;l++){var c=a.m_Cells[l],d=c.m_pKarta.GetTexty(o.texttables),m=c.m_pKarta.GetFarby(o.colortable),u=Math.round(i+s*c.y1),p=Math.round(i+s*c.y2);if(V.CUtils.PaintFarbyToRect(m,t,e,u,n,p-u),t.font="Arial 11px",t.fillStyle="#000000","teachers"==o.colortable){var h=c.m_pKarta.m_pHodina.m_Ucitelia[0];h&&h.m_Data.fontcolorscreen&&(t.fillStyle=h.m_Data.fontcolorscreen)}V.CUtils.PaintTextToRect(d,t,e,u,n,p-u)}},a.prototype.GetPreviewMHodina=function(){return this.m_bPreviewPodKurzorom?this.m_pRozApp.m_PodKurzoromMHodina:this.m_pRozApp.m_TahanaMHodina},a.prototype.ScrollToRiadky=function(t){if(0!=t.length){for(var e=this.m_pRozApp.m_pTriedyView.$content_d[0],i=1e6,n=0,s=0,r=t;s<r.length;s++){var o=r[s].$div[0],a=o.offsetTop,l=a+o.offsetHeight;i=Math.min(i,a),n=Math.max(n,l)}var c=e.scrollTop;c=Math.max(c,n-e.clientHeight),c=Math.min(c,i),e.scrollTop=c}},a);function a(t,e){this.m_Riadky=[],this.m_Policka=[],this.m_nVyskaMenoDna=22,this.m_nDefaultVyskaRiadokTrieda=25,this.m_nDefaultSirkaStlpecMenoTriedy=28,this.m_pAktObdobie={},this.m_bPreviewPodKurzorom=!1,this.m_pCursorRiadok=null,this.m_pCursorPolicko=null,this.m_pComboPohlad=null,this.m_ComboObdobia={},this.m_nOldContentWidth=-1,this.m_bInvalidAll=!1,this.m_bInvalidFarbyRiadkov=!1,this.m_bInvalidFarbyStlpcov=!1,this.m_nROJTF=0,this.lastPohlad=null,this.m_pRozApp=t,this.m_pRok=this.m_pRozApp.m_pRok,this.$div=e,this.$div.addClass("triedyview"),this.m_pAktPohlad=null,this.m_nVyskaRiadokTrieda=this.m_nDefaultVyskaRiadokTrieda,this.m_nSirkaStlpecMenoTriedy=this.m_nDefaultSirkaStlpecMenoTriedy,this.m_nSirkaPolicko=20,this.m_pTTRowRenderer=new n.CTTRowRenderer(this.m_pRok),this.$div.attr("tabindex","0")}t.CTriedyView=o;var g=(l.prototype.isOutOfView=function(t,e){var i=this.$div[0].offsetTop;return i<t||e<i},l.prototype.DrawMeno0=function(){this.$name_d&&this.$name_d.remove(),this.$name_d=$j("<div class='name'>").prependTo(this.$div).css("width",this.m_pTriedyView.m_nSirkaStlpecMenoTriedy+1+"px"),this.$name_s=$j("<span>").text(this.m_pRokObject.GetSkratka()).appendTo(this.$name_d)},l.prototype.Draw=function(){var a=this.$div,t=this.m_pTriedyView,e=t.m_pRozApp,i=t.m_Policka,n=t.m_pAktPohlad,s=e.m_pKontrolaItem,r=null;s&&(r=s.FindRiadok(this.m_pRokObject));var o,l=this.m_pRokObject instanceof U.CTrieda?this.m_pRokObject:null;a.empty(),this.DrawMeno0(),e.VerticalCenter(this.$name_d.get(0));for(var c=0;c<i.length;c++){var d=i[c];o=(0!=c&&((j=document.createElement("div")).className="vline",a.append(j),j.style[ertl("left","right")]=d.x1-1+"px",d.m_pGroup!=o.m_pGroup&&ASC.setClass(j,"first")),d)}var m=this.m_pRokObject.GetKartyTu(t.m_nROJTF);a.get(0).ASC_karty=m;var u=0;for(c=0;c<m.length;c++)m[c].JeUmiestnena()||u++;0<u&&$j("<span class='neumiestnenych'>").text(""+u).appendTo(this.$name_d);var p=t.m_pTTRowRenderer;p.Clear();for(var h=!0,_=0;_<i.length;_++){var f=i[_];h&&(p.Clear(),p.m_pHorizontalRokObject=this.m_pRokObject,p.m_pHorizontalVolno=this.m_pRokObject.m_pVolno,p.m_nDay=f.m_nDay,p.m_nWeek=f.m_nWeek,p.m_nTerm=f.m_nTerm,p.m_nVerticalHodinyOd=f.period,p.m_SuggestedKarty=m,h=!1),p.m_Policka.push(f);var v=!0,b=i[_+1];if(b&&b.JeRovnakyDen(f)&&(v=!1),v){if(p.m_nVerticalHodinyDo=f.period,p.Compute(),p.m_pHorizontalVolno)for(var g=0;g<p.m_nXCount;g++)for(var y=p.m_nVerticalHodinyOd+g,k=p.m_nXFaz[g],C=0;C<k;C++){var S=0;if("0"==p.GetVolno(C,g)?S=1:l&&l.JeObed(y)&&(S=2),0<S){var T=p.m_Policka[g].x1,w=p.m_Policka[g].x2;switch((j=document.createElement("div")).style[ertl("left","right")]=T+"px",j.style.width=w-T+"px",j.style.top="0%",j.style.bottom="0%",S){case 1:j.className="krizik";break;case 2:j.className="obed"}a.append(j)}}for(c=0;c<p.m_Cells.length;c++){var A=p.m_Cells[c],R=A.m_pKarta;(j=document.createElement("div")).className="card",a.append(j);var I=R.GetTexty(n.texttables);ASC.createText(j,I),j.ASC_karta=R,T=p.m_Policka[A.x1].x1,w=p.m_Policka[A.x2].x2,j.style.boxSizing="border-box",j.style[ertl("left","right")]=T+"px",j.style.width=w-T+"px",j.style.top=100*A.y1+"%",j.style.bottom=100-100*A.y2+"%";var D=R.GetFarby(n.colortable);if(D&&0!=D.length||(D=["#ffffff"]),"teachers"==n.colortable){var O=R.m_pHodina.m_Ucitelia[0];O&&O.m_Data.fontcolorscreen&&(j.style.color=O.m_Data.fontcolorscreen)}var x=!1,P=!1;s&&(x=!0,r&&(r.m_RelevantneHodiny[R.m_pHodina.m_Id]&&(x=!1),r.m_ZleKarty[R.m_Id]&&(x=!(P=!0)))),x&&(D=V.CUtils.ZasedniColors(D));var E=(A.y2-A.y1)*t.m_nVyskaRiadokTrieda;ASC.strippedBackground(j,D,w-T,E,!0),P&&(j.style.border="2px solid red"),I.length<=2||I.indexOf(" ")<0?j.style.paddingTop=Math.max(0,(E-11)/2)+"px":e.VerticalCenter(j),0<(D=A.m_pKarta.GetFarbyChyby()).length&&(ASC.createDiv(j,"pruzok").style.backgroundColor=D[0]);var z=!1;if("students"==this.m_pRokObject.m_Table){var G=this.m_pRokObject.GetZiakPredmet(R.m_pHodina);G&&G.m_bLocked&&(z=!0)}else z=A.m_pKarta.IsLocked();z&&ASC.createDiv(j,"locked"),j.onmouseover=e.m_OnMouseOverKarta,j.onmouseout=e.m_OnMouseOutKarta,t.JePohladDozory()||(j.onclick=e.m_OnMouseClickKarta,j.oncontextmenu=e.m_OnMouseRightClickKarta),j.onmouseup=e.m_OnMouse_StopEvent}if(1<p.m_nMaxFaz)for(g=0;g<p.m_nXCount;g++)if(!((k=p.m_nXFaz[g])<=1))for(d=p.m_Policka[g],C=1;C<k;C++){var j;(j=document.createElement("div")).className="cyklus",j.style[ertl("left","right")]=d.x1+"px",j.style.width=d.x2-d.x1+"px",j.style.top=100*C/k+"%",a.append(j)}if(r){var M=function(t,e){if(t)for(var i=null,n=0,s=0,r=0;r<p.m_nXCount;r++){var o=p.m_Policka[r];"1"==ASC.tt.timeOff_get(t,o.m_nTerm,o.m_nWeek,o.m_nDay,o.period,function(t,e){return"1"==t||"1"==e?"1":t})?i?i.style.width=o.x2-n+"px":((i=document.createElement("div")).className="vysvietpos",i.style.borderColor=e,n=o.x1,s=o.x2,i.style.left=n+"px",i.style.width=s-n+"px",a.append(i)):i=null}};M(r.m_pVysviet2,"#fce872"),M(r.m_pVysviet1,"#ff8040"),M(r.m_pVysvietZle,"#ff0000")}h=!0}}this.m_bInvalid=!1,this.UpdateFarbaRiadku(),this.DrawDozory()},l.prototype.DrawDozory=function(){var t=this.m_pRokObject,e=t.m_pRok;if(0!=e.m_ObjectsO.classroomsupervisions.length)for(var i=this.m_pRozApp.m_pTriedyView,n=i.m_pRozApp,s=i.m_nVyskaRiadokTrieda-1,r=null,o=0,a=[!1,!0];o<a.length;o++)for(var l=a[o],c=0,d=this.m_pTriedyView.m_Policka;c<d.length;c++){var m=d[c],u=e.GetDozoryTWDH(t,m.m_nTerm,m.m_nWeek,m.m_nDay,m.period,l);if(u.length)for(var p=0;p<u.length;p++){var h=u[p],_=document.createElement("span");_.className="dozor";var f=.25+.5*p/u.length,v=.25+.5*(p+1)/u.length;_.style.top=s*f+"px",_.style.bottom=s*(1-v)-1+"px";var b=m.x1,g=(m.x2-b)/2;b--,l?r&&m.JeRovnakyDen(r)?b-=g/2:g/=2:b+=g/2,_.style.left=b+"px",_.style.width=g+"px",h.m_bLocked&&ASC.createDiv(_,"locked");var y="#c0c0c0";t instanceof U.CUcebna&&(h.m_pUcitel?y=h.m_pUcitel.GetColor():ASC.setClass(_,"otaznik")),_.style.backgroundColor=y,0<=h.m_Tyzden&&(ASC.createDiv(_,"pruzok_l").style.backgroundColor=V.CUtils.GetFarbaFazy(h.m_Tyzden,e.m_nTyzdnov)),_.ASC_dozor=h,_.oncontextmenu=n.m_OnMouseRightClickDozor,_.onmouseover=n.m_OnMouseOverKarta,_.onmouseout=n.m_OnMouseOutKarta,i.JePohladDozory()&&(_.onclick=n.m_OnMouseRightClickDozor),this.$div.append(_)}r=m}},l.prototype.MozeSemIst=function(t){return!t.IsEmpty()&&this.m_pRokObject.UI_KartaMozeSem(this.m_pRozApp,t)},l.prototype.UpdateFarbaRiadku=function(){var t=!1,e=!1;if(this.$name_d){var i=this.m_pRozApp.m_TahanaMHodina;i.IsEmpty()||this.MozeSemIst(i)&&(t=!0),this.m_pRozApp.m_pRadSelector.IsInRad(this.m_pRokObject)&&(e=!0),this.$name_d.toggleClass("mozesem",t),this.$div.toggleClass("selrad",e);var n=this.m_pRozApp.m_pSync.GetFarbyUserov(this.m_pRokObject);if(n){var s=this.$name_d.find(".users");s.length||(s=$j("<div class='users'>").appendTo(this.$name_d)),s.css("background-color",n[0]),this.$name_d.addClass("users")}else this.$name_d.find(".users").remove(),this.$name_d.removeClass("users")}},l.prototype.GetKartaOnPositionE=function(n){return this.$div.children().each(function(t,e){var i=e.ASC_karta;if(i&&V.CUtils.IsEventInside(n,$j(e)))return V.CUtils.IsEventInside(n,$j(e)),i}),null},l);function l(t,e){this.$name_d=null,this.$name_s=null,this.m_bInvalid=!0,this.m_pRozApp=t.m_pRozApp,this.m_pTriedyView=t,this.m_pRokObject=e,this.$div=$j("<div class='vriadok'>").appendTo(this.m_pTriedyView.$content_d).css("height",t.m_nVyskaRiadokTrieda+"px"),this.$div.get(0).ASC_vriadok=this}t.CVRiadok=g;var y=(c.prototype.UpdateX=function(){var t=this.m_pTriedyView.$content_d.get(0).clientWidth,e=this.m_pTriedyView.m_nSirkaStlpecMenoTriedy;t-=e,this.x1=Math.round(e+t*this.index/this.m_pTriedyView.m_Policka.length+1),this.x2=Math.round(e+t*(this.index+1)/this.m_pTriedyView.m_Policka.length),this.$div.css(ertl("left","right"),this.x1-1+"px"),this.$div.css("width",this.x2-this.x1+"px"),this.m_pGroup.UpdateX()},c.prototype.JeRovnakyDen=function(t){return this.m_nTerm==t.m_nTerm&&this.m_nWeek==t.m_nWeek&&this.m_nDay==t.m_nDay},c.prototype.UpdateFarbaStlpca=function(){var t="",e=this.m_pTriedyView.GetPreviewMHodina();e.IsEmpty()||(t=this.m_pTriedyView.m_pAktPohlad.UI_VhodnostTahanejMHodiny(e,this)),this.$div.toggleClass("obsadene","x"==t),this.$div.toggleClass("volne","1"==t),this.$div.toggleClass("otaznikove","?"==t)},c);function c(t,e,i,n,s,r){if(this.m_pGroup=null,this.m_pRozApp=t.m_pRozApp,this.m_pTriedyView=t,this.m_nTerm=e,this.m_nWeek=i,this.m_nDay=n,this.period=s,this.index=r,this.x1=0,this.x2=20,this.$div=$j("<div class='vpolicko'>").appendTo(this.m_pTriedyView.$header_d),ASC.createSpanText(this.$div.get(0),this.m_pRozApp.dbi.rowName("periods",""+this.period,"short"),"","display:block;margin-top:-0px"),this.m_pRozApp.m_pRok.m_ObjectsI.breaks[s]&&this.$div.addClass("break"),0<t.m_Policka.length){var o=t.m_Policka[t.m_Policka.length-1];o.m_nDay==this.m_nDay&&o.m_nWeek==this.m_nWeek&&o.m_nTerm==this.m_nTerm&&(this.m_pGroup=o.m_pGroup,this.m_pGroup.m_pLast=this)}this.m_pGroup||(this.m_pGroup=new d(this),this.$div.addClass("first"))}t.CVPolicko=y;var d=(m.prototype.UpdateX=function(){var t=this.m_pFirst.x1,e=this.m_pLast.x2;this.$div.css(ertl("left","right"),t-1+"px"),this.$div.css("width",e-t+"px")},m);function m(t){var e=t.m_pTriedyView;this.m_pRozApp=e.m_pRozApp,this.m_pTriedyView=e,this.m_pFirst=t,this.m_pLast=t,this.$div=$j("<div class='vpolickogroup'>").appendTo(this.m_pTriedyView.$header_d);var i=this.m_pRozApp.m_pRok,n="";0<=this.m_pFirst.m_nTerm&&(n&&(n+="-"),n+=this.m_pRozApp.dbi.rowName("terms",""+this.m_pFirst.m_nTerm)),0<=this.m_pFirst.m_nWeek&&(n&&(n+="-"),n+=this.m_pRozApp.dbi.rowName("weeks",""+this.m_pFirst.m_nWeek)),0<=this.m_pFirst.m_nDay&&(n&&(n+="-"),n+=i.GetObdobie_One("days",this.m_pFirst.m_nDay).GetNazov()),ASC.createSpanText(this.$div.get(0),n,"","display:block;margin-top:-0px")}t.CVPolickoGroup=d;var k=(u.prototype.Clear=function(){for(var t in this.m_ModeTable="",this.m_Pozicia={},this.m_Skupiny=[],this.m_Objects)this.m_Objects[t]=[],this.m_ObjectsI[t]={};this.m_pDelenie=null,this.m_bSeminar=!1,this.m_nPoradieSeminaru=-1,this.m_dHodin=0,this.m_bRoznePoctyHodin=!1},u.prototype.SetPozicia=function(t){this.m_Pozicia[t.m_Table]=t},u.prototype.Add0=function(t){var e=t.m_Table,i=t.m_Id;this.m_ObjectsI[e][i]||(this.m_Objects[e].push(t),this.m_ObjectsI[e][i]=t)},u.prototype.Add0_array=function(t){for(var e=0;e<t.length;e++)this.Add0(t[e])},u.prototype.Add0_id=function(t,e){this.Add0_array(this.m_pRok.ids2ro(t,[e]))},u.prototype.Add0_ids=function(t,e){this.Add0_array(this.m_pRok.ids2ro(t,e))},u.prototype.Add=function(t){var e=t.m_Table;ASC.assert(""==this.m_ModeTable||this.m_ModeTable==e),this.m_ModeTable=e,this.Add0(t)},u.prototype.Add_array=function(t){for(var e=0;e<t.length;e++)this.Add(t[e])},u.prototype.FinishAdding=function(){var i=this,n=this.m_Pozicia.classes;switch(this.m_ModeTable){case"cards":for(var t=0;t<this.m_Objects.cards.length;t++){var e=this.m_Objects.cards[t],s=e.m_pHodina;this.Add0(s),this.Add0_array(e.Ucebne())}break;case"lessons":for(t=0;t<this.m_Objects.lessons.length;t++)s=this.m_Objects.lessons[t],this.Add0(s);break;case"classroomsupervisions":for(var r=0,o=this.m_Objects.classroomsupervisions;r<o.length;r++){var a=o[r];this.Add0(a.m_pUcebna),a.m_pUcitel&&this.Add0(a.m_pUcitel)}}if("lessons"==this.m_ModeTable||"cards"==this.m_ModeTable){var l=!1;n=this.m_Pozicia.classes,this.m_Objects.lessons.forEach(function(t){i.Add0_array(t.m_Ucitelia),i.Add0(t.m_pPredmet),i.Add0_array(t.m_Triedy),t.m_Skupiny.forEach(function(t){var e=t.m_pTrieda;n&&e!=n||(i.m_pDelenie?i.m_pDelenie!=t.m_pDelenie&&(l=!0):i.m_pDelenie=t.m_pDelenie,t.m_bCelaTrieda||t.m_bKurz||i.m_Skupiny.indexOf(t.GetNazov())<0&&i.m_Skupiny.push(t.GetNazov()))}),0<t.m_KurzyPreTriedy.length&&(n?0<=t.m_KurzyPreTriedy.indexOf(n)&&(i.m_bSeminar=!0):i.m_bSeminar=!0)}),l&&(this.m_pDelenie=null)}this.m_dHodin=0,this.m_bRoznePoctyHodin=!1;var c=this.m_Objects.lessons;if(n){for(var d=0,m=n.m_Delenia;d<m.length;d++){for(var u=-1,p=0,h=m[d].m_Skupiny;p<h.length;p++){for(var _=h[p],f=0,v=0,b=c;v<b.length;v++)(s=b[v]).m_Skupiny.indexOf(_)<0||(f+=this.DHodin(s));u=u<0?f:(.001<Math.abs(u-f)&&(this.m_bRoznePoctyHodin=!0),Math.max(u,f))}0<u&&(this.m_dHodin+=u)}this.m_bSeminar}else{var g=0;c.forEach(function(t){g+=i.DHodin(t)}),this.m_dHodin=g}},u.prototype.GetMaxDlzka=function(){for(var t=0,e=0;e<this.m_Objects.lessons.length;e++)t=Math.max(t,this.m_Objects.lessons[e].GetDlzka());return t},u.prototype.DHodin=function(t){return t.m_pTermMozny.AvgPokrytieBitov()*t.m_pTyzdenMozny.AvgPokrytieBitov()*t.m_pDenMozny.GetDlzka()*(t.GetDlzka()+1)*1*this.PocetKarietDoSuctuHodin(t)},u.prototype.PocetKarietDoSuctuHodin=function(t){var e=this;if("cards"!=this.m_ModeTable)return t.GetPocet();var i=0;return t.m_Karty.forEach(function(t){t.JeUmiestnena()&&(e.m_Objects.cards.indexOf(t)<0||i++)}),i},u.prototype.IsEmpty=function(){switch(this.m_ModeTable){case"lessons":case"cards":return 0==this.m_Objects[this.m_ModeTable].length;default:return!(0<this.m_Objects.lessons.length||0<this.m_Objects.cards.length||0<this.m_Objects.teachers.length||0<this.m_Objects.classes.length||0<this.m_Objects.classrooms.length||0<this.m_Objects.subjects.length)}},u.prototype.Set=function(t){for(var e in this.Clear(),t.m_Pozicia)this.m_Pozicia[e]=t.m_Pozicia[e];switch(t.m_ModeTable){case"cards":case"lessons":case"classroomsupervisions":this.m_ModeTable=t.m_ModeTable,this.Add0_array(t.m_Objects[t.m_ModeTable]);break;default:for(var e in this.m_Objects)this.Add0_array(t.m_Objects[e])}this.FinishAdding()},u.prototype.Equals=function(t){for(var e in this.m_Objects)if(!V.CUtils.RovnakyList(this.m_Objects[e],t.m_Objects[e]))return!1;return!0},u.prototype.GetText=function(t,e){switch(t){case"classes":return V.CUtils.GetUINazvy(this.m_Objects.classes);case"subjects":return V.CUtils.GetUINazvy(this.m_Objects.subjects);case"teachers":return V.CUtils.GetUINazvy(this.m_Objects.teachers);case"classrooms":return V.CUtils.GetUINazvy(this.m_Objects.classrooms);case"groupnames":case"groups":return this.m_Skupiny.join(", ")}return"HU"+t},u.prototype.GetFarby=function(t){var e=[],i=this.m_Objects[t];return i&&i.forEach(function(t){e.push(t.GetColor())}),e},u.prototype.GetTexty=function(t){var e=this,i="";return t.forEach(function(t){""!=i&&(i+="\n"),i+=e.GetText(t)}),i},u.prototype.IsLocked=function(t){void 0===t&&(t=!1);var e=this.m_Pozicia.students;if(e){for(var i=!1,n=0,s=this.Hodiny();n<s.length;n++){var r=s[n],o=e.GetZiakPredmet(r);if(o)if(i=!0,o.m_bLocked){if(!t)return!0}else if(t)return!1}return!!i&&t}var a=this.m_Objects.cards;if(0==a.length)return!1;for(var l=0;l<a.length;l++){var c=a[l];if(c.JeUmiestnena()&&c.IsLocked()){if(!t)return!0}else if(t)return!1}return t},u.prototype.Karty=function(){return this.m_Objects.cards},u.prototype.Hodiny=function(){return this.m_Objects.lessons},u.prototype.Ucitelia=function(){return this.m_Objects.teachers},u.prototype.Predmety=function(){return this.m_Objects.subjects},u.prototype.Triedy=function(){return this.m_Objects.classes},u.prototype.GetJedinaKarta=function(){return 1==this.m_Objects.cards.length?this.m_Objects.cards[0]:null},u.prototype.GetJedinaHodina=function(){return 1==this.m_Objects.lessons.length?this.m_Objects.lessons[0]:null},u);function u(t){this.m_Objects={classes:[],teachers:[],subjects:[],students:[],classrooms:[],lessons:[],cards:[],classroomsupervisions:[]},this.m_ObjectsI={classes:{},teachers:{},subjects:{},students:{},classrooms:{},lessons:{},cards:{},classroomsupervisions:{}},this.m_Skupiny=[],this.m_pDelenie=null,this.m_bSeminar=!1,this.m_nPoradieSeminaru=-1,this.m_dHodin=0,this.m_bRoznePoctyHodin=!1,this.m_nRozView_Ciselko=0,this.m_nRozView_TypKarty=0,this.m_bRozView_Zasednut=!1,this.m_pRok=t,this.Clear()}t.CMHodina=k;var h=(_.prototype.SetEnabled=function(t){(t=ASC.boolVal(t))!=this.m_bEnabled&&(this.m_bEnabled=t,this.m_pRozApp.InvalidatePohladSwitcher())},_.prototype.Validate=function(){var n=this;if(this.m_bInvalid)if(this.m_bEnabled){this.$div.show(),this.$div.empty();for(var t=function(t){if(t.m_Hidden)return"continue";var e=$j("<div class='tab'>").appendTo(s.$div),i=$j("<span>").text(t.GetNazov()).appendTo(e).outerWidth();e.css("height",i+"px"),s.m_pRozApp.m_pTriedyView.m_pAktPohlad==t&&e.addClass("selected"),e.click(function(){n.m_pRozApp.m_pTriedyView.SetAktPohlad(t)})},s=this,e=0,i=this.m_pRok.TableObjects("ttviews");e<i.length;e++)t(i[e]);this.m_bInvalid=!1}else this.$div.hide()},_);function _(t,e){this.m_bEnabled=!0,this.m_bInvalid=!0,this.m_pRozApp=t,this.m_pRok=this.m_pRozApp.m_pRok,this.$div=e,this.$div.addClass("pohladswitcher")}t.CPohladSwitcher=h;var R=(f.prototype.MenuItem=function(){var t=this,e="";e=this.m_pUcitel?V.CUtils.GetUINazov(this.m_pUcitel,"short_name"):ASC.ttls(3118);var i=V.CUtils.GetIconNic(),n="/timetable/pics/app/supervision/";i=this.obsadeny?n+"uh0.png":n+"uh"+this.p1+this.p2+".png";var s=this.m_pUcitel.m_Data.constraints,r=this.m_pUcitel.GetPocetDozorov(),o=!ASC.strEmpty(s.m_nMaxDozorovPocet)||!ASC.strEmpty(s.m_nMaxDozorovMinut);return(r.count||o)&&(e+=" ("+r.minutes+"/"+r.count+")"),o&&(e+=" (",e+=ASC.strEmpty(s.m_nMaxDozorovMinut)?"-":s.m_nMaxDozorovMinut,e+="/",e+=ASC.strEmpty(s.m_nMaxDozorovPocet)?"-":s.m_nMaxDozorovPocet,e+=" "+ASC.ttls(3001)+")"),{text:e,icon:i,selected:this.m_pUcitel==this.m_pDozor.m_pUcitel,onclick:function(){t.m_pRozApp.InvalidateDozor(t.m_pDozor),t.m_pDozor.SetUcitel(t.m_pUcitel),t.m_pRozApp.InvalidateDozor(t.m_pDozor)}}},f);function f(t,e){this.p1=0,this.p2=0,this.obsadeny=!1,this.poradie=0,this.m_pRozApp=t.m_pRok.m_pRozApp,this.m_pDozor=t,this.m_pUcitel=e;var i=t.m_pRok,n=t.m_Hodina,s=t.m_Prestavka,r=!1,o=i.GetDozoryTWDH(e,t.m_Term,t.m_Tyzden,t.m_Den,n,s);(1<o.length||1==o.length&&o[0]!=t)&&(r=!0),s||e.GetKartyTuTWDH(t.m_Term,t.m_Tyzden,t.m_Den,n,0).length&&(r=!0);var a=!1,l=0,c=0,d=!0;if(s){var m=h="0"!=e.m_pVolno.GetTWDH(t.m_Term,t.m_Tyzden,t.m_Den,n);if(n>i.m_nHodinyDo&&(m="0"!=e.m_pVolno.GetTWDH(t.m_Term,t.m_Tyzden,t.m_Den,n)),h||m||(d=!1),0<n)if(0<(f=e.GetKartyTuTWDH(t.m_Term,t.m_Tyzden,t.m_Den,n-1,0)).length)l=1,t.m_pUcebna.JeBlizkaUcebna(f[0].Ucebna(0))&&(l=2),f[0].GetHodina()+f[0].GetDlzka()>=n&&(a=!0);else{var u=n-1,p=!1;(_=i.GetDozoryTWDH(e,t.m_Term,t.m_Tyzden,t.m_Den,u,p)).length&&(l=1,t.m_pUcebna.JeBlizkaUcebna(_[0].m_pUcebna)&&(l=2))}if(0<(f=e.GetKartyTuTWDH(t.m_Term,t.m_Tyzden,t.m_Den,n,0)).length)c=1,t.m_pUcebna.JeBlizkaUcebna(f[0].Ucebna(0))&&(c=2);else{u=n,p=!1;(_=i.GetDozoryTWDH(e,t.m_Term,t.m_Tyzden,t.m_Den,u,p)).length&&(c=1,t.m_pUcebna.JeBlizkaUcebna(_[0].m_pUcebna)&&(c=2))}}else{var h;(h="0"!=e.m_pVolno.GetTWDH(t.m_Term,t.m_Tyzden,t.m_Den,n))||(d=!1);var _,f;u=n,p=!0;if((_=i.GetDozoryTWDH(e,t.m_Term,t.m_Tyzden,t.m_Den,u,p)).length)l=1,t.m_pUcebna.JeBlizkaUcebna(_[0].m_pUcebna)&&(l=2);else 0<(f=e.GetKartyTuTWDH(t.m_Term,t.m_Tyzden,t.m_Den,n-1,0)).length&&(l=1,t.m_pUcebna.JeBlizkaUcebna(f[0].Ucebna(0))&&(l=2));if(u=n+1,p=!0,(_=i.GetDozoryTWDH(e,t.m_Term,t.m_Tyzden,t.m_Den,u,p)).length)c=1,t.m_pUcebna.JeBlizkaUcebna(_[0].m_pUcebna)&&(c=2);else 0<(f=e.GetKartyTuTWDH(t.m_Term,t.m_Tyzden,t.m_Den,n+1,0)).length&&(c=1,t.m_pUcebna.JeBlizkaUcebna(f[0].Ucebna(0))&&(c=2))}d||(r=!0);var v=0;r||!d?v=-1e3:(v=100+100*Math.max(l,c)+12*l+10*c,a&&(v-=1)),this.p1=l,this.p2=c,this.obsadeny=r,this.poradie=v+(1e3-this.m_pUcitel.GetSaveID())/1e3}}),ASC.setModuleSourceFunc("/timetable/app/ttrowrenderer.js",function(t,require,e){t.__esModule=!0;var r=require("./online"),i=(n.prototype.Clear=function(){this.m_pHorizontalRokObject=null,this.m_nROJTF=0,this.m_pHorizontalVolno=null,this.m_bVsetkoNaJednuPoziciu=!1,this.m_bSpojNaViacHodinovku=!1,this.m_bIgnoreFilters=!1,this.m_nVerticalHodinyOd=this.m_pRok.m_nHodinyOd,this.m_nVerticalHodinyDo=this.m_pRok.m_nHodinyDo,this.m_nDay=-1,this.m_nWeek=-1,this.m_nTerm=-1,this.m_Cells.length=0,this.m_Policka.length=0},n.prototype.Compute=function(){this.m_nXCount=this.m_nVerticalHodinyDo-this.m_nVerticalHodinyOd+1,this.m_bVsetkoNaJednuPoziciu&&(this.m_nXCount=1),0<this.m_Policka.length&&ASC.assert(this.m_nXCount==this.m_Policka.length);var t=this.m_SuggestedKarty;t=t||this.m_pHorizontalRokObject.GetKartyTu(this.m_nROJTF);for(var e=[0,0],i=0;i<t.length;i++){var n=t[i];if(this.HorizontalCheck(n)&&this.OtherCheck(n)&&this.VerticalCheck(n,e)){var s=e[0],r=e[1];(u=this.NewCell()).x1=s,u.x2=r,u.m_pKarta=n,u.m_nFaza=0}}if(this.m_bSpojNaViacHodinovku){this.m_Cells.sort(function(t,e){return t.x1-e.x1});for(var o=0;o<this.m_Cells.length;o++)for(var a=this.m_Cells[o],l=o+1;l<this.m_Cells.length;l++)a.SpojNaViacHodinovku(this.m_Cells[l])&&(this.m_Cells.splice(l,1),l--)}for(this.m_nMaxFaz=1,this.m_nXFaz.length=0,this.m_nXCyklovaniePo.length=0,O=this.m_bXJeSeminar.length=0;O<this.m_nXCount;O++)this.m_nXFaz[O]=1,this.m_nXCyklovaniePo[O]=0,this.m_bXJeSeminar[O]=!1;if(!this.m_bVsetkoNaJednuPoziciu){var c=!1,d=!1;switch(this.m_pHorizontalRokObject.m_Table){case"classes":c=!0;break;case"globals":d=!0}var m=0;for(this.m_nDay<0&&(m|=1),this.m_nWeek<0&&(m|=2),this.m_nTerm<0&&(m|=4),O=0;O<this.m_Cells.length;O++){var u=this.m_Cells[O];this.m_nXCyklovaniePo[u.x1]|=u.CyklovaniePo()&m,u.JeSeminar()&&(this.m_bXJeSeminar[u.x1]=!0)}var p=[];for(O=0;O<this.m_nXCount;O++)p[O]=!1;for(O=0;O<this.m_Cells.length;O++)for(var h=(u=this.m_Cells[O]).x1;h<u.x2;h++)p[h]=!0;for(O=0;O<this.m_nXCount-1;O++)p[O]&&(this.m_nXCyklovaniePo[O+1]|=this.m_nXCyklovaniePo[O],c&&this.m_bXJeSeminar[O]&&(this.m_bXJeSeminar[O+1]=!0));for(O=this.m_nXCount-2;0<=O;O--)p[O]&&(this.m_nXCyklovaniePo[O]|=this.m_nXCyklovaniePo[O+1],c&&this.m_bXJeSeminar[O+1]&&(this.m_bXJeSeminar[O]=!0));for(this.m_nMaxFaz=1,O=0;O<this.m_nXCount;O++)d||c&&this.m_bXJeSeminar[O]?(this.m_nXFaz[O]=1,this.m_nXCyklovaniePo[O]=0):this.m_nXFaz[O]=this.FazyFaz(this.m_nXCyklovaniePo[O]),this.m_nMaxFaz=Math.max(this.m_nMaxFaz,this.m_nXFaz[O]);var _=this.m_Cells.length;for(O=0;O<_;O++){u=this.m_Cells[O];var f=this.m_nXCyklovaniePo[u.x1];if(0!=f){var v=0;4&f&&(v=this.m_pRok.m_nTermov-1);var b=0;2&f&&(b=this.m_pRok.m_nTyzdnov-1);var g=0;1&f&&(g=this.m_pRok.m_nDni-1);for(var y=!1,k=0,C=0;C<=v;C++)for(var S=0;S<=b;S++)for(var T=0;T<=g;T++){var w=!0;0==v||u.m_pKarta.JeTu_TWDH(C)||(w=!1),0==b||u.m_pKarta.JeTu_TWDH(-1,S)||(w=!1),0==g||u.m_pKarta.JeTu_TWDH(-1,-1,T)||(w=!1),w&&(y?this.SplitCell(u).m_nFaza=k:(u.m_nFaza=k,y=!0)),k++}}}}var A=this.m_pHorizontalRokObject&&"classes"==this.m_pHorizontalRokObject.m_Table,R=[],I=[],D=[];for(k=0;k<this.m_nMaxFaz;k++){for(var O=0;O<this.m_nXCount;O++)R[O]=A;if(A){var x=[],P=[];for(O=0;O<this.m_nXCount;O++)x[O]=-1,P[O]=0;for(O=0;O<this.m_Cells.length;O++)if((u=this.m_Cells[O]).m_nFaza==k)for(h=u.x1;h<=u.x2;h++)if(R[h]){var E=u.m_pKarta.GetDelenieSkupin(this.m_pHorizontalRokObject);if(E<0){R[h]=!1;break}if(30<E){R[h]=!1;break}if(x[h]!=E){if(0<=x[h]){R[h]=!1;break}x[h]=E}var z=u.m_pKarta.GetDelenieSkupinyBity(this.m_pHorizontalRokObject);if(0!=(P[h]&z)){R[h]=!1;break}P[h]|=z}for(p=[],O=0;O<this.m_nXCount;O++)p[O]=!1;for(O=0;O<this.m_Cells.length;O++)if((u=this.m_Cells[O]).m_nFaza==k)for(h=u.x1;h<u.x2;h++)p[h]=!0;var G=0,j=!1;for(O=0;O<this.m_nXCount;O++)if(0==R[O]&&(j=!0),!p[O]){if(j)for(var M=G;M<=O;M++)R[M]=!1;j=!1,G=O+1}for(_=this.m_Cells.length,O=0;O<_;O++)if((u=this.m_Cells[O]).m_nFaza==k&&R[u.x1]){var V=u.m_pKarta.GetDelenieSkupin(this.m_pHorizontalRokObject);if(V<1)ASC.assert(!1);else for(var U=u.m_pKarta.GetDelenieSkupinyBity(this.m_pHorizontalRokObject),H=(y=!1,null),N=0;N<V;N++)0!=(U&1<<N)?(H||(y?H=this.SplitCell(u):(H=u,y=!0),H.y1=N/V),H.y2=(N+1)/V):H=null}}for(O=0;O<this.m_nXCount;O++)I[O]=0,D[O]=!1;for(O=0;O<this.m_Cells.length;O++)if((u=this.m_Cells[O]).m_nFaza==k&&!R[u.x1]){var K=0;for(h=u.x1;h<=u.x2;h++)K=Math.max(K,I[h]);for(u.m_nTempOrder=K,h=u.x1;h<=u.x2;h++)I[h]=K+1,h<u.x2&&(D[h]=!0)}var $=G=0;for(h=0;h<this.m_nXCount;h++)if($=Math.max($,I[h]),!D[h]){for(r=G;r<=h;r++)I[r]=$;G=h+1,$=0}for(O=0;O<this.m_Cells.length;O++)if((u=this.m_Cells[O]).m_nFaza==k){if(!R[u.x1]){var F=I[u.x1];K=u.m_nTempOrder,u.y1=K/F,u.y2=(K+1)/F}var L=this.m_nXFaz[u.x1];1<L&&(u.y1=(u.y1+u.m_nFaza)/L,u.y2=(u.y2+u.m_nFaza)/L)}}},n.prototype.HorizontalCheck=function(t){return!!this.m_bIgnoreFilters||this.m_pHorizontalRokObject.KartaJeTu(t,this.m_nROJTF)},n.prototype.OtherCheck=function(t){return!!this.m_bIgnoreFilters||!!t.JeTu_TWDH(this.m_nTerm,this.m_nWeek,this.m_nDay)},n.prototype.VerticalCheck=function(t,e){if(this.m_bIgnoreFilters&&this.m_bVsetkoNaJednuPoziciu)return s=r=0,!0;if(!t.JeUmiestnena())return!1;var i=t.GetHodina(),n=i+t.GetDlzka(),s=i-this.m_nVerticalHodinyOd,r=n-this.m_nVerticalHodinyOd;return s=Math.max(s,0),!((r=Math.min(r,this.m_nXCount-1))<s||(e[0]=s,e[1]=r,0))},n.prototype.NewCell=function(){var t=new s(this);return this.m_Cells.push(t),t},n.prototype.SplitCell=function(t){var e=this.NewCell();return e.Set(t),e},n.prototype.FazyFaz=function(t){var e=1;return 1&t&&(e*=this.m_pRok.m_nDni),2&t&&(e*=this.m_pRok.m_nTyzdnov),4&t&&(e*=this.m_pRok.m_nTermov),e},n.prototype.GetVolno=function(t,e){if(!this.m_pHorizontalVolno)return"";var i=this.m_nTerm,n=this.m_nWeek,s=this.m_nDay;return this.m_pHorizontalVolno.GetTWDH(i,n,s,this.m_nVerticalHodinyOd+e)},n.prototype.GetPeriodX=function(t){return this.m_pRok.GetPeriod(this.m_nVerticalHodinyOd+t)},n);function n(t){this.m_pHorizontalRokObject=null,this.m_nROJTF=0,this.m_pHorizontalVolno=null,this.m_nDay=-1,this.m_nWeek=-1,this.m_nTerm=-1,this.m_nVerticalHodinyOd=0,this.m_nVerticalHodinyDo=5,this.m_SuggestedKarty=null,this.m_bVsetkoNaJednuPoziciu=!1,this.m_bSpojNaViacHodinovku=!1,this.m_bIgnoreFilters=!1,this.m_Cells=[],this.m_nXCount=5,this.m_Policka=[],this.m_nXFaz=[],this.m_nXCyklovaniePo=[],this.m_bXJeSeminar=[],this.m_pRok=t}t.CTTRowRenderer=i;var s=(o.prototype.Set=function(t){this.m_pKarta=t.m_pKarta,this.m_MHodina=t.m_MHodina,this.x1=t.x1,this.x2=t.x2,this.y1=t.y1,this.y2=t.y2,this.m_nTempOrder=t.m_nTempOrder,this.m_nFaza=t.m_nFaza},o.prototype.CyklovaniePo=function(){return this.m_pKarta?this.m_pKarta.CyklovaniePo():0},o.prototype.JeSeminar=function(){return!!this.m_pKarta&&this.m_pKarta.m_pHodina.JeSeminar()},o.prototype.SpojNaViacHodinovku=function(t){if(t.x2+1!=this.x1&&this.x2+1!=t.x1)return!1;if(!this.m_pKarta)return!1;var e=this.m_pKarta,i=t.m_pKarta,n=e.m_pHodina,s=i.m_pHodina;if(n!=s){if(n.m_pPredmet!=s.m_pPredmet)return!1;if(!r.CUtils.RovnakyList(n.m_Ucitelia,s.m_Ucitelia))return!1;if(!r.CUtils.RovnakyList(n.m_Triedy,s.m_Triedy))return!1;if(!r.CUtils.RovnakyList(n.m_Skupiny,s.m_Skupiny))return!1;if(!r.CUtils.RovnakyList(n.m_KurzyPreTriedy,s.m_KurzyPreTriedy))return!1;if(n.m_nPoradieSeminaru!=s.m_nPoradieSeminaru)return!1;if(n.GetTerm()!=s.GetTerm())return!1}return!!r.CUtils.RovnakyList(e.Ucebne(),i.Ucebne())&&e.days()==i.days()&&e.weeks()==i.weeks()&&(this.x1=Math.min(this.x1,t.x1),this.x2=Math.max(this.x2,t.x2),!0)},o);function o(t){this.x1=0,this.x2=0,this.y1=0,this.y2=1,this.m_nTempOrder=0,this.m_nFaza=0,this.m_pKarta=null,this.m_MHodina=null,this.m_pTTRowRenderer=t}t.CTTRowCell=s}),ASC.setModuleSourceFunc("/timetable/app/print.js",function(t,require,e){t.__esModule=!0;var ft,i,R=require("tslib"),vt=require("./rokobject"),p=require("./online"),bt=require("./ttrowrenderer"),gt=require("./tview"),u=require("../../asc/edurequest"),yt=(s.prototype.width=function(){return this.x2-this.x1},s.prototype.height=function(){return this.y2-this.y1},s.prototype.pad=function(t,e){void 0===e&&(e=t);var i=this.width()*t,n=this.height()*e;return new s(this.x1+i,this.y1+n,this.x2-i,this.y2-n)},s);function s(t,e,i,n){this.x1=t,this.y1=e,this.x2=i,this.y2=n}(i=ft=ft||{})[i.TLACDEF_STRED_HODINA=0]="TLACDEF_STRED_HODINA",i[i.TLACDEF_STRED_POCET=1]="TLACDEF_STRED_POCET",i[i.TLACDEF_STRED_POCETHODIN=2]="TLACDEF_STRED_POCETHODIN",i[i.TLACDEF_STRED_ZOZNAMHODIN_PODLATRIEDY=3]="TLACDEF_STRED_ZOZNAMHODIN_PODLATRIEDY";var n,r=(n=vt.CRokObject,R.__extends(o,n),o.prototype.InitFromData=function(){this.m_PageTables=this.m_Data.page_tables,this.m_RowTables=this.m_Data.row_tables,this.m_ColumnTables=this.m_Data.column_tables,this.m_nTypStredu=this.m_Data.celltype,this.m_PrintKartaStyles=this.m_Data.cardstyles},o.prototype.GetIcon=function(){return this.m_Data.icon},o.prototype.Render=function(t){var e=this.m_Data,i=[],n=t.filter,s=n;t.m_bTTViewer&&(s=this.m_pRok.m_pRozApp.ttviewer_options.filter);var r=this.Roznasob(this.m_pRok,this.m_PageTables,s,{withclassroomtt:e.withclassroomtt}),o=this.Roznasob(this.m_pRok,this.m_RowTables,n),a=this.Roznasob(this.m_pRok,this.m_ColumnTables,n),l={6:"teachers_summary",5:"classes_summary",7:"classrooms_summary"}[e.typ];l&&l in s&&(s[l].length||(r=[]));for(var c=0,d=r;c<d.length;c++){var m=d[c],u=new P(this,m,this.PurgeSliziky(m,o,ASC.boolVal(e.hideemptyrows)),this.PurgeSliziky(m,a,ASC.boolVal(e.hideemptycolumns)));i.push(u)}if(1<this.m_Data.repeatpage){var p=i;i=[];for(var h=0,_=p;h<_.length;h++){u=_[h];for(var f=0;f<this.m_Data.repeatpage;f++)i.push(u)}}if(!this.m_Data.fitwidth){for(var v=Math.max(1,Math.floor(1/e.cellwidth)),b=[],g=0,y=i;g<y.length;g++)if((w=y[g])instanceof O)for(u=w,f=0;f<u.m_Columns.length;f+=v){var k=new P(this,u.m_Page,u.m_Rows,u.m_Columns.slice(f,f+v));b.push(k)}i=b}if(!this.m_Data.fitheight){for(var C=Math.max(1,Math.floor(1/e.cellheight)),S=(b=[],0),T=i;S<T.length;S++){var w;if((w=T[S])instanceof O)for(u=w,f=0;f<u.m_Rows.length;f+=C)k=new P(this,u.m_Page,u.m_Rows.slice(f,f+C),u.m_Columns),b.push(k)}i=b}var A=this.Dimensions(!0);if(1<A.splitpage_w||1<A.splitpage_h){p=i,i=[];for(var R=null,I=0,D=p;I<D.length;I++)u=D[I],null==R&&(R=new x(this),i.push(R)),R.subpages.push(u),R.subpages.length>=A.splitpage_w*A.splitpage_h&&(R=null)}return i},o.prototype.PurgeSliziky=function(t,e,i){for(var n=null,s=Ct(t),r=0,o=t;r<o.length;r++)(k=o[r])instanceof vt.CTrieda&&(n=k),k instanceof vt.CZiak&&(n=k.m_pTrieda);var a=this.m_pRok.m_ObjectsO.cards;i&&s&&(a=s.GetKartyTu(0));for(var l=[],c=0,d=e;c<d.length;c++){for(var m=d[c],u=!1,p=0,h=m;p<h.length;p++)(k=h[p])instanceof vt.CPeriodOrBreak&&n&&!k.JeValidPreTriedu(n)&&(u=!0);if(i&&!u){u=!0;for(var _=0,f=a;_<f.length;_++){var v=f[_];if(v.JeUmiestnena()){for(var b=!0,g=0,y=m;g<y.length;g++){var k;if(!(k=y[g]).KartaJeTu(v,0)){b=!1;break}}if(b){u=!1;break}}}}u||l.push(m)}return l},o.prototype.Dimensions=function(t){var e=6*kt,i=5*kt,n={page_width:297*kt,page_height:210*kt,pad_w:e,pad_h:e,tt_basex:e,tt_basey:25*kt,tt_space_bottom:15*kt,tt_width:0,tt_height:0,splitpage_w:t?this.m_Data.splitpage_w:1,splitpage_h:t?this.m_Data.splitpage_h:1};if(!this.m_Data.landscape){var s=n.page_width;n.page_width=n.page_height,n.page_height=s}(1<n.splitpage_w||1<n.splitpage_h)&&(n.tt_basex-=n.pad_w,n.page_width-=2*n.pad_w,n.pad_w=0,n.tt_basey-=n.pad_h,n.tt_space_bottom-=n.pad_h,n.page_height-=2*n.pad_h,n.pad_h=0);var r=0;1<n.splitpage_w&&(n.page_width=(n.page_width+i)/n.splitpage_w,n.tt_basex/=n.splitpage_w,r=i);var o=0;return 1<n.splitpage_h&&(n.page_height=(n.page_height+i)/n.splitpage_h,n.tt_basey/=n.splitpage_h,n.tt_space_bottom/=n.splitpage_h,o=i),n.tt_width=n.page_width-2*n.tt_basex-r,n.tt_height=n.page_height-n.tt_basey-n.tt_space_bottom-o,n},o.prototype.IsSuhrn=function(){for(var t=0,e=["teachers","classes","classrooms","subjects","students"];t<e.length;t++){var i=e[t];if(0<=this.m_RowTables.indexOf(i))return!0;if(0<=this.m_ColumnTables.indexOf(i))return!0}return!1},o.prototype.Roznasob=function(t,e,i,n){void 0===n&&(n={});for(var s=[[]],r=0,o=e;r<o.length;r++){var a=o[r],l=s;s=[];for(var c=0,d=l;c<d.length;c++){var m=d[c],u=t.TableObjects(a);if("periods"==a){for(var p=[],h=0,_=u;h<_.length;h++){var f=_[h],v=t.m_ObjectsI.breaks[f.m_Id];v&&p.push(v),p.push(f)}u=[];for(var b=0,g=p;b<g.length;b++){var y=g[b];this.TlacPeriodu(y)&&u.push(y)}}for(var k=0,C=u;k<C.length;k++){var S=C[k];if(!(i[a]&&ASC.indexOf2(i[a],S.m_Id)<0)){var T=m.slice();if(T.push(S),s.push(T),"classes"==a&&n.withclassroomtt){var w=S.GetUcebna();if(w){var A=R.__spreadArrays(T);A.pop(),A.push(w),s.push(A)}}}}}}return s},o.prototype.TlacPeriodu=function(t){var e=t.m_Data;return this.IsSuhrn()?ASC.boolVal(e.printinsummary):0<=this.m_PageTables.indexOf("teachers")?ASC.boolVal(e.printinteacher):0<=this.m_PageTables.indexOf("classes")||0<=this.m_PageTables.indexOf("students")?ASC.boolVal(e.printinclass):!(0<=this.m_PageTables.indexOf("classrooms"))||ASC.boolVal(e.printinclassroom)},o.prototype.GetPrintKartaStyle=function(t,e,i){for(var n=0,s=this.m_PrintKartaStyles;n<s.length;n++)if((a=s[n]).m_nDlzka==t&&a.m_nPocetRiadkov==e&&a.m_nBezTriedyAleboUcitela==i)return a;for(var r=0,o=this.m_PrintKartaStyles;r<o.length;r++){var a;if((a=o[r]).m_nDlzka==t&&0==a.m_nPocetRiadkov&&a.m_nBezTriedyAleboUcitela==i)return a}return this.m_PrintKartaStyles[0]},o.prototype.UpdateSetting=function(t,e){this.m_pRok.m_pRozApp.click_func("print_setting","tzid="+this.m_Id+"&s="+t+"&v="+e)},o);function o(t,e){var i=n.call(this,t,"ttreports",e)||this;return i.m_PageTables=[],i.m_RowTables=[],i.m_ColumnTables=[],i.m_nTypStredu=0,i.m_PrintKartaStyles=[],i.m_bTTViewerDisableCardColor=!1,i.InitFromData(),i}t.CTlacZostava=r;var kt=10,w=0<=["il","rb"].indexOf(ASC.lang),a=(l.prototype.SetScale=function(t,e){var i=this.m_Scale;this.m_Scale=t;var n=this.m_Pages[this.m_nPage];if(n&&(n.UpdateSheetScale(this.m_Scale),e)){var s=e.offsetX/i,r=e.offsetY/i,o=n.$svg.offset().left+s*t,a=n.$svg.offset().top+r*t,l=this.$sheet.parent();l[0].scrollLeft+=o-e.pageX,l[0].scrollTop+=a-e.pageY}},l.prototype.Zoom=function(t,e){var i=this.m_Scales[0];if(e)i=this.m_Scale*e,i=Math.max(i,this.m_Scales[0]),i=Math.min(i,this.m_Scales[this.m_Scales.length-1]);else for(var n=1;n<this.m_Scales.length;n++){var s=this.m_Scales[n];if(s>=1.05*this.m_Scale){i=s;break}}this.SetScale(i,t)},l.prototype.ZoomFit=function(){this.ZoomFit0(),this.m_Scales=ASC.clone(l.default_scales),this.m_Scales.push(this.m_Scale),this.m_Scales.sort(function(t,e){return t-e})},l.prototype.ZoomFit0=function(){var t=this.m_Pages[0];if(t){var e=(this.$div.innerHeight()-13)/t.height;e=Math.min(e,(this.$div.innerWidth()-13)/t.width),e*=kt,10<(e=Math.max(e,1.5))||this.SetScale(e)}},l.prototype.Render=function(){if(this.m_Pages=this.m_pTlacZostava.Render(this),0==this.m_Pages.length){var t=new m(this.m_pTlacZostava);this.m_Pages.push(t)}},l.prototype.IsNoPage=function(){return 0==this.m_Pages.length||this.m_Pages[0]instanceof m},l.prototype.Update=function(){this.Render(),this.m_nPage>=this.m_Pages.length&&(this.m_nPage=0),this.UpdatePage()},l.prototype.UpdatePage=function(){var t=this.m_Pages[this.m_nPage];this.$sheet.empty(),this.UpdateRibbon(),t.RenderSheet(this.$sheet,this.m_Scale,!this.m_bTTViewer)},l.prototype.UpdateRibbon=function(){var h=this;this.$pagenum_d.text(ASC.ttls(1750)+" "+(this.m_nPage+1)+"/"+this.m_Pages.length);var o=this.m_pRozApp,_=this.m_pRok;if(o.ribbonMenu.findButtonsByCmd("printpreview_prev").forEach(function(t){t.enabled(0<h.m_nPage)}),o.ribbonMenu.findButtonsByCmd("printpreview_next").forEach(function(t){t.enabled(h.m_nPage+1<h.m_Pages.length)}),this.m_bTTViewer){for(var f=o.ttviewer_options.filter,v=this.TTViewer_CurrentObject(),t=function(p){o.ribbonMenu.findButtonsByCmd("ttviewer_"+p).forEach(function(t){var e=[];if("students"==p){for(var i={},n=function(t){if(ASC.indexOf2(f[p],t.m_Id)<0)return"continue";var e=t.m_pTrieda.m_Id;i[e]||(i[e]=[]),i[e].push({text:ASC.escapeHTML(t.GetNazov()),checked:t==v,onclick:function(){h.TTViewer_SetCurrentObject(t)}})},s=0,r=_.TableObjects(p);s<r.length;s++)n(r[s]);for(var o=0,a=_.TableObjects("classes");o<a.length;o++){var l=a[o],c=l.m_Id;i[c]&&e.push({text:ASC.escapeHTML(l.GetNazov()),submenu:i[c]})}}else for(var d=function(t){if(ASC.indexOf2(f[p],t.m_Id)<0)return"continue";e.push({text:ASC.escapeHTML(t.GetNazov()),checked:t==v,onclick:function(){h.TTViewer_SetCurrentObject(t)}})},m=0,u=_.TableObjects(p);m<u.length;m++)d(u[m]);t.enabled(0<e.length),t.selected(v&&v.m_Table==p),t.menu=e})},e=0,i=["subjects","classes","teachers","classrooms","students"];e<i.length;e++)t(i[e]);o.ribbonMenu.findButtonsByCmd("ttviewer_summary").forEach(function(t){for(var n=[],s=!1,e=function(t){var e=t.t+"_summary";if(0==f[e].length)return"continue";var i=h.m_pTlacZostava.m_Data.typ==t.pt;s=s||i,n.push({text:ASC.escapeHTML(t.l),checked:i,onclick:function(){h.TTViewer_SetTable(e)}})},i=0,r=[{t:"teachers",l:ASC.ls(1656),pt:6},{t:"classes",l:ASC.ls(1657),pt:5},{t:"classrooms",l:ASC.ls(1658),pt:7}];i<r.length;i++)e(r[i]);n.length&&!o.ttviewer_options.kiosk&&(0<n.length&&n.push([]),n.push({text:ASC.ls(2838),onclick:function(){var t="/timetable/view.php";document.location.href.indexOf("fullscreen=1")<0&&(t+="?fullscreen=1"),document.location.href=t}})),t.enabled(0<n.length),t.selected(s),t.menu=n})}},l.prototype.TTViewer_Select=function(t){if(!t)return!1;var e=t.split(":");return this.TTViewer_Sel(e[0],e[1])},l.prototype.TTViewer_Sel=function(t,e){var i=this.m_pRok;if(i.m_ObjectsI[t]){var n=i.m_ObjectsI[t][e];if(n)return this.TTViewer_SetCurrentObject(n),!0}return this.TTViewer_SetTable(t)},l.prototype.TTViewer_AutoSelect=function(){for(var t=0,e=["classes","classes_summary","teachers","teachers_summary","subjects"];t<e.length;t++){var i=e[t];if(this.TTViewer_SetTable(i),!this.IsNoPage())break}},l.prototype.TTViewer_SetTable=function(t){var e={teachers_summary:6,classes_summary:5,classrooms_summary:7}[t];if(e){for(var i=0,n=this.m_pRok.TableObjects("ttreports");i<n.length;i++)if((o=n[i]).m_Data.typ==e)return this.SetZostava(o),!0;return!1}if(0<=this.m_pTlacZostava.m_PageTables.indexOf(t))return 0==this.m_Pages.length&&this.Update(),!0;for(var s=0,r=this.m_pRok.TableObjects("ttreports");s<r.length;s++){var o;if(0<=(o=r[s]).m_PageTables.indexOf(t))return this.SetZostava(o),!0}return!1},l.prototype.TTViewer_SetCurrentObject=function(t){if(t&&this.TTViewer_SetTable(t.m_Table))for(var e=0;e<this.m_Pages.length;e++){var i=this.m_Pages[e];if(!(i instanceof P))return;if(0<=i.m_Page.indexOf(t)){this.m_nPage=e,this.UpdatePage();break}}},l.prototype.TTViewer_CurrentObject=function(){var t=this.m_Pages[this.m_nPage];if(!t)return null;if(t instanceof P){for(var e=0,i=t.m_Page;e<i.length;e++){var n=i[e];if(0<=["subjects","classes","teachers","classrooms","students"].indexOf(n.m_Table))return n}return null}},l.prototype.TTViewer_GetSelected=function(){var t=this.TTViewer_CurrentObject();return t?t.m_Table+":"+t.m_Id:null},l.prototype.PrevPage=function(){this.m_nPage<=0||(this.m_nPage--,this.UpdatePage())},l.prototype.NextPage=function(){this.m_nPage+1>=this.m_Pages.length||(this.m_nPage++,this.UpdatePage())},l.prototype.SetZostava=function(t){if(ASC.isString(t)){var e=t;t=(t=this.m_pRok.m_ObjectsI.ttreports[e])||this.m_pRok.FindTableTlacZostava(e)}this.m_pTlacZostava!=t&&(t||this.m_pRozApp.Fail("Error 6995307472"),this.m_pTlacZostava=t,this.m_pZostavaCombo.ASC_set(this.m_pTlacZostava.m_Id),this.m_nPage=0,this.Update())},l.prototype.Print=function(t){void 0===t&&(t={}),g(t.selected_page?[this.m_Pages[this.m_nPage]]:this.m_Pages)},l.prototype.ClickFilter=function(){this.m_pRozApp.click_func("print_filter","filter="+encodeURIComponent(JSON.stringify(this.filter)))},l.prototype.SetFilter=function(t){JSON.stringify(t)!=JSON.stringify(this.filter)&&(this.filter=t,this.Update())},l.prototype.SettingsChanged=function(){var t=this;this.m_pRozApp.SyncNow().then(function(){t.Update()})},l.prototype.Validate=function(){this.m_bInvalid&&(this.m_bInvalid=!1,this.Update())},l.prototype.Destroy=function(){},l.default_scales=[2,3,4,6,10],l);function l(t,e){var m=this;void 0===e&&(e={}),this.m_pTlacZostava=null,this.m_pZostavaCombo=null,this.m_Pages=[],this.m_nPage=0,this.m_Scale=4,this.m_Scales=ASC.clone(l.default_scales),this.filter={},this.m_bInvalid=!1,this.m_bTTViewer=!1,this.m_pRozApp=t,this.m_pRok=t.m_pRok,this.m_pRozApp.m_pPrintPreview=this,e.ttviewer&&(this.m_bTTViewer=!0);var i=t.$rg_printpreview_div;i.css("margin-top","4px"),i.empty();for(var n=[],s=0,r=($j("<div style='margin-bottom:4px'>").appendTo(i).text(ASC.ttls(3341)).get(0).ASC_printpreview=this).m_pRok.m_ObjectsO.ttreports;s<r.length;s++){var o=r[s];this.m_pTlacZostava||(this.m_pTlacZostava=o),n.push({value:o.m_Id,name:o.GetNazov(),icon:o.GetIcon(),html:"<img src='"+o.GetIcon()+"' style='height:24px;vertical-align:middle;padding-right:10px'>"+ASC.escapeHTML(o.GetNazov())})}this.m_pZostavaCombo=new ASC.ui.ComboBox(i,this.m_pTlacZostava.m_Id,n,{style:"width:100%",fn:function(t){m.SetZostava(t)}}),this.$pagenum_d=$j("<div style='margin-top:4px'>").appendTo(i),this.$div=t.$printpreview_d,this.$div.empty(),this.$sheet=$j("<div class='print-sheet' style='cursor:zoom-in'>").appendTo(this.$div),this.$sheet.on("mousedown",function(t){0==t.button&&(t.shiftKey?m.ZoomFit():m.Zoom(t),t.preventDefault(),ASC.hideContextMenu())}),this.$sheet.on("contextmenu",function(t){var e=[];e.push({text:ASC.ttls(2551)+": "+ASC.ttls(2829),onclick:function(){m.ZoomFit()}});var i=m.m_pTlacZostava;i.m_Data.cardcolorenabled&&(e.push([]),e.push({text:ASC.ttls(1438),checked:!i.m_bTTViewerDisableCardColor,onclick:function(){i.m_bTTViewerDisableCardColor=!i.m_bTTViewerDisableCardColor,m.Update()}})),m.m_bTTViewer&&(e.push([]),e.push({text:ASC.ls(1248),onclick:function(){var t="https://"+ASC.edupage+".edupage.org/timetable/view.php",e=[],i=""+m.m_pRozApp.ttviewer_options.num;i&&(""+parseInt(i)==i?e.push("num="+m.m_pRozApp.ttviewer_options.num):"week:"==i.substr(0,5)&&i!="week:"+u.client_req.lib_date.date_week(u.client_req.lib_date.timezone_date())&&e.push("week="+i.substr(5)));var n=m.m_Pages[m.m_nPage];if(n instanceof P){for(var s="",r=0,o=n.m_Page;r<o.length;r++){var a=o[r];if(0<=["classes","teachers","classrooms","subjects","students"].indexOf(a.m_Table)){s=ASC.tt.removeEs(a.m_Table)+"="+a.m_Id;break}}if(!s)for(var l=0,c=m.m_pTlacZostava.m_RowTables;l<c.length;l++){var d=c[l];if(0<=["classes","teachers","classrooms"].indexOf(d)){s="summary="+d;break}}s&&e.push(s)}prompt(ASC.ls(1248)+":",t+"?"+e.join("&"))}})),ASC.showContextMenu(e,t),t.preventDefault()}),this.m_bTTViewer&&ASC.edupage;if(this.$sheet.on("mousedown mouseup",function(t){t.preventDefault()}),this.m_bTTViewer){var a=null;t.ttviewer_options.browser_jsc&&(t.ttviewer_options.browser_jsc.app&&(a=t.ttviewer_options.browser_jsc.app.m_pPrintPreview.TTViewer_GetSelected()),t.ttviewer_options.browser_jsc.app=t),!a&&t.ttviewer_options.select&&(a=t.ttviewer_options.select),a&&this.TTViewer_Select(a),this.IsNoPage()&&this.TTViewer_AutoSelect()}this.IsNoPage()&&this.Render(),"interactive"==document.readyState?$j(window).load(function(){m.ZoomFit0(),m.Update()}):(this.ZoomFit0(),this.Update())}function q(t,e){return void 0===e&&(e=null),$j(function(t,e){void 0===e&&(e=null);e=e||document;return e.createElementNS("http://www.w3.org/2000/svg",t)}(t,e))}function A(t){return t.get(0).getBBox()}t.CPrintPreview=a;var I=1,O=(c.prototype.RenderSheet=function(t,e,i){this.$sheet=t,this.preview=i,t.css({minHeight:"0px",padding:"0px"}),this.page_document=t[0].ownerDocument,this.$svg=$j("<svg style='position:absolute;left:0px;top:0px;direction:ltr'>").attr("xmlns:xlink","http://www.w3.org/1999/xlink").attr("stroke","#000000").attr("stroke-width","0").attr("fill","#000000").appendTo(t),this.$defs=q("defs",this.page_document).appendTo(this.$svg),this.$page=q("g",this.page_document).appendTo(this.$svg),this.UpdateSheetScale(e),this.Render()},c.prototype.UpdateSheetScale=function(t){if(this.$sheet){var e=t/kt,i=e*this.width,n=e*this.height;this.$sheet.css({width:i+"px",height:.995*n+"px",minHeight:"0px",padding:"0px"}),this.$svg.attr({width:i,height:n}),w?this.$page.attr({"transform-origin":"0 0",transform:"scale("+-e+","+e+") translate("+-this.width+")"}):this.$page.attr({transform:"scale("+e+")"})}},c.prototype.Render=function(){},c);function c(t){this.width=100,this.height=100,this.preview=!1,this.m_pTlacZostava=t,this.dimensions=t.Dimensions(this instanceof P),this.width=this.dimensions.page_width,this.height=this.dimensions.page_height}t.CPrintPage=O;var d,m=(d=O,R.__extends(h,d),h);function h(){return null!==d&&d.apply(this,arguments)||this}t.CDummyPage=m;var _,x=(_=O,R.__extends(f,_),f.prototype.Render=function(){for(var t=this.m_pTlacZostava.Dimensions(!1),e=this.m_pTlacZostava.Dimensions(!0),i=0,n=0,s=t.pad_w,r=t.pad_h,o=0,a=this.subpages;o<a.length;o++){var l=a[o];l.page_document=this.page_document;var c=q("g",this.page_document).appendTo(this.$page).attr("transform","translate("+s+","+r+")");l.$page=c,l.$defs=this.$defs,l.preview=this.preview,l.Render(),this.m_pTlacZostava.m_Data.splitpageorder?(n++,r+=l.height,n>=e.splitpage_h&&(n=0,r=t.pad_h,i++,s+=l.width)):(i++,s+=l.width,i>=e.splitpage_w&&(i=0,s=t.pad_w,n++,r+=l.height))}},f);function f(t){var e=_.call(this,t)||this;return e.subpages=[],e}function Ct(t){for(var e=0,i=t;e<i.length;e++){var n=i[e];switch(n.m_Table){case"classes":case"teachers":case"subjects":case"classrooms":case"students":return n}}return null}t.CPrintPageSplit=x,t.HorizontalRO=Ct;var v,P=(v=O,R.__extends(b,v),b.prototype.Render=function(){var n=this,t=this.dimensions,e=this.m_pTlacZostava_objekt.m_Data.userheader,i=this.m_pTlacZostava_objekt.m_Data.pageheader,s=t.pad_w,r=t.tt_basey,o=this.m_pTlacZostava.m_pRok.m_ObjectsI.globals[1].m_Data.settings.m_strPrintHeaderText;if(""!=o){var a=(r-s)/4;this.TextBox(new yt(t.tt_basex,s,t.tt_basex+t.tt_width,s+a),t.tt_height*e.size,o,0,1,e,e),s+=a/2}var l=this.m_pTlacZostava.m_Data.printlogo_url;l&&this.Image(new yt(t.tt_basex,t.pad_h,t.tt_basex+t.tt_width,t.tt_basey-2),l,-1,0).css("pointer-events","none");var c=t.tt_basex,d=s,m=t.tt_basex+t.tt_width,u=new yt(c,d,m,r);this.TextBox(u,t.tt_height*i.size,this.m_Title,0,0,i,i),this.preview&&this.Rect(u,"transparent",0).on("contextmenu",function(t){var e=n.m_pTlacZostava_objekt,i="tzid="+e.m_Id;e.m_pRok.m_pRozApp.click_func("print_ph",i),t.preventDefault(),t.stopPropagation()}),this.RenderTT()},b.prototype.RenderTT=function(){var F=this,L=this.m_pTTRowRenderer,B=this.m_pTlacZostava.m_pRok,Z=this.m_pTlacZostava.m_Data,m=Z.gridheadertexts,t=this.dimensions,e=t.tt_basex,i=t.tt_basey,n=t.tt_width,s=t.tt_height,r=0,o=0,a=null,u=this.m_Columns,J=this.m_Rows,l=this.m_pTlacZostava.m_ColumnTables,c=this.m_pTlacZostava.m_RowTables,d=u.length,p=J.length,h=n*Z.headerwidth,_=s*Z.headerheight,W=Z.cellwidth*(n-h),Y=Z.cellheight*(s-_);function f(t,e,i,n){var s=0,r=0;if(i&&i.pos)switch(i.pos){case 1:s=r=-1;break;case 2:r=-1,s=1;break;case 3:s=-(r=1);break;case 4:s=r=1;break;case 5:r=1,s=0;break;case 6:r=-1,s=0;break;case 7:r=0,s=-1;break;case 8:r=0,s=1}var o=i?i.size:0;return o=o||.4,F.TextBox(t.pad(.05),e*o,n,s,r,i,{shrink:!0})}function v(t,e,i,n,s,r){var o=i;m[o]||(o="objects");var a=m[o],l="";if(l=a&&a.column?n.GetNazov(a.column):"periods"==i?n.GetNazov():n.GetSkratka(),f(t,e,a,l),"periods"==i&&m.time&&m.time.enabled){var c=[];$j.merge(c,F.m_Page),0<=s&&$j.merge(c,u[s]),0<=r&&$j.merge(c,J[r]);var d=B.GetPeriodTime(c);0<=s&&(X[s]=d),0<=r&&(y[r]=d),i=B.FormatTimeFromTo(d.starttime,d.endtime),f(t,e,m.time,i)}F.preview&&F.Rect(t,"transparent",0).on("contextmenu",function(t){var e=F.m_pTlacZostava,i="tzid="+e.m_Id+"&ht="+o;e.m_pRok.m_pRozApp.click_func("print_ght",i),t.preventDefault(),t.stopPropagation()})}Z.fitwidth&&0<d&&(W=(n-h)/d),Z.fitheight&&0<p&&(Y=(s-_)/p);var b=e+h+d*W,g=i+_+p*Y,X=[],y=[];function k(t){for(var e=0,i=t;e<i.length;e++){var n=i[e];if(n instanceof vt.CBreak)return n}return null}var q=[],Q=[],C=m.days.size;for(C?(0<=l.indexOf("days")&&(C*=l.length),0<=c.indexOf("days")&&(C*=c.length)):C=.5,r=0;r<d;r++){var S=k(u[r]);if(S){var T=new yt(tt=e+h+r*W,et=i+_,it=e+h+(r+1)*W,nt=g);this.Rect(T,"#fff",0),S.m_Data.printtext&&this.TextBoxRotated(T,C*W,S.m_Data.printtext),q[r]=S}}for(r=0;r<p;r++){var tt,et,it,nt,w=k(J[r]);if(w)T=new yt(tt=e+h,et=i+_+r*Y,it=b,nt=i+_+(1+r)*Y),this.Rect(T,"#fff",0),w.m_Data.printtext&&this.TextBox(T,C*Y,w.m_Data.printtext),Q[r]=w}var A=function(t,e,i,n,s,r,o){for(var a=0;a<s;a++)if(!r[a]){for(var l=a+1;l<s&&!r[l];)l++;F.Line(t+a*i,e+a*n,t+l*i,e+l*n,o),a=l}},st=[];for(o=0;o<l.length;o++){et=i+o*_/l.length,nt=et+_/l.length,0<o&&this.HLine(e+h,et,d*W,.1);var R=null;for(r=0;r<d;r++)(a=u[r][o])!=R&&(tt=e+h+r*W,R&&(o+1<l.length&&(st[r]=!0),this.VLine(tt,et,nt-et,st[r]?.2:.1))),(d<=r+1||u[r+1][o]!=a)&&v(new yt(tt,et,it=e+h+(r+1)*W,nt),_,l[o],a,r,-1),R=a}for(r=1;r<d;r++)A(e+h+r*W,i+_,0,Y,p,Q,st[r]?.2:.1);var rt=[];for(o=0;o<c.length;o++)for(tt=e+o*h/c.length,it=tt+h/c.length,0<o&&this.VLine(tt,i+_,p*Y,.1),R=null,r=0;r<p;r++)(a=J[r][o])!=R&&(et=i+_+r*Y,R&&(o+1<c.length&&(rt[r]=!0),this.HLine(tt,et,it-tt,rt[r]?.2:.1))),(p<=r+1||J[r+1][o]!=a)&&v(new yt(tt,et,it,nt=i+_+(r+1)*Y),Y,c[o],a,-1,r),R=a;for(r=1;r<p;r++)A(e+h,i+_+r*Y,W,0,d,q,rt[r]?.2:.1);function ot(t){for(var e=0,i=t;e<i.length;e++)if(i[e]instanceof vt.CPeriod)return!0;return!1}function at(t,e){for(var i=0,n=e;i<n.length;i++){var s=n[i];switch(s.m_Table){case"termsdefs":t[0]=s.m_Val;break;case"weeksdefs":t[1]=s.m_Val;break;case"daysdefs":t[2]=s.m_Val;break;case"periods":case"breaks":t[3]=s.m_nHodina}}}function lt(t){for(var e=0,i=t;e<i.length;e++){var n=i[e];if(n instanceof vt.CUcitel)return n;if(n instanceof vt.CUcebna)return n}return null}function I(t,e,i){for(var n=e==J,s=n?1:0,r=1-s,o=n?rt:st,a=n?Q:q,l=!0,c=0,d=[0,0],m=[0,0],u=[d,m],p=0;p<e.length;p++){var h=e[p];if(ot(h)){l&&(F.TTR_Init(F.m_Page.concat(t,h)),l=!1,c=p);var _=p+1>=e.length;if(_||ot(e[p+1])||(_=!0),_||F.TTR_TryContinue(e[p+1])||(_=!0),_){L.Compute();var f=[];$j.merge(f,F.m_Page),$j.merge(f,t);for(var v=0,b=L.m_Cells;v<b.length;v++){var g=b[v],y=[];$j.merge(y,F.m_Page),$j.merge(y,t);var k=$j.merge([],y);$j.merge(y,e[c+g.x1]),$j.merge(k,e[c+g.x2]),d[s]=ct[s]+dt[s]+(c+g.x1)*mt[s],m[s]=d[s]+(g.x2-g.x1+1)*mt[s],d[r]=ct[r]+dt[r]+(i+g.y1)*mt[r],m[r]=ct[r]+dt[r]+(i+g.y2)*mt[r],tt=d[0],et=d[1],it=m[0],nt=m[1],F.RenderCell(new yt(tt,et,it,nt),W,Y,g,!1,y,k,X[c+g.x1],X[c+g.x2]);var C=void 0;C=F.Line(u[0][0],u[0][1],u[r][0],u[s][1],.1),0<g.y1&&C.attr("stroke-dasharray","0.7,0.7"),C=F.Line(u[s][0],u[r][1],u[1][0],u[1][1],.1),g.y2<1&&C.attr("stroke-dasharray","0.7,0.7"),C=F.Line(u[0][0],u[0][1],u[s][0],u[r][1],o[c+g.x1]?.2:.1),C=F.Line(u[r][0],u[s][1],u[1][0],u[1][1],o[c+g.x1+1]?.2:.1)}l=!0}}}var S=B.GlobalData().settings;if(F.m_pTlacZostava.IsSuhrn()?S.m_bPrintDozoryVSuhrnnych:S.m_bPrintDozory){var T=[-1,-1,-1,-1];at(T,F.m_Page),at(T,t);var w=lt(F.m_Page)||lt(t);for(p=0;p<e.length;p++){var A=e[p];at(T,A);var R=lt(A);if(R&&(w=R),w)for(var I=0,D=[!0,!1];I<D.length;I++){var O=D[I],x=null;if(a[p]){if(O)continue;x=B.GetDozoryTWDH(w,T[0],T[1],T[2],T[3],!0)}else{if(O){var P=a[p-1];if(P&&P.m_nHodina==T[3])continue}x=B.GetDozoryTWDH(w,T[0],T[1],T[2],T[3],O)}if(x&&x.length){O?(d[s]=ct[s]+dt[s]+Math.max(0,p-.1)*mt[s],m[s]=ct[s]+dt[s]+(p+.1)*mt[s]):(d[s]=ct[s]+dt[s]+(p+.3)*mt[s],m[s]=ct[s]+dt[s]+(p+.7)*mt[s]);for(var E=x.length,z=0;z<E;z++){var G=x[z];d[r]=ct[r]+dt[r]+(i+.2+.6*z/E)*mt[r],m[r]=ct[r]+dt[r]+(i+.2+.6*(z+1)/E)*mt[r];var j="",M="",V=null;w instanceof vt.CUcebna?G.m_pUcitel&&(V=G.m_pUcitel):V=G.m_pUcebna,V&&(j=V.GetSkratka(),M=V.GetNazov());var U=new yt(d[0],d[1],m[0],m[1]),H=F.Rect(U,S.m_bPrintDozoryColor&&V&&!F.m_pTlacZostava.m_bTTViewerDisableCardColor?V.GetColor():"#fff",.1);""!=M&&F.Tootlip(H,M);var N=Z.classroomsupervisionstyle,K={shrink:!0},$=mt[s]*N.size;0==s?F.TextBoxRotated(U,$,j,0,0,N,K):F.TextBox(U,$,j,0,0,N,K),G.m_Data.substed&&F.SubstBox(U),F.preview&&H.on("contextmenu",function(t){B.m_pRozApp.click_func("print_ds","tzid="+F.m_pTlacZostava_objekt.m_Id),t.preventDefault(),t.stopPropagation()})}}}}}}var ct=[e,i],dt=[h,_],mt=[W,Y];if(this.m_pTlacZostava.m_nTypStredu==ft.TLACDEF_STRED_HODINA){if("periods"==l[l.length-1])for(o=0;o<p;o++)I(J[o],u,o);else if("periods"==c[c.length-1])for(o=0;o<d;o++)I(u[o],J,o)}else{var D=function(t,e){for(var i=0;i<e.length;i++)if(!e[i].KartaJeTu(t,0))return!1;return!0},O=[];$j.merge(O,B.TableObjects("cards"));var x=[];O.forEach(function(t){D(t,F.m_Page)&&x.push(t)});var P=Ct(this.m_Page);for(o=0;o<p;o++){nt=(et=i+_+o*Y)+Y;var E=J[o],z=[];x.forEach(function(t){D(t,E)&&z.push(t)});var G=P||Ct(E);for(r=0;r<d;r++){it=(tt=e+h+r*W)+W;var j=u[r],M=new gt.CMHodina(B);if(M.SetPozicia(G||Ct(j)),z.forEach(function(t){D(t,j)&&M.Add(t)}),!M.IsEmpty()){M.FinishAdding();var V=new bt.CTTRowCell(L);V.m_MHodina=M,T=new yt(tt,et,it,nt),this.RenderCell(T,W,Y,V,!1,[],[],X[r],X[r]),this.Rect(T,"none",.1)}}}}this.Box(e,i,e+h+d*W,i+_+p*Y,.3),this.VLine(e+h,i,_+p*Y,.3),this.HLine(e,i+_,h+d*W,.3),this.preview&&(new St(this.$page,!0,Z.headerwidth,e,i,e+n,g,function(t){F.m_pTlacZostava.UpdateSetting("headerwidth",t)}),new St(this.$page,!1,Z.headerheight,e,i,b,i+s,function(t){F.m_pTlacZostava.UpdateSetting("headerheight",t)}),Z.fitwidth||new St(this.$page,!0,Z.cellwidth,e+h,i,e+n,i+_,function(t){F.m_pTlacZostava.UpdateSetting("cellwidth",t)}),Z.fitheight||new St(this.$page,!1,Z.cellheight,e,i+_,e+h,i+s,function(t){F.m_pTlacZostava.UpdateSetting("cellheight",t)}));var U=.02*s,H=.2*U;this.TextBox(new yt(e,0,b,i-H),U,this.m_pTlacZostava.m_pRok.GetRegName(!0),Z.printlogo_url?0:-1,1);var N=null,K=Ct(this.m_Page);if(K instanceof vt.CTrieda&&(N=K),N){var $=[];N.GetUcebna()&&$.push(N.GetUcebna().GetSkratka()),N.m_pUcitel&&$.push(ASC.ttls(1532)+": "+N.m_pUcitel.GetNazov());for(var ut=i-H,pt=0,ht=$;pt<ht.length;pt++){var _t=ht[pt];this.TextBox(new yt(e,0,b,ut),U,_t,1,1),ut-=U+H}}this.TextBox(new yt(e,g+H,b,g+30*kt),U,B.GlobalData().settings.m_strDateBellowTimeTable,-1,-1),this.TextBox(new yt(e,g+H,b,g+30*kt),U,"aSc "+ASC.ls(1687),1,-1),B.m_pRozApp&&B.m_pRozApp.jsc.unregistered&&(T=new yt(b-.35*n,g-.35*s,b,g),this.Rect(T,"rgba(255,255,255,0.8)",0),this.TextBox(T,.05*s,ASC.ttls(2061),0,0,{},{shrink:!0}))},b.prototype.RenderCell=function(t,e,i,n,s,r,o,a,l){var c,d=this,m=this.m_pTlacZostava.m_pRok,u=this.m_pTlacZostava.m_Data,p=n.m_pKarta,h=n.m_MHodina,_=this.m_pTlacZostava_objekt.m_Data,f=Ct(r),v=t.x1,b=null;if(_.cardcolorenabled&&!this.m_pTlacZostava.m_bTTViewerDisableCardColor){var g=_.cardcolortable1;g=g||(0<=this.m_pTlacZostava.m_PageTables.indexOf("teachers")?"classes":"teachers");var y=p?this.GetKartaFarby(p,g):h.GetFarby(g),k=p?this.GetKartaFarby(p,_.cardcolortable2):h.GetFarby(g);"teachers"==g&&(b=p?p.m_pHodina.m_Ucitelia[0]:h.m_Objects.teachers[0]);var C=null,S=null,T=null,w=null;"left"==_.cardcolorpos?S=y:"topleft"==_.cardcolorpos?w=y:(C=y,T=k);var A="#fff";if(C&&0<C.length&&(A=this.FillFarby(C,t.width(),t.height())),c=this.Rect(t,A,0),S&&0<S.length){var R=t.x1+t.width()/5;this.Rect(new yt(t.x1,t.y1,R,t.y2),this.FillFarby(S,0,t.width()),0),v=R}if(T&&0<T.length&&this.Rect(new yt(t.x1,t.y1+3*t.height()/4,t.x2,t.y2),this.FillFarby(T,t.x2-t.x1,0),0),w&&0<w.length){var I=Math.max(e,i)/5,D=(R=t.x1+I,t.y1+I);q("polygon",this.page_document).appendTo(this.$page).attr({points:[t.x1,t.y1,R,t.y1,t.x1,D].join(","),stroke:"none",style:"fill:"+this.FillFarby(w,I,I,!0)})}}else c=this.Rect(t,"#fff",0);if(0==u.typ&&p){for(var O=null,x=0,P=this.m_Page;x<P.length;x++){var E=P[x];E instanceof vt.CTrieda&&(O=E)}var z=ASC.strVal(p.m_pHodina.m_pPredmet.m_Data.picture_url);""!=z&&O&&ASC.boolVal(O.m_Data.printsubjectpictures)&&this.Image(t.pad(.2),z).css("pointer-events","none")}var G=1;p&&p.m_pHodina&&(G=p.m_pHodina.IsBezTriedy()?0:p.m_pHodina.IsBezUcitela()?2:1);var j=1/(n.y2-n.y1);(!(j=Math.round(j-.01)-1)||j<0)&&(j=0);for(var M=n.x2-n.x1,V=this.m_pTlacZostava_objekt.GetPrintKartaStyle(M,j,G),U="",H=0,N=["subjects","classes","groupnames","teachers","classrooms","time","count"];H<N.length;H++){var K=N[H],$=V.texts[K];if($&&$.enabled){var F=0,L=0;switch($.pos){case 1:F=L=-1;break;case 2:L=-1,F=1;break;case 3:F=-(L=1);break;case 4:F=L=1;break;case 5:L=1,F=0;break;case 6:L=-1,F=0;break;case 7:L=0,F=-1;break;case 8:L=0,F=1}var B="",Z="";if("time"==K){var J=m.GetPeriodTime(r,n.m_pKarta.m_pHodina),W=m.GetPeriodTime(o,n.m_pKarta.m_pHodina);a&&l&&a.starttime==J.starttime&&l.endtime==W.endtime||(B=m.FormatTimeFromTo(J.starttime,W.endtime)),Z=B}else B=p?this.GetKartaText(n.m_pKarta,K,$.autohide,f,$.name_col):this.GetMHText(h,K,$.name_col),Z=p?this.GetKartaText(n.m_pKarta,K,$.autohide,f,"name"):h.GetText(K,"name");if(""!=B){var Y=this.TextBox(new yt(v,t.y1,t.x2,t.y2).pad(.05),i*$.size,B,F,L,$,{wrap:!0,clip:!0});if(this.preview&&Y.css("pointer-events","none"),b){var X=b.m_Data[0==F&&0==L?"fontcolorprint":"fontcolorprint2"];X&&Y.attr("fill",X)}}""!=Z&&(U&&(U+="\n"),U+=Z)}}this.Tootlip(c,U),p&&p.m_Data.substed&&this.SubstBox(t),this.preview&&c.on("contextmenu",function(t){var e=d.m_pTlacZostava_objekt,i=e.m_PrintKartaStyles.indexOf(V),n="tzid="+e.m_Id+"&ksi="+i+"&btu="+G+"&nd="+M+"&nsv="+j;e.m_pRok.m_pRozApp.click_func("print_ks",n),t.preventDefault(),t.stopPropagation()})},b.prototype.GetKartaText=function(t,e,i,n,s){var r;switch(void 0===s&&(s="short"),s=s||"short",e){case"subjects":var o=t.m_pHodina,a=o.m_pPredmet.GetNazov(s);return 1<=o.m_nPoradieSeminaru&&("short"==s?("0"<=a.substr(-1)&&a.substr(-1)<="9"&&(a+="-"),a+=o.m_nPoradieSeminaru):a+=" ("+o.m_nPoradieSeminaru+")"),a;case"groups":case"groupnames":r=[];for(var l=0,c=t.m_pHodina.m_Skupiny;l<c.length;l++){var d=c[l];d.m_bCelaTrieda||n instanceof vt.CTrieda&&n!=d.m_pTrieda||(a=d.GetNazov(),r.indexOf(a)<0&&r.push(a))}return r.join("/");case"teachers":r=[];for(var m=0,u=t.m_pHodina.m_Ucitelia;m<u.length;m++){var p=u[m];r.push(p.GetNazov(s))}return r.join(" / ");case"classes":r=[];for(var h=0,_=t.m_pHodina.m_Triedy;h<_.length;h++){var f=_[h];r.push(f.GetNazov(s))}return r.join("/");case"classrooms":r=[];for(var v=0,b=t.Ucebne();v<b.length;v++){var g=b[v];if(g){if(i){for(var y=!1,k=0,C=t.m_pHodina.m_Triedy;k<C.length;k++)f=C[k],g.JeKmenovaPre(f)&&(y=!0);if(y)continue}r.push(g.GetNazov(s))}}return r.join(" / ");default:return t.GetTexty([e],s,n)}},b.prototype.GetKartaFarby=function(t,e){var i=[];switch(e){case"teachers":for(var n=0,s=t.m_pHodina.m_Ucitelia;n<s.length;n++){var r=s[n];i.push(r.GetColor())}break;case"subjects":i.push(t.m_pHodina.m_pPredmet.GetColor());break;case"classes":for(var o=0,a=t.m_pHodina.m_Triedy;o<a.length;o++)r=a[o],i.push(r.GetColor());break;case"groupnames":case"groups":for(var l=0,c=t.m_pHodina.m_Skupiny;l<c.length;l++)r=c[l],i.push(r.GetColor());break;case"classrooms":for(var d=0,m=t.Ucebne();d<m.length;d++)(r=m[d])&&i.push(r.GetColor());break;case"buildings":for(var u=0,p=t.Ucebne();u<p.length;u++)(r=p[u])&&r.m_pBudova&&i.push(r.m_pBudova.GetColor())}return i},b.prototype.GetMHText=function(t,e,i){switch(e){case"teachers":case"classes":case"subjects":case"classrooms":case"groups":case"groupnames":return t.GetText(e,i);case"count":return(t.m_bRoznePoctyHodin?"*":"")+Math.round(100*t.m_dHodin)/100}return e+"?"},b.prototype.Line=function(t,e,i,n,s){return q("line",this.page_document).attr({x1:t,y1:e,x2:i,y2:n,"stroke-width":s*kt}).appendTo(this.$page)},b.prototype.VLine=function(t,e,i,n){return this.Line(t,e,t,e+i,n)},b.prototype.HLine=function(t,e,i,n){return this.Line(t,e,t+i,e,n)},b.prototype.Box=function(t,e,i,n,s){var r=this.Line(t,e,i,e,s);return r=(r=(r=r.add(this.Line(i,e,i,n,s))).add(this.Line(i,n,t,n,s))).add(this.Line(t,n,t,e,s))},b.prototype.Rect=function(t,e,i){var n=q("rect",this.page_document).attr({x:t.x1,y:t.y1,width:t.width(),height:t.height(),style:"fill:"+e}).appendTo(this.$page);return 0<i?n.attr("stroke-width",i*kt):n.attr("stroke","none"),n},b.prototype.Tootlip=function(t,e){q("title",this.page_document).text(e).prependTo(t)},b.prototype.Image=function(e,t,i,n){void 0===i&&(i=0),void 0===n&&(n=0);var s=q("image",this.page_document),r=document.createAttributeNS("http://www.w3.org/1999/xlink","href");r.nodeValue=t,s[0].attributes.setNamedItemNS(r),s.appendTo(this.$page).attr({x:e.x1,y:e.y1});var o=e.width(),a=e.height();if(i||n){var l=A(s),c=function(){var t=Math.min(o/l.width,a/l.height);o=l.width*t,a=l.height*t,0==i?s.attr("width",e.width()):0<i&&s.attr({x:e.x2-o,width:o}),0==n?s.attr("height",e.height()):0<i&&s.attr({y:e.y2-a,width:a})};l.width?c():s.load(function(){l=A(s),c()})}else s.attr({width:o,height:a});if(w){var d=A(s);s.attr({transform:"scale(-1 1) translate("+(-2*d.x-d.width)+")"})}return s},b.prototype.FillFarby=function(t,e,i,n){if(0==t.length)return"#fff";if(1==t.length)return t[0];for(var s="LG_"+I++,r=q("linearGradient",this.page_document).appendTo(this.$defs).attr({id:s,x1:0,y1:0,x2:0<e?1:0,y2:0<i?1:0}),o=(n?.5:1)/t.length,a=0;a<t.length;a++)q("stop",this.page_document).appendTo(r).attr({offset:a*o,"stop-color":t[a]}),q("stop",this.page_document).appendTo(r).attr({offset:(a+1)*o,"stop-color":t[a]});return"url(#"+s+")"},b.prototype.FixFont=function(t){return 0<=["arial","courier","times new roman"].indexOf(t.toLowerCase())?t:t+",Arial"},b.prototype.TextBox=function(t,e,i,n,s,r,o){void 0===n&&(n=0),void 0===s&&(s=0),void 0===r&&(r={}),void 0===o&&(o={}),e=Math.min(e,t.height());var a=q("text",this.page_document).attr({"font-size":e,"text-rendering":"geometricPrecision","text-anchor":n<0?"start":0<n?"end":"middle","dominant-baseline":s<0?"text-before-edge":0<s?"text-after-edge":"central"}).appendTo(this.$page).css("pointer-events","none").css("white-space","pre").text(i);r.bold&&a.css("font-weight","bold"),r.italic&&a.css("font-style","italic"),r.underline&&a.css("text-decoration","underline"),r.font&&a.css("font-family",this.FixFont(r.font));var l=a[0];e>t.height()&&(e=t.height(),a.attr("font-size",e));var c=t.width(),d=t.height(),m=1,u=l.getComputedTextLength();if(c<u)if(o.wrap){for(var p=[],h=0;h<i.length;){for(var _=h,f=!1;_<i.length;){var v=_+1;if(f||(v=i.indexOf(" ",v))<0&&(v=i.length),l.getSubStringLength(h,v-h)>c){if(h<_)break;if(f){_=i.length;break}f=!0,_=h}else _=v}for(p.push(i.substring(h,_).trim()),h=_;" "==i.charAt(h);)h++}a.empty();for(var b=0,g=p;b<g.length;b++){var y=g[b],k=q("tspan",this.page_document).appendTo(a).text(y);y!=p[0]&&k.attr({dy:e})}m=p.length}else o.shrink&&(e=e*c/u,a.attr("font-size",e));if((1<m?a.find("tspan"):a).attr("x",t.x1+(1+n)*c/2),a.attr("y",t.y1+(1+s)*(d-(m-1)*e)/2),0<=["edge","ie11","ie10"].indexOf(ASC.browser)){var C=A(a);a.attr("y",parseFloat(a.attr("y"))+t.y1-C.y+(t.height()-C.height)*(1+s)/2)}if(o&&o.clip&&((C=A(a)).width>c||C.height>d)){var S="CP_"+I++,T=q("clipPath",this.page_document).appendTo(this.$page).attr("id",S);q("rect",this.page_document).appendTo(T).attr({x:t.x1,y:t.y1,width:c,height:d}),a.attr("clip-path","url(#"+S+")")}return w&&(C=A(a),a.attr({transform:"scale(-1 1) translate("+(-2*C.x-C.width)+")"})),a},b.prototype.TextBoxRotated=function(t,e,i,n,s,r,o){void 0===n&&(n=0),void 0===s&&(s=0);var a=t.width(),l=t.height();this.TextBox(new yt(t.x1-l,t.y1,t.x1,t.y1+a),e,i,n,s,r,o).attr("transform","rotate(-90 "+t.x1+" "+t.y1+")")},b.prototype.SubstBox=function(t){var e=this.Rect(new yt(t.x1+.35,t.y1+.35,t.x2-.35,t.y2-.35),"none",.7);return e.attr("stroke-dasharray","2,2"),e},b.prototype.TTR_Init=function(t){var e=this.m_pTTRowRenderer;e.Clear();for(var i=0,n=t;i<n.length;i++){var s=n[i];if("periods"==s.m_Table){var r=s;e.m_nVerticalHodinyOd=r.m_nHodina,e.m_nVerticalHodinyDo=r.m_nHodina}if("daysdefs"==s.m_Table){var o=s;e.m_nDay=o.m_Val}"weeksdefs"==s.m_Table&&(o=s,e.m_nWeek=o.m_Val),"termsdefs"==s.m_Table&&(o=s,e.m_nTerm=o.m_Val)}if(e.m_pHorizontalRokObject=Ct(t),e.m_bSpojNaViacHodinovku=ASC.boolVal(e.m_pRok.GlobalData().settings.m_bPrintSinglesSpolu),!e.m_pHorizontalRokObject)throw"Error 7857072888"},b.prototype.TTR_TryContinue=function(t){for(var e=!1,i=this.m_pTTRowRenderer,n=0,s=t;n<s.length;n++){var r=s[n];if("periods"==r.m_Table){if(r.m_nHodina!=i.m_nVerticalHodinyDo+1)return!1;e=!0}}return!!e&&(i.m_nVerticalHodinyDo++,!0)},b);function b(t,e,i,n){var s=v.call(this,t)||this;s.m_Title="",s.m_Page=[],s.m_Rows=[],s.m_Columns=[],s.m_pTlacZostava=t,s.m_pTlacZostava_objekt=t;for(var r=0,o=e;r<o.length;r++){if("classrooms"==o[r].m_Table&&t.m_PageTables.indexOf("classrooms")<0)for(var a=0,l=t.m_pRok.m_ObjectsO.ttreports;a<l.length;a++){var c=l[a];if(3==c.m_Data.typ){s.m_pTlacZostava_objekt=c;break}}}if(s.m_Page=e,s.m_Rows=i,s.m_Columns=n,0<e.length)for(var d=0,m=e;d<m.length;d++){var u=m[d];""!=s.m_Title&&(s.m_Title+=" - "),s.m_pTlacZostava_objekt.m_Data.pageheaderprefixenabled&&u.m_Data.printheaderprefix&&(s.m_Title+=u.m_Data.printheaderprefix+" "),s.m_Title+=p.CUtils.GetUINazov(u,"name")}else s.m_Title=s.m_pTlacZostava.GetNazov();return s.m_pTTRowRenderer=new bt.CTTRowRenderer(s.m_pTlacZostava.m_pRok),s}function g(t){var e=window.open("","_blank"),i=e.document,n=$j(i.head).empty(),s=$j(i.body).empty();s.css({margin:"0px",padding:"0px"});try{$j("<base>").attr("href","https://"+document.location.host).appendTo(n),$j("link[type='text/css']").each(function(t,e){$j(e).clone().appendTo(n)})}catch(t){console.error(t)}$j("<style type='text/css'>@page {margin: 0px;margin-bottom: -5cm;}</style>").appendTo(n);for(var r=[],o=function(e){r.push(function(){var t=$j("<div class='print-sheet-manual'>").appendTo(s);t.css({width:5*e.width+"px",height:5*e.height-100+"px"}),e.RenderSheet(t,5,!1)})},a=0,l=t;a<l.length;a++){o(l[a])}r.push(function(){$j(i).ready(function(){setTimeout(function(){e.print()},100)})});var c=new ASC.ui.ProgressBar(r);c.safetyCounterMax=Math.max(c.safetyCounterMax,r.length+10)}t.CPrintPageGrid=P,t.printPagesPrint=g,t.phpPrintPosField=function(t,e,i,n,s){void 0===i&&(i={}),n[s]=new y(t,e,i).input};var y=(k.prototype.setValue=function(t){this.input.value=""+t,this.$div.find("div").removeClass("selected"),this.$pos[t].addClass("selected")},k);function k(t,i,e){var n=this;void 0===e&&(e={}),this.$pos=[],i=parseInt(i),this.$div=$j("<div class='ttonline-print-pos-field'>").appendTo(t),this.input=$j("<input type='hidden'>").appendTo(t).get(0),this.input.value=""+i,e.style&&(this.$div[0].style.cssText+=";"+e.style);[1,6,2,7,0,8,3,5,4].forEach(function(t,e){n.$pos[t]=$j("<div>").appendTo(n.$div).toggleClass("selected",t==i).click(function(){n.setValue(t)}),2!=e&&5!=e||$j("<br>").appendTo(n.$div)})}t.PrintPosField=y;var St=(C.prototype.updatePos=function(){if(this.vertical){var t=this.s_min+this.s_delta*this.v;this.$l.attr({x1:t,x2:t})}else{var e=this.s_min+this.s_delta*this.v;this.$l.attr({y1:e,y2:e})}},C);function C(t,e,i,n,s,r,o,a){var l=this;this.v_min=.01,this.v_max=.99,this.vertical=!1;var c=$j(t)[0].ownerDocument;this.$l=q("line",c).appendTo(t).attr({"stroke-width":2*kt,cursor:e?"w-resize":"n-resize","stroke-opacity":0}),this.$f=q("line",c).appendTo(t).attr({x1:n,y1:s,x2:r,y2:o,"stroke-width":1*kt,"stroke-opacity":0}),this.v=i,this.vertical=e,this.fn=a,e?(this.s_min=n,this.s_delta=r-n,this.$l.attr({y1:s,y2:o})):(this.s_min=s,this.s_delta=o-s,this.$l.attr({x1:n,x2:r})),this.updatePos(),this.$l.mousedown(function(o){l.$l.attr("stroke-opacity",1);function e(t){var e,i,n,s=l.v,r=l.$f[0].getBoundingClientRect();n=l.vertical?(e=t.pageX,i=r.left,r.width):(e=t.pageY,i=r.top,r.height),s=(e-i)/n,s=Math.max(l.v_min,Math.min(l.v_max,s)),(a||1<Math.abs(t.pageX-o.pageX)+Math.abs(t.pageY-o.pageY))&&(l.v=s,l.updatePos(),a=!0),t.stopPropagation(),t.preventDefault(),l.updatePos()}var a=!1,i=function(t){$j(document).off("mousemove",e).off("mouseup",i),l.$l.attr("stroke-opacity",0),t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),a&&l.fn(l.v)};$j(document).mousemove(e).mouseup(i),o.preventDefault(),o.stopPropagation(),o.stopImmediatePropagation()})}t.Potahovatko=St}),ASC.setModuleSourceFunc("/timetable/app/gendlgs.js",function(t,require,e){t.__esModule=!0;var i=require("tslib"),m=require("./online"),s=require("./rokobject"),n=(r.prototype.DoModal=function(t){var e=this;this.dlg=m.CUtils.OpenDialog(ASC.ttls(1129),t),this.dlg.$div.on("dialogbeforeclose",function(t){e.closing||(e.ClickClose(),t.preventDefault())}),this.dlg.$div.on("dialogclose",function(t){e.Closed()}),this.$div=this.dlg.$div,this.$div.addClass("pingingdlg"),this.InitDialog(),this.dlg.center(),this.SchedulePing(!1)},r.prototype.SchedulePing=function(t){var e=this;void 0===t&&(t=!0),window.setTimeout(function(){e.Ping()},t?this.ping_interval:0)},r.prototype.Ping=function(){var e=this;this.$div.is(":visible")&&(this.ping_pause?this.SchedulePing():this.m_pRozApp.jsc.ASC_action(this.ping_cmd,"",{modal:!1,failure:function(t){console.log(t),e.SchedulePing()},success:function(t){e.SchedulePing()}}))},r.prototype.CloseSubDlg=function(){var t=this.subdlg;t&&(this.subdlg=null,t.hide())},r.prototype.Close=function(){this.closing=!0,this.CloseSubDlg(),this.dlg.hide()},r.prototype.ClickClose=function(){alert("Close")},r.prototype.Closed=function(){this.CloseSubDlg()},r);function r(t,e){this.ping_interval=1e3,this.ping_pause=!1,this.pinger=null,this.closing=!1,this.m_pRozApp=t,this.m_pRok=this.m_pRozApp.m_pRok,this.ping_cmd=e}var o,g,a,l=(o=n,i.__extends(c,o),c.prototype.InitDialog=function(){var t=this;this.$div.addClass("generprogressdlg");var e=$j("<div style='height:100px; position:relative'>").appendTo(this.$div);"dozory"==this.miniries&&e.hide(),e.append($j("<div style='position: absolute; left: 0px; top: 0px; width:80px; height:80px; border:1px solid #808080;overflow:hidden'>").append("<img style='padding-top:20px' src='/timetable/pics/app/gener.gif'>"));var i=$j("<div style='position:absolute;left:130px;width:120px'>").appendTo(e);this.$speed_d=$j("<div class='speed'><div style='background-color:#80ff80'/><span/>").appendTo(i),this.$vykop_d=$j("<div class='speed'><div style='background-color:#ff8080'/><span/>").appendTo(i),this.$zlava_high_d=$j("<div class='speed'><div/><span/>").appendTo(i),this.$zlava_normal_d=$j("<div class='speed'><div/><span/>").appendTo(i),this.$zlava_low_d=$j("<div class='speed'><div/><span/>").appendTo(i),$j("<img>").appendTo(this.$speed_d).attr("src",m.CUtils.GetIconTimeOff()),$j("<img>").appendTo(this.$vykop_d).attr("src",m.CUtils.GetIconImportance("strict")),$j("<img>").appendTo(this.$zlava_high_d).attr("src",m.CUtils.GetIconImportance("high")),$j("<img>").appendTo(this.$zlava_normal_d).attr("src",m.CUtils.GetIconImportance("normal")),$j("<img>").appendTo(this.$zlava_low_d).attr("src",m.CUtils.GetIconImportance("low")),$j("<div>").appendTo(this.$div).text("Progress"),this.$p1_d=$j("<div>").appendTo($j("<div class='progress'>").appendTo(this.$div)),this.$p2_d=$j("<div>").appendTo($j("<div class='progress'>").appendTo(this.$div)),"dozory"==this.miniries&&this.$p2_d.parent().hide(),e=$j("<div style='height:100px; position:relative'>").appendTo(this.$div),"dozory"==this.miniries&&e.hide(),i=$j("<div style='Xdisplay: inline-block; background-color: #808080; Xwidth:200px; padding:3px; border: 1px solid #ffffff;position:relative'>").appendTo(e),this.$card_d=$j("<div style='border:1px solid #ffffff;width:32px;height:60px; float:left; text-align:center;box-sizing:border-box;padding-top:21px;margin-right:10px; visibility:hidden'>").appendTo(i),this.$card_detail_d=$j("<span style='color: #ffff00'>").appendTo(i),$j("<div style='clear:both'>").appendTo(i),this.dlg.$ft.css({"text-align":"center"}),this.btn_close=new ASC.ui.Button({container:this.dlg.$ft,label:ASC.ttls(1007),onclick:function(){t.ClickClose()},style:"text-align:center;width:100px"}),this.m_pRozApp.trackEvent("GenerProgressDlg","opened")},c.prototype.SetProgress=function(t){null!=t.p1&&this.$p1_d.css("width",100*t.p1+"%"),null!=t.p2&&this.$p2_d.css("width",100*t.p2+"%");var e={m_nRychlost:this.$speed_d,p_VykaslalSa:this.$vykop_d,p_IZ_high:this.$zlava_high_d,p_IZ_normal:this.$zlava_normal_d,p_IZ_low:this.$zlava_low_d};for(var i in e){var n=e[i];if(i in t){var s=parseInt(t[i]),r=.5;switch(i){case"m_nRychlost":r=(Math.log(Math.max(1,s))/Math.LN10-2)/4;break;case"p_VykaslalSa":default:r=s/20}n.find("span").text(s),n.find("div").css("width",Math.min(100*r,100)+"px")}}if(t.m_pPoslednaKarta){var o=this.m_pRok.m_ObjectsI.cards[t.m_pPoslednaKarta];if(o){var a=this.$card_d;a.css("visibility",""),a.text(o.m_pHodina.m_pPredmet.GetSkratka()),ASC.strippedBackground(a[0],o.GetFarby("teachers"),a.outerWidth(),a.outerHeight()),(a=this.$card_detail_d).empty();for(var l=0,c=["subjects","classes","teachers"];l<c.length;l++){var d=c[l];ASC.createText(a[0],o.GetTexty([d],"name")),$j("<br>").appendTo(a)}}}},c.prototype.Closed=function(){o.prototype.Closed.call(this),this.m_pRozApp.m_pGenerProgressDlg=null,this.m_pRozApp.jsc.ASC_action("generator_cancel","",{modal:!1})},c.prototype.ClickClose=function(){var t=this,e=m.CUtils.OpenDialog(ASC.ttls(1079),{width:400});$j("<span>").appendTo(e.$div).text(ASC.ttls(1487)),new ASC.ui.Button({container:e.$ft,label:ASC.ttls(1007),onclick:function(){e.hide(),t.Close()},style:"text-align:center;"}),"dozory"!=this.miniries&&new ASC.ui.Button({container:e.$ft,label:ASC.ttls(1488),onclick:function(){t.CloseSubDlg(),t.m_pRozApp.jsc.ASC_action("generator_cancel","finish_quickly=1",{modal:!1})},style:"text-align:center;"}),new ASC.ui.Button({container:e.$ft,label:ASC.ttls(1486),onclick:function(){t.CloseSubDlg()},style:"text-align:center;"}),e.center(),this.subdlg=e},c);function c(t,e){var i=o.call(this,t,"generator_ping")||this;return i.miniries=e,(i.m_pRozApp.m_pGenerProgressDlg=i).DoModal({width:375,Xheight:340}),i}t.CGenerProgressDlg=l,(a=g=g||{})[a.iGenNic=0]="iGenNic",a[a.iGenVseob=1]="iGenVseob",a[a.iGenTriedy=2]="iGenTriedy",a[a.iGenUcit=3]="iGenUcit",a[a.iGenPredm=4]="iGenPredm",a[a.iGenZiaci=5]="iGenZiaci",a[a.iGenUcebnu=6]="iGenUcebnu",a[a.nTestGen=7]="nTestGen";var d,u=(d=n,i.__extends(p,d),p.prototype.UpdateFlags=function(){for(var t=0;t<this.m_flag.length;t++){var e=this.$flags[t];if(e){var i=this.m_flag[t];if(0==i||t>=this.m_iGenerujeSa)e.css("visibility","hidden");else{e.css("visibility","");var n="/timetable/pics/app/test_ok.png";i<1&&(n="/timetable/pics/app/test_krizik.png",t==g.iGenVseob&&(n="/timetable/pics/app/test_otaznik.png")),e.find("img").attr("src",n)}}}},p.prototype.InitDialog=function(){var t=this,e=this.$div;e.addClass("testgendlg"),this.dlg.setHeader(ASC.ttls(1368));var i=$j("<div>").appendTo(e).text(ASC.ttls(1369));this.$p1_d=$j("<div>").appendTo($j("<div class='progress'>").appendTo(e)),e.append("<br>"),e.append("<hr>"),this.$p2_l=$j("<span style='width:185px; display:inline-block'>").appendTo(e),this.$p2_d=$j("<div>").appendTo($j("<div class='progress' style='width:240px; display:inline-block; vertical-align:middle'>").appendTo(e)),e.append("<br>"),this.$p3_l=$j("<span style='width:185px; display:inline-block'>").appendTo(e),this.$p3_d=$j("<div>").appendTo($j("<div class='progress' style='width:240px; display:inline-block; vertical-align:middle'>").appendTo(e)),e.append("<br>"),e.append("<hr>"),i=$j("<div style='margin-bottom:10px'>").appendTo(e);for(var n=1;n<7;n++){var s=$j("<span style='display:inline-block;text-align:center;'>").appendTo(i);s.append("<img style='width:32px;height:32px;border:0;padding:4px 23px'>"),$j("<div style=''>").appendTo(s).text(this.flagNames[n]),this.$flags[n]=s}this.UpdateFlags(),this.dt=new ASC.ui.dt.DataTable($j("<div>").appendTo(e),[{key:"icon",width:16,icons:{hc:"/timetable/pics/app/ok_small_16.png",xr:"/timetable/pics/app/bug_small_16.png",sc:"/timetable/pics/app/bug_small_16.png",oc:"/timetable/pics/app/test_otaznik.png"}},{key:"text",width:200,resizeable:!0}],new ASC.ui.dt.DataSource([]),{height:160,hideHead:!0,cssClass:"base-dt"}),this.dt.fitWidth(),this.dlg.$ft.css("text-align","right"),new ASC.ui.Button({container:this.dlg.$ft,label:ASC.ttls(2739),onclick:function(){t.Skip()}}),new ASC.ui.Button({container:this.dlg.$ft,label:ASC.ttls(1783),onclick:function(){t.ClickClose()}}),this.m_pRozApp.trackEvent("TestGenDlg","opened")},p.prototype.Closed=function(){d.prototype.Closed.call(this),this.m_pRozApp.m_pTestGenDlg=null,this.m_pRozApp.jsc.ASC_action("test_stop","")},p.prototype.SetStatus=function(t){for(var e=t.list.length,i=0,n=["m_iGenerujeSa","m_nKde","m_nCelkovo","m_flag","m_strDetail","m_detailPos"];i<n.length;i++){var s=n[i];this[s]=t[s]}if(t.m_pCoTestujem&&(this.m_pCoTestujem=this.m_pRok.decodeRo(t.m_pCoTestujem)),"m_listNedaloSa"in t){this.m_listNedaloSa=[];for(var r=0,o=t.m_listNedaloSa;r<o.length;r++){var a=o[r],l=this.m_pRok.decodeRo(a);l&&this.m_listNedaloSa.push(l)}console.log(this.m_listNedaloSa)}if(e>this.m_nChybySkip){for(var c=[],d=this.m_nChybySkip;d<e;d++){var m=t.list[d].Popis,u={icon:m.substr(0,2),text:m.substr(2)};c.push(u)}this.dt.addRows(c),this.dt.scrollTo(this.dt.rows[this.dt.rows.length-1]),this.m_nChybySkip=e}if(this.m_iGenerujeSa==g.nTestGen)this.$p1_d.css("width","100%"),this.$p2_d.css("width","0%"),this.$p3_d.css("width","0%"),this.$p2_l.text(""),this.$p3_l.text("");else{if(this.m_iGenerujeSa<this.m_nKde.length){var p=0;0<this.m_nCelkovo[this.m_iGenerujeSa]&&(p=this.m_nKde[this.m_iGenerujeSa]/this.m_nCelkovo[this.m_iGenerujeSa]*100),this.$p2_d.css("width",p+"%")}this.$p2_l.text(this.flagNames[this.m_iGenerujeSa]+":");for(var h=0,_=0,f=0,v=[g.iGenTriedy,g.iGenUcit,g.iGenPredm];f<v.length;f++){var b=v[f];h+=this.m_nCelkovo[b],_+=this.m_nKde[b]}0<h&&this.$p1_d.css("width",_/h*100+"%"),this.$p3_d.css("width",100*this.m_detailPos+"%"),this.$p3_l.text(this.m_strDetail)}this.UpdateFlags(),t.m_bHintFinished?this.HintFinished():t.m_bTestFinished?this.Finished():t.m_flagAskShow&&this.ShowAskDialog(t)},p.prototype.Finished=function(){var t=this;this.CloseSubDlg(),this.ping_pause=!0,this.m_iGenerujeSa=g.nTestGen,this.UpdateFlags();for(var e=this.m_bTestFinished=!0,i=0;i<g.nTestGen;i++)i!=g.iGenVseob&&this.m_flag[i]<0&&(e=!1);e?ASC.ASC_messageBox(ASC.ttls(1807)):ASC.ASC_messageBox(ASC.ttls(1808)),this.dlg.$ft.empty(),new ASC.ui.Button({container:this.dlg.$ft,label:ASC.ls(1573),onclick:function(){t.ClickClose()}})},p.prototype.Skip=function(){this.m_bTestFinished},p.prototype.ShowAskDialog=function(t){var e=this;this.ping_pause=!0;var i=this.m_pCoTestujem;if(i){var n,s,r=m.CUtils.OpenDialog(ASC.ttls(1368),{width:640}),o=r.$div,a=function(){d=$j("<div style='margin-top:10px; display: flex; flex-direction: row'>").appendTo(o),n=$j("<div style='border:1px solid #808080;flex: 1 1 100px;width:100px;padding:10px'>").appendTo(d),s=$j("<div style='border:1px solid #808080;flex: 1 1 100px;width:100px;padding:10px;margin-left:10px'>").appendTo(d)},l=function(t,e,i,n,s){new ASC.ui.Button({container:t,label:"<img src='/timetable/pics/app/"+e+"' style='width:auto;height:auto'>",style:"text-align:center;"+(i?"width:90px":"width:70px; margin-left:10px"),onclick:n}),s&&$j("<span style='margin-left:5px'>").appendTo(t).text(s)},c="There is a problem in %1.";switch(i.m_Table){case"classes":c=ASC.ttls(1784)}c=c.replace("%1",i.GetNazov()),c+="\n"+ASC.ttls(1249)+this.m_listNedaloSa.length,$j("<div style='text-align:center; font-weight:bold;padding:10px;white-space:pre-wrap'>").appendTo(o).text(c);var d=$j("<div style='text-align:center; font-weight:bold; border:1px solid #808080;padding:10px'>").appendTo(o);l(d,"test_pozriet.png",!0,function(){e.AskActionPozriet(),e.m_pRozApp.trackEvent("TestAskDlg","show")},""),$j("<div style='margin-top:5px'>").appendTo(d).text(ASC.ttls(3078)),a(),l(n,"test_znovu.png",!0,function(){e.AskAction("m_bEsteRaz"),e.m_pRozApp.trackEvent("TestAskDlg","retry")},ASC.ttls(3080)),l(s,"test_zlavit.png",!0,function(){e.AskAction("m_bTestWithHint"),e.m_pRozApp.trackEvent("TestAskDlg","hint")},ASC.ttls(3081)),a(),l(n,"test_skip.png",!1,function(){e.AskAction("m_bSkip"),e.m_pRozApp.trackEvent("TestAskDlg","skip")},ASC.ttls(3082)),l(n,"test_krizik.png",!1,function(){e.m_flag[e.m_iGenerujeSa]=-1,e.Finished(),e.m_pRozApp.trackEvent("TestAskDlg","exit")},ASC.ttls(3084)),s.css("padding-top","30px"),l(s,"test_help.png",!1,function(){e.m_pRozApp.ShowHelp("TestFailHelpDlg"),e.m_pRozApp.trackEvent("TestAskDlg","help")},ASC.ttls(3083)),r.center(),r.$div.on("dialogclose",function(){e.subdlg&&e.AskAction("m_bSkip")}),this.subdlg=r,this.m_pRozApp.trackEvent("TestAskDlg","opened")}else this.m_pRozApp.Fail("Error 4459961955")},p.prototype.ClickClose=function(){var t=this;if(this.m_bTestFinished)this.Close();else{var e=m.CUtils.OpenDialog(ASC.ttls(1079),{width:400});$j("<span>").appendTo(e.$div).text(ASC.ttls(1368)+" - "+ASC.ttls(1007)+"?"),new ASC.ui.Button({container:e.$ft,label:ASC.ttls(1007),onclick:function(){t.m_pRozApp.trackEvent("TestGenDlg","close"),e.hide(),t.Close()},style:"text-align:center;"}),new ASC.ui.Button({container:e.$ft,label:ASC.ttls(1486),onclick:function(){e.hide()},style:"text-align:center;"}),e.center(),this.subdlg=e}},p.prototype.AskAction=function(t){var e=this.m_pCoTestujem;this.m_pRozApp.click_func("test_action","test_item="+e.m_Table+":"+e.m_Id+"&test_action="+t),this.m_nChybySkip=0},p.prototype.AskActionPozriet=function(){var t=this.m_pRozApp;this.Close(),t.m_pRadSelector.SetCelok(),t.OdhodKartu(),t.m_pRadSelector.AddRadObject(this.m_pCoTestujem);for(var e=0,i=this.m_listNedaloSa;e<i.length;e++){var n=i[e];if(n instanceof s.CKarta){t.ChytKartu(n);break}}t.InvalidatePending(),t.InvalidateTriedyView()},p.prototype.ActionAccepted=function(){this.CloseSubDlg(),this.ping_pause=!1},p.prototype.HintFinished=function(){return i.__awaiter(this,void 0,void 0,function(){return i.__generator(this,function(t){switch(t.label){case 0:return this.Close(),[4,this.m_pRozApp.SyncNow()];case 1:return t.sent(),this.m_pRozApp.ClickVerification("verification"),[2]}})})},p);function p(t){var e=d.call(this,t,"test_ping")||this;return e.$flags=[],e.m_bTestFinished=!1,e.m_nKde=[],e.m_nCelkovo=[],e.m_flag=[0,0,0,0,0,0,0],e.m_pCoTestujem=null,e.m_strDetail="",e.m_detailPos=0,e.m_listNedaloSa=[],e.m_nChybySkip=0,e.flagNames=["?",ASC.ttls(1803),m.CUtils.GetTableName("classes"),m.CUtils.GetTableName("teachers"),m.CUtils.GetTableName("subjects"),m.CUtils.GetTableName("students"),m.CUtils.GetTableName("classrooms"),"?"],(e.m_pRozApp.m_pTestGenDlg=e).DoModal({width:512}),e}t.CTestGenDlg=u}),ASC.setModuleSourceFunc("/timetable/app/import.js",function(t,require,e){t.__esModule=!0;var i=(n.prototype.InitTable=function(t){var e=this;this.table=t,this.d_links=this.jsc.d_links,this.UpdateButtons(),this.UpdateLinks(),this.dt(0).subscribe("select scrollEvent",function(){e.UpdateLinks()}),this.dt(1).subscribe("select scrollEvent",function(){e.UpdateLinks()})},n.prototype.Unlink=function(t){for(var e=0,i=this.dt(t).getSelectedRows();e<i.length;e++){var n=i[e];if("link"==n.record.getData("action")){var s=n.record.getData("linkid");if(ASC.strEmpty(s))continue;this.dt(t).ASC_updateRow({id:n.record.getData("id"),action:"ignore",linkid:""}),this.dt(1-t).ASC_updateRow({id:s,action:"ignore",linkid:""})}}},n.prototype.Action=function(t,e){if(-1==t){var i=[this.dt(0),this.dt(1)],n=[i[0].ASC_getSelectedRowsIds(),i[1].ASC_getSelectedRowsIds()];if("link"==e){for(t=0;t<=1;t++)if(1!=n[t].length)return void ASC.ASC_messageBox(ASC.ls(1574));var s=[n[0][0],n[1][0]];for(t=0;t<=1;t++)this.Unlink(t),i[t].ASC_updateRow({id:s[t],action:e,linkid:s[1-t]})}if("unlink"==e)for(t=0;t<=1;t++)this.Unlink(t);"dump"==e&&this.jsc.ASC_action("dump","id0="+(n[0][0]||"")+"&id1="+(n[1][0]||""))}else{this.Unlink(t);var r=this.dt(t);if(0==(s=r.ASC_getSelectedRowsIds()).length)return void ASC.ASC_messageBox(ASC.ls(1574));for(var o=0,a=s;o<a.length;o++){var l=a[o];r.ASC_updateRow({id:l,action:e})}}this.UpdateLinks()},n.prototype.dt=function(t){return this.jsc["dt"+t]},n.prototype.UpdateButtons=function(){for(var t=0;t<=1;t++)for(var e=0,i=["add","remove"];e<i.length;e++){var n=i[e];this.jsc["btn_"+n+t].set("disabled",!this.CanAction(t,n))}this.jsc.btn_link.set("disabled",!this.CanAction(-1,"link"))},n.prototype.CanAction=function(t,e){return"add"==e?!!this.jsc["can"+e+(1-t)]:"remove"!=e||!!this.jsc["can"+e+t]},n.prototype.ClickOK=function(){for(var t=[{},{}],e=0;e<=1;e++)for(var i=0,n=this.dt(e).getRecordSet().getRecords();i<n.length;i++){var s=n[i],r=s.getData("id"),o=s.getData("action");if("ignore"!=o){var a=s.getData("linkid"),l={action:o};"link"==o&&(l.linkid=a),t[e][r]=l}}this.jsc.ASC_action("do","actions="+encodeURIComponent(JSON.stringify(t)))},n.prototype.UpdateLinks=function(){for(var s="<svg style='width:100%;height:100%'>",t=$j(this.d_links),r=t.offset().top+parseInt(t.css("padding-top"))-12,e=function(t,e){var i=t.$tr.offset().top-r,n=e.$tr.offset().top-r;s+="<polyline fill='none' stroke='#008000' stroke-width='3' points='0,"+i+" 5,"+i+" 15,"+n+" 20,"+n+"'/>"},i=0,n=this.dt(0).getSelectedRows();i<n.length;i++)"link"==(c=n[i]).record.getData("action")&&(l=this.dt(1).findDataRow(c.record.getData("linkid")))&&e(c,l);for(var o=0,a=this.dt(1).getSelectedRows();o<a.length;o++){var l,c;"link"==(l=a[o]).record.getData("action")&&(c=this.dt(0).findDataRow(l.record.getData("linkid")))&&e(c,l)}s+="</svg>",t.html(s)},n);function n(t){this.table="",(this.jsc=t).import=this}t.ImportDlg=i}),ASC.setModuleSourceFunc("/timetable/app/dlg.js",function(t,require,e){t.__esModule=!0;var g=require("tslib"),y=require("react"),r=require("./server/ttdoc"),k=require("../../asc/asc_react"),o=require("./online"),C=require("../../asc/datatable_r"),S=require("../../asc/actions"),T=require("../../rpr/dbi_react"),p=require("../../rpr/dbi"),w=require("../../asc/asc_react2"),l=require("./lesson_dlg"),a=require("../../asc/edurequest"),h=require("./ttdoc"),s=require("../../rpr/itemdlg"),_=require("../../react/chooseoption_r");function A(t){var e=t.action;return y.createElement(y.Fragment,null,y.createElement(k.RButton,{content:y.createElement(y.Fragment,null,y.createElement("img",{src:S.action_icon(e),style:{height:16,marginRight:10}}),S.action_name(e)),onClick:t.onClick}),y.createElement("div",{style:{height:8}}))}function n(t){var e,i=this,n=t.app,s=t.isDlg,r=t.table,o=n.ttgpid,a=T.useTTUIDocDBI(o,{needed_part:(e={},e[r]=["short","name","firstname","lastname","color"],e)}),l=k.useStateValueRef([]),c=l.read(),d=a.table(r),m=600,u=500,p=!1,h=[];h.push({key:"icon",label:" ",singleIcon:d.icon(),width:16});function _(t,e){var i={key:t,label:d.column(t).name(),resizable:!0,width:e};return h.push(i),i}switch(r){case"buildings":_("short",80),_("name",200),p=!0,m=600,u=400}var f=1==c.length?function(){return a.frontend.showItemDlg(r,c[0])}:null,v=y.createElement(k.Fragment,null,y.createElement(w.DlgHeader,{title:d.name(),icon:d.icon(),small:!0}),y.createElement("div",{style:{flex:"1 1 100px",display:"flex",flexDirection:"row"}},y.createElement(C.RDatatable,{columns:h,data:a.tableData(r),cssClass:"light-theme",style:{flex:"1 1 100px"},fitWidth:p,selectedIdsRef:l,onRowDoubleClick:f}),y.createElement("div",{className:"full-width",style:{width:150,marginLeft:10}},y.createElement(A,{action:"add",onClick:function(){return a.frontend.showItemDlg(r,"")}}),y.createElement(A,{action:"edit",onClick:f}),y.createElement(A,{action:"delete",onClick:0<c.length?function(){return a.frontend.showRemoveDlg(r,c)}:null})))),b=null;return"buildings"==r&&(b=y.createElement(k.RButton,{label:S.action_name("constraints"),onClick:function(){return g.__awaiter(i,void 0,void 0,function(){var e;return g.__generator(this,function(t){switch(t.label){case 0:return[4,Promise.resolve().then(function(){return require("./constraints")})];case 1:return e=t.sent().BuildingsConstraints,k.RDialog.show(y.createElement(e,{ttgpid:o})),[2]}})})}})),s?y.createElement(k.RDialog,{header:d.name(),width:m,height:u,allowMaximizeBtn:!0,buttons:["close"],footer:b},v):v}function f(t,i,e,n){return"boolean"==typeof n.trackEvent&&(n=g.__assign(g.__assign({},n),{trackEvent:n.trackEvent?void 0:function(t){var e="ObjDlg_"+i;h.trackTTOEvent(e,e+"."+t)}})),s.useItemDlgState0("ttuidocdbi",""+t,i,e,n)}function c(t){var e,i=t.ttgpid,n=t.table,s=t.id,r=t.needed_part,o=t.client_filter,a=t.onValidate,l=t.columns,c=f(i,n,s,{needed_part:p.DBITools.mergeNeededParts((e={},e[n]=g.__spreadArrays(l,["customfields"]),e),r||{}),onValidate:a,client_filter:o,trackEvent:!0}),d=c.dlgRow,m=c.rdlgProps,u=c.header;return y.createElement(k.RDialog,g.__assign({},m),u,y.createElement("div",{style:{flex:"1 1 50px"}},l.map(function(t){return y.createElement(k.Fragment,{key:t},t?"-"==t?y.createElement(w.SeparatorLine,null):y.createElement(T.DlgField,{dlgRow:d,column:t}):y.createElement("div",{style:{height:15}}))})))}function v(t){var i=t.valueRef,e=i.read();return y.createElement(k.RButton,{content:e?y.createElement("img",{src:e,style:{height:32}}):"-",onClick:function(){barNewDialog({source:"/skin/?cmd=ImageBrowser&dgt=timetables",returnFunc:function(t,e){"none"==e&&(e=""),i.write(e)}})}})}function d(t){var e=this,l=t.ttgpid,c=t.id,i=f(l,"subjects",c,{needed_part:{subjects:["name","short","color","metaclassroomids","customfields","picture_url"],metaclassrooms:["__name"]},trackEvent:!0}),d=i.dbi,n=i.rdlgProps,s=i.header,r=i.dlgRow,o=i.rowRef,m=i.row,u=k.useReq();return y.createElement(k.RDialog,g.__assign({},n,{width:550}),s,y.createElement("div",{style:{flex:"1 1 50px"}},y.createElement(T.DlgField,{dlgRow:r,column:"name"}),y.createElement(T.DlgField,{dlgRow:r,column:"short"}),y.createElement(w.SeparatorLine,null),y.createElement(T.DlgField,{dlgRow:r,column:"color"}),y.createElement(k.VGap,{height:3}),y.createElement(k.RLabel,{text:d.column("subjects","picture_url").name()+":"}),y.createElement(v,{valueRef:k.subRef(o,"picture_url")}),y.createElement(w.SeparatorLine,null),y.createElement(T.DlgField,{dlgRow:r,column:"metaclassroomids",after:y.createElement(T.AfterFieldButton,{text:u.ttls(1408),onClick:function(){return g.__awaiter(e,void 0,void 0,function(){var e,i,n,s,r,o,a;return g.__generator(this,function(t){switch(t.label){case 0:return[4,_.showChooseOption({title:u.ttls(1408),subtitle:d.tools.itemName("metaclassrooms",m.metaclassroomids.length)+": "+d.rowNames("metaclassrooms",m.metaclassroomids),options:[{id:"replace",title:u.ttls(1415),details:u.ttls(2528)},{id:"add",title:u.ttls(1416),details:u.ttls(1418)},{id:"setmeta",title:u.ttls(3774),details:u.ttls(4374)}]})];case 1:return(e=t.sent())?[4,ASC.blockUI(u.ttuidocdbi(l,{needed_part:{lessons:["subjectid","metaclassroomidss"]}}))]:[2];case 2:for(i=t.sent(),n=[],s=0,r=i.tableFilterData("lessons",{subjectid:c});s<r.length;s++){switch(o=r[s],a=o.metaclassroomidss,e){case"replace":a=[m.metaclassroomids];break;case"add":a=g.__spreadArrays([p.idsArrayMergeUnique(a[0]||[],m.metaclassroomids)],a.slice(1));break;case"setmeta":a=[["*subject"]]}h.idssArrayMatch(a,o.metaclassroomidss)||n.push({id:o.id,metaclassroomidss:a})}return n.length&&ASC.blockUI(i.backend.updateRows("lessons",n)),[2]}})})}})}),y.createElement("br",null)))}function m(t){var e=f(t.ttgpid,"classrooms",t.id,{needed_part:{classrooms:["name","short","color","classids","sharedroom","needssupervision","nearbyclassroomids","buildingid","customfields"],buildings:["__name"],classes:["__name"]},client_filter:{},trackEvent:!0}),i=e.dbi,n=e.rdlgProps,s=e.header,r=e.dlgRow,o=e.row,a={display:"inline-block",width:200,padding:"4px 0px"};return y.createElement(k.RDialog,g.__assign({},n,{width:470}),s,y.createElement("div",{style:{flex:"1 1 50px"}},y.createElement(T.DlgField,{dlgRow:r,column:"name",label_style:a}),y.createElement(T.DlgField,{dlgRow:r,column:"short",label_style:a}),y.createElement(w.SeparatorLine,null),y.createElement(T.DlgField,{dlgRow:r,column:"classids",label_style:a}),y.createElement(T.DlgField,{dlgRow:r,column:"sharedroom",label_style:a,after:y.createElement(k.RHelpIcon,{topic:237,help:"tt"})}),y.createElement(T.DlgField,{dlgRow:r,column:"needssupervision",label_style:a,after:y.createElement(k.RHelpIcon,{topic:478,help:"tt"})}),y.createElement(k.VGap,{height:5}),y.createElement(T.DlgField,{dlgRow:r,column:"color",label_style:a}),y.createElement(w.SeparatorLine,null),(o.buildingid||0<i.tableData("buildings").length)&&y.createElement(T.DlgField,{dlgRow:r,column:"buildingid",label_style:a}),y.createElement(T.DlgField,{dlgRow:r,column:"nearbyclassroomids",label_style:a}),y.createElement("br",null)))}function b(t){var e=t.mode,i=t.row,n=k.useReq(),s={x1:0,y1:0,x2:105,y2:90},r={x1:4,y1:4,x2:s.x2-4,y2:s.y2-4};return y.createElement("div",{style:{width:s.x2}},y.createElement("div",{style:{}},"screen"==e?n.ls(9392):n.ls(7885),":"),y.createElement("div",{style:{position:"relative"}},y.createElement(k.RBox,g.__assign({},s,{style:{backgroundColor:i.color,border:"1px solid black"}})),y.createElement(k.RTextBox,g.__assign({},r,{text:n.ttls(1440),style:{fontSize:15,color:("screen"==e?i.fontcolorscreen:i.fontcolorprint)||"#000000"},vAlign:"center",hAlign:"center"})),"print"==e&&y.createElement(k.RTextBox,g.__assign({},r,{text:n.ttls(1441),style:{fontSize:13,color:i.fontcolorprint2||"#000000"},vAlign:"bottom",hAlign:"right"}))))}function u(t){var e=t.ttgpid,i=t.id,n=y.useState(!1),s=n[0],r=n[1],o=f(e,"teachers",i,{needed_part:{teachers:["__name","color","fontcolorprint","fontcolorprint2","fontcolorscreen","gender","nameprefix","namesuffix","classroomids"],buildings:["__name"],classes:["__name"],classrooms:["__name"]},trackEvent:!0,onEditingRow:function(t){function e(t){t&&"#000000"!=t&&(n=!0)}var i=t.origrow,n=!1;e(i.fontcolorprint),e(i.fontcolorprint2),e(i.fontcolorscreen),r(n)}}),a=o.rdlgProps,l=o.header,c=o.dlgRow,d=o.row,m=k.useReq(),u={display:"inline-block",width:200,padding:"4px 0px"},p=y.createElement(k.VGap,{height:3});return y.createElement(k.RDialog,g.__assign({},a,{width:s?550:470}),l,y.createElement("div",{style:{flex:"1 1 50px"}},y.createElement(T.DlgField,{dlgRow:c,column:"lastname",label_style:u}),y.createElement(T.DlgField,{dlgRow:c,column:"firstname",label_style:u}),y.createElement(T.DlgField,{dlgRow:c,column:"short",label_style:u}),s?y.createElement(y.Fragment,null,y.createElement(w.SeparatorLine,null),y.createElement("div",{style:{fontWeight:"bold"}},m.ttls(3346),":"),y.createElement("div",{style:{display:"flex",flexDirection:"row"}},y.createElement("div",null,y.createElement(k.RLabel,{text:m.ls(1357)+":",style:u}),y.createElement(T.DBIField,{dlgRow:c,column:"color"}),p,y.createElement(T.DlgField,{dlgRow:c,column:"fontcolorprint",label_style:u}),p,y.createElement(T.DlgField,{dlgRow:c,column:"fontcolorprint2",label_style:u}),p,y.createElement(T.DlgField,{dlgRow:c,column:"fontcolorscreen",label_style:u})),["print","screen"].map(function(t){return y.createElement("div",{key:t,style:{marginLeft:20}},y.createElement(b,{mode:t,row:d}))}))):y.createElement(T.DlgField,{dlgRow:c,column:"color",label_style:u,after:y.createElement(T.AfterFieldButton,{text:m.ttls(3648),onClick:function(){return r(!0)}})}),y.createElement(w.SeparatorLine,null),y.createElement(T.DlgField,{dlgRow:c,column:"gender",label_style:u}),y.createElement(T.DlgField,{dlgRow:c,column:"nameprefix",label_style:u}),y.createElement(T.DlgField,{dlgRow:c,column:"namesuffix",label_style:u}),y.createElement(T.DlgField,{dlgRow:c,column:"classroomids",label_style:u})))}t.UndoRedo=function(t){var e=t.ttgpid,i=T.useTTUIDocDBI(e,{needed_part:{globals:["canundo","canredo"]}}),n=a.client_req,s=i.rowData("globals","1")||{};return y.createElement(y.Fragment,null,y.createElement(k.RButton,{icon:"/timetable/pics/app/office/undo_32.png",title:o.CUtils.StripStringTab(n.ttls(2629)),onClick:s.canundo?function(){return r.ttuidocUndo(null,e)}:void 0}),y.createElement(k.RButton,{icon:"/timetable/pics/app/office/redo_32.png",title:o.CUtils.StripStringTab(n.ttls(2630)),onClick:s.canredo?function(){return r.ttuidocUndo(null,e,!0)}:void 0}))},t.showZadanieDiv=function(e,i){return g.__awaiter(this,void 0,void 0,function(){return g.__generator(this,function(t){switch(t.label){case 0:return[4,k.RDialog.show(y.createElement(n,g.__assign({},{app:e,table:i,isDlg:!0})))];case 1:return t.sent(),[2]}})})},t.useTTUIDocItemDlgState=f,t.ItemDlg=c,t.showItemDlg=function(s,r,o,a){return void 0===a&&(a={}),g.__awaiter(this,void 0,void 0,function(){var e,i,n;return g.__generator(this,function(t){switch(t.label){case 0:switch(e=null,r){case"buildings":return[3,1];case"subjects":return[3,2];case"classrooms":return[3,3];case"teachers":return[3,4];case"students":return[3,5];case"studentsubjects":return[3,7];case"classes":return[3,9];case"lessons":return[3,10]}return[3,11];case 1:return e=y.createElement(c,g.__assign({},{ttgpid:s,table:r,id:o,columns:["name","short","-","color"]})),[3,11];case 2:return e=y.createElement(d,{ttgpid:s,id:o,options:a}),[3,11];case 3:return e=y.createElement(m,{ttgpid:s,id:o,options:a}),[3,11];case 4:return e=y.createElement(u,{ttgpid:s,id:o,options:a}),[3,11];case 5:return[4,Promise.resolve().then(function(){return require("./students_dlg")})];case 6:return i=t.sent().StudentDlg,e=y.createElement(i,{ttgpid:s,id:o,options:a}),[3,11];case 7:return[4,Promise.resolve().then(function(){return require("./students_dlg")})];case 8:return n=t.sent().StudentSubjectDlg,e=y.createElement(n,{ttgpid:s,id:o,options:a}),[3,11];case 9:return e=y.createElement(c,g.__assign({},{ttgpid:s,table:r,id:o,columns:["name","short","","teacherid","-","color","classroomids","grade","","printsubjectpictures"],needed_part:{grades:["__name"],classrooms:["__name"],teachers:["__name"]}})),[3,11];case 10:return e=y.createElement(l.LessonDlg,g.__assign({},{ttgpid:s,id:o,options:{row:a.row}})),[3,11];case 11:return e?[4,k.RDialog.show(e)]:[3,13];case 12:return t.sent(),[3,14];case 13:ASC.dieError("4426492901"),t.label=14;case 14:return[2]}})})},t.showRemoveDlg=function(e,i,n){return g.__awaiter(this,void 0,void 0,function(){return g.__generator(this,function(t){switch(t.label){case 0:return[4,k.RDialog.showConfirm(S.action_name("delete")+(1<n.length?" ("+n.length+")":"")+"?")];case 1:return t.sent()?[4,r.ttuidocRemoveRows(null,e,i,n)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})},t._hotswap=[c,d,m,u,n]}),ASC.setModuleSourceFunc("/timetable/app/server/ttdoc.js",function(t,require,e){e.implementRpc(["ttuidocDBIAccessor","ttuidocAddRows","ttuidocUpdateRows","ttuidocRemoveRows","ttuidocUndo","showBellsInLessonDlg","ttuidocInfo"])}),ASC.setModuleSourceFunc("/timetable/app/lesson_dlg.js",function(t,require,e){t.__esModule=!0;var A=require("tslib"),R=require("react"),I=require("./dlg"),D=require("../../asc/asc_react2"),O=require("../../asc/asc_react"),x=require("../../rpr/dbi"),S=require("../../rpr/vyber"),P=require("./server/ttdoc"),E=require("../../asc/actions"),z=require("./ttdoc"),G=require("../../asc/edurequest"),j=require("../../rpr/dbi_react"),M=require("../../asc/datatable_r"),b=require("./mhodina"),T=require("./rokobject"),V=require("./previewcards"),w=require("../../react/intfield"),U=require("../../react/tablecombomulti"),H=require("../../react/chooseoption_r"),N=235,K=150,$=190,F=100,L=350,B=150,Z=L+B;function J(t,e){if(!e)return{classid:""};if("-"==e)return{classid:"-"};if("seminar:"==e.substr(0,8))return{classid:e.substr(8),seminar:!0};var i=t.rowData("groups",e);return i||ASC.dieError("9170789191",e),{classid:i.classid,division:i.ascttdivision,grow:i}}function W(t,e,i){for(var n=A.__assign(A.__assign({},e),{classids:[],groupids:[],seminargroup:null}),s=0,r=i;s<r.length;s++){var o=r[s];if(o){var a=J(t,o);n.classids=x.idsArrayMergeUnique(n.classids,[a.classid]),a.seminar?n.seminargroup||(n.seminargroup=e.seminargroup||1):n.groupids=x.idsArrayMergeUnique(n.groupids,[o])}}return n}function Y(t,e){for(var i=new Map,n=new Set,s=0,r=e;s<r.length;s++){var o=r[s],a=J(t,o);if(a.classid){if(n.has(o))return!1;n.add(o);var l=a.seminar?"seminar":a.division;if(i.has(a.classid)){if(i.get(a.classid)!=l)return!1}else i.set(a.classid,l)}}return!0}function X(n){var s=n.dbi,r=n.sgroupRef,t=n.mode,e=r.read(),i=J(s,e),o=i.classid,a=i.grow,l=O.makeSimpleValueRef(function(){return o},function(t){var e=n.hint_groupname||(a?a.name:""),i=z.findClassGroup(s,t,e);n.hint_seminar&&(i="seminar:"+t),t||(i=""),r.write(i||z.entireClassGroupid(s,t))});return R.createElement(R.Fragment,null,R.createElement("span",{style:{display:"inline-block",width:$}},R.createElement(O.RComboBox,{valueRef:l,items:function(t,e){var i=[];"more"==e&&i.push({value:"",name:"-"});for(var n=0,s=t.tableData("classes");n<s.length;n++){var r=s[n],o=t.rowName("classes",r.id);i.push({value:r.id,name:o,html:"<span style='display:inline-block;min-width:130px'>"+ASC.escapeHTML(o)+"</span><span style='display:inline-block;min-width:30px'>"+ASC.escapeHTML(r.short)+"</span>"})}"one"==e&&i.push({value:"-",name:ASC.ttls(2825)});return i}(s,t),style:{width:K}})),e&&"-"!=e&&R.createElement(O.RComboBox,{valueRef:r,items:function(t,e){for(var i=t.req,n=[{value:z.entireClassGroupid(t,e),name:i.ls(1904)}],s=0,r=t.tableFilterData("divisions",{classid:e,entireclass:!1});s<r.length;s++){var o=r[s];n.push([]);for(var a=0,l=o.groupids;a<l.length;a++){var c=l[a],d=t.rowData("groups",c);n.push({value:d.id,name:d.name})}}return n.push([]),n.push({value:"seminar:"+e,name:ASC.ttls(2609)}),n}(s,o),style:{width:F}}))}function q(t){return R.createElement("span",{style:{width:t.width,display:"inline-block",verticalAlign:"top"}},void 0!==t.label?R.createElement(R.Fragment,null,t.label||String.fromCharCode(160),R.createElement("br",null)):null,t.children)}function Q(t,e){var i=[];"lg"==e&&i.push({value:"-",name:ASC.ttls(3118)});for(var n=new Map,s=0,r=t.tableIds("teachers");s<r.length;s++){var o=r[s];(h=new b.MHodina(t)).SetPozicia("teachers",o),n.set(o,h)}for(var a=0,l=t.tableData("lessons");a<l.length;a++)for(var c=l[a],d=0,m=c.teacherids;d<m.length;d++){o=m[d];n.get(o).Add("lessons",c.id)}for(var u=0,p=t.tableData("teachers");u<p.length;u++){var h,_=p[u],f=t.rowName("teachers",_.id)+" ("+_.short+")";(h=n.get(_.id)).FinishAdding();var v=h.m_dHodin;i.push({value:_.id,name:f,html:"<span style='display:inline-block;width:16px;height:16px;background-color:"+_.color+";vertical-align:middle;margin-right:5px'/><span style='display:inline-block;width:200px'>"+ASC.escapeHTML(f)+"</span><span style='display:inline-block;width:20px'>"+ASC.escapeHTML(""+v)+"</span>"})}return"dlg"==e&&i.push({value:"-",name:ASC.ttls(3118)}),i}function tt(t){var e=this,i=t.ttgpid,d=G.client_req,n=t.options||{};R.useEffect(function(){return function(t){z.trackTTOEvent("LessonDlg","LessonDlg."+t)}("open")},[]);var s=R.useState(!1),r=s[0],o=s[1],a=R.useState(!1),l=a[0],c=a[1],m=I.useTTUIDocItemDlgState(i,"lessons",t.id,{needed_part:{teachers:["__name","classroomids","color"],subjects:["__name","metaclassroomids"],classes:["__name","classroomids"],classrooms:["__name","sharedroom"],lessons:["subjectid","teacherids","metaclassroomidss","classids","groupids","seminargroup","count","durationperiods","daysdefid","weeksdefid","termsdefid","bell"],groups:["classid","name","entireclass","ascttdivision"],divisions:["classid","groupids","entireclass"],metaclassrooms:["__name"],daysdefs:["__name","vals","typ"],weeksdefs:["__name","vals","typ"],termsdefs:["__name","vals","typ"],bells:["__name"]},blank:{teacherids:[],subjectid:"",classids:[],groupids:[],seminargroup:null,metaclassroomidss:[[]],count:null,durationperiods:1},client_filter:{},onAddingRow:function(t){var e=t.dbi,i=A.__assign({durationperiods:1},n.row);return i.groupids&&0<i.groupids.length&&!i.classids&&(i=W(e,i,i.groupids)),i.weeksdefid||(i.weeksdefid=e.tableFilterData("weeksdefs",{typ:"all"})[0].id),i.termsdefid||(i.termsdefid=e.tableFilterData("termsdefs",{typ:"all"})[0].id),i},onEditingRow:function(t){var e=t.origrow;0==e.teacherids.length&&o(!0),0==e.classids.length&&c(!0)},onValidate:function(s){return A.__awaiter(e,void 0,void 0,function(){var e,i,n;return A.__generator(this,function(t){switch(t.label){case 0:return e=s.row,i=s.adding,n=function(t){O.RDialog.showMessage(t)},0!=e.teacherids.length||r?e.subjectid?e.count?0!=e.classids.length||l||!i?[3,2]:[4,O.RDialog.showConfirm(ASC.ttls(2906))]:(n(ASC.lsf(1840,{f:ASC.ttls(1075)})),[2,!1]):(n(ASC.ttls(3562)),[2,!1]):(n(ASC.ttls(3307)),[2,!1]);case 1:if("ok"!=t.sent())return[2,!1];t.label=2;case 2:return[2,!0]}})})}}),u=m.dbi,p=O.useAsyncMemo(function(){return A.__awaiter(e,void 0,void 0,function(){return A.__generator(this,function(t){return[2,d.memoize("showBellsInLessonDlg",function(){return P.showBellsInLessonDlg(null)})]})})},[],!1),h=m.rowRef,_=h.read(),f=_.teacherids,v=function(n,t){var e=A.__spreadArrays(t.groupids);return t.seminargroup&&t.classids.forEach(function(i){t.groupids.find(function(t){var e=n.rowData("groups",t);return e&&e.classid==i})||e.push("seminar:"+i)}),function(t){return t=t.filter(function(t){return t})}(e)}(u,_);0==v.length&&(v=[l?"-":""]);function b(){return A.__awaiter(e,void 0,void 0,function(){var e;return A.__generator(this,function(t){switch(t.label){case 0:return[4,S.showDBIVyberDlg(u,"teachers",f)];case 1:return(e=t.sent())&&h.update(function(t){return A.__assign(A.__assign({},t),{teacherids:e})}),[2]}})})}function g(){return A.__awaiter(e,void 0,void 0,function(){var e;return A.__generator(this,function(t){switch(t.label){case 0:return[4,O.RDialog.showInput({sgroupids:v,cnt:Math.max(v.length+3,6)},function(t){var e=O.subRef(t.stateRef,"sgroupids"),i=e.read(),n=O.subRef(t.stateRef,"cnt"),s=n.read(),r="",o=!1,a=J(u,i[0]||""),l=a.grow,c=a.seminar;return l&&(r=l.name),c&&(o=c),R.createElement("div",{style:{maxHeight:250,overflow:"auto"}},O.rangeFromTo(0,s-1).map(function(t){return R.createElement("div",{key:""+t,style:{marginBottom:5,border:i[t]&&!Y(u,i.slice(0,t+1))?"2px solid red":void 0}},R.createElement("span",{style:{width:100,display:"inline-block"}},u.tools.itemName("classes")+":"),R.createElement(X,{dbi:u,sgroupRef:O.indexRef(e,t),mode:"more",hint_groupname:r,hint_seminar:o}))}),R.createElement("div",null,R.createElement("span",{style:{width:100,display:"inline-block"}}),R.createElement("a",{style:{cursor:"pointer"},onClick:function(){return n.write(s+3)}},d.ls(1239),"...")))},{width:500,header:ASC.ttls(1108)})];case 1:return(e=t.sent())&&Y(u,e.sgroupids)&&h.update(function(t){return W(u,t,e.sgroupids)}),[2]}})})}var y=O.makeSimpleValueRef(function(){return f[0]||(r?"-":"")},function(e){return h.update(function(t){return"-"==e&&o(!(e="")),A.__assign(A.__assign({},t),{teacherids:e?[e]:[]})})}),k=_.metaclassroomidss,C=O.castRef(h,function(t){return k[0]||[]},function(t,e){return A.__assign(A.__assign({},e),{metaclassroomidss:[t]})});return R.createElement(O.RDialog,A.__assign({},m.rdlgProps,{width:Z+100,footer:R.createElement(q,null,R.createElement(O.RButton,{label:E.action_name("help"),fa_icon:E.action_fa_icon("help"),onClick:function(){return window.open("http://help.asctimetables.com/text.php?id=475","_blank")}}),p&&R.createElement(R.Fragment,null,R.createElement(O.HGap,{width:20}),u.tools.columnName("lessons","bell")+": ",R.createElement(O.RComboBox,{items:u.tools.tableCombo("bells",void 0,ASC.ls(1215)),valueRef:O.subRef(h,"bell")})))}),R.createElement(D.SectionWithIcon,{icon:u.table("teachers").icon()},u.tools.itemName("teachers",f.length||1),R.createElement("br",null),f.length<=1?R.createElement(R.Fragment,null,R.createElement("span",{style:{display:"inline-block",width:L}},R.createElement(O.RComboBox,{valueRef:y,style:{width:N},items:Q(u,"dlg")})),R.createElement(O.RButton,{label:ASC.ttls(1064),style:{width:B},onClick:b})):R.createElement(R.Fragment,null,R.createElement(O.RButton,{label:u.rowNames("teachers",f),style:{width:"auto"},onClick:b}))),R.createElement(D.SeparatorLine,null),R.createElement(D.SectionWithIcon,{icon:u.table("subjects").icon()},R.createElement(q,{label:u.tools.itemName("subjects")},R.createElement(O.RComboBox,{valueRef:O.subRef(h,"subjectid"),items:u.tools.tableCombo("subjects"),style:{width:N}})),_.seminargroup&&R.createElement(R.Fragment,null,R.createElement(O.HGap,{width:10}),R.createElement(q,{label:u.tools.columnName("lessons","seminargroup")},R.createElement(O.RComboBox,{valueRef:O.castRef(O.subRef(h,"seminargroup"),function(t){return t?""+t:""},function(t){return parseInt(t)}),items:O.rangeFromTo(1,200).map(function(t){return{value:""+t,name:""+t}})})))),R.createElement(D.SeparatorLine,null),R.createElement(D.SectionWithIcon,{icon:u.table("classes").icon()},v.length<=1?R.createElement(R.Fragment,null,R.createElement(q,{label:u.tools.itemName("classes")},R.createElement(q,{width:L},R.createElement(X,{dbi:u,sgroupRef:O.makeSimpleValueRef(function(){return v[0]},function(e){"-"==e&&(c(!0),e=""),h.update(function(t){return W(u,t,[e])})}),mode:"one"})),R.createElement(O.RButton,{label:ASC.ttls(3845),style:{width:B},onClick:g}))):R.createElement(R.Fragment,null,R.createElement(O.RButton,{style:{width:Z},label:ASC.ttls(2645)+": "+function(r,t){var o=[];return t.forEach(function(t){var e,i=J(r,t),n=i.classid,s=i.grow;e=i.seminar?ASC.ttls(2609):s.entireclass?"":s.name,o.push(r.rowName("classes",n)+(e?" ("+e+")":""))}),o.join(", ")}(u,v),onClick:g}))),R.createElement(D.SeparatorLine,null),R.createElement(D.SectionWithIcon,{icon:"/global/pics/ui/events_32.svg"},R.createElement(q,{width:L},R.createElement(q,{label:ASC.ttls(1075),width:$},R.createElement(w.default,{valueRef:O.subRef(h,"count"),style:{width:K}})),R.createElement(q,{label:""},R.createElement(O.RComboBox,{valueRef:O.castRef(O.subRef(h,"durationperiods"),function(t){return""+t},function(t){return parseInt(t)}),items:A.__spreadArrays([{value:"1",name:ASC.ttls(2704)},{value:"2",name:ASC.ttls(1645)},{value:"3",name:ASC.ttls(1646)}],O.rangeFromTo(4,T.nMaxDuration).map(function(t){return{value:""+t,name:""+t}})),style:{width:F}}))),R.createElement(q,{label:""},3<u.tableData("weeksdefs").length&&R.createElement(R.Fragment,null,R.createElement(O.RComboBox,{valueRef:O.subRef(h,"weeksdefid"),items:u.tools.tableCombo("weeksdefs","name",null),style:{width:B}}),R.createElement(O.VGap,{height:5})),3<u.tableData("termsdefs").length&&R.createElement(O.RComboBox,{valueRef:O.subRef(h,"termsdefid"),items:u.tools.tableCombo("termsdefs","name",null),style:{width:B}}))),R.createElement(D.SeparatorLine,null),R.createElement(D.SectionWithIcon,{icon:u.table("classrooms").icon()},R.createElement(et,{dbi:u,metaclassroomidsRef:C,row:_,onMoreClassrooms:function(){return A.__awaiter(e,void 0,void 0,function(){var e,i;return A.__generator(this,function(t){switch(t.label){case 0:return[4,O.RDialog.showInput({metaclassroomidss:k},function(t){var n=O.subRef(t.stateRef,"metaclassroomidss"),s=n.read();return R.createElement(R.Fragment,null,R.createElement("div",null,ASC.ttls(2554)+": ",R.createElement(O.RComboBox,{items:O.rangeFromTo(1,7).map(function(t){return{value:""+t,name:""+t}}),valueRef:O.makeSimpleValueRef(function(){return""+s.length},function(t){for(var e=parseInt(t),i=A.__spreadArrays(s);e>i.length;)i.push([]);e<i.length&&(i=i.slice(0,e)),n.write(i)})}),R.createElement(D.SeparatorLine,null)),R.createElement("div",{style:{overflowY:"auto",flex:1}},s.map(function(t,e){return R.createElement(R.Fragment,null,0<e&&R.createElement(D.SeparatorLine,null),R.createElement(q,{label:1+e+"."},R.createElement(et,{dbi:u,metaclassroomidsRef:O.indexRef(n,e),row:_})))})))},{width:550,height:600,header:ASC.ttls(2523)})];case 1:return(e=t.sent())&&(i=e.metaclassroomidss.filter(function(t){return 0<t.length}),h.update(function(t){return A.__assign(A.__assign({},t),{metaclassroomidss:i})})),[2]}})})}})),R.createElement(D.SeparatorLine,null),R.createElement(V.PreviewCards,{ttgpid:i,lrows:[_],singleCards:!0,classid:0<=_.classids.indexOf(n.preferred_classid)?n.preferred_classid:void 0,style:{justifyContent:"center"}}))}function et(t){var e=this,n=G.client_req,s=t.dbi,r=t.metaclassroomidsRef,i=t.row,o=t.onMoreClassrooms,a=function(i,t){var n={"*home":[],"*teacher":[],"*shared":[],"*subject":[]},e=i.rowData("subjects",t.subjectid);return e&&(n["*subject"]=x.idsArrayMergeUnique(n["*subject"],e.metaclassroomids||[])),i.tableData("classrooms").forEach(function(t){t.sharedroom&&n["*shared"].push(t.id)}),t.classids.forEach(function(t){var e=i.rowData("classes",t);e&&(n["*home"]=x.idsArrayMergeUnique(n["*home"],e.classroomids))}),t.teacherids.forEach(function(t){var e=i.rowData("teachers",t);e&&(n["*teacher"]=x.idsArrayMergeUnique(n["*teacher"],e.classroomids))}),n}(s,i),l=r.read(),c=l.filter(function(t){return s.rowData("classrooms",t)});return R.createElement(R.Fragment,null,z.metaclassrooms_linka_def.map(function(t,e){var i=s.rowNames("classrooms",a[t.id],"short");return R.createElement(R.Fragment,{key:""+e},2==e&&R.createElement("br",null),R.createElement("span",{style:{display:"inline-block",width:220,whiteSpace:"pre",overflow:"hidden"},title:i,key:t.id},R.createElement(O.RCheckBox,{valueRef:function(i){return O.castRef(r,function(t){return!!(r.read()||[]).find(function(t){return t==i})},function(t,e){return t?x.idsArrayMergeUnique(e,[i]):e.filter(function(t){return t!=i})})}(t.id),label:n.localize(t.name)+" "+i})))}),R.createElement("br",null),R.createElement(q,{width:L},R.createElement(O.RButton,{style:{width:L-10},label:0<c.length?s.rowNames("metaclassrooms",c,"short"):ASC.ttls(1069),onClick:function(){return A.__awaiter(e,void 0,void 0,function(){var e;return A.__generator(this,function(t){switch(t.label){case 0:return[4,z.showTTDocVyberDlg(s,"metaclassrooms",l)];case 1:return(e=t.sent())&&r.write(e),[2]}})})}})),o&&R.createElement(O.RButton,{style:{width:B},label:ASC.ttls(2523),onClick:o}))}t.teachersCombo=Q,t.LessonDlg=tt,et.needed_part={classrooms:["__name","sharedroom"],metaclassrooms:["__name"],subjects:["metaclassroomids"],classes:["classroomids"],teachers:["classroomids"]};var it=["subjects","classes","classrooms","teachers"],nt={subjects:[],classes:[],classrooms:[],teachers:[]};function i(t){var e,i=this,_=t.ttgpid,f=G.client_req;R.useEffect(function(){return function(t){z.trackTTOEvent("LessonsDlg","LessonsDlg."+t)}("open")},[]);var v=j.useTTUIDocDBI(_,{needed_part:{lessons:["subjectid","classids","groupids","teacherids","seminargroup","classroomidss","metaclassroomidss","count","durationperiods","weeksdefid","termsdefid","daysdefid"],subjects:["__name"],classes:["__name"],groups:["name","classid","ascttdivision","entireclass"],teachers:["__name","color"],classrooms:["__name"],termsdefs:["vals"],weeksdefs:["vals"]}}),b=O.useWorkIndicator(),n=O.useStateValueRef(t.selectedIds||[]),g=n.read(),s=v.table("lessons").name(),r=O.useStateValueRef(nt),o=r.read(),a="",l="";t.subjectid&&(a="subjects",l=t.subjectid),t.classid&&(a="classes",l=t.classid),t.teacherid&&(a="teachers",l=t.teacherid),t.classroomid&&(a="classrooms",l=t.classroomid),a&&(o=A.__assign(A.__assign({},nt),((e={})[a]=[l],e)));for(var c=v.tableData("lessons"),d=function(e){var i=o[e];if(0==i.length)return"continue";c=c.filter(function(t){switch(e){case"subjects":return i.includes(t.subjectid);case"classes":return x.idsIsOverlap(i,t.classids);case"teachers":return x.idsIsOverlap(i,t.teacherids);case"classrooms":return t.classroomidss.find(function(t){return x.idsIsOverlap(t,i)})}return!1})},m=0,u=it;m<u.length;m++){d(u[m])}var p=1;c.forEach(function(t){return p=Math.max(p,t.durationperiods)});p=Math.min(p,3);for(var h=R.useCallback(function(t){var e=t.row,i=20*Math.min(e.durationperiods,3);return R.createElement("span",{style:{whiteSpace:"nowrap"}},R.createElement("span",{style:{display:"inline-block",width:20*p+5}},R.createElement("span",{style:{display:"inline-flex",width:i,height:20,fontSize:10,background:z.strippedBackground(z.ids2colors(v,"teachers",e.teacherids),i,20),color:"#000",justifyContent:"center",alignItems:"center",marginLeft:-5,marginTop:-3,marginBottom:-3,overflow:"hidden"}},v.rowName("subjects",e.subjectid,"short"))),v.rowName("subjects",e.subjectid),e.seminargroup&&" ("+e.seminargroup+")")},[v]),y=function(t){var e=[];t.seminargroup&&e.push(f.ttls(2609));for(var i=0,n=t.groupids;i<n.length;i++){var s=n[i],r=v.rowData("groups",s);r.entireclass||e.indexOf(r.name)<0&&e.push(r.name)}return e.join(", ")},k=[{key:"subjectid",label:v.tools.columnName("lessons","subjectid"),width:120+20*p,formatter:h,sortable:!0,sortFunction:function(t,e){var i=v.rowIndex("subjects",t.subjectid)-v.rowIndex("subjects",e.subjectid);return 0!=i?i:(t.seminargroup||0)-(e.seminargroup||0)}},{key:"teacher",label:v.tools.itemName("teachers"),width:150,formatter:function(t){var e=t.row;return R.createElement(R.Fragment,null,v.rowNames("teachers",e.teacherids))},sortable:!0,sortFunction:function(t,e){return M.compareIds(v,"teachers",t.teacherids,e.teacherids)}},{key:"class",label:v.tools.itemName("classes"),width:100,formatter:function(t){var e=t.row;return R.createElement(R.Fragment,null,v.rowNames("classes",e.classids)," ",y(e))},sortable:!0,sortFunction:function(t,e){var i=M.compareIds(v,"classes",t.classids,e.classids);return 0!=i?i:M.compareStrings(y(t),y(e))}},{key:"count",label:v.tools.columnName("lessons","count"),width:30,sortable:!0},{key:"durationperiods",label:v.tools.columnName("lessons","durationperiods"),width:30,sortable:!0},{key:"classroom",label:v.table("classrooms").name(),width:150,formatter:function(t){var e=t.row;return R.createElement(D.RJoin,{glue:"| "},e.metaclassroomidss.map(function(t,e){return R.createElement(D.RJoin,{glue:", ",key:e},t.map(function(t,e){for(var i=0,n=A.__spreadArrays(z.metaclassrooms_linka_def,z.metaclassrooms_priorita_def);i<n.length;i++){var s=n[i];if(s.id==t)return R.createElement("img",{key:e,src:s.icon,style:{height:12,margin:0},title:f.localize(s.name)})}return v.rowName("classrooms",t,"short")}))}))},sortable:!0,sortFunction:function(t,e){return M.compareIds(v,"classrooms",t.metaclassroomidss[0]||[],e.metaclassroomidss[0]||[])}}],C=function(i){var n=i.substr(0,i.length-1)+"id",t=v.tableData(i);if(t.length<=3)return"continue";var e=t[0].vals[0].length;k.push({key:n,label:v.tools.columnName("lessons",n),width:Math.max(2+11*e,35),formatter:st,sortable:!0,sortFunction:function(t,e){return M.compareId(v,i,t[n],e[n])}})},S=0,T=["weeksdefs","termsdefs"];S<T.length;S++){C(T[S])}function w(t,e){e=A.__assign({},e||{}),"classes"==a&&(e.preferred_classid=l),O.RDialog.show(R.createElement(tt,{ttgpid:_,id:t,options:e}))}return R.useEffect(function(){function t(t){65==t.keyCode&&t.ctrlKey&&(n.write(c.map(function(t){return t.id})),t.preventDefault())}return document.addEventListener("keydown",t),function(){return document.removeEventListener("keydown",t)}}),R.createElement(O.RDialog,{header:s,width:900,height:600,allowMaximizeBtn:!0,buttons:["close"],footer:R.createElement(R.Fragment,null,R.createElement(O.RButton,{label:f.ttls(1058),icon:E.action_icon("add"),onClick:function(){var t={};if(1==o.subjects.length&&(t.subjectid=o.subjects[0]),1==o.classes.length){var e=o.classes[0];t.classids=[e],t.groupids=[z.entireClassGroupid(v,e)]}1==o.teachers.length&&(t.teacherids=[o.teachers[0]]),1==o.classrooms.length&&(t.metaclassroomidss=[[o.classrooms[0]]]),w("",{row:t})}}),R.createElement(O.RButton,{label:f.ttls(1059),icon:E.action_icon("edit"),onClick:1==g.length?function(){return w(g[0])}:void 0}),R.createElement(O.RButton,{label:E.action_name("delete"),icon:E.action_icon("delete"),onClick:0<g.length?function(){return A.__awaiter(i,void 0,void 0,function(){var e;return A.__generator(this,function(t){switch(t.label){case 0:return e=f.ttls(1648),1<g.length&&(e=f.ttls(1159)+" "+g.length+"\n"+e),[4,O.RDialog.showConfirm(e)];case 1:return t.sent()?[4,b(P.ttuidocRemoveRows(null,_,"lessons",g))]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})}:void 0}),R.createElement(O.HGap,{width:30}),R.createElement(O.RButton,{label:f.ttls(2784),icon:"/timetable/pics/app/copy_32.png",onClick:0<g.length?function(){return A.__awaiter(i,void 0,void 0,function(){var e,i,n,s,r,o,a,l,c,d,m,u,p,h;return A.__generator(this,function(t){switch(t.label){case 0:return[4,O.RDialog.showConfirm(R.createElement("h1",null,f.ttls(2784)),{buttons:[{action:"teachers",label:f.ttls(3941),icon:v.table("teachers").icon(),type:"green"},{action:"classes",label:f.ttls(3942),icon:v.table("classes").icon(),type:"green"},"","cancel"],width:400})];case 1:return(e=t.sent())?[4,z.showTTDocVyberDlg(v,e,[])]:[2];case 2:if(!(i=t.sent()))return[2];for(n=[],s=0,r=g;s<r.length;s++)for(o=r[s],a=v.rowData("lessons",o),l=0,c=i;l<c.length;l++)d=c[l],delete(m=A.__assign({},a)).id,delete m.ascttchrid,"teachers"==e&&(m.teacherids=[d]),"classes"==e&&(m.classids=[d],m.seminargroup?m.groupids=[]:(u=v.rowData("groups",a.groupids[0]),p=u?u.name:"",h=(h=v.tableFilterData("groups",{classid:d,name:p})[0])||v.tableFilterData("groups",{classid:d,entireclass:!0})[0],m.groupids=[h.id])),n.push(m);return n&&b(P.ttuidocAddRows(null,_,"lessons",n)),[2]}})})}:void 0}),!a&&R.createElement(R.Fragment,null,R.createElement(O.RButton,{label:f.ttls(2785),icon:"/timetable/pics/app/office/change_32.png",onClick:0<g.length&&function(){return function(u,p){return A.__awaiter(this,void 0,void 0,function(){var n,e,s,i,r,o,a,l,c,d,m;return A.__generator(this,function(t){switch(t.label){case 0:return n=G.client_req,e=["metaclassroomidss","subjectid","teacherids","termsdefid","weeksdefid","daysdefid","count","durationperiods","maxstudents"],[4,ASC.blockUI(n.ttuidocdbi(u,{needed_part:x.DBITools.mergeNeededParts({lessons:A.__spreadArrays(e),subjects:["__name"],teachers:["__name"],classes:["__name"],classrooms:["__name"],termsdefs:["__name"],weeksdefs:["__name"],daysdefs:["__name"]},et)}))];case 1:return s=t.sent(),(i=s.rowData("lessons",p[0]))||ASC.dieError("8559052026"),[4,H.showChooseOption({title:n.ttls(2785),subtitle:n.ls(8056)+": "+p.length+" "+s.tools.itemName("lessons",p.length),options:A.__spreadArrays(e.map(function(t){return{id:t,title:s.tools.columnName("lessons",t)}}))})];case 2:return(r=t.sent())?(o=s.column("lessons",r))?(a=r,[4,O.RDialog.showInput({row:A.__assign(A.__assign({},i),{metaclassroomidss:[i.metaclassroomidss[0]||[]]}),mode:"replace"},function(t){var e=O.subRef(t.stateRef,"row"),i={dbi:s,table:"lessons",rowRef:e};return"metaclassroomidss"==a?R.createElement("div",null,R.createElement(et,{dbi:s,metaclassroomidsRef:O.indexRef(O.subRef(e,"metaclassroomidss"),0),row:{subjectid:"",classids:[],teacherids:[]}}),R.createElement(O.VGap,{height:20}),R.createElement(O.RComboBox,{valueRef:O.subRef(t.stateRef,"mode"),items:[{value:"replace",name:n.ttls(1415)},{value:"add",name:n.ttls(1416)}]})):R.createElement("div",null,R.createElement(j.DBIField,{dlgRow:i,column:a}))},{header:n.ttls(2785)+": "+o.name(),width:500})]):[3,5]:[2];case 3:if(!(l=t.sent()))return[2];switch(c=l.row[a],a){case"subjectid":case"termsdefid":case"weeksdefid":case"daysdefid":if(!c)return[2]}return d=p.map(function(t){var e;return(e={id:t})[a]=c,e}),"metaclassroomidss"==a&&"add"==l.mode&&(m=c[0]||[],d=p.map(function(t){var e=s.rowData("lessons",t);return{id:t,metaclassroomidss:A.__spreadArrays([x.idsArrayMergeUnique(e.metaclassroomidss[0]||[],m)],e.metaclassroomidss.slice(1))}})),[4,ASC.blockUI(s.backend.updateRows("lessons",d))];case 4:return t.sent(),[2];case 5:return[2]}})})}(_,g)}})),R.createElement(O.HGap,{width:30}),R.createElement(I.UndoRedo,{ttgpid:_}))},a?R.createElement(D.DlgHeader,{title:v.rowName(a,l),subtitle:v.rowName(a,l,"short"),icon:v.table(a).icon()}):R.createElement(D.DlgHeader,{title:v.table("lessons").name(),icon:v.table("lessons").icon(),right:R.createElement(R.Fragment,null,R.createElement("img",{src:"/global/pics/ui/filter_32.svg",style:{height:24,marginRight:5}}),it.map(function(t){return R.createElement(R.Fragment,{key:t},R.createElement("img",{src:v.table(t).icon(),style:{height:16,marginRight:3,marginLeft:8}}),R.createElement(U.default,{dbi:v,table:t,valueRef:O.subRef(r,t),style:{maxWidth:200},quickSelect:!0}))}))}),R.createElement(M.RDatatable,{data:c,columns:k,sortedBy:[{key:"subjectid",dir:"asc"},{key:"class",dir:"asc"}],style:{flex:"1 1 10px"},selectedIdsRef:n,onRowDoubleClick:function(t){return w(t.id)},dbi:v,fitWidth:!0,cssClass:"compact light-theme"}),0<=["classes","teachers"].indexOf(a)&&R.createElement(V.PreviewCards,{ttgpid:_,lrows:c,selected:g.length?c.filter(function(t){return 0<=g.indexOf(t.id)}):null,classid:t.classid,teacherid:t.teacherid,style:{marginTop:3,marginBottom:-8,justifyContent:"start"},onClickLrow:function(t){return n.write([t.id])}}))}function st(t){var e=t.row,i=t.dbi,n=t.cd.key,s=n.substr(0,n.length-2)+"s",r=i.rowData(s,e[n]);if(!r)return null;var o=r.vals;if(1==o.length&&o[0].indexOf("0")<0)return null;var a=o[0].length;return R.createElement(R.Fragment,null,O.rangeFromTo(0,a-1).map(function(t){for(var e=!1,i=!1,n=0,s=o;n<s.length;n++){"1"==s[n][t]?i=!0:e=!0}return R.createElement("span",{key:""+t,style:{display:"inline-block",width:12,height:12,boxSizing:"border-box",border:"1px solid #000",boxShadow:"inset 0px 0px 0px 1px #fff",backgroundColor:e?i?"#aaa":"#fff":"#000",marginLeft:0<t?-1:void 0}})}))}t.showLessonsDlg=function(t,e){void 0===e&&(e={}),O.RDialog.show(R.createElement(i,A.__assign({ttgpid:t},e)))},t._hotswap=[i]}),ASC.setModuleSourceFunc("/timetable/app/mhodina.js",function(t,require,e){t.__esModule=!0;var M=require("../../rpr/dbi"),r=require("./rokobject"),V=require("./ttdoc");function i(t){for(var e=0,i=0;i<t.length;i++)"1"==t[i]&&e++;return e}function n(t){return i(t)/t.length}t.pocetBitov=i,t.pokrytieBitov=n;var s=(h.prototype.Clear=function(){for(var t in this.m_ModeTable="",this.m_Pozicia)this.m_Pozicia[t]="";for(var t in this.m_Objects)this.m_Objects[t]=[];this.m_dHodin=0,this.divisionid=""},h.prototype.SetPozicia=function(t,e){null==this.m_Pozicia[t]&&ASC.dieError("5233456288"),this.m_Pozicia[t]=e},h.prototype.Add0=function(t,e){var i=this.m_Objects[t];i||ASC.dieError("4033334670"),i.indexOf(e)<0&&i.push(e)},h.prototype.Add=function(t,e){this.m_ModeTable?this.m_ModeTable!=t&&ASC.dieError("0137113310"):this.m_ModeTable=t,this.Add0(t,e)},h.prototype.AddList=function(t,e){for(var i=0,n=e;i<n.length;i++){var s=n[i];this.Add(t,s)}},h.prototype.FinishAdding=function(){for(var t=this.dbi,e=this.m_dHodin=0,i=this.m_Objects.lessons;e<i.length;e++){var n=i[e],s=t.rowData("lessons",n);this.m_Objects.teachers=M.idsArrayMergeUnique(this.m_Objects.teachers,s.teacherids),this.m_Objects.classes=M.idsArrayMergeUnique(this.m_Objects.classes,s.classids),this.m_Objects.subjects=M.idsArrayMergeUnique(this.m_Objects.subjects,[s.subjectid]),this.m_dHodin+=this.DHodin(s)}var r=this.m_Pozicia.classes,o=this.lrows();if(r){this.m_dHodin=0;for(var a=[],l=new Map,c=[],d=[],m=0,u=o;m<u.length;m++){for(var p=!1,h=0,_=(s=u[m]).groupids;h<_.length;h++){var f=_[h],v=t.rowData("groups",f);if(v.classid==r){p=!0;var b=v.ascttdivision;a.indexOf(b)<0&&a.push(b),(T=l.get(f))||(T=[],l.set(f,T)),T.push(s)}}s.seminargroup&&!p&&(c.indexOf(s.seminargroup)&&c.push(s.seminargroup),d.indexOf(s.subjectid)<0&&d.push(s.subjectid))}for(var g=0,y=a;g<y.length;g++){b=y[g];for(var k=-1,C=0,S=t.rowData("divisions",r+":"+b).groupids;C<S.length;C++){f=S[C];var T,w=0;if(T=l.get(f))for(var A=0,R=T;A<R.length;A++)s=R[A],w+=this.DHodin(s);k<0?k=w:k!=w&&(this.m_bRoznePoctyHodin=!0,k=Math.max(k,w))}this.m_dHodin+=k}this.divisionid=1==a.length?r+":"+a[0]:"";for(var I=0,D=d;I<D.length;I++){for(var O=D[I],x=0,P=0,E=c;P<E.length;P++){for(var z=E[P],G=w=0,j=o;G<j.length;G++)(s=j[G]).subjectid==O&&s.seminargroup==z&&(V.lessonSeminarClasses(t,s).indexOf(r)<0||(w+=this.DHodin(s)));x=Math.max(x,w)}this.m_dHodin+=x,this.m_bRoznePoctyHodin=!0}}},h.prototype.DivisionGroupsMH=function(){var o=this,a=this.dbi,t=this.divisionid;if(!t)return null;for(var e=a.rowData("divisions",t).groupids,i=e.map(function(t){for(var e=new h(a),i=0,n=["classes","subjects"];i<n.length;i++){var s=n[i],r=o.m_Pozicia[s];r&&e.SetPozicia(s,r)}return e.SetPozicia("groups",t),e}),n=0,s=this.m_Objects.lessons;n<s.length;n++)for(var r=s[n],l=0,c=a.rowData("lessons",r).groupids;l<c.length;l++){var d=c[l],m=e.indexOf(d);m<0||i[m].Add("lessons",r)}for(var u=0,p=i;u<p.length;u++)p[u].FinishAdding();return i},h.prototype.lrows=function(){var e=this;return this.m_Objects.lessons.map(function(t){return e.dbi.rowData("lessons",t)})},h.prototype.getDurationCounts=function(){if(!this.RovnakeHodinyOkremPoctuADlzky())return null;for(var t={},e=0,i=this.lrows();e<i.length;e++){var n=i[e],s=n.durationperiods;t[s]=(t[s]||0)+n.count}return t},h.prototype.getGroupName=function(){var t=this.dbi.rowData("groups",this.m_Pozicia.groups);return!t||t.entireclass?"":t.name},h.durationCountsStr=function(t){var e=0,i=0,n=0;for(var s in t)(a=t[o=parseInt(s)])&&(e++,i=Math.max(i,o),n+=a*o);if(0==e||0==n)return"";if(1==e){if(1==i)return n<=20?""+n:"="+n;if(1==t[i])return n+"*"}for(var r="",o=i;0<o;o--){var a;if(a=t[o])for(var l=0;l<a;l++)r+=o}return r},h.parseDurationCounts=function(t){var e;if(!t)return null;if(/^[0-9]{1,2}$/.test(t)&&1<=(s=parseInt(t))&&s<=20)return{1:s};if(/^[1-9]\*$/.test(t)&&1<=(s=parseInt(t))&&s<=r.nMaxDuration)return(e={})[s]=1,e;if(/^=[0-9]{1,2}$/.test(t)&&1<=(s=parseInt(t.substring(1)))&&s<=50)return{1:s};for(var i={},n=0;n<t.length;n++){var s;if(!(1<=(s=parseInt(t[n]))&&s<=8))return null;i[s]=(i[s]||0)+1}return i},h.prototype.RovnakeHodinyOkremPoctuADlzky=function(){if(0==this.m_Objects.lessons.length)return!1;for(var t=null,e=0,i=this.lrows();e<i.length;e++){var n=i[e];if(t){if(t.subjectid!=n.subjectid)return!1;if(!M.idsArrayMatchI(t.groupids,n.groupids))return!1;if(!M.idsArrayMatchI(t.classids,n.classids))return!1;if(t.seminargroup!=n.seminargroup)return!1;if(!M.idsArrayMatchI(t.teacherids,n.teacherids))return!1;if(t.metaclassroomidss.length!=n.metaclassroomidss.length)return!1;for(var s=0;s<t.metaclassroomidss.length;s++)if(!M.idsArrayMatchI(t.metaclassroomidss[s],n.metaclassroomidss[s]))return!1}else t=n}return!0},h.prototype.GetDlgPocet=function(){var t=this.DivisionGroupsMH();if(!t)return"";for(var e="",i=0,n=t;i<n.length;i++){var s=n[i];if(s){var r=s.getDurationCounts();if(!r)return"";var o=h.durationCountsStr(r);if(e){if(o!=e)return""}else e=o}}return e},h.prototype.GetText=function(t,e){switch(t){case"count":var i=this.m_dHodin.toLocaleString("en-US",{maximumFractionDigits:2});return this.m_bRoznePoctyHodin&&(i="*"+i),i;case"subjects":case"classes":case"teachers":return this.dbi.rowNames(t,this.m_Objects[t],e)}return""},h.prototype.GetFarby=function(t){switch(t){case"teachers":return V.ids2colors(this.dbi,t,this.m_Objects[t])}return[]},h.prototype.isEmpty=function(){return!this.m_ModeTable||0==this.m_Objects[this.m_ModeTable].length},h.prototype.DHodin=function(t){return n(this.obdobieSample("termsdefs",t.termsdefid))*n(this.obdobieSample("weeksdefs",t.weeksdefid))*i(this.obdobieSample("daysdefs",t.daysdefid))*t.count*t.durationperiods},h.prototype.obdobieSample=function(t,e){var i=this.dbi.rowData(t,e);return i?i.vals[0]:"1"},h.needed_part={lessons:["subjectid","classids","teacherids","groupids","seminargroup","count","durationperiods","termsdefid","weeksdefid","daysdefid"],groups:["classid","entireclass","ascttdivision","name"],divisions:["classid","ascttdivision","groupids"],termsdefs:["vals"],weeksdefs:["vals"],daysdefs:["vals"]},h);function h(t){this.dbi=t,this.m_ModeTable="",this.m_Pozicia={teachers:"",classes:"",groups:"",subjects:""},this.m_Objects={lessons:[],teachers:[],classes:[],subjects:[]},this.m_dHodin=0,this.m_bRoznePoctyHodin=!1,this.divisionid="",this.Clear()}t.MHodina=s,t.groupsBits=function(t,e,i){for(var n=0,s=i;n<s.length;n++){var r=s[n],o=t.rowData("groups",r);if(o&&o.classid==e){for(var a="",l=0,c=t.rowData("divisions",o.classid+":"+o.ascttdivision).groupids;l<c.length;l++){var d=c[l];a+=0<=i.indexOf(d)?"1":"0"}return a}}return"1"}}),ASC.setModuleSourceFunc("/timetable/app/previewcards.js",function(t,require,e){t.__esModule=!0;var o=require("tslib"),y=require("react"),a=require("../../rpr/dbi_react"),l=require("../../asc/asc_react"),k=require("./mhodina"),C=require("./ttdoc");t.PreviewCards=function(t){var e=t.ttgpid,n=t.singleCards,_=t.onMouseLrow,f=t.onClickLrow,s=t.selected,v=t.classid,b=t.teacherid,g=a.useTTUIDocDBI(e,{needed_part:{subjects:["short"],teachers:["short","color"],classes:[],groups:["classid","ascttdivision"],divisions:["classid","groupids"]}}),i=t.lrows.filter(function(t){return t});i.sort(function(t,e){var i;return 0!=(i=g.rowIndex("subjects",t.subjectid)-g.rowIndex("subjects",e.subjectid))?i:0!=(i=g.rowIndex("classes",t.classids[0])-g.rowIndex("classes",e.classids[0]))?i:e.durationperiods-t.durationperiods});var r=y.useCallback(function(t){for(var e=t.lrow,i=t.repeat,n=t.gray,s=e.teacherids.map(function(t){return(g.rowData("teachers",t)||{}).color}),r=28*e.durationperiods,o=k.groupsBits(g,v||e.classids[0],e.groupids),a=[],l=b?g.rowNames("classes",e.classids,"short"):g.rowName("subjects",e.subjectid,"short"),c=o.length,d=0;d<c;)if("0"!=o[d]){for(var m=d+1;"1"==o[m];)m++;var u=(m-d)/c*28;a.push(y.createElement("div",{key:""+d,style:{display:"flex",flexDirection:"column",justifyContent:"center",textAlign:"center",position:"absolute",left:0,right:0,top:d/c*28,height:u,background:C.strippedBackground(s,r,u),fontSize:Math.min(u,11),overflow:"hidden"}},l)),d=m}else d++;for(var p=null,h=1;h<Math.min(i,6);h++)p=y.createElement("div",{className:"viac",style:{opacity:1==h&&6<=i?.5:void 0}},p);return y.createElement("div",{className:"rvcard",style:{display:"inline-block",position:"relative",boxSizing:"content-box",width:r,height:28,filter:n?"grayscale(100%) contrast(33%) brightness(1.333)":void 0,cursor:f?"pointer":void 0},onMouseEnter:function(){_&&_(e)},onMouseLeave:function(){_&&_(null)},onClick:function(){f&&f(e)}},a,p)},[g,[]]);return y.createElement("div",{style:o.__assign({padding:5,display:"flex",flexDirection:"row",height:30,overflow:"hidden"},t.style||{})},i.map(function(e,t){if(!e)return null;var i=!!s&&s.indexOf(e)<0;return y.createElement(y.Fragment,{key:""+t},0<t&&y.createElement(l.HGap,{width:n?15:10}),n?l.rangeFromTo(1,e.count).map(function(t){return y.createElement(y.Fragment,{key:""+t},0<t&&y.createElement(l.HGap,{width:10}),y.createElement(r,{lrow:e,key:""+t,gray:i}))}):y.createElement(r,{lrow:e,repeat:e.count,gray:i}))}))}}),ASC.setModuleSourceFunc("/react/intfield.js",function(t,require,e){t.__esModule=!0;var i=require("tslib"),n=require("../asc/asc_react"),s=require("react");t.default=function(t){return s.createElement(n.RInput,{valueRef:n.castRef(t.valueRef,function(t){return null==t?"":""+t},function(t){if(""==(t=t.trim()))return null;var e=parseInt(t);return isNaN(e)&&(e=null),e}),style:i.__assign({width:46},t.style)})}}),ASC.setModuleSourceFunc("/react/tablecombomulti.js",function(t,require,e){t.__esModule=!0;var u=require("tslib"),p=require("react");t.default=function(i){function n(){return u.__awaiter(t,void 0,void 0,function(){var e;return u.__generator(this,function(t){switch(t.label){case 0:return[4,s.frontend.showVyberDlg(r,l)];case 1:return(e=t.sent())&&o.write(e),[2]}})})}var t=this,s=i.dbi,r=i.table,o=i.valueRef,a=s.req,l=o.read(),c=p.useRef(),d=s.tableIds(r),m=s.column(r,"lastname")?a.sort_name_col:void 0;return p.createElement("div",{ref:c,className:"dropDownBtn asc-combo",style:i.style,onClick:function(e){return u.__awaiter(t,void 0,void 0,function(){return u.__generator(this,function(t){return e.preventDefault(),e.stopPropagation(),i.quickSelect&&l.length<=1?ASC.showContextMenu(u.__spreadArrays([{text:"-",onclick:function(){return o.write([])},selected:0==l.length},[]],d.map(function(t){return{text:s.rowName(r,t,m),onclick:function(){return o.write([t])},selected:t==l[0]}}),[[],{text:a.ls(1239),onclick:n}]),e,c.current):n(),[2]})})}},p.createElement("a",{href:"#"},p.createElement("span",{className:"button-title"},s.rowNames(r,o.read(),i.name_col||"short").trim()||"-")))}}),ASC.setModuleSourceFunc("/react/chooseoption_r.js",function(t,require,e){t.__esModule=!0;var s=require("tslib"),r=require("react"),o=require("../asc/asc_react"),a=require("../asc/asc_react2");function l(t){var e=o.useHover(),i=e[0],n=e[1];return r.createElement("div",s.__assign({},n,{style:{fontSize:16,padding:10,border:"1px solid "+(i?"#808080":"transparent")},onClick:t.onClick}),r.createElement("i",{className:"fa fa-arrow-right",style:{marginRight:10}}),t.title,r.createElement("div",{style:{fontSize:12,marginLeft:23}},t.details))}t.showChooseOption=function e(n){return s.__awaiter(this,void 0,void 0,function(){var i;return s.__generator(this,function(t){switch(t.label){case 0:return i=r.createRef(),[4,o.RDialog.show(r.createElement(o.RDialog,{ref:i,width:600,buttons:["cancel"],srcFunction:e},r.createElement(a.DlgHeader,{title:n.title,subtitle:n.subtitle,icon:n.icon||"/global/pics/ui/info_32.svg",small:!0}),r.createElement("div",{style:{paddingLeft:30}},n.options.map(function(t,e){return r.createElement(l,{key:e,title:t.title,details:t.details,onClick:function(){i.current.confirmClose(t.id),t.onClick&&t.onClick()}})}))))];case 1:return[2,t.sent()]}})})}}),ASC.setModuleSourceFunc("/timetable/app/gener.js",function(t,require,e){t.__esModule=!0;var _=require("tslib"),f=require("../../asc/asc_react"),v=require("react"),s=require("../../asc/edurequest"),b=require("../../asc/asc_react2"),m=require("./ttdoc"),u=require("./server/generator"),g=require("../../rpr/dbi_react"),y=require("./dlg"),l=require("./chybygrid"),r=require("../../react/chooseoption_r"),c="/timetable/pics/app/gener_uspech_64.svg",d="/timetable/pics/app/gener_zlavene_64.svg",p="/timetable/pics/app/gener_fail_64.svg";function o(t){return{title:t.split("\n")[0],details:t.split("\n",2)[1]}}function a(n){return _.__awaiter(this,void 0,void 0,function(){var e,i;return _.__generator(this,function(t){switch(t.label){case 0:return e=s.client_req,[4,r.showChooseOption({title:e.ttls(4314),options:[_.__assign({id:"full"},o(e.ttls(4315))),_.__assign({id:"finish"},o(e.ttls(4316))),_.__assign({id:"optimize"},o(e.ttls(4317)))]})];case 1:switch(i=t.sent(),i){case"full":return[3,2];case"finish":return[3,4];case"optimize":return[3,6]}return[3,8];case 2:return[4,R(n)];case 3:return t.sent(),[3,8];case 4:return[4,R(n,{dopocitat:!0})];case 5:return t.sent(),[3,8];case 6:return[4,A(n)];case 7:return t.sent(),[3,8];case 8:return[2]}})})}function h(n,s){return _.__awaiter(this,void 0,void 0,function(){var e,i;return _.__generator(this,function(t){switch(t.label){case 0:return e=v.createRef(),[4,f.RDialog.show(v.createElement(S,_.__assign({},s,{result_ref:e,ttgpid:n})))];case 1:return t.sent(),i=e.current,console.log(i),0==i.nNeumiestnenych&&0==i.nZliav?[2]:[4,f.RDialog.show(v.createElement(O,{ttgpid:n,result:i}))];case 2:return t.sent(),[2]}})})}function k(l,c,d,m){return void 0===m&&(m=null),_.__awaiter(this,void 0,void 0,function(){var e,i,n,s,r,o,a;return _.__generator(this,function(t){switch(t.label){case 0:return i=null,(e=function(t){})("STARTING"),[4,u.generatorStart(m,l,{tcg:c.tcg,zlozitost:c.zlozitost,allowZlavnenie:c.allowZlavnenie,dopocitat:c.dopocitat,ibaOptimize:c.ibaOptimize,sel:c.sel,strAutoGenerParams:c.strAutoGenerParams,engineid:c.engineid})];case 1:n=t.sent(),s=0,t.label=2;case 2:return[4,function(e){return new Promise(function(t){return setTimeout(t,e)})}(500)];case 3:return t.sent(),(r=d.current)&&"finishquickly"!=r?(e("STOPPING"),[4,u.generatorStop(m,n)]):[3,5];case 4:return t.sent(),[3,11];case 5:return t.trys.push([5,9,,10]),e("PINGING"),[4,u.generatorPing(m,n,"finishquickly"==r)];case 6:return o=t.sent(),e(o),o.generating&&c.onPing&&c.onPing(o.generating),o.result?(i=o.result,e("STOPPING"),[4,u.generatorStop(m,n)]):[3,8];case 7:return t.sent(),[3,11];case 8:return s=0,[3,10];case 9:return a=t.sent(),console.log(a),100<++s?(ASC.logProblem("6090573066"),[3,11]):(c.onError&&c.onError(""+a),[3,10]);case 10:return[3,2];case 11:return[2,i]}})})}function C(n,s){var r=v.useRef(),t=v.useState(""),e=t[0],o=t[1],i=v.useState(null),a=i[0],l=i[1],c=f.useWorkIndicator();return v.useEffect(function(){return c(function(){return _.__awaiter(this,void 0,void 0,function(){var e,i;return _.__generator(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,k(n,_.__assign(_.__assign({},s),{onPing:function(t){l(t),o(""),s.onPing&&s.onPing(t)},onError:function(t){o(t),s.onError&&s.onError(t)}}),r)];case 1:return e=t.sent(),s.onEnd(e),[3,3];case 2:return i=t.sent(),ASC.showError(i),s.onEnd(null),[3,3];case 3:return[2]}})})}()),function(){return r.current="stop"}},[]),{error:e,generating:a,cancelGener:function(){return r.current="stop"},finishQuickly:function(){return r.current="finishquickly"}}}function S(e){var t=f.useReq(),i=e.ttgpid,n=e.tcg,s=void 0===e.zlozitost?1:e.zlozitost,r=e.allowZlavnenie,o=v.useRef(),a=C(i,{tcg:n,zlozitost:s,allowZlavnenie:r,onEnd:function(t){e.result_ref.current=t,o.current.close()}}),l=a.generating,c=a.error,d=a.cancelGener;return v.useEffect(function(){return m.trackTTOEvent("MiniGenerProgressDlg","opened")},[]),v.createElement(f.RDialog,{ref:o,header:t.ttls(1129),buttons:["cancel"],footer:v.createElement(v.Fragment,null,l&&v.createElement("span",{style:{color:"#c0c0c0"}},"Speed: ",l.m_nRychlost)),onCancel:function(){return d()}},v.createElement("div",null,v.createElement(f.VGap,{height:10}),v.createElement("div",{style:{border:"1px solid #808080",height:15,boxSizing:"border-box"}},l&&v.createElement("div",{style:{width:100*l.p2+"%",height:"100%",background:"#808080"}})),c&&v.createElement("span",{style:{color:"red"}},c)))}function T(e){var t=e.ttgpid,i=e.sel,n=f.useReq(),s=v.useRef(),r=C(t,{dopocitat:e.dopocitat,ibaOptimize:e.ibaOptimize,sel:i,onEnd:function(t){e.result_ref.current=t,s.current.close()}}),o=r.generating,a=r.error,l=r.cancelGener,c=r.finishQuickly;v.useEffect(function(){return m.trackTTOEvent("GenerProgressDlg","opened")},[]);var d=v.useCallback(function(t){return v.createElement("div",{style:{border:"1px solid black",borderTopColor:"white",borderLeftColor:"white",height:14,marginBottom:2,backgroundColor:"#c0c0c0",fontSize:12,paddingRight:4,position:"relative"}},v.createElement("div",{style:{backgroundColor:t.barColor||"#8080ff",position:"absolute",left:0,top:0,bottom:0,width:Math.min(100*t.pos,100)+"%"}}),v.createElement("img",{style:{position:"absolute",left:-20,top:0,height:"100%"},src:t.icon}),v.createElement("div",{style:{position:"absolute",left:3,top:0,fontSize:12}},t.text))},[]);return v.createElement(f.RDialog,{ref:s,onCancel:function(){return function(){return _.__awaiter(this,void 0,void 0,function(){function e(){i.current.close()}var i;return _.__generator(this,function(t){return i=v.createRef(),f.RDialog.show(v.createElement(f.RDialog,{ref:i,header:n.ttls(1079),width:400,buttons:[],footer:v.createElement(v.Fragment,null,v.createElement(f.RButton,{label:n.ttls(1007),onClick:function(){e(),l()}}),v.createElement(f.RButton,{label:n.ttls(1488),onClick:function(){e(),c()}}),v.createElement(f.RButton,{label:n.ttls(1486),onClick:function(){e()}}))},v.createElement("div",null,n.ttls(1487)))),[2]})})}()},buttons:["cancel"],header:n.ttls(1129),width:375,footer:i&&v.createElement(E,{ttgpid:t,sel:i})},v.createElement("div",{style:{marginTop:5,height:100,position:"relative"}},v.createElement("div",{style:{position:"absolute",left:0,top:0,width:80,height:80,border:"1px solid #808080",overflow:"hidden"}},v.createElement("img",{style:{paddingTop:20},src:"/timetable/pics/app/gener.gif"})),v.createElement("div",{style:{position:"absolute",left:130,width:120}},o&&v.createElement(v.Fragment,null,v.createElement(d,{text:o.m_nRychlost,pos:(Math.log(Math.max(1,o.m_nRychlost))/Math.LN10-2)/4,icon:"/timetable/pics/app/office/timeoff_32.png",barColor:"#80ff80"}),v.createElement(d,{text:o.p_VykaslalSa,pos:o.p_VykaslalSa/20,icon:"/timetable/pics/app/relations/importance_strict_16.png",barColor:"#ff8080"}),v.createElement(d,{text:o.p_IZ_high,pos:o.p_IZ_high/20,icon:"/timetable/pics/app/relations/importance_high_16.png"}),v.createElement(d,{text:o.p_IZ_normal,pos:o.p_IZ_normal/20,icon:"/timetable/pics/app/relations/importance_normal_16.png"}),v.createElement(d,{text:o.p_IZ_low,pos:o.p_IZ_low/20,icon:"/timetable/pics/app/relations/importance_low_16.png"})))),v.createElement("div",null,n.ttls(1131)),v.createElement(w,{pos:o?o.p1:0}),v.createElement(w,{pos:o?o.p2:0}),v.createElement("div",{style:{marginTop:5,color:"#808080"}},n.ls(1345),": ",v.createElement(D,null)),a&&v.createElement("div",{style:{color:"red"}},a))}function w(t){return v.createElement("div",{style:_.__assign({border:"1px solid #b2b2b2",borderRadius:2,position:"relative",height:16,marginTop:5,marginBottom:5},t.style||{})},v.createElement("div",{style:{position:"absolute",left:0,top:0,bottom:0,width:Math.min(100*t.pos,100)+"%",backgroundColor:"#01d429"}}))}function A(e){return _.__awaiter(this,void 0,void 0,function(){return _.__generator(this,function(t){switch(t.label){case 0:return[4,R(e,{ibaOptimize:!0})];case 1:return t.sent(),[2]}})})}function R(l,c){return void 0===c&&(c={}),_.__awaiter(this,void 0,void 0,function(){var e,i,n,s,r,o,a;return _.__generator(this,function(t){switch(t.label){case 0:return e=c.dopocitat,i=c.ibaOptimize,n=c.sel,i?[3,2]:[4,f.RDialog.show(v.createElement(z,{ttgpid:l,dopocitat:e,sel:n}))];case 1:if("test"==(s=t.sent()))return document.getElementsByClassName("ttonline")[0].previousSibling.ASC_gjsc.app.ClickTest(),[2];if("gener"!=s)return[2];t.label=2;case 2:return r=v.createRef(),[4,f.RDialog.show(v.createElement(T,{ttgpid:l,result_ref:r,dopocitat:e,ibaOptimize:i,sel:n}))];case 3:return t.sent(),(o=r.current)?(a=0==o.nNeumiestnenych,m.trackTTOEvent("Generator",a?"success":"fail"),[4,f.RDialog.show(v.createElement(O,{ttgpid:l,result:o}))]):[2];case 4:return t.sent(),[2]}})})}function I(t){var e=Math.round(t/1e3),i=""+e%60;return i.length<2&&(i="0"+i),Math.floor(e/60)+":"+i}function D(t){var e=v.useRef(Date.now()).current,i=v.useState(0),n=i[0],s=i[1];return v.useEffect(function(){var t=setInterval(function(){return s(Date.now()-e)},100);return function(){return clearInterval(t)}},[]),v.createElement(v.Fragment,null,I(n))}function O(t){var e=t.ttgpid,i=t.result,n=f.useReq(),s=n.ttls(1760),r=c;i.nZliav&&(s+=" ("+n.ttls(3226)+")",r=d),0<i.nNeumiestnenych&&(s=n.ttls(2764),r=p);var o={width:230},a=i.chyby||[];return 0==a.length&&(a=null),t.showChyby||(a=null),v.createElement(f.RDialog,{header:s,width:a?700:500,height:a?400:void 0},v.createElement("div",{style:{padding:10}},v.createElement("img",{src:r,style:{float:"right"}}),v.createElement(f.RLabel,{text:n.ttls(2761),style:o}),I(i.time),v.createElement("br",null),v.createElement(f.RLabel,{text:n.ttls(2762),style:o}),i.tries,v.createElement("br",null),v.createElement(f.RLabel,{text:n.ttls(2760),style:o}),i.nZliav,v.createElement("br",null),v.createElement(f.RLabel,{text:n.ttls(2770),style:o}),i.nNeumiestnenych,v.createElement("br",null),a&&v.createElement(v.Fragment,null,v.createElement(f.VGap,{height:25}),v.createElement("div",{style:{fontSize:20}},n.ttls(1616),":"))),a&&v.createElement(l.default,{ttgpid:e,chyby:a}))}function x(t){var e=t.checked,i=t.vertical,n=f.useHover(),s=n[0],r=n[1],o={},a={};return i?o={display:"inline-block",textAlign:"center",marginRight:10,width:95,padding:10}:(o={padding:5,marginBottom:10},a={verticalAlign:"middle",marginRight:10}),v.createElement("div",_.__assign({},r,{onClick:t.onClick,style:_.__assign({whiteSpace:"pre",cursor:"pointer",boxSizing:"border-box",border:"1px solid "+(e||s?"#3399ff":"#acacac"),background:e?"#b4cff5":void 0},o)}),v.createElement("img",{src:t.icon,style:a}),i&&v.createElement("br",null),t.title)}function P(t){return v.createElement("span",{style:{position:"absolute",right:5,top:5,cursor:"pointer",color:"#000080"},onClick:function(){return window.open(t.url,"_blank")}},"?")}function E(t){var e=t.sel,i=f.useReq();return v.createElement("span",{style:{fontWeight:"bold"}},i.ls(8056)+": "+i.lsf(1910,{n:e.length}))}function z(t){var e=this,i=f.useReq(),n=t.ttgpid,s=t.dopocitat,r=t.sel,o=y.useTTUIDocItemDlgState(n,"globals","1",{needed_part:{globals:["settings"]},needed_combos:{globals:["settings"]},blank:{settings:{}}}),a=o.dbi,l=o.dlgRow,c=o.rowRef,d=o.doApply,m=o.rdlg,u=o.rdlgProps,p=f.subRef(c,"settings"),h=p.read()||{};return v.createElement(f.RDialog,_.__assign({},u,{header:s?i.ttls(1614):i.ttls(1424),width:600,buttons:["cancel"],footer:r&&v.createElement(E,{ttgpid:n,sel:r})}),v.createElement("div",null,v.createElement("div",{style:{height:60}},v.createElement("span",{style:{float:"right"}},v.createElement(f.RButton,{style:{width:200},label:i.ttls(1611),type:"blue",onClick:function(){return m.confirmClose("test")}}))),v.createElement("div",{style:{height:90,textAlign:"center"}},v.createElement(f.RButton,{style:{width:270,height:50},label:i.ttls(1125),type:"green",onClick:function(){return _.__awaiter(e,void 0,void 0,function(){return _.__generator(this,function(t){switch(t.label){case 0:return[4,d()];case 1:return t.sent(),m.confirmClose("gener"),[2]}})})}})),v.createElement("div",{style:{display:"flex",flexDirection:"row",height:150}},v.createElement(b.RGroupBox,{title:i.ttls(1336),style:{position:"relative",width:330}},v.createElement(P,{url:"https://help.asctimetables.com/text.php?id=111"}),(a.column("globals","settings","m_nZlozitostGener").comboDB||[]).map(function(t){return Array.isArray(t)?null:v.createElement(x,{key:t.id,vertical:!0,title:t.name,icon:t.icon,checked:t.id==""+h.m_nZlozitostGener,onClick:function(){return f.subRef(p,"m_nZlozitostGener").write(parseInt(t.id))}})})),v.createElement(b.RGroupBox,{title:i.ttls(1419),style:{position:"relative",marginLeft:10,width:230}},v.createElement(P,{url:"https://help.asctimetables.com/text.php?id=113"}),v.createElement(x,{title:i.ttls(3072),icon:"/timetable/pics/app/office/gener_relax_32.png",checked:h.m_bAllowZlavnenie,onClick:function(){return f.subRef(p,"m_bAllowZlavnenie").write(!0)}}),v.createElement(x,{title:i.ttls(3073),checked:!h.m_bAllowZlavnenie,icon:"/timetable/pics/app/office/gener_strict_32.png",onClick:function(){return f.subRef(p,"m_bAllowZlavnenie").write(!1)}}))),v.createElement(f.VGap,{height:10}),v.createElement("div",null,i.ttls(3607)),v.createElement(g.DBIField,{dlgRow:l,column:"settings",subcolumn:"m_nCoGenerovat"})))}t.showAssignClassrooms=function(n){return _.__awaiter(this,void 0,void 0,function(){var e,i;return _.__generator(this,function(t){switch(t.label){case 0:return e=s.client_req,[4,r.showChooseOption({title:e.ttls(4370),options:[_.__assign({id:"add"},o(e.ttls(4371))),_.__assign({id:"optimize"},o(e.ttls(4372))),_.__assign({id:"improve"},o(e.ttls(4373)))]})];case 1:switch(i=t.sent(),i){case"add":return[3,2];case"optimize":return[3,4];case"improve":return[3,6]}return[3,8];case 2:return[4,h(n,{tcg:m.TypCoGenerovat.TCG_UCEBNE_LOCKPRIRADENE})];case 3:return t.sent(),[3,8];case 4:return[4,h(n,{tcg:m.TypCoGenerovat.TCG_UCEBNE})];case 5:return t.sent(),[3,8];case 6:return[4,a(n)];case 7:return t.sent(),[3,8];case 8:return[2]}})})},t.showImprove=a,t.showMiniGenerDlg=h,t.doTTGener=k,t.ProgressIndicator=w,t.showOptimizeDlg=A,t.showStartGenerDlg=R,t._hotswap=[z,S,T,O]}),ASC.setModuleSourceFunc("/timetable/app/server/generator.js",function(t,require,e){e.implementRpc(["listTTGenerators_local","listTTGenerators_global","scTTGeneratorFind","runTTVerification","rozExportDownloadLink","ttdocDbForGen","generatorStart","generatorPing","generatorStop","testStart","testPing","testStop"])}),ASC.setModuleSourceFunc("/timetable/app/chybygrid.js",function(t,require,e){var i;t.__esModule=!0;var a=require("tslib"),n=require("./rozview"),l=require("../../asc/datatable_r"),c=require("react"),d=require("../../rpr/dbi_react"),m=require("../../asc/asc_react"),u=require("./ttdoc"),p=((i={})[n.CHYBAITEMIKONA.CHYBAITEMIKONA_CHYBA]="/timetable/pics/app/bug_small_16.png",i[n.CHYBAITEMIKONA.CHYBAITEMIKONA_OK]="/timetable/pics/app/ok_small_16.png",i[n.CHYBAITEMIKONA.CHYBAITEMIKONA_OPTIMIZE]="/timetable/pics/app/importance_optimize_16.png",i[n.CHYBAITEMIKONA.CHYBAITEMIKONA_WARNING]="/timetable/pics/app/warning_32.png",i);function h(t){var e=t.icon;return e?c.createElement("img",{src:e,style:{height:16}}):null}function _(t){return{table:t[0],id:1[1]}}t.default=function(t){var e=m.useReq(),n=d.useTTUIDocDBI(t.ttgpid,{needed_part:{classes:["__name"],teachers:["__name"],classrooms:["__name"],subjects:["__name"],students:["__name","classid"],termsdefs:["__name","vals"],weeksdefs:["__name","vals"],daysdefs:["__name","vals"],periods:["__name"],lessons:["subjectid","classids","seminargroup","groupnames","terms"],cards:["lessonid","weeks","days","period"]}}),i=c.useState([]),s=i[0],r=i[1],o=[];return t.chyby.forEach(function(t,e){var n="*"+e;o.push(a.__assign(a.__assign({},t),{id:n})),s.includes(n)&&t.m_ZgrcnuteChyby.forEach(function(t,e){var i=n+":"+e;o.push(a.__assign(a.__assign({},t),{id:i}))})}),c.createElement(l.RDatatable,{style:t.style,data:o,cssClass:"compact light-theme",fitWidth:!0,columns:[{key:"zgrc",width:16,label:" ",formatter:function(t){var e=t.row;if(0<=e.id.indexOf(":"))return c.createElement("img",{src:"/global/pics/ui/tree_sub.png"});if(!e.m_ZgrcnuteChyby)return null;var i=s.includes(e.id);return c.createElement("img",{src:i?"/global/pics/ui/tree_minus.png":"/global/pics/ui/tree_plus.png",style:{cursor:"pointer"},onClick:function(){r(i?s.filter(function(t){return t!=e.id}):a.__spreadArrays(s,[e.id]))}})}},{key:"icon",width:16,label:" ",formatter:function(t){var e=t.row;if(!e.m_pKde)return"";var i=n.table(e.m_pKde[0]);return i?c.createElement(h,{icon:i.icon()}):"???"}},{key:"object",width:170,label:e.ttls(3181),formatter:function(t){var e=t.row;return n.mock?null:u.getUINazov2(n,_(e.m_pKde),_(e.m_pKde2),"BHSN")}},{key:"icon2",width:16,label:" ",formatter:function(t){var e=t.row;return c.createElement(h,{icon:p[e.m_nIkona]})}},{key:"description",width:500,label:e.ttls(1276),resizable:!0,formatter:function(t){return t.row.m_Text}}]})}}),ASC.setModuleSourceFunc("/timetable/app/test.js",function(t,require,e){t.__esModule=!0;var k=require("tslib"),C=require("../../asc/asc_react"),S=require("react"),n=require("../../asc/edurequest"),T=require("./gener"),w=require("../../asc/asc_react2"),A=require("../../rpr/dbi_react"),R=require("./server/generator"),I=require("./ttdoc"),D=require("../../rpr/dbi"),u=require("./rokobject"),O=["globals","classes","teachers","subjects","students"];function x(v,b,g,y){return void 0===y&&(y=null),k.__awaiter(this,void 0,void 0,function(){var e,i,n,s,r,o,a,l,c,d,m,u,p,h,_,f=this;return k.__generator(this,function(t){switch(t.label){case 0:(e=function(t){})("STARTING"),n=i=void 0,s=b.onPing||function(){},r=b.onAsk||function(){return k.__awaiter(f,void 0,void 0,function(){return k.__generator(this,function(t){return[2,"m_bSkip"]})})},l=a=!(o={fail_parts:[],list:[]}),c=null,t.label=1;case 1:return[4,R.testStart(y,v,{action:i,action_object:n,engineid:b.engineid})];case 2:d=t.sent(),t.label=3;case 3:t.trys.push([3,,12,13]),m=0,t.label=4;case 4:return[4,function(e){return new Promise(function(t){return setTimeout(t,e)})}(500)];case 5:if(t.sent(),g.current)return[3,14];t.label=6;case 6:return t.trys.push([6,9,,10]),e("PINGING"),[4,R.testPing(y,d)];case 7:return u=t.sent(),e(u),m=0,p=u.data,u.part_globals_fail&&(o.fail_parts=D.idsArrayMergeUnique(o.fail_parts,["globals"])),"ask"==u.status&&(o.fail_parts=D.idsArrayMergeUnique(o.fail_parts,[p.detail_part])),h=k.__assign(k.__assign({},p),{fail_parts:o.fail_parts,list:k.__spreadArrays(o.list,p.list)}),b.onPing&&s(h),"generating"==u.status?[3,10]:"finished"==u.status?[3,14]:"hint"==u.status?(l=!0,c=u.object,[3,14]):("ask"!=u.status&&ASC.dieError("7920673696"),R.testStop(y,d),d=null,n=u.object,i="m_bSkip",o.list=k.__spreadArrays(o.list,p.list),a=!0,[4,r(n,u.left)]);case 8:return"m_bEsteRaz"!=(i=t.sent())&&"m_bSkip"!=i&&"m_bTestWithHint"!=i?[3,14]:[3,13];case 9:return _=t.sent(),console.log(_),100<++m?(ASC.logProblem("0763883526"),[3,11]):(b.onError&&b.onError(""+_),[3,10]);case 10:return[3,4];case 11:return[3,13];case 12:return e("STOPPING"),d&&R.testStop(y,d),[7];case 13:return[3,1];case 14:return[2,{fail:a,hint:l,object:c}]}})})}t.doTTTest=x,t.showTestDlg=function(i){return k.__awaiter(this,void 0,void 0,function(){var e;return k.__generator(this,function(t){switch(t.label){case 0:return e=n.client_req,[4,C.RDialog.showConfirm(S.createElement("span",{style:{whiteSpace:"pre-wrap"}},e.ttls(1799)),{msgType:"warn"})];case 1:return t.sent()&&C.RDialog.show(S.createElement(s,{app:i})),[2]}})})};var P="/timetable/pics/app/office/ok_48.png",E="/timetable/pics/app/office/no_48.png",z="/timetable/pics/app/office/question_48.png";function G(t){var e=t.stav;if("running"==e)return S.createElement("i",{className:"fa fa-spinner fa-pulse",style:k.__assign({width:48,height:48,fontSize:48,color:"#e0e0e0"},t.style||{})});var i="";return"ok"==e&&(i=P),"fail"==e&&(i=E),"question"==e&&(i=z),S.createElement("img",{src:i,style:k.__assign({width:48,height:48,visibility:i?void 0:"hidden"},t.style||{})})}function s(t){function o(){d.current=!0,i.current.close()}var e=this,a=t.app,l=a.ttgpid,c=C.useReq(),i=S.useRef(),d=S.useRef(!1),n=A.useTTUIDocDBI(l,{needed_part:{classes:["__name"],teachers:["__name"],subjects:["__name"],classrooms:["__name"],students:["__name"]}}),s=S.useState(""),r=s[0],m=s[1],u=S.useState(!0),p=u[0],h=u[1],_=S.useState({global_pos:0,detail_part:"globals",detail:"",detail_pos:0,finished_parts:[],fail_parts:[],list:[]}),f=_[0],v=_[1];S.useEffect(function(){I.trackTTOEvent("TestProgressDlg","TestProgressDlg.opened"),k.__awaiter(e,void 0,void 0,function(){var e,i,n,s,r=this;return k.__generator(this,function(t){switch(t.label){case 0:return t.trys.push([0,4,,5]),[4,x(l,{onPing:function(t){return v(t)},onAsk:function(i,n){return k.__awaiter(r,void 0,void 0,function(){var e;return k.__generator(this,function(t){switch(t.label){case 0:return[4,C.RDialog.show(S.createElement(j,{app:a,object:i,left:n}))];case 1:return"show"==(e=t.sent())?(o(),[2,"cancel"]):[2,e]}})})}},d)];case 1:return e=t.sent(),h(!1),d.current?[2]:e.hint?[4,a.SyncNow()]:[3,3];case 2:return t.sent(),o(),i=a.m_pRok.object2ro(e.object),a.SelectRiadok(i),a.ScrollToRiadok(i),a.ClickVerification("verification"),[2];case 3:return n=c.ttls(1807),e.fail&&(n=c.ttls(1808)),C.RDialog.showMessage(n,{width:400,msgType:e.fail?"fail":"success"}),[3,5];case 4:return s=t.sent(),m(""+s),d.current=!0,[3,5];case 5:return[2]}})})},[]);function b(t){if("globals"==t)return c.ttls(1803);var e=n.table(t);return e?e.name():""}var g=S.useRef();S.useLayoutEffect(function(){g.current&&(g.current.scrollTop=1e6)},[f.list.length]);var y=0<f.fail_parts.filter(function(t){return"globals"!=t}).length?"fail":"ok";return p&&(y="running"),S.createElement(C.RDialog,{ref:i,header:c.ttls(1368),width:500,height:500,onCancel:function(){return o()},onConfirm:function(){return o()},buttons:p?[{label:c.ttls(1783),onClick:function(){return d.current=!0}}]:["ok"==y?{type:"green",label:c.ttls(1090),onClick:function(){o(),a.ClickGenerate()}}:null,"close"]},S.createElement("div",{style:{display:"flex",flexDirection:"row"}},S.createElement("div",{style:{flex:"1 1 0px",marginRight:10}},S.createElement("div",{style:{}},c.ttls(1369)),S.createElement(T.ProgressIndicator,{pos:f.global_pos})),S.createElement(G,{stav:y})),S.createElement(w.SeparatorLine,null),S.createElement("div",null,S.createElement(C.RLabel,{text:p&&b(f.detail_part)}),S.createElement(T.ProgressIndicator,{pos:f.detail_pos,style:{display:"inline-block",width:250,verticalAlign:"middle"}}),S.createElement("br",null),S.createElement(C.RLabel,{text:p&&f.detail}),S.createElement(T.ProgressIndicator,{pos:f.detail_pos,style:{display:"inline-block",width:250,verticalAlign:"middle"}}),S.createElement("br",null)),S.createElement(w.SeparatorLine,null),S.createElement("div",{style:{display:"flex",flexDirection:"row"}},O.map(function(t){var e="";return f.finished_parts.includes(t)&&(e="ok"),f.fail_parts.includes(t)&&(e="globals"==t?"question":"fail"),f.detail_part==t&&p&&(e="running"),S.createElement("div",{key:t,style:{flex:"1 1 0px",textAlign:"center"}},S.createElement(G,{stav:e}),S.createElement(C.VGap,{height:4}),b(t))})),S.createElement("div",{ref:g,style:{marginTop:10,flex:"1 1 0px",minHeight:0,border:"1px solid #e0e0e0",overflowY:"auto",overflowX:"hidden",padding:3}},f.list.map(function(t,e){var i={hc:P,xr:E,sc:E,oc:z}[t.type];return S.createElement("div",{key:e,style:{whiteSpace:"nowrap",marginBottom:2}},i&&S.createElement("img",{src:i,style:{verticalAlign:"middle",marginRight:5,height:16}}),t.text)})),r&&S.createElement("div",{style:{color:"red"}},r))}function j(t){function s(t){I.trackTTOEvent("TestAskDlg","TestAskDlg."+t)}var e=this,n=t.app,r=t.object,o=t.left,i=n.dbi,a=C.useReq();S.useEffect(function(){return s("opened")},[]);var l=i.rowName(r.table,r.id),c="There is a problem in %1.";switch(r.table){case"classes":c=a.ttls(1784);break;case"teachers":c=a.ttls(1788);break;case"subjects":c=a.ttls(1794);break;case"classrooms":c=a.ttls(2780);break;case"students":c=a.ttls(3964)}c=c.replace("%1",l);var d=S.useRef(),m=S.useCallback(function(t){var e=C.useHover(),i=e[0],n=e[1];return S.createElement("td",k.__assign({},n,{colSpan:t.colSpan,rowSpan:t.rowSpan,onClick:t.onClick||function(){s(t.action),d.current.confirmClose(t.action)},style:k.__assign({padding:15,border:"1px solid #c0c0c0",backgroundColor:i?"#ffeea3":"#f0f0f0",width:200,cursor:"pointer"},t.style||{})}),S.createElement("img",{src:"/timetable/pics/app/"+t.icon,style:{verticalAlign:"middle",marginRight:10}}),t.text)},[]);return S.createElement(C.RDialog,{ref:d,buttons:["cancel"],width:700},S.createElement("div",{style:{fontWeight:"bold",textAlign:"center",marginTop:10,whiteSpace:"pre-line"}},c,S.createElement(C.VGap,{height:15}),a.ttls(1249)+" "+o.length),S.createElement("table",{style:{borderCollapse:"separate",borderSpacing:30}},S.createElement("tbody",null,S.createElement("tr",null,S.createElement(m,{text:a.ttls(3078),icon:"standard/inspect_64.png",colSpan:2,style:{textAlign:"center"},onClick:function(){return k.__awaiter(e,void 0,void 0,function(){var e,i;return k.__generator(this,function(t){switch(t.label){case 0:return s("show"),d.current.confirmClose("show"),e=n.m_pRok.object2ro(o[0]),i=n.m_pRok.object2ro(r),[4,n.SyncNow()];case 1:return t.sent(),n.OdhodKartu(),n.SelectRiadok(i),n.ScrollToRiadok(i),e instanceof u.CKarta&&(n.ChytKartu(e,i),n.m_bTahanaDajKontrolu=!0),[2]}})})}})),S.createElement("tr",null,S.createElement(m,{text:a.ttls(3080),icon:"standard/refresh_32.png",action:"m_bEsteRaz"}),S.createElement(m,{text:a.ttls(3082),icon:"standard/skip_32.png",action:"m_bSkip",rowSpan:2})),S.createElement("tr",null,S.createElement(m,{text:a.ttls(3081),icon:"office/gener_relax_32.png",action:"m_bTestWithHint"})),S.createElement("tr",null,S.createElement(m,{text:a.ttls(3083),icon:"office/help_32.png",onClick:function(){s("help"),window.open("https://help.asctimetables.com/text.php?id=130","_blank")}}),S.createElement(m,{text:a.ttls(3084),icon:"office/no_32.png",action:"cancel"})))))}t._hotswap=[s,j]});