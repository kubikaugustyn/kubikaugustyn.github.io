"use strict";ASC.loadBundle("dbi"),ASC.loadBundle("subst"),ASC.loadBundle("ttonline"),ASC.setModuleSourceFunc("/timetable/ttviewer.js",function(e,require,t){e.__esModule=!0;var Me=require("tslib"),je=require("../asc/edurequest"),ze=require("../asc/asc_react"),Ne=require("../rpr/dbi"),Le=require("react"),Pe=require("./currenttt"),He=require("../asc/actions"),Ge=require("./regulartt"),qe=require("../asc/lib_date"),Oe=require("react-dom"),We=require("../asc/asc_react2"),Ye=require("./server/ttviewer"),l=require("../asc/datatable_r"),s=require("../rpr/dbi_react");function n(e){var t=this,f=je.client_req,n=e.fitheight,r=e.kiosk;ze.useTTLang();var g=ze.useResponsiveLevel(),a=["classes","teachers","students","classrooms","igroups","subjects"],p=f.loggedUser;if(("Admin"==p||a.indexOf(Ne.DBITools.user2rowid(p).table)<0)&&(p=""),!p){var i=f.isStudentOrParent();i&&(p="Student"+i)}function l(){x("current")}function s(e){D(null),x("regular"),S(e)}var o=Le.useState(e.user||p),h=o[0],_=o[1],b=Ne.DBITools.user2rowid(h),v="*"==b.id?b.table+"_summary":b.table,u=f.timezone_date(),c=Le.useState(e.date||e.week&&f.lib_date.week_start(e.week)||u),d=c[0],m=c[1],w=Le.useState(e.num?"regular":"current"),y=w[0],x=w[1],k=Le.useState(e.num||""),E=k[0],S=k[1],T=Le.useState(null),C=T[0],D=T[1];Le.useEffect(function(){D(null)},[d,h]);var R=Le.useState(),A=R[0],B=R[1],I=Le.useState(null),V=I[0],F=I[1],M=Le.useState({}),j=M[0],z=M[1],N=f.lib_date.date_week(d),L=f.lib_date.date_week(u),P=f.lib_date.week_delta(L,-2),H=f.lib_date.week_start(N),G=f.lib_date.week_end(N),q=f.getSchoolYear(G),O=ze.useAsyncMemo(function(){return Ye.getTTViewerData(null,q)},[q],null),W=ze.useLocalState("CurrentTTViewer.showColor",!O||O.defaults.showColors),Y=W[0],U=W[1],$=Le.useState(!0),K=$[0],X=$[1],J=Le.useState(!1),Q=J[0],Z=J[1],ee=function(e){var t=Le.useState(void 0),n=t[0],r=t[1];return[void 0===n?e:n,r]}(!!O&&O.defaults.timeMode),te=ee[0],ne=ee[1],re=Le.useState(!0),ae=re[0],ie=re[1],le=Le.useState(!1),se=le[0],oe=le[1];Le.useEffect(function(){n&&barWndResize()},[O]);var ue=Le.useState(0),ce=ue[0],de=ue[1],me=Le.useState(0),fe=me[0],ge=me[1],pe=Le.useRef(),he=Le.useCallback(function(){var e=pe.current;e&&(de(e.scrollLeft),ge(e.scrollTop))},[]),_e=Le.useRef();if(ze.useDomReader(he),!O)return Le.createElement(ze.Loading,null);if("regular"==y&&"igroups_summary"==v&&_(""),"current"==y&&(O.current.allow||s(O.regular.default_num),"classes_summary"!=v&&"teachers_summary"!=v&&"classrooms_summary"!=v||_("")),!h&&V&&j.classes){var be=V.tableIds("classes")[0];be&&_("Trieda"+be)}var ve="Kruzok*",we=[{text:f.ls(1637),onclick:Je},[],{text:f.ls(1190),onclick:Qe}],ye=[];if("current"==y&&V&&(0<ye.length&&ye.push([]),ye.push({text:f.ttls(1009),checked:Y,onclick:function(){return U(!Y)}}),ye.push({text:f.ls(1489)+": "+f.ls(2322),checked:K,onclick:function(){return X(!K)}}),"classes"==b.table&&0<V.tableData("igroups").length&&ye.push({text:f.ls(1489)+": "+V.table("igroups").name(),checked:Q,onclick:function(){return Z(!Q)}}),ye.length&&ye.push([]),ye.push({text:f.ls(6399),checked:!te,onclick:function(){return ne(!1)}}),ye.push({text:f.ls(1345),checked:te,onclick:function(){return ne(!0)}})),"regular"==y&&ae&&(0<ye.length&&ye.push([]),ye.push({text:f.ttls(1009),checked:!se,onclick:function(){return oe(!se)}})),h&&(ye.length&&ye.push([]),ye.push({text:He.action_name("print"),onclick:function(){return Me.__awaiter(t,void 0,void 0,function(){var t,n;return Me.__generator(this,function(e){switch(e.label){case 0:return _e.current?(_e.current(),[2]):[4,Promise.resolve().then(function(){return require("../dashboard/printSheet")})];case 1:return t=e.sent().PrintSheet,n=f.ls(1001)+" - "+V.rowName(b.table,b.id),"regular"==y&&(n=f.ls(8735)),ze.RDialog.show(Le.createElement(t,{renderer:function(){return null},asDialog:!0,filename:n},Ve(!0))),[2]}})})}})),O&&O.regular.default_num&&O.current.allow&&(ye.push([]),ye.push({text:f.ls(8735),onclick:function(){"regular"==y?l():s(O.regular.default_num)},checked:"regular"==y})),ye.push([]),ye.push({text:ASC.ls(1248),onclick:function(){var e="https://"+ASC.edupage+".edupage.org/timetable/view.php",t=[];"regular"==y?E&&t.push("num="+E):N!=L&&t.push("week="+N),b.table&&("*"==b.id?t.push("summary="+b.table):t.push(Ne.DBITools.removeEs(b.table)+"="+b.id)),prompt(ASC.ls(1248)+":",e+"?"+t.join("&"))}}),f.hasRight("timetable")){var xe=Me.__spreadArrays(we);xe.push([]),xe.push({text:f.ls(1687),onclick:Xe}),0<ye.length&&ye.push([]),ye.push({text:f.ls(2340),submenu:xe})}if(f.isAdmin()||f.isUcitel()){var ke="";"de"==f.lang&&(ke="https://help.edupage.org/text.php?id=3161&lang=de"),"sk"!=f.lang&&"cz"!=f.lang||(ke="https://help.edupage.org/text.php?id=3161&lang=sk"),ke&&(ye.push([]),ye.push({text:He.action_name("help"),onclick:function(){return window.open(ke,"_blank")}}))}if(O.asklogin){var Ee=f.ls(4788);return f.loggedUser||(Ee=Le.createElement(Le.Fragment,null,f.ls(2853),Le.createElement(ze.VGap,{height:20}),Le.createElement(ze.RButton,{label:f.ls(1012),onClick:function(){return document.location.href="/login/"},type:"green"}))),Le.createElement(Le.Fragment,null,Ee,Le.createElement(Ke,{style:{marginTop:50}}))}var Se=[];if("regular"==y&&V)for(var Te=function(e){if(!j[e+"_summary"])return"continue";Se.push({text:V.table(e).name(),checked:b.table==e&&"*"==b.id,onclick:function(){return _(Ne.DBITools.rowid2user(e,"*"))}})},Ce=0,De=["classes","teachers","classrooms"];Ce<De.length;Ce++){Te(De[Ce])}function Re(e){var t=e.dbi,n=e.rights,r=e.colorsEnabled;t&&F(t),n&&z(n),"regular"==y&&null!=r&&ie(r),_e.current=e.print}var Ae={},Be=void 0;h||(Be=Le.createElement(Le.Fragment,null,Le.createElement("i",{className:"fa fa-reply fa-rotate-90"}),Le.createElement(ze.HGap,{width:20}),(j.classes||O.allow_my_items.classes)&&Le.createElement(Le.Fragment,null,f.ls(6801),"..."))),"regular"!=y||E||0!=O.regular.timetables.filter(function(e){return!e.hidden}).length||(Be=Le.createElement(Le.Fragment,null,0<O.regular.timetables.filter(function(e){return e.year==q}).length?f.ls(1759):f.ls(1644)+" ("+f.getSchoolYearName(q)+")",f.hasRight("timetable")&&Le.createElement(Le.Fragment,null,Le.createElement(ze.VGap,{height:30}),Le.createElement(ze.RButton,{label:f.ls(1687),onClick:Xe,type:"green"}))));var Ie=[];N!=L&&Ie.push({text:f.ls(1733),onclick:function(){return m(f.lib_date.week_start(L))}}),O.regular.default_num&&!r&&(0<Ie.length&&Ie.push([]),Ie.push({text:f.ls(8735),onclick:function(){return s(O.regular.default_num)}}));var Ve=function(e){return void 0===e&&(e=!1),"regular"==y?Le.createElement(Ge.RegularTTView,{tt_num:E,oblast:v,id:b.id,disableColors:se,style:{flex:"1 1 0px"},fit:!0,buildButtonsPortal:e?void 0:function(e){if(A)return Oe.createPortal(e.map(function(e,t){return Array.isArray(e)?Le.createElement(ze.HGap,{key:t,width:5}):Le.createElement(Ue,{key:t,text:e.text,icon:e.icon,onClick:e.onclick})}),A)},setViewData:e?void 0:Re}):Le.createElement(Pe.CurrentTTView,{table:b.table,id:b.id,datefrom:H,dateto:G,showColors:Y,showIgroupsInClasses:Q,showOrig:K,showCurrentTime:!e,showHeader:!0,time_mode:te,onTTItemClick:e?void 0:function(e){return D(e)},selectedTTItem:e?void 0:C,setViewData:e?void 0:Re,style:e?void 0:{flex:"1 1 0px",minWidth:100},scrollPos:e?void 0:[ce,fe],print:e})},Fe=O&&O.regular.timetables.find(function(e){return e.tt_num==E});return Le.createElement("div",{id:n?"fitheight":void 0,style:Me.__assign({display:"flex",flexDirection:"column",boxSizing:"border-box",minHeight:100,height:0==g?"80vh":n?300:650,background:"#ffffff"},e.style||{})},Le.createElement("div",{style:{display:"flex",flexDirection:"row",marginBottom:10,whiteSpace:"pre",overflowX:"auto",overflowY:"hidden"}},O.allow_my_user&&Le.createElement(Ue,{text:f.ls(3883),selected:""!=h&&h==O.allow_my_user,style:{marginRight:15},onClick:function(){return _(O.allow_my_user)}}),V&&a.map(function(r){if(!j[r]&&!O.allow_my_items[r])return null;if("regular"==y&&"igroups"==r)return null;var e=V.tableData(r).map(function(e){return Ne.DBITools.rowApplyChanges(e,G)});if("teachers"==r&&(e=e.filter(function(e){return!e.expired})),!j[r]){if(!O.allow_my_items[r])return null;e=e.filter(function(e){return O.allow_my_items[r].includes(e.id)})}function a(e,t){var n=V.rowData(r,e);return{text:ASC.escapeHTML(V.rowName(r,n.id,f.sort_name_col)+(t||"")),onclick:function(){return _(Ne.DBITools.rowid2user(r,n.id))},CSS_CLASS_NAME:n.cb_hidden?"item-old":"",checked:r==b.table&&n.id==b.id}}var i=[];if("students"==r){var n=ASC.lang_getLocale(),l=Me.__spreadArrays(e);l.sort(function(e,t){return V.rowName(r,e.id,f.sort_name_col).localeCompare(V.rowName(r,t.id,f.sort_name_col),n)});for(var t=function(t){var n=!1,e=l.filter(function(e){return e.classid==t}).map(function(e){var t=a(e.id);return n=n||t.checked,t});if(0==e.length)return"continue";i.push({text:V.rowName("classes",t),submenu:e,checked:n})},s=0,o=V.tableIds("classes");s<o.length;s++){t(o[s])}var u=l.map(function(e){return a(e.id,e.classid&&" ("+V.rowName("classes",e.classid)+")")});i.push([]),i.push({text:f.ls(2824),submenu:u})}else i=Ne.DBITools.splitItemsForCombo(e).map(function(e){return a(e.id)}),"igroups"==r&&1<V.tableData(r).length&&j.igroups_summary&&(i.push([]),i.push({text:f.ls(1349),checked:h==ve,onclick:function(){return _(ve)}}));if(0==e.length)return null;var c=v==r&&h!=p;"igroups"==r&&"igroups_summary"==v&&(c=!0);var d=void 0,m=V.table(r).name();return 1<=g&&(m=void 0,d=V.table(r).icon()),Le.createElement(Ue,{key:r,text:m,icon:d,selected:c,menu:i})}),0<Se.length&&Le.createElement(Ue,{text:0==g?f.ls(1250):void 0,icon:0==g?void 0:"/timetable/pics/app/office/schedule_32.png",title:f.ls(1250),menu:Se,selected:"*"==b.id}),Le.createElement("span",{ref:function(e){return B(e)},style:{marginLeft:10,display:"flex",flexDirection:"row",minWidth:0,flexShrink:1}}),f.hasRight("timetable")&&0==g&&Le.createElement(Le.Fragment,null,Le.createElement(ze.HGap,{width:5}),Le.createElement(Ue,{text:He.action_name("customize"),icon:"/global/pics/ui/tools.svg",menu:Me.__spreadArrays(we)}),Le.createElement(Ue,{text:f.ls(2340),icon:"/global/pics/ui/timetables_48.svg",onClick:Xe})),Le.createElement("span",{style:{flex:1}}),"regular"==y?Le.createElement(Le.Fragment,null,Le.createElement(Ue,{text:Fe&&Fe.hidden?Fe.text:f.ls(8735),style:Ae,menu:r?void 0:Me.__spreadArrays(O.regular.timetables.filter(function(e){return!e.hidden}).map(function(e){return{text:e.text,checked:e.tt_num==E,onclick:function(){return s(e.tt_num)}}}),f.isAdmin()||f.hasRight("timetable")||f.hasRight("ttadminview")||f.isUcitel()&&!f.hasRight("limited")?[{text:f.ls(8044)+"...",onclick:function(){return Me.__awaiter(t,void 0,void 0,function(){var t;return Me.__generator(this,function(e){switch(e.label){case 0:return[4,ze.RDialog.show(Le.createElement(Ze,null))];case 1:return(t=e.sent())&&s(t),[2]}})})}}]:[],O.current.allow?[[],{text:f.ls(6204),onclick:function(){return l()}}]:[]),enabled:!0})):Le.createElement(Le.Fragment,null,P<N&&Le.createElement(Ue,{text:0==g?"<<":"<",style:Ae,onClick:function(){return m(qe.date_delta(H,-1))}}),Le.createElement(Ue,{text:N==L?f.ls(1733):f.lib_date.date_format_2dates(H,G,0==g),style:Ae,menu:Ie,enabled:!0}),Le.createElement(Ue,{text:0==g?">>":">",style:Ae,onClick:function(){return m(qe.date_delta(G,1))}})),!r&&Le.createElement(Ue,{text:Le.createElement("i",{className:"fa fa-caret-down"}),style:Me.__assign(Me.__assign({},Ae),{color:"#808080"}),menu:ye})),Be&&Le.createElement(Le.Fragment,null,Le.createElement("div",{style:{minHeight:0,flex:"1 1 0px",padding:15,fontSize:16,color:"#a0a0a0",boxSizing:"border-box",display:h?"none":void 0}},Be),Le.createElement(Ke,{style:{padding:20}})),Le.createElement("div",{style:{display:Be?"none":"flex",flexDirection:"row",minHeight:0,flex:"1 1 0px"}},Le.createElement("div",{ref:pe,onScroll:he,style:{display:"flex",flex:"1 1 0px",overflow:"auto",position:"relative"}},Ve()),C&&Le.createElement(Le.Fragment,null,Le.createElement(We.VSeparatorLine,{height:"auto"}),Le.createElement($e,{ttitem:C,dbi:V,style:{width:250,marginRight:10},onClose:function(){return D(null)}}))))}function Ue(t){var e=ze.useHoverWithMenu(),n=e[0],r=e[1],a=e[2],i=Le.createRef(),l=t.text,s=t.icon,o=t.title,u=t.selected,c=!(!t.onClick&&!t.menu),d=t.enabled;return null==d&&(d=c),Le.createElement("span",Me.__assign({ref:i},r,{title:o||("string"==typeof l?l:""),style:Me.__assign({background:d&&(n||u)?"#E3F2FD":void 0,padding:"10px 15px",borderTop:"2px solid "+(u?"#2196F3":"rgba(0,0,0,0)"),cursor:c?"pointer":void 0,textTransform:"uppercase",fontSize:12,fontWeight:u?"bold":void 0,color:d?"#333":"#ccc",flexShrink:1,minWidth:10,overflow:"hidden",textOverflow:"ellipsis"},t.style||{}),onClick:function(e){t.onClick?t.onClick(e):t.menu&&a(t.menu,e.currentTarget)},onMouseDown:function(e){return e.preventDefault()}}),s&&Le.createElement("img",{src:s,style:{maxHeight:16,filter:d?void 0:"grayscale(100%) opacity(50%)",marginRight:l?5:void 0,verticalAlign:"middle"}}),l)}function $e(e){var t=e.ttitem,n=e.dbi,r=e.onClose,a=e.inDlg||!1,i=je.client_req,l=t.type,s=t.date,o=t.attached,u=i.ls(1301),c="/global/pics/ui/subject_32.svg";switch(l){case"event":u=i.ls(1831),c="/global/pics/ui/events_32.svg";break;case"classroomsupervision":u=i.ls(1723);break;case"absent":u=i.ls(1846),c="/global/pics/ui/subst_32.svg";break;case"subst_duty":u=i.localize("{tt:1471} ({1003})"),c="/substitution/pics/must_be_32.svg"}function d(e,t){return n.tools.itemName(e)+": "+n.rowNames(e,t)}var m,f,g=Le.useCallback(function(e){return Le.createElement("div",{style:Me.__assign({fontSize:16,marginBottom:5},e.style||{})},e.children)},[]),p=n.tools.ttitem_popis(t);return Le.createElement("div",{style:Me.__assign({position:"relative",background:"#ffffff"},e.style||{})},Le.createElement(We.DlgHeader,{title:u,inDlg:a,icon:c,small:!0}),r&&Le.createElement("i",{className:"fa fa-times",style:{position:"absolute",right:0,top:0,cursor:"pointer",fontSize:16,color:"#a0a0a0"},onClick:r}),Le.createElement(g,null,i.lib_date.date_format_day(s,!1)),t.starttime&&Le.createElement(g,null,i.lib_date.date_format_time0(t.starttime,{ajSekundy:!1})+"-"+i.lib_date.date_format_time0(t.endtime,{ajSekundy:!1})),Le.createElement(ze.VGap,{height:15}),t.name&&Le.createElement(g,null,t.name),t.subjectid&&Le.createElement(g,null,(m="subjects",f=t.subjectid,d(m,f?[f]:[]))),p.class&&Le.createElement(g,null,n.tools.itemName(t.igroupid?"igroups":"classes")+": "+p.class),0<t.teacherids.length&&Le.createElement(g,null,d("teachers",t.teacherids)),0<t.classroomids.length&&Le.createElement(g,null,d("classrooms",t.classroomids)),t.studentids&&0<t.studentids.length&&t.studentids.length<=3&&Le.createElement(g,null,d("students",t.studentids)),o&&Le.createElement(Le.Fragment,null,Le.createElement(ze.VGap,{height:10}),o.map(function(e,t){return Le.createElement(g,{style:{background:"#ffff80"}},e.name)})))}function Ke(e){ze.useReq();return null}function Xe(){document.location.href="/timetable/admin.php"}function Je(){ASC.ASC_action("/gcall",{gadget:"TimetableVersionAdmin",action:"settings",gsh:ASC.gsechash})}function Qe(){ASC.ASC_action("/gcall",{gadget:"TimetableVersionAdmin",action:"rights",gsh:ASC.gsechash})}function r(e){var t=ze.useReq();return Le.createElement(ze.RDialog,{width:1150,height:750,buttons:["close"],header:t.ls(1001)},Le.createElement(n,Me.__assign({},e)))}function Ze(e){var t=ze.useReq(),n=s.useMainDBI(t.getSchoolYear(),{needed_part:{timetables:["stav","name","year","datefrom","dateto","filetime_int","_uial"]},needed_combos:{timetables:["stav"]}}),r=n.tableData("timetables").filter(function(e){return 0<e._uial});r.sort(function(e,t){return t.filetime_int-e.filetime_int});var a=n.table("timetables"),i=ze.useStateValueRef("");return Le.createElement(ze.RDialog,{onConfirm:function(e){return e.confirmClose(i.read())},width:700,height:400,buttons:[{label:t.ls(1489),action:"view",type:i.read()?"green":void 0},"cancel"]},Le.createElement(l.RDatatable,{data:r,dbi:n,dbi_table:"timetables",cssClass:"light-theme",columns:["stav","year","name","datefrom","dateto"].map(function(e){return{key:e,type:"dbi_textValue",label:a.column(e).name(),width:{name:200,stav:100}[e]||80}}),fitWidth:!0,selectedIdRef:i,idcol:"id"}))}(e.TTViewer=n).needed_part=Ne.typed({teachers:["__name","cb_hidden","expired"],classes:["__name"],classrooms:["__name"],igroups:["__name"],students:["__name","classid"],subjects:["__name"]}),e.TopButton=Ue,e.showTTViewerDlg=function(t){return Me.__awaiter(this,void 0,void 0,function(){return Me.__generator(this,function(e){return ze.RDialog.show(Le.createElement(r,Me.__assign({},t))),[2]})})},e._hotswap=[r,Ze]}),ASC.setModuleSourceFunc("/timetable/currenttt.js",function(e,require,t){e.__esModule=!0;var J=require("tslib"),Q=require("react"),Z=require("../asc/edurequest"),ee=require("../asc/asc_react"),te=require("../rpr/dbi_react"),ne=require("../asc/lib_date"),re=require("../substitution/online/timetable"),ae=require("./server/currenttt"),ie=require("./ttview_components"),le=require("../rpr/dbi"),se=require("./ttviewer"),oe={ttitems:[],rights:{}};e.CurrentTTView=function(e){var t,i=Z.client_req,a=e.table,n=e.id,r=e.datefrom,l=e.dateto,s=e.showColors,o=e.showIgroupsInClasses,u=e.showOrig,c=e.showCurrentTime,d=e.showHeader,m=e.onTTItemClick,f=e.selectedTTItem,g=e.scrollPos,p=e.time_mode,h=e.print,_=i.getSchoolYear(l),b=ee.useClientWidth(),v=b[0],w=b[1],y=ee.useResponsiveLevel(),x=Q.useState(""),k=x[0],E=x[1];Q.useEffect(function(){if(c){var e=function(){return E(i.lib_date.timezone_datetime())};e();var t=setInterval(e,5e3);return function(){return clearInterval(t)}}E("")},[c]);var S=te.useMainDBI(_,{needed_part:le.DBITools.mergeNeededParts(se.TTViewer,{subjects:["name","short"],teachers:["firstname","lastname","short"],classes:["__name"],igroups:["__name"],classrooms:["name","short"],events:["typ","name"],event_types:["name"],subst_absents:["date","absent_typeid","groupname"],periods:["__name","period","starttime","endtime"],dayparts:["starttime","endtime"],dates:["tt_num","tt_day"]}),vt_filter:{datefrom:r,dateto:l}}),T=ee.useAsyncMemo(function(){return ae.curentttGetData(null,{datefrom:r,dateto:l,table:a,id:n,showColors:s,showIgroupsInClasses:o,showOrig:u})},[r,l,a,n,s,o,u],oe,[a]);Q.useEffect(function(){e.setViewData&&T!=oe&&e.setViewData({dbi:S,rights:A})},[S,T.rights]);var C=T.ttitems,D=T.swapAxis,R=T.error,A=T.rights,B=T.week_name,I=ne.date_interval_array(r,l).filter(function(e){if(i.getSchoolYear(e)!=_)return!1;if(i.lib_date.timezone_isWeekend(e)){for(var t=0,n=C;t<n.length;t++){var r=n[t];if(r.date==e){if(r.eventid){var a=S.rowData("events",r.eventid);if(a&&("holiday"==a.typ||"sholiday"==a.typ))continue}return!0}}return!1}return!0}),V=7,F=45,M=80,j=110,z=v-M-0-1;D?(M=(t=[F,M])[0],F=t[1],j=150,z=800,V=6,h&&(j=Math.min(j,(v-F-1)/I.length))):z=Math.max(z,p?600:50*S.tableData("periods").length);var N,L=j*I.length,P=0;d&&("*"==n?N=S.table(a).name():(N=S.rowName(a,n),S.rowData(a,n)||"students"==a&&n==i.isStudentOrParent()&&(N=i.ls(3883))),P=37);var H=re.makeTLR(S,null,"dates",p||!1,z,F);H.qSide=18,H.gap=2;var G=0,q=0;if(g){var O=D?1:0,W=[g[0],Math.max(0,g[1]-P)];G=W[O],q=W[1-O]}var Y={x1:M+0,x2:M+0+z,y1:F+0,y2:F+0+L},U={x1:Y.x1+G,x2:Y.x2+1,y1:Y.y1+q,y2:Y.y2+1},$={x1:M+0,x2:M+0+z,y1:q,y2:F+q},K={x1:G,x2:M+G,y1:F+0,y2:F+0+L},X={x1:K.x1,x2:K.x2,y1:$.y1,y2:$.y2};return Q.createElement(Q.Fragment,null,Q.createElement("div",{ref:w,style:J.__assign({color:"#000",backgroundColor:"#fff",fontFamily:"sans-serif"},e.style||{}),className:"print-nobreak"},d&&Q.createElement("div",{style:{fontSize:0==y?32:26,whiteSpace:"pre",textAlign:"center",height:P,position:"relative",width:ee.swapBox(U,D).x2}},Q.createElement("span",{className:"print-font-resizable"},N)),R||Q.createElement("div",{style:{position:"relative",height:ee.swapBox(Y,D).y2+1}},Q.createElement(ie.TTView_Periods,{dbi:S,periodsBox:$,tlr:H,swap:D,showTime:!0,periods:T.periods}),Q.createElement(ie.TTView_OuterLines,{outerBox:ee.swapBox(U,D)}),Q.createElement(ee.RBox,J.__assign({},ee.swapBox(Y,D),{style:{overflow:"visible"}}),I.map(function(t,e){var n=e*j,r={x1:0,x2:z,y1:n,y2:n+j};return Q.createElement(ie.TTView_TTDay,{key:t,dbi:S,box:r,gap_day:V,table:a,tlr:H,ttitems:S.mock?[]:C.filter(function(e){return e.date==t}),onTTItemClick:m,selectedTTItem:f,swapAxis:D,showTime:k.substr(0,10)==t?k.substr(11):""})})),Q.createElement(ee.RBox,J.__assign({},ee.swapBox(K,D),{style:{background:"#fff"}}),I.map(function(e,t){var n=j*t,r={x1:0,x2:M,y1:n,y2:n+j};return Q.createElement(ie.TTView_Day,{key:e,date:e,box:r,splitLineTop:0<t,swap:D})})),B&&Q.createElement(ee.RTextBox,J.__assign({},ee.swapBox(X,D),{text:B,vAlign:"center",hAlign:"center",style:{fontSize:12,background:"#fff"}})))))}}),ASC.setModuleSourceFunc("/timetable/server/currenttt.js",function(e,require,t){t.implementRpc(["curentttGetData"])}),ASC.setModuleSourceFunc("/timetable/regulartt.js",function(e,require,t){e.__esModule=!0;var T=require("tslib"),C=require("react"),D=require("../asc/asc_react"),R=require("../rpr/dbi"),A=require("./server/regulartt"),B=require("./app/rokobject"),I=require("./app/print");function V(e,t){for(var n=0,r=e.tableData("ttreports");n<r.length;n++){var a=r[n];if("teachers_summary"==t&&6==a.typ)return a.id;if("classes_summary"==t&&5==a.typ)return a.id;if("classrooms_summary"==t&&7==a.typ)return a.id;if(a.page_tables.includes(t))return a.id}return""}e.RegularTTView=function(t){var e=t.tt_num,a=t.oblast,i=t.id,n=t.buildButtonsPortal,l=t.disableColors,r=D.useClientSize(),s=r[0],o=r[1],u=r[2],c=C.useRef(),d=C.useState(0),m=d[0],f=d[1],g=C.useState(t.fit?-1:4),p=g[0],h=g[1],_=D.useReq(),b=D.useAsyncMemo(function(){return A.regularttGetData(null,e)},[e],{rights:{}}),v=C.useMemo(function(){return b.dbiAccessorRes?R.ClientDBI.fromAccessorResult(_,b.dbiAccessorRes):null},[b]),w=C.useMemo(function(){if(!v)return[];var e=function(e){var t=new B.CRok;for(var n in B.ttapp_needed_part)if(t.m_ObjectsI[n])for(var r=0,a=e.tableData(n);r<a.length;r++){var i=a[r];t.addRow(n,i),t.dbi.addRow(n,i)}return t.StructureFromData(),t}(v),t=V(v,a);if(!t)return[];var n={};i&&(n[a]=[i]);var r=e.m_ObjectsI.ttreports[t];return r.m_bTTViewerDisableCardColor=!!l,r.Render({filter:n,m_bTTViewer:!1})},[v,l,a,i]);C.useEffect(function(){m>=w.length&&f(0)},[m,w]);var y=w[m];C.useEffect(function(){if(t.setViewData&&b){var e=v?v.rowData("ttreports",V(v,a)):null;t.setViewData({dbi:v,rights:b.rights,colorsEnabled:!!e&&e.cardcolorenabled,print:function(){return I.printPagesPrint([y])}})}},[b,v,a,y]);var x=p;y&&p<0&&(x=10*Math.min(s/y.width,o/y.height)),C.useEffect(function(){var e=$j(c.current);if(e.empty(),y){y.$sheet=e;var t=x;y.RenderSheet(e,t,!1)}else e.text(_.ls(8467))},[m,w,x]);var k=[];1<w.length&&(k.push({icon:"/timetable/pics/app/office/preview_back_32.png",onclick:0<m?function(){return f(m-1)}:void 0}),k.push({icon:"/timetable/pics/app/office/preview_forward_32.png",onclick:m+1<w.length?function(){return f(m+1)}:void 0}));var E=-1,S=-1;return[2,3,4,6,10].forEach(function(e){e<x/1.1&&(S=e),1.1*x<e&&E<0&&(E=e)}),0<k.length&&k.push([]),k.push({icon:"/global/pics/ui/zoom_plus_32.png",onclick:0<E?function(){return h(E)}:void 0}),k.push({icon:"/global/pics/ui/zoom_minus_32.png",onclick:0<S?function(){return h(S)}:void 0}),0<p&&k.push({text:_.ls(1915),onclick:function(){return h(-1)}}),C.createElement(C.Fragment,null,C.createElement("div",{ref:u,className:"print-nobreak",style:T.__assign({position:"relative",overflow:"auto"},t.style||{})},C.createElement("div",{ref:c,style:{marginLeft:"auto",marginRight:"auto",position:"relative"}})),n&&n(k))},e.ttviewdbi=function(t,r,a){return T.__awaiter(this,void 0,void 0,function(){var n=this;return T.__generator(this,function(e){return[2,R.ClientDBI.newInstance(t,function(t){return T.__awaiter(n,void 0,void 0,function(){return T.__generator(this,function(e){return[2,A.ttviewDBIAccessor(null,r,t)]})})},a)]})})}}),ASC.setModuleSourceFunc("/timetable/server/regulartt.js",function(e,require,t){t.implementRpc(["regularttGetData","ttviewDBIAccessor"])}),ASC.setModuleSourceFunc("/timetable/server/ttviewer.js",function(e,require,t){t.implementRpc(["getTTViewerData"])});